(()=>{var t={21019:(t,e,o)=>{"use strict";var i=o(93811),n=o(95665),r=o(38085),s=o(30827),a=function(t,e,o,i){var n,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,o,s):n(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};const l=o(80460),d=r.SHARED_COMPONENTS_INTERNAL.PopupToolboxMenu,c=d.TAG;class h extends s.y{constructor(){super(),this.components=[r.SHARED_COMPONENTS.MarkElementToolbar.TAG],this.currentMark=null}onMarkDeleted(){return t=this,e=void 0,i=function*(){try{const t=this.currentMark?this.currentMark:{_id:this.markId};(0,r.hideMarker)(t),(0,r.deleteMarkFromDom)(t)}catch(t){}},new((o=void 0)||(o=Promise))(function(n,r){function s(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,a)}l((i=i.apply(t,e||[])).next())});var t,e,o,i}get markElementToolbarProps(){var t;return{markId:this.markId,mark:null!==(t=this.currentMark)&&void 0!==t?t:null,isLoading:!this.currentMark,chromeSettings:this.chromeSettings,notesWereToggled:!1,tagsWereToggled:!1,readOnly:!1,enabledFeatures:{changeColor:!0,deleteMark:!0,toggleNotes:!1,toggleTags:!1,copyToClipboard:!0,sidebarToggle:!0,mediaTypes:!this.currentMark||(0,r.shouldShowMediaDropdown)(this.currentMark)}}}render(){return i.html`
      <div
        class="menu-container"
        tabindex="0"
        data-testid=${r.SHARED_COMPONENTS_INTERNAL.PopupToolboxMenu.TEST_IDS.MENU_CONTAINER}
      >
        <webhighlights-mark-element-toolbar
          class="header-toolbar"
          part="header-toolbar"
          data-testid=${d.TEST_IDS.MARK_ELEMENT_TOOLBAR}
          @deleted=${this.onMarkDeleted}
          .props=${this.markElementToolbarProps}
        ></webhighlights-mark-element-toolbar>
      </div>
    `}}h.styles=i.css`
    ${(0,i.unsafeCSS)(l)}
  `,a([(0,n.property)()],h.prototype,"chromeSettings",void 0),a([(0,n.property)({type:String})],h.prototype,"markId",void 0),a([(0,n.property)()],h.prototype,"currentMark",void 0),customElements.define(c,h)},25045:(t,e,o)=>{"use strict";o.r(e),o.d(e,{default:()=>a});var i=o(36758),n=o.n(i),r=o(40935),s=o.n(r)()(n());s.push([t.id,':host{font-family:var(--wh-font-family);box-sizing:border-box}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.wh-loading-skeleton{color:rgba(0,0,0,0);opacity:.8;animation:1.25s linear 0s infinite normal none running loadingBlinking;background:var(--wh-skeleton-bg);border-radius:4px;position:relative;overflow:hidden}.wh-loading-skeleton::after{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg, transparent, var(--wh-skeleton-bg-hover), transparent);animation:skeleton-shimmer 2s infinite}@keyframes loadingBlinking{0%{background:var(--wh-skeleton-bg)}70%{background:var(--wh-skeleton-bg-hover)}100%{background:var(--wh-skeleton-bg-strong)}}@keyframes skeleton-shimmer{0%{left:-100%}100%{left:100%}}:host{z-index:9999 !important}:host{color:#fff;height:18px;margin:-10px auto 0px auto;margin-bottom:100px}.menu-container{z-index:9999 !important}.menu-container{color:var(--wh-gray-200);display:flex;display:flex;gap:12px;padding:0px 8px;justify-content:space-between;align-items:center}.menu-container webhighlights-recent-colors:not(.keep-open){display:none}.menu-container:hover webhighlights-recent-colors{display:block}.header-toolbar{--wh-toolbar-icon-size: 18px}',""]);const a=s},30827:(t,e,o)=>{"use strict";o.d(e,{y:()=>r});var i=o(38085),n=o(93811);class r extends n.LitElement{constructor(){super(...arguments),this.components=[],this.subscriptions=[]}connectedCallback(){super.connectedCallback(),(0,i.lazyDefine)(this.components)}disconnectedCallback(){super.disconnectedCallback(),this.unsubscribe()}unsubscribe(){this.subscriptions.forEach(t=>{t.unsubscribe()})}static define(t,e,o){(0,i.defineWebHighlightsElement)(t,e,o)}}},36758:t=>{"use strict";t.exports=function(t){return t[1]}},38085:t=>{"use strict";t.exports=WebHighlightsSharedLibExternal},40935:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var o="",i=void 0!==e[5];return e[4]&&(o+="@supports (".concat(e[4],") {")),e[2]&&(o+="@media ".concat(e[2]," {")),i&&(o+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),o+=t(e),i&&(o+="}"),e[2]&&(o+="}"),e[4]&&(o+="}"),o}).join("")},e.i=function(t,o,i,n,r){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(i)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(s[l]=!0)}for(var d=0;d<t.length;d++){var c=[].concat(t[d]);i&&s[c[0]]||(void 0!==r&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=r),o&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=o):c[2]=o),n&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=n):c[4]="".concat(n)),e.push(c))}},e}},80460:(t,e,o)=>{var i=o(25045);i&&i.__esModule&&(i=i.default),t.exports="string"==typeof i?i:i.toString()},84916:(t,e,o)=>{"use strict";o.r(e),o.d(e,{default:()=>a});var i=o(36758),n=o.n(i),r=o(40935),s=o.n(r)()(n());s.push([t.id,":host{font-family:var(--wh-font-family);box-sizing:border-box}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}:host{z-index:9999 !important;visibility:visible !important}:host{position:absolute;left:0;display:flex;justify-content:center;height:0px;line-height:14px;cursor:default}.popup-toolbox-container{display:flex;justify-content:center;width:-moz-max-content;width:max-content}.popup-toolbox-container .notes-container{display:flex;justify-content:start}.popup-toolbox-container .toolbox-menu{z-index:9999 !important}.popup-toolbox-container .toolbox-menu{overflow:hidden;min-width:-moz-fit-content;min-width:fit-content;min-height:-moz-fit-content;min-height:fit-content;display:flex;justify-content:center;opacity:0;animation:slideOut 300ms forwards;visibility:hidden;transition:opacity 300ms,visibility 300ms}.popup-toolbox-container .toolbox-menu.slideIn{visibility:visible !important;opacity:1 !important;animation:slideIn 300ms forwards !important}.popup-toolbox-container .toolbox-menu.slideIn{overflow:visible}.popup-toolbox-container .toolbox-menu.slideOut{visibility:hidden !important;opacity:0 !important;animation:slideOut 300ms forwards !important}@keyframes slideIn{100%{-webkit-transform:translate(0%, -100%)}0%{-webkit-transform:translate(0%, -300%)}}@keyframes slideOut{100%{-webkit-transform:translate(0%, -300%)}0%{-webkit-transform:translate(0%, -100%)}}@keyframes slideInFromBottom{100%{-webkit-transform:translate(0%, 30%)}0%{-webkit-transform:translate(0%, 100%)}}@keyframes slideOutToBottom{100%{-webkit-transform:translate(0%, 100%)}0%{-webkit-transform:translate(0%, 30%)}}.notes-container.slideIn{animation:slideInFromBottom 300ms forwards !important;visibility:visible !important;opacity:1 !important}.notes-container.slideOut{animation:slideOutToBottom 300ms forwards !important;visibility:hidden !important;opacity:0 !important}.notes-container{position:absolute;width:340px;display:flex;justify-content:center;flex-wrap:wrap;background:var(--wh-bg-base);box-shadow:var(--wh-shadow);border-radius:4px;padding:6px;transition:opacity 300ms,visibility 300ms}webhighlights-notes-editor{width:100%}webhighlights-tags{padding-bottom:4px}webhighlights-toolbox-editor{border-radius:4px}",""]);const a=s},93811:t=>{"use strict";t.exports=LitExternal},94741:(t,e,o)=>{var i=o(84916);i&&i.__esModule&&(i=i.default),t.exports="string"==typeof i?i:i.toString()},95665:t=>{"use strict";t.exports=LitDecoratorsExternal}},e={};function o(i){var n=e[i];if(void 0!==n)return n.exports;var r=e[i]={id:i,exports:{}};return t[i](r,r.exports,o),r.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t=o(38085),e=o(93811),i=o(95665),n=(o(21019),o(30827)),r=function(t,e,o,i){var n,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,o,s):n(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};const s=o(94741),a=t.SHARED_COMPONENTS.PopupToolbox;class l extends n.y{constructor(){super(),this.show=!1,this.loaded=!0,this.abortHide=!1,this.animation="slideIn",this.components=[t.SHARED_COMPONENTS.NotesEditor.TAG,t.SHARED_COMPONENTS.Tags.TAG],this.subscriptions=[t.notifications.subscribe("updatedMark",this.onUpdatedMark.bind(this)),t.notifications.subscribe("deletedMark",this.onDeletedMark.bind(this)),t.notifications.subscribe("updatedChromeSettings",this.onChromeSettingsChanged.bind(this))]}applyStyles(){var e,o;const i=null!==(o=null===(e=this.shadowRoot)||void 0===e?void 0:e.host)&&void 0!==o?o:this.parentElement;(0,t.applyCssVariables)(i,t.defaultLayout.compact)}updated(t){t.has("show")&&this.show&&(this.loadMark(),this.applyStyles())}onDeletedMark(t){var e;(null===(e=this.mark)||void 0===e?void 0:e._id)===t.detail._id&&(this.show=!1)}onChromeSettingsChanged(t){this.updateChromeSettings(Object.assign({},t.detail))}updateChromeSettings(t){this.chromeSettings=t}loadMark(){return e=this,o=void 0,n=function*(){var e,o,i;if((!this.currentMark||this.currentMark._id!==(null===(e=this.mark)||void 0===e?void 0:e._id))&&(null===(o=this.mark)||void 0===o?void 0:o._id)){this.currentMark=null,this.loaded=!1;const{db:e}=(0,t.useContext)(),[o,n]=yield Promise.all([e.getEntityById({_id:null===(i=this.mark)||void 0===i?void 0:i._id,_objectStore:t.ObjectStoreNameSyncable.marks}),e.getChromeSettings()]);this.chromeSettings=n,this.currentMark=o,this.loaded=!0}},new((i=void 0)||(i=Promise))(function(t,r){function s(t){try{l(n.next(t))}catch(t){r(t)}}function a(t){try{l(n.throw(t))}catch(t){r(t)}}function l(e){var o;e.done?t(e.value):(o=e.value,o instanceof i?o:new i(function(t){t(o)})).then(s,a)}l((n=n.apply(e,o||[])).next())});var e,o,i,n}get notesEditorProps(){const e=!this.currentMark;return{content:(0,t.resolveNotesContentOfMark)(this.currentMark),focused:!e,isLoading:e,editable:!e,onUpdate:e=>{if(this.currentMark){const o={notes:e,_id:this.currentMark._id};(0,t.updateMark)(o),this.mark=Object.assign(Object.assign({},this.mark),o)}}}}onUpdatedMark(t){var e,o;const i=t.detail;i._id!==(null===(e=this.mark)||void 0===e?void 0:e._id)&&i._id!==(null===(o=this.currentMark)||void 0===o?void 0:o._id)||(this.currentMark=Object.assign({},i),this.requestUpdate())}tagsChanged(e){if(this.currentMark){const o=e.detail.tags;this.currentMark=Object.assign(Object.assign({},this.currentMark),{tags:o}),(0,t.updateMark)({_id:this.currentMark._id,tags:o})}}render(){var t,o,i,n;return this.show&&(null===(t=this.mark)||void 0===t?void 0:t._id)?e.html`
      <div class="popup-toolbox-container">
        <webhighlights-popup-toolbox-menu
          class="toolbox-menu ${this.animation}"
          .currentMark=${null!==(o=this.currentMark)&&void 0!==o?o:null}
          .markId=${this.mark._id}
          .chromeSettings=${this.chromeSettings}
        ></webhighlights-popup-toolbox-menu>
        <div
          class="notes-container ${this.animation}"
          data-testid="mark-container-notes-container"
        >
          <webhighlights-tags
            .tags=${null!==(n=null===(i=this.currentMark)||void 0===i?void 0:i.tags)&&void 0!==n?n:[]}
            .isLoading=${!this.currentMark}
            @tagsChanged=${this.tagsChanged}
          ></webhighlights-tags>

          <!-- Render twice so that the editor updates when mark is loaded -->
          ${this.currentMark?e.html`
                <webhighlights-notes-editor
                  .props=${this.notesEditorProps}
                  class="notes-editor"
                ></webhighlights-notes-editor>
              `:e.html`<webhighlights-notes-editor
                .props=${this.notesEditorProps}
                class="notes-editor"
              ></webhighlights-notes-editor>`}
        </div>
      </div>
    `:e.html``}}l.styles=e.css`
    ${(0,e.unsafeCSS)(s)}
  `,r([(0,i.property)({type:Boolean})],l.prototype,"show",void 0),r([(0,i.property)({type:Number})],l.prototype,"menuWidth",void 0),r([(0,i.property)({type:Object})],l.prototype,"chromeSettings",void 0),r([(0,i.state)()],l.prototype,"mark",void 0),r([(0,i.state)()],l.prototype,"currentMark",void 0),r([(0,i.state)()],l.prototype,"loaded",void 0),r([(0,i.state)()],l.prototype,"animation",void 0),n.y.define(a.TAG,l)})()})();