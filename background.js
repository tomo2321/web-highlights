/*! For license information please see background.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var i in r)("object"==typeof exports?exports:e)[i]=r[i]}}(self,()=>(()=>{var e={155:e=>{e.exports=function(e,t){return null==e?void 0:e[t]}},186:function(e,t,r){"use strict";var i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(4627)),o=r(3029),s=function(){function e(){}return e.sanitize=function(e,t){var r=function(){};t&&"function"==typeof t.urlSanitizer&&(r=t.urlSanitizer);var i=r(e);return"string"==typeof i?i:o.encodeLink(n.sanitize(e))},e}();t.OpLinkSanitizer=s},275:function(e,t,r){"use strict";var i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var n=r(4171),o=r(1913),s=r(887),a=r(8840),l=r(886),c=r(3029),h=i(r(1439)),u=r(5289),d=r(1915),g="<br/>",f=function(){function e(e,t){var r;this.rawDeltaOps=[],this.callbacks={},this.options=h.assign({paragraphTag:"p",encodeHtml:!0,classPrefix:"ql",inlineStyles:!1,multiLineBlockquote:!0,multiLineHeader:!0,multiLineCodeblock:!0,multiLineParagraph:!0,multiLineCustomBlock:!0,allowBackgroundClasses:!1,linkTarget:"_blank"},t,{orderedListTag:"ol",bulletListTag:"ul",listItemTag:"li"}),r=this.options.inlineStyles?"object"==typeof this.options.inlineStyles?this.options.inlineStyles:{}:void 0,this.converterOptions={encodeHtml:this.options.encodeHtml,classPrefix:this.options.classPrefix,inlineStyles:r,listItemTag:this.options.listItemTag,paragraphTag:this.options.paragraphTag,linkRel:this.options.linkRel,linkTarget:this.options.linkTarget,allowBackgroundClasses:this.options.allowBackgroundClasses,customTag:this.options.customTag,customTagAttributes:this.options.customTagAttributes,customCssClasses:this.options.customCssClasses,customCssStyles:this.options.customCssStyles},this.rawDeltaOps=e}return e.prototype._getListTag=function(e){return e.isOrderedList()?this.options.orderedListTag+"":e.isBulletList()||e.isCheckedList()||e.isUncheckedList()?this.options.bulletListTag+"":""},e.prototype.getGroupedOps=function(){var e=n.InsertOpsConverter.convert(this.rawDeltaOps,this.options),t=s.Grouper.pairOpsWithTheirBlock(e),r=s.Grouper.groupConsecutiveSameStyleBlocks(t,{blockquotes:!!this.options.multiLineBlockquote,header:!!this.options.multiLineHeader,codeBlocks:!!this.options.multiLineCodeblock,customBlocks:!!this.options.multiLineCustomBlock}),i=s.Grouper.reduceConsecutiveSameStyleBlocksToOne(r);return i=(new d.TableGrouper).group(i),(new l.ListNester).nest(i)},e.prototype.convert=function(){var e=this;return this.getGroupedOps().map(function(t){if(t instanceof a.ListGroup)return e._renderWithCallbacks(u.GroupType.List,t,function(){return e._renderList(t)});if(t instanceof a.TableGroup)return e._renderWithCallbacks(u.GroupType.Table,t,function(){return e._renderTable(t)});if(t instanceof a.BlockGroup){var r=t;return e._renderWithCallbacks(u.GroupType.Block,t,function(){return e._renderBlock(r.op,r.ops)})}return t instanceof a.BlotBlock?e._renderCustom(t.op,null):t instanceof a.VideoItem?e._renderWithCallbacks(u.GroupType.Video,t,function(){var r=t;return new o.OpToHtmlConverter(r.op,e.converterOptions).getHtml()}):e._renderWithCallbacks(u.GroupType.InlineGroup,t,function(){return e._renderInlines(t.ops,!0)})}).join("")},e.prototype._renderWithCallbacks=function(e,t,r){var i="",n=this.callbacks.beforeRender_cb;(i="function"==typeof n?n.apply(null,[e,t]):"")||(i=r());var o=this.callbacks.afterRender_cb;return"function"==typeof o?o.apply(null,[e,i]):i},e.prototype._renderList=function(e){var t=this,r=e.items[0];return c.makeStartTag(this._getListTag(r.item.op))+e.items.map(function(e){return t._renderListItem(e)}).join("")+c.makeEndTag(this._getListTag(r.item.op))},e.prototype._renderListItem=function(e){e.item.op.attributes.indent=0;var t=new o.OpToHtmlConverter(e.item.op,this.converterOptions).getHtmlParts(),r=this._renderInlines(e.item.ops,!1);return t.openingTag+r+(e.innerList?this._renderList(e.innerList):"")+t.closingTag},e.prototype._renderTable=function(e){var t=this;return c.makeStartTag("table")+c.makeStartTag("tbody")+e.rows.map(function(e){return t._renderTableRow(e)}).join("")+c.makeEndTag("tbody")+c.makeEndTag("table")},e.prototype._renderTableRow=function(e){var t=this;return c.makeStartTag("tr")+e.cells.map(function(e){return t._renderTableCell(e)}).join("")+c.makeEndTag("tr")},e.prototype._renderTableCell=function(e){var t=new o.OpToHtmlConverter(e.item.op,this.converterOptions).getHtmlParts(),r=this._renderInlines(e.item.ops,!1);return c.makeStartTag("td",{key:"data-row",value:e.item.op.attributes.table})+t.openingTag+r+t.closingTag+c.makeEndTag("td")},e.prototype._renderBlock=function(e,t){var r=this,i=new o.OpToHtmlConverter(e,this.converterOptions).getHtmlParts();if(e.isCodeBlock())return i.openingTag+c.encodeHtml(t.map(function(t){return t.isCustomEmbed()?r._renderCustom(t,e):t.insert.value}).join(""))+i.closingTag;var n=t.map(function(t){return r._renderInline(t,e)}).join("");return i.openingTag+(n||g)+i.closingTag},e.prototype._renderInlines=function(e,t){var r=this;void 0===t&&(t=!0);var i=e.length-1,n=e.map(function(e,t){return t>0&&t===i&&e.isJustNewline()?"":r._renderInline(e,null)}).join("");if(!t)return n;var o=c.makeStartTag(this.options.paragraphTag),s=c.makeEndTag(this.options.paragraphTag);return n===g||this.options.multiLineParagraph?o+n+s:o+n.split(g).map(function(e){return""===e?g:e}).join(s+o)+s},e.prototype._renderInline=function(e,t){return e.isCustomEmbed()?this._renderCustom(e,t):new o.OpToHtmlConverter(e,this.converterOptions).getHtml().replace(/\n/g,g)},e.prototype._renderCustom=function(e,t){var r=this.callbacks.renderCustomOp_cb;return"function"==typeof r?r.apply(null,[e,t]):""},e.prototype.beforeRender=function(e){"function"==typeof e&&(this.callbacks.beforeRender_cb=e)},e.prototype.afterRender=function(e){"function"==typeof e&&(this.callbacks.afterRender_cb=e)},e.prototype.renderCustomWith=function(e){this.callbacks.renderCustomOp_cb=e},e}();t.QuillDeltaToHtmlConverter=f},547:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},581:(e,t,r)=>{var i=r(9261);e.exports=function(e,t){return e&&e.length&&t&&t.length?i(e,t):e}},796:(e,t,r)=>{var i=r(7403),n=r(3316)(i);e.exports=n},886:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(8840),n=r(8735),o=function(){function e(){}return e.prototype.nest=function(e){var t=this,r=this.convertListBlocksToListGroups(e),o=this.groupConsecutiveListGroups(r),s=n.flatten(o.map(function(e){return Array.isArray(e)?t.nestListSection(e):e}));return n.groupConsecutiveElementsWhile(s,function(e,t){return e instanceof i.ListGroup&&t instanceof i.ListGroup&&e.items[0].item.op.isSameListAs(t.items[0].item.op)}).map(function(e){if(!Array.isArray(e))return e;var t=e.map(function(e){return e.items});return new i.ListGroup(n.flatten(t))})},e.prototype.convertListBlocksToListGroups=function(e){return n.groupConsecutiveElementsWhile(e,function(e,t){return e instanceof i.BlockGroup&&t instanceof i.BlockGroup&&e.op.isList()&&t.op.isList()&&e.op.isSameListAs(t.op)&&e.op.hasSameIndentationAs(t.op)}).map(function(e){return Array.isArray(e)?new i.ListGroup(e.map(function(e){return new i.ListItem(e)})):e instanceof i.BlockGroup&&e.op.isList()?new i.ListGroup([new i.ListItem(e)]):e})},e.prototype.groupConsecutiveListGroups=function(e){return n.groupConsecutiveElementsWhile(e,function(e,t){return e instanceof i.ListGroup&&t instanceof i.ListGroup})},e.prototype.nestListSection=function(e){var t=this,r=this.groupByIndent(e);return Object.keys(r).map(Number).sort().reverse().forEach(function(i){r[i].forEach(function(r){var i=e.indexOf(r);t.placeUnderParent(r,e.slice(0,i))&&e.splice(i,1)})}),e},e.prototype.groupByIndent=function(e){return e.reduce(function(e,t){var r=t.items[0].item.op.attributes.indent;return r&&(e[r]=e[r]||[],e[r].push(t)),e},{})},e.prototype.placeUnderParent=function(e,t){for(var r=t.length-1;r>=0;r--){var i=t[r];if(e.items[0].item.op.hasHigherIndentThan(i.items[0].item.op)){var n=i.items[i.items.length-1];return n.innerList?n.innerList.items=n.innerList.items.concat(e.items):n.innerList=e,!0}}return!1},e}();t.ListNester=o},887:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(4204),n=r(8735),o=r(8840),s=function(){function e(){}return e.pairOpsWithTheirBlock=function(e){for(var t,r=[],i=function(e){return!(e.isJustNewline()||e.isCustomEmbedBlock()||e.isVideo()||e.isContainerBlock())},s=function(e){return e.isInline()},a=e.length-1;a>=0;a--){var l=e[a];l.isVideo()?r.push(new o.VideoItem(l)):l.isCustomEmbedBlock()?r.push(new o.BlotBlock(l)):l.isContainerBlock()?(t=n.sliceFromReverseWhile(e,a-1,i),r.push(new o.BlockGroup(l,t.elements)),a=t.sliceStartsAt>-1?t.sliceStartsAt:a):(t=n.sliceFromReverseWhile(e,a-1,s),r.push(new o.InlineGroup(t.elements.concat(l))),a=t.sliceStartsAt>-1?t.sliceStartsAt:a)}return r.reverse(),r},e.groupConsecutiveSameStyleBlocks=function(t,r){return void 0===r&&(r={header:!0,codeBlocks:!0,blockquotes:!0,customBlocks:!0}),n.groupConsecutiveElementsWhile(t,function(t,i){return t instanceof o.BlockGroup&&i instanceof o.BlockGroup&&(r.codeBlocks&&e.areBothCodeblocksWithSameLang(t,i)||r.blockquotes&&e.areBothBlockquotesWithSameAdi(t,i)||r.header&&e.areBothSameHeadersWithSameAdi(t,i)||r.customBlocks&&e.areBothCustomBlockWithSameAttr(t,i))})},e.reduceConsecutiveSameStyleBlocksToOne=function(e){var t=i.DeltaInsertOp.createNewLineOp();return e.map(function(e){if(!Array.isArray(e))return e instanceof o.BlockGroup&&!e.ops.length&&e.ops.push(t),e;var r=e.length-1;return e[0].ops=n.flatten(e.map(function(e,i){return e.ops.length?e.ops.concat(i<r?[t]:[]):[t]})),e[0]})},e.areBothCodeblocksWithSameLang=function(e,t){return e.op.isCodeBlock()&&t.op.isCodeBlock()&&e.op.hasSameLangAs(t.op)},e.areBothSameHeadersWithSameAdi=function(e,t){return e.op.isSameHeaderAs(t.op)&&e.op.hasSameAdiAs(t.op)},e.areBothBlockquotesWithSameAdi=function(e,t){return e.op.isBlockquote()&&t.op.isBlockquote()&&e.op.hasSameAdiAs(t.op)},e.areBothCustomBlockWithSameAttr=function(e,t){return e.op.isCustomTextBlock()&&t.op.isCustomTextBlock()&&e.op.hasSameAttr(t.op)},e}();t.Grouper=s},927:(e,t,r)=>{const i=r(1580),n=r(3142),o=r(7426),s=r(5528),a=r(8227);function l(e,t){for(var r in e)if(Object.keys(t.block).includes(r))return!0;return!1}e.exports=function(e,t=s){return o(function(e,t){var r,o,s,c,h,u=new a;function d(){s=o=new a(["","\n"]),u.append(o),c={}}d();for(var g=0;g<e.length;g++){var f=e[g];if(i(f.insert))for(var p in f.insert)t.embed[p]&&(A(f.attributes),t.embed[p].call(s,f.insert[p],f.attributes));else{var m=f.insert.split("\n");if(l(f.attributes,t)){for(var y=1;y<m.length;y++)for(var b in f.attributes)if(t.block[b]){var T=t.block[b];"object"==typeof T&&(r&&r.type!==b&&(r=null),!r&&T.group&&(r={el:T.group(),type:b,value:f.attributes[p],distance:0},u.append(r.el)),r&&(r.el.append(o),r.distance=0),T=T.line),T.call(o,f.attributes,r),d();break}h=!0}else{for(var _=0;_<m.length;_++)(_>0||h)&&r&&++r.distance>=2&&(r=null),A(f.attributes,e[g+1]&&e[g+1].attributes),s.append(m[_]),_<m.length-1&&d();h=!1}}}return u;function A(e,r){var i=[],o=[];e=e||{};for(var l=s,h={};l._format;){if(h[l._format]=!0,!e[l._format]){for(var u in h)delete c[u];s=l.parent()}l=l.parent()}for(var d in e)if(t.inline[d]){if(c[d]&&c[d]===e[d])continue;r&&e[d]===r[d]?i.push(d):o.push(d),c[d]=e[d]}function g(r){var i=t.inline[r].call(null,e[r]);n(i)&&(i=new a(i)),i._format=r,s.append(i),s=i}i.forEach(g),o.forEach(g)}}(e,t).render())+"\n"}},1073:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildRequestError=t.APIResponseError=t.UnknownHTTPResponseError=t.isHTTPResponseError=t.RequestTimeoutError=t.isNotionClientError=t.ClientErrorCode=t.APIErrorCode=void 0;const i=r(6745);var n,o;!function(e){e.Unauthorized="unauthorized",e.RestrictedResource="restricted_resource",e.ObjectNotFound="object_not_found",e.RateLimited="rate_limited",e.InvalidJSON="invalid_json",e.InvalidRequestURL="invalid_request_url",e.InvalidRequest="invalid_request",e.ValidationError="validation_error",e.ConflictError="conflict_error",e.InternalServerError="internal_server_error",e.ServiceUnavailable="service_unavailable"}(n=t.APIErrorCode||(t.APIErrorCode={})),function(e){e.RequestTimeout="notionhq_client_request_timeout",e.ResponseError="notionhq_client_response_error"}(o=t.ClientErrorCode||(t.ClientErrorCode={}));class s extends Error{}function a(e){return(0,i.isObject)(e)&&e instanceof s}function l(e,t){return a(e)&&e.code in t}t.isNotionClientError=a;class c extends s{constructor(e="Request to Notion API has timed out"){super(e),this.code=o.RequestTimeout,this.name="RequestTimeoutError"}static isRequestTimeoutError(e){return l(e,{[o.RequestTimeout]:!0})}static rejectAfterTimeout(e,t){return new Promise((r,i)=>{const n=setTimeout(()=>{i(new c)},t);e.then(r).catch(i).then(()=>clearTimeout(n))})}}t.RequestTimeoutError=c;class h extends s{constructor(e){super(e.message),this.name="HTTPResponseError";const{code:t,status:r,headers:i,rawBodyText:n}=e;this.code=t,this.status=r,this.headers=i,this.body=n}}const u={[o.ResponseError]:!0,[n.Unauthorized]:!0,[n.RestrictedResource]:!0,[n.ObjectNotFound]:!0,[n.RateLimited]:!0,[n.InvalidJSON]:!0,[n.InvalidRequestURL]:!0,[n.InvalidRequest]:!0,[n.ValidationError]:!0,[n.ConflictError]:!0,[n.InternalServerError]:!0,[n.ServiceUnavailable]:!0};t.isHTTPResponseError=function(e){return!!l(e,u)};class d extends h{constructor(e){var t;super({...e,code:o.ResponseError,message:null!==(t=e.message)&&void 0!==t?t:`Request to Notion API failed with status: ${e.status}`}),this.name="UnknownHTTPResponseError"}static isUnknownHTTPResponseError(e){return l(e,{[o.ResponseError]:!0})}}t.UnknownHTTPResponseError=d;const g={[n.Unauthorized]:!0,[n.RestrictedResource]:!0,[n.ObjectNotFound]:!0,[n.RateLimited]:!0,[n.InvalidJSON]:!0,[n.InvalidRequestURL]:!0,[n.InvalidRequest]:!0,[n.ValidationError]:!0,[n.ConflictError]:!0,[n.InternalServerError]:!0,[n.ServiceUnavailable]:!0};class f extends h{constructor(){super(...arguments),this.name="APIResponseError"}static isAPIResponseError(e){return l(e,g)}}t.APIResponseError=f,t.buildRequestError=function(e,t){const r=function(e){if("string"!=typeof e)return;let t;try{t=JSON.parse(e)}catch(e){return}var r;return(0,i.isObject)(t)&&"string"==typeof t.message&&("string"==typeof(r=t.code)&&r in g)?{...t,code:t.code,message:t.message}:void 0}(t);return void 0!==r?new f({code:r.code,message:r.message,headers:e.headers,status:e.status,rawBodyText:t}):new d({message:void 0,headers:e.headers,status:e.status,rawBodyText:t})}},1187:(e,t,r)=>{var i=r(7379),n=r(547);e.exports=function(e){return"symbol"==typeof e||n(e)&&"[object Symbol]"==i(e)}},1366:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(5289),n=r(2229),o=r(8735),s=r(186),a=function(){function e(){}return e.sanitize=function(t,r){var a={};if(!t||"object"!=typeof t)return a;var l=["bold","italic","underline","strike","code","blockquote","code-block","renderAsBlock"],c=["background","color"],h=t.font,u=t.size,d=t.link,g=t.script,f=t.list,p=t.header,m=t.align,y=t.direction,b=t.indent,T=t.mentions,_=t.mention,A=t.width,v=t.target,w=t.rel,E=t["code-block"],S=l.concat(c,["font","size","link","script","list","header","align","direction","indent","mentions","mention","width","target","rel","code-block"]);if(l.forEach(function(e){var r=t[e];r&&(a[e]=!!r)}),c.forEach(function(r){var i=t[r];i&&(e.IsValidHexColor(i+"")||e.IsValidColorLiteral(i+"")||e.IsValidRGBColor(i+""))&&(a[r]=i)}),h&&e.IsValidFontName(h+"")&&(a.font=h),u&&e.IsValidSize(u+"")&&(a.size=u),A&&e.IsValidWidth(A+"")&&(a.width=A),d&&(a.link=s.OpLinkSanitizer.sanitize(d+"",r)),v&&e.isValidTarget(v)&&(a.target=v),w&&e.IsValidRel(w)&&(a.rel=w),E&&(e.IsValidLang(E)?a["code-block"]=E:a["code-block"]=!!E),g!==i.ScriptType.Sub&&i.ScriptType.Super!==g||(a.script=g),f!==i.ListType.Bullet&&f!==i.ListType.Ordered&&f!==i.ListType.Checked&&f!==i.ListType.Unchecked||(a.list=f),Number(p)&&(a.header=Math.min(Number(p),6)),o.find([i.AlignType.Center,i.AlignType.Right,i.AlignType.Justify,i.AlignType.Left],function(e){return e===m})&&(a.align=m),y===i.DirectionType.Rtl&&(a.direction=y),b&&Number(b)&&(a.indent=Math.min(Number(b),30)),T&&_){var I=n.MentionSanitizer.sanitize(_,r);Object.keys(I).length>0&&(a.mentions=!!T,a.mention=_)}return Object.keys(t).reduce(function(e,r){return-1===S.indexOf(r)&&(e[r]=t[r]),e},a)},e.IsValidHexColor=function(e){return!!e.match(/^#([0-9A-F]{6}|[0-9A-F]{3})$/i)},e.IsValidColorLiteral=function(e){return!!e.match(/^[a-z]{1,50}$/i)},e.IsValidRGBColor=function(e){return!!e.match(/^rgb\(((0|25[0-5]|2[0-4]\d|1\d\d|0?\d?\d),\s*){2}(0|25[0-5]|2[0-4]\d|1\d\d|0?\d?\d)\)$/i)},e.IsValidFontName=function(e){return!!e.match(/^[a-z\s0-9\- ]{1,30}$/i)},e.IsValidSize=function(e){return!!e.match(/^[a-z0-9\-]{1,20}$/i)},e.IsValidWidth=function(e){return!!e.match(/^[0-9]*(px|em|%)?$/)},e.isValidTarget=function(e){return!!e.match(/^[_a-zA-Z0-9\-]{1,50}$/)},e.IsValidRel=function(e){return!!e.match(/^[a-zA-Z\s\-]{1,250}$/i)},e.IsValidLang=function(e){return"boolean"==typeof e||!!e.match(/^[a-zA-Z\s\-\\\/\+]{1,50}$/i)},e}();t.OpAttributeSanitizer=a},1439:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assign=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),n=0;n<t.length;n++){var o=t[n];if(null!=o)for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])}return i}},1580:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},1913:function(e,t,r){"use strict";var i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var n=r(3029),o=r(5289),s=i(r(1439)),a=i(r(8735)),l=r(1366),c={serif:"font-family: Georgia, Times New Roman, serif",monospace:"font-family: Monaco, Courier New, monospace"};t.DEFAULT_INLINE_STYLES={font:function(e){return c[e]||"font-family:"+e},size:{small:"font-size: 0.75em",large:"font-size: 1.5em",huge:"font-size: 2.5em"},indent:function(e,t){var r=3*parseInt(e,10);return"padding-"+("rtl"===t.attributes.direction?"right":"left")+":"+r+"em"},direction:function(e,t){return"rtl"===e?"direction:rtl"+(t.attributes.align?"":"; text-align:inherit"):void 0}};var h=function(){function e(e,t){this.op=e,this.options=s.assign({},{classPrefix:"ql",inlineStyles:void 0,encodeHtml:!0,listItemTag:"li",paragraphTag:"p"},t)}return e.prototype.prefixClass=function(e){return this.options.classPrefix?this.options.classPrefix+"-"+e:e+""},e.prototype.getHtml=function(){var e=this.getHtmlParts();return e.openingTag+e.content+e.closingTag},e.prototype.getHtmlParts=function(){var e=this;if(this.op.isJustNewline()&&!this.op.isContainerBlock())return{openingTag:"",closingTag:"",content:o.NewLine};var t=this.getTags(),r=this.getTagAttributes();!t.length&&r.length&&t.push("span");for(var i=[],s=[],a=function(t){return"img"===t&&!!e.op.attributes.link},l=0,c=t;l<c.length;l++){var h=c[l];a(h)&&i.push(n.makeStartTag("a",this.getLinkAttrs())),i.push(n.makeStartTag(h,r)),s.push("img"===h?"":n.makeEndTag(h)),a(h)&&s.push(n.makeEndTag("a")),r=[]}return s.reverse(),{openingTag:i.join(""),content:this.getContent(),closingTag:s.join("")}},e.prototype.getContent=function(){if(this.op.isContainerBlock())return"";if(this.op.isMentions())return this.op.insert.value;var e=this.op.isFormula()||this.op.isText()?this.op.insert.value:"";return this.options.encodeHtml&&n.encodeHtml(e)||e},e.prototype.getCssClasses=function(){var e=this.op.attributes;if(this.options.inlineStyles)return[];var t=["indent","align","direction","font","size"];return this.options.allowBackgroundClasses&&t.push("background"),(this.getCustomCssClasses()||[]).concat(t.filter(function(t){return!!e[t]}).filter(function(t){return"background"!==t||l.OpAttributeSanitizer.IsValidColorLiteral(e[t])}).map(function(t){return t+"-"+e[t]}).concat(this.op.isFormula()?"formula":[]).concat(this.op.isVideo()?"video":[]).concat(this.op.isImage()?"image":[]).map(this.prefixClass.bind(this)))},e.prototype.getCssStyles=function(){var e=this,r=this.op.attributes,i=[["color"]];return!this.options.inlineStyles&&this.options.allowBackgroundClasses||i.push(["background","background-color"]),this.options.inlineStyles&&(i=i.concat([["indent"],["align","text-align"],["direction"],["font","font-family"],["size"]])),(this.getCustomCssStyles()||[]).concat(i.filter(function(e){return!!r[e[0]]}).map(function(i){var n=i[0],o=r[n],s=e.options.inlineStyles&&e.options.inlineStyles[n]||t.DEFAULT_INLINE_STYLES[n];return"object"==typeof s?s[o]:"function"==typeof s?s(o,e.op):a.preferSecond(i)+":"+o})).filter(function(e){return void 0!==e})},e.prototype.getTagAttributes=function(){if(this.op.attributes.code&&!this.op.isLink())return[];var e=this.makeAttr.bind(this),t=this.getCustomTagAttributes(),r=t?Object.keys(this.getCustomTagAttributes()).map(function(r){return e(r,t[r])}):[],i=this.getCssClasses(),n=i.length?r.concat([e("class",i.join(" "))]):r;if(this.op.isImage())return this.op.attributes.width&&(n=n.concat(e("width",this.op.attributes.width))),n.concat(e("src",this.op.insert.value));if(this.op.isACheckList())return n.concat(e("data-checked",this.op.isCheckedList()?"true":"false"));if(this.op.isFormula())return n;if(this.op.isVideo())return n.concat(e("frameborder","0"),e("allowfullscreen","true"),e("src",this.op.insert.value));if(this.op.isMentions()){var o=this.op.attributes.mention;return o.class&&(n=n.concat(e("class",o.class))),n=o["end-point"]&&o.slug?n.concat(e("href",o["end-point"]+"/"+o.slug)):n.concat(e("href","about:blank")),o.target&&(n=n.concat(e("target",o.target))),n}var s=this.getCssStyles();return s.length&&n.push(e("style",s.join(";"))),this.op.isCodeBlock()&&"string"==typeof this.op.attributes["code-block"]?n.concat(e("data-language",this.op.attributes["code-block"])):(this.op.isContainerBlock()||this.op.isLink()&&(n=n.concat(this.getLinkAttrs())),n)},e.prototype.makeAttr=function(e,t){return{key:e,value:t}},e.prototype.getLinkAttrs=function(){var e=l.OpAttributeSanitizer.isValidTarget(this.options.linkTarget||"")?this.options.linkTarget:void 0,t=l.OpAttributeSanitizer.IsValidRel(this.options.linkRel||"")?this.options.linkRel:void 0,r=this.op.attributes.target||e,i=this.op.attributes.rel||t;return[].concat(this.makeAttr("href",this.op.attributes.link)).concat(r?this.makeAttr("target",r):[]).concat(i?this.makeAttr("rel",i):[])},e.prototype.getCustomTag=function(e){if(this.options.customTag&&"function"==typeof this.options.customTag)return this.options.customTag.apply(null,[e,this.op])},e.prototype.getCustomTagAttributes=function(){if(this.options.customTagAttributes&&"function"==typeof this.options.customTagAttributes)return this.options.customTagAttributes.apply(null,[this.op])},e.prototype.getCustomCssClasses=function(){if(this.options.customCssClasses&&"function"==typeof this.options.customCssClasses){var e=this.options.customCssClasses.apply(null,[this.op]);if(e)return Array.isArray(e)?e:[e]}},e.prototype.getCustomCssStyles=function(){if(this.options.customCssStyles&&"function"==typeof this.options.customCssStyles){var e=this.options.customCssStyles.apply(null,[this.op]);if(e)return Array.isArray(e)?e:[e]}},e.prototype.getTags=function(){var e=this,t=this.op.attributes;if(!this.op.isText())return[this.op.isVideo()?"iframe":this.op.isImage()?"img":"span"];for(var r=this.options.paragraphTag||"p",i=0,n=[["blockquote"],["code-block","pre"],["list",this.options.listItemTag],["header"],["align",r],["direction",r],["indent",r]];i<n.length;i++){var s,l=n[i],c=l[0];if(t[c])return(s=this.getCustomTag(c))?[s]:"header"===c?["h"+t[c]]:[a.preferSecond(l)]}if(this.op.isCustomTextBlock())return(s=this.getCustomTag("renderAsBlock"))?[s]:[r];var h=Object.keys(t).reduce(function(t,r){var i=e.getCustomTag(r);return i&&(t[r]=i),t},{}),u=[["link","a"],["mentions","a"],["script"],["bold","strong"],["italic","em"],["strike","s"],["underline","u"],["code"]];return u.filter(function(e){return!!t[e[0]]}).concat(Object.keys(h).filter(function(e){return!u.some(function(t){return t[0]==e})}).map(function(e){return[e,h[e]]})).map(function(e){return h[e[0]]?h[e[0]]:"script"===e[0]?t[e[0]]===o.ScriptType.Sub?"sub":"sup":a.preferSecond(e)})},e}();t.OpToHtmlConverter=h},1915:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(8840),n=r(8735),o=function(){function e(){}return e.prototype.group=function(e){return this.convertTableBlocksToTableGroups(e)},e.prototype.convertTableBlocksToTableGroups=function(e){var t=this;return n.groupConsecutiveElementsWhile(e,function(e,t){return e instanceof i.BlockGroup&&t instanceof i.BlockGroup&&e.op.isTable()&&t.op.isTable()}).map(function(e){return Array.isArray(e)?new i.TableGroup(t.convertTableBlocksToTableRows(e)):e instanceof i.BlockGroup&&e.op.isTable()?new i.TableGroup([new i.TableRow([new i.TableCell(e)])]):e})},e.prototype.convertTableBlocksToTableRows=function(e){return n.groupConsecutiveElementsWhile(e,function(e,t){return e instanceof i.BlockGroup&&t instanceof i.BlockGroup&&e.op.isTable()&&t.op.isTable()&&e.op.isSameTableRowAs(t.op)}).map(function(e){return new i.TableRow(Array.isArray(e)?e.map(function(e){return new i.TableCell(e)}):[new i.TableCell(e)])})},e}();t.TableGrouper=o},1950:(e,t,r)=>{var i=r(8942)["__core-js_shared__"];e.exports=i},2013:e=>{var t="\\ud800-\\udfff",r="["+t+"]",i="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",n="\\ud83c[\\udffb-\\udfff]",o="[^"+t+"]",s="(?:\\ud83c[\\udde6-\\uddff]){2}",a="[\\ud800-\\udbff][\\udc00-\\udfff]",l="(?:"+i+"|"+n+")?",c="[\\ufe0e\\ufe0f]?",h=c+l+"(?:\\u200d(?:"+[o,s,a].join("|")+")"+c+l+")*",u="(?:"+[o+i+"?",i,s,a,r].join("|")+")",d=RegExp(n+"(?="+n+")|"+u+h,"g");e.exports=function(e){return e.match(d)||[]}},2053:e=>{e.exports=function(e){return e}},2229:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(186),n=function(){function e(){}return e.sanitize=function(t,r){var n={};return t&&"object"==typeof t?(t.class&&e.IsValidClass(t.class)&&(n.class=t.class),t.id&&e.IsValidId(t.id)&&(n.id=t.id),e.IsValidTarget(t.target+"")&&(n.target=t.target),t.avatar&&(n.avatar=i.OpLinkSanitizer.sanitize(t.avatar+"",r)),t["end-point"]&&(n["end-point"]=i.OpLinkSanitizer.sanitize(t["end-point"]+"",r)),t.slug&&(n.slug=t.slug+""),n):n},e.IsValidClass=function(e){return!!e.match(/^[a-zA-Z0-9_\-]{1,500}$/i)},e.IsValidId=function(e){return!!e.match(/^[a-zA-Z0-9_\-\:\.]{1,500}$/i)},e.IsValidTarget=function(e){return["_self","_blank","_parent","_top"].indexOf(e)>-1},e}();t.MentionSanitizer=n},2237:(e,t,r)=>{var i=r(2837),n=r(3417),o=r(2013);e.exports=function(e){return n(e)?o(e):i(e)}},2255:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthIntrospect=t.oauthRevoke=t.oauthToken=t.listComments=t.createComment=t.search=t.createDatabase=t.listDatabases=t.queryDatabase=t.updateDatabase=t.getDatabase=t.appendBlockChildren=t.listBlockChildren=t.deleteBlock=t.updateBlock=t.getBlock=t.getPageProperty=t.updatePage=t.getPage=t.createPage=t.listUsers=t.getUser=t.getSelf=void 0,t.getSelf={method:"get",pathParams:[],queryParams:[],bodyParams:[],path:()=>"users/me"},t.getUser={method:"get",pathParams:["user_id"],queryParams:[],bodyParams:[],path:e=>`users/${e.user_id}`},t.listUsers={method:"get",pathParams:[],queryParams:["start_cursor","page_size"],bodyParams:[],path:()=>"users"},t.createPage={method:"post",pathParams:[],queryParams:[],bodyParams:["parent","properties","icon","cover","content","children"],path:()=>"pages"},t.getPage={method:"get",pathParams:["page_id"],queryParams:["filter_properties"],bodyParams:[],path:e=>`pages/${e.page_id}`},t.updatePage={method:"patch",pathParams:["page_id"],queryParams:[],bodyParams:["properties","icon","cover","archived","in_trash"],path:e=>`pages/${e.page_id}`},t.getPageProperty={method:"get",pathParams:["page_id","property_id"],queryParams:["start_cursor","page_size"],bodyParams:[],path:e=>`pages/${e.page_id}/properties/${e.property_id}`},t.getBlock={method:"get",pathParams:["block_id"],queryParams:[],bodyParams:[],path:e=>`blocks/${e.block_id}`},t.updateBlock={method:"patch",pathParams:["block_id"],queryParams:[],bodyParams:["embed","type","archived","in_trash","bookmark","image","video","pdf","file","audio","code","equation","divider","breadcrumb","table_of_contents","link_to_page","table_row","heading_1","heading_2","heading_3","paragraph","bulleted_list_item","numbered_list_item","quote","to_do","toggle","template","callout","synced_block","table"],path:e=>`blocks/${e.block_id}`},t.deleteBlock={method:"delete",pathParams:["block_id"],queryParams:[],bodyParams:[],path:e=>`blocks/${e.block_id}`},t.listBlockChildren={method:"get",pathParams:["block_id"],queryParams:["start_cursor","page_size"],bodyParams:[],path:e=>`blocks/${e.block_id}/children`},t.appendBlockChildren={method:"patch",pathParams:["block_id"],queryParams:[],bodyParams:["children","after"],path:e=>`blocks/${e.block_id}/children`},t.getDatabase={method:"get",pathParams:["database_id"],queryParams:[],bodyParams:[],path:e=>`databases/${e.database_id}`},t.updateDatabase={method:"patch",pathParams:["database_id"],queryParams:[],bodyParams:["title","description","icon","cover","properties","is_inline","archived","in_trash"],path:e=>`databases/${e.database_id}`},t.queryDatabase={method:"post",pathParams:["database_id"],queryParams:["filter_properties"],bodyParams:["sorts","filter","start_cursor","page_size","archived","in_trash"],path:e=>`databases/${e.database_id}/query`},t.listDatabases={method:"get",pathParams:[],queryParams:["start_cursor","page_size"],bodyParams:[],path:()=>"databases"},t.createDatabase={method:"post",pathParams:[],queryParams:[],bodyParams:["parent","properties","icon","cover","title","description","is_inline"],path:()=>"databases"},t.search={method:"post",pathParams:[],queryParams:[],bodyParams:["sort","query","start_cursor","page_size","filter"],path:()=>"search"},t.createComment={method:"post",pathParams:[],queryParams:[],bodyParams:["parent","rich_text","discussion_id"],path:()=>"comments"},t.listComments={method:"get",pathParams:[],queryParams:["block_id","start_cursor","page_size"],bodyParams:[],path:()=>"comments"},t.oauthToken={method:"post",pathParams:[],queryParams:[],bodyParams:["grant_type","code","redirect_uri","external_account"],path:()=>"oauth/token"},t.oauthRevoke={method:"post",pathParams:[],queryParams:[],bodyParams:["token"],path:()=>"oauth/revoke"},t.oauthIntrospect={method:"post",pathParams:[],queryParams:[],bodyParams:["token"],path:()=>"oauth/introspect"}},2291:(e,t,r)=>{var i=r(5650),n=r(5111),o=r(3142),s=r(1187),a=i?i.prototype:void 0,l=a?a.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(o(t))return n(t,e)+"";if(s(t))return l?l.call(t):"";var r=t+"";return"0"==r&&1/t==-1/0?"-0":r}},2478:(e,t,r)=>{var i=r(7250),n=r(9454),o=r(7706);e.exports=function(e,t,r){return t==t?o(e,t,r):i(e,n,r)}},2532:(e,t,r)=>{var i=r(4715),n=function(){try{var e=i(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=n},2619:e=>{e.exports=function(e){return function(){return e}}},2837:e=>{e.exports=function(e){return e.split("")}},2945:e=>{var t=/\s/;e.exports=function(e){for(var r=e.length;r--&&t.test(e.charAt(r)););return r}},3029:(e,t)=>{"use strict";var r;function i(e){return n(r.Html).reduce(s,e)}function n(e){var t=[["&","&amp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"],["'","&#x27;"],["\\/","&#x2F;"],["\\(","&#40;"],["\\)","&#41;"]];return e===r.Html?t.filter(function(e){var t=e[0];return e[1],-1===t.indexOf("(")&&-1===t.indexOf(")")}):t.filter(function(e){var t=e[0];return e[1],-1===t.indexOf("/")})}function o(e,t){return e.replace(new RegExp(t[0],"g"),t[1])}function s(e,t){return e.replace(new RegExp(t[1],"g"),t[0].replace("\\",""))}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Html=0]="Html",e[e.Url=1]="Url"}(r||(r={})),t.makeStartTag=function(e,t){if(void 0===t&&(t=void 0),!e)return"";var r="";t&&(r=[].concat(t).map(function(e){return e.key+(e.value?'="'+e.value+'"':"")}).join(" "));var i=">";return"img"!==e&&"br"!==e||(i="/>"),r?"<"+e+" "+r+i:"<"+e+i},t.makeEndTag=function(e){return void 0===e&&(e=""),e&&"</"+e+">"||""},t.decodeHtml=i,t.encodeHtml=function(e,t){return void 0===t&&(t=!0),t&&(e=i(e)),n(r.Html).reduce(o,e)},t.encodeLink=function(e){var t=n(r.Url),i=t.reduce(s,e);return t.reduce(o,i)}},3142:e=>{var t=Array.isArray;e.exports=t},3316:e=>{var t=Date.now;e.exports=function(e){var r=0,i=0;return function(){var n=t(),o=16-(n-i);if(i=n,o>0){if(++r>=800)return arguments[0]}else r=0;return e.apply(void 0,arguments)}}},3317:(e,t)=>{"use strict";String.prototype.remove=function(e){return Array.isArray(e)?e.reduce(function(e,t){return e.replace(t,"")},this):"string"==typeof e?this.replace(e,""):this}},3417:e=>{var t=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");e.exports=function(e){return t.test(e)}},3449:function(e,t,r){"use strict";var i,n,o,s,a,l,c,h,u,d=this&&this.__classPrivateFieldSet||function(e,t,r,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,r):n?n.value=r:t.set(e,r),r},g=this&&this.__classPrivateFieldGet||function(e,t,r,i){if("a"===r&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0});const f=r(6465),p=r(1073),m=r(6745),y=r(2255),b=r(8203),T=r(7422);class _{constructor(e){var t,r,g,p,A,v;i.set(this,void 0),n.set(this,void 0),o.set(this,void 0),s.set(this,void 0),a.set(this,void 0),l.set(this,void 0),c.set(this,void 0),h.set(this,void 0),u.set(this,void 0),this.blocks={retrieve:e=>this.request({path:y.getBlock.path(e),method:y.getBlock.method,query:(0,m.pick)(e,y.getBlock.queryParams),body:(0,m.pick)(e,y.getBlock.bodyParams),auth:null==e?void 0:e.auth}),update:e=>this.request({path:y.updateBlock.path(e),method:y.updateBlock.method,query:(0,m.pick)(e,y.updateBlock.queryParams),body:(0,m.pick)(e,y.updateBlock.bodyParams),auth:null==e?void 0:e.auth}),delete:e=>this.request({path:y.deleteBlock.path(e),method:y.deleteBlock.method,query:(0,m.pick)(e,y.deleteBlock.queryParams),body:(0,m.pick)(e,y.deleteBlock.bodyParams),auth:null==e?void 0:e.auth}),children:{append:e=>this.request({path:y.appendBlockChildren.path(e),method:y.appendBlockChildren.method,query:(0,m.pick)(e,y.appendBlockChildren.queryParams),body:(0,m.pick)(e,y.appendBlockChildren.bodyParams),auth:null==e?void 0:e.auth}),list:e=>this.request({path:y.listBlockChildren.path(e),method:y.listBlockChildren.method,query:(0,m.pick)(e,y.listBlockChildren.queryParams),body:(0,m.pick)(e,y.listBlockChildren.bodyParams),auth:null==e?void 0:e.auth})}},this.databases={list:e=>this.request({path:y.listDatabases.path(),method:y.listDatabases.method,query:(0,m.pick)(e,y.listDatabases.queryParams),body:(0,m.pick)(e,y.listDatabases.bodyParams),auth:null==e?void 0:e.auth}),retrieve:e=>this.request({path:y.getDatabase.path(e),method:y.getDatabase.method,query:(0,m.pick)(e,y.getDatabase.queryParams),body:(0,m.pick)(e,y.getDatabase.bodyParams),auth:null==e?void 0:e.auth}),query:e=>this.request({path:y.queryDatabase.path(e),method:y.queryDatabase.method,query:(0,m.pick)(e,y.queryDatabase.queryParams),body:(0,m.pick)(e,y.queryDatabase.bodyParams),auth:null==e?void 0:e.auth}),create:e=>this.request({path:y.createDatabase.path(),method:y.createDatabase.method,query:(0,m.pick)(e,y.createDatabase.queryParams),body:(0,m.pick)(e,y.createDatabase.bodyParams),auth:null==e?void 0:e.auth}),update:e=>this.request({path:y.updateDatabase.path(e),method:y.updateDatabase.method,query:(0,m.pick)(e,y.updateDatabase.queryParams),body:(0,m.pick)(e,y.updateDatabase.bodyParams),auth:null==e?void 0:e.auth})},this.pages={create:e=>this.request({path:y.createPage.path(),method:y.createPage.method,query:(0,m.pick)(e,y.createPage.queryParams),body:(0,m.pick)(e,y.createPage.bodyParams),auth:null==e?void 0:e.auth}),retrieve:e=>this.request({path:y.getPage.path(e),method:y.getPage.method,query:(0,m.pick)(e,y.getPage.queryParams),body:(0,m.pick)(e,y.getPage.bodyParams),auth:null==e?void 0:e.auth}),update:e=>this.request({path:y.updatePage.path(e),method:y.updatePage.method,query:(0,m.pick)(e,y.updatePage.queryParams),body:(0,m.pick)(e,y.updatePage.bodyParams),auth:null==e?void 0:e.auth}),properties:{retrieve:e=>this.request({path:y.getPageProperty.path(e),method:y.getPageProperty.method,query:(0,m.pick)(e,y.getPageProperty.queryParams),body:(0,m.pick)(e,y.getPageProperty.bodyParams),auth:null==e?void 0:e.auth})}},this.users={retrieve:e=>this.request({path:y.getUser.path(e),method:y.getUser.method,query:(0,m.pick)(e,y.getUser.queryParams),body:(0,m.pick)(e,y.getUser.bodyParams),auth:null==e?void 0:e.auth}),list:e=>this.request({path:y.listUsers.path(),method:y.listUsers.method,query:(0,m.pick)(e,y.listUsers.queryParams),body:(0,m.pick)(e,y.listUsers.bodyParams),auth:null==e?void 0:e.auth}),me:e=>this.request({path:y.getSelf.path(),method:y.getSelf.method,query:(0,m.pick)(e,y.getSelf.queryParams),body:(0,m.pick)(e,y.getSelf.bodyParams),auth:null==e?void 0:e.auth})},this.comments={create:e=>this.request({path:y.createComment.path(),method:y.createComment.method,query:(0,m.pick)(e,y.createComment.queryParams),body:(0,m.pick)(e,y.createComment.bodyParams),auth:null==e?void 0:e.auth}),list:e=>this.request({path:y.listComments.path(),method:y.listComments.method,query:(0,m.pick)(e,y.listComments.queryParams),body:(0,m.pick)(e,y.listComments.bodyParams),auth:null==e?void 0:e.auth})},this.search=e=>this.request({path:y.search.path(),method:y.search.method,query:(0,m.pick)(e,y.search.queryParams),body:(0,m.pick)(e,y.search.bodyParams),auth:null==e?void 0:e.auth}),this.oauth={token:e=>this.request({path:y.oauthToken.path(),method:y.oauthToken.method,query:(0,m.pick)(e,y.oauthToken.queryParams),body:(0,m.pick)(e,y.oauthToken.bodyParams),auth:{client_id:e.client_id,client_secret:e.client_secret}}),introspect:e=>this.request({path:y.oauthIntrospect.path(),method:y.oauthIntrospect.method,query:(0,m.pick)(e,y.oauthIntrospect.queryParams),body:(0,m.pick)(e,y.oauthIntrospect.bodyParams),auth:{client_id:e.client_id,client_secret:e.client_secret}}),revoke:e=>this.request({path:y.oauthRevoke.path(),method:y.oauthRevoke.method,query:(0,m.pick)(e,y.oauthRevoke.queryParams),body:(0,m.pick)(e,y.oauthRevoke.bodyParams),auth:{client_id:e.client_id,client_secret:e.client_secret}})},d(this,i,null==e?void 0:e.auth,"f"),d(this,n,null!==(t=null==e?void 0:e.logLevel)&&void 0!==t?t:f.LogLevel.WARN,"f"),d(this,o,null!==(r=null==e?void 0:e.logger)&&void 0!==r?r:(0,f.makeConsoleLogger)(T.name),"f"),d(this,s,`${null!==(g=null==e?void 0:e.baseUrl)&&void 0!==g?g:"https://api.notion.com"}/v1/`,"f"),d(this,a,null!==(p=null==e?void 0:e.timeoutMs)&&void 0!==p?p:6e4,"f"),d(this,l,null!==(A=null==e?void 0:e.notionVersion)&&void 0!==A?A:_.defaultNotionVersion,"f"),d(this,c,null!==(v=null==e?void 0:e.fetch)&&void 0!==v?v:b.default,"f"),d(this,h,null==e?void 0:e.agent,"f"),d(this,u,`notionhq-client/${T.version}`,"f")}async request({path:e,method:t,query:r,body:i,auth:n}){this.log(f.LogLevel.INFO,"request start",{method:t,path:e});const o=i&&0!==Object.entries(i).length?JSON.stringify(i):void 0,d=new URL(`${g(this,s,"f")}${e}`);if(r)for(const[e,t]of Object.entries(r))void 0!==t&&(Array.isArray(t)?t.forEach(t=>d.searchParams.append(e,decodeURIComponent(t))):d.searchParams.append(e,String(t)));let m;if("object"==typeof n){const e=`${n.client_id}:${n.client_secret}`;m={authorization:`Basic ${Buffer.from(e).toString("base64")}`}}else m=this.authAsHeaders(n);const y={...m,"Notion-Version":g(this,l,"f"),"user-agent":g(this,u,"f")};void 0!==o&&(y["content-type"]="application/json");try{const r=await p.RequestTimeoutError.rejectAfterTimeout(g(this,c,"f").call(this,d.toString(),{method:t.toUpperCase(),headers:y,body:o,agent:g(this,h,"f")}),g(this,a,"f")),i=await r.text();if(!r.ok)throw(0,p.buildRequestError)(r,i);const n=JSON.parse(i);return this.log(f.LogLevel.INFO,"request success",{method:t,path:e}),n}catch(e){if(!(0,p.isNotionClientError)(e))throw e;throw this.log(f.LogLevel.WARN,"request fail",{code:e.code,message:e.message}),(0,p.isHTTPResponseError)(e)&&this.log(f.LogLevel.DEBUG,"failed response body",{body:e.body}),e}}log(e,t,r){(0,f.logLevelSeverity)(e)>=(0,f.logLevelSeverity)(g(this,n,"f"))&&g(this,o,"f").call(this,e,t,r)}authAsHeaders(e){const t={},r=null!=e?e:g(this,i,"f");return void 0!==r&&(t.authorization=`Bearer ${r}`),t}}t.default=_,i=new WeakMap,n=new WeakMap,o=new WeakMap,s=new WeakMap,a=new WeakMap,l=new WeakMap,c=new WeakMap,h=new WeakMap,u=new WeakMap,_.defaultNotionVersion="2022-06-28"},3501:e=>{e.exports=function(e,t,r){var i=-1,n=e.length;t<0&&(t=-t>n?0:n+t),(r=r>n?n:r)<0&&(r+=n),n=t>r?0:r-t>>>0,t>>>=0;for(var o=Array(n);++i<n;)o[i]=e[i+t];return o}},3655:(e,t,r)=>{var i=r(7379),n=r(1580);e.exports=function(e){if(!n(e))return!1;var t=i(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},3945:(e,t,r)=>{var i=r(2053),n=r(5234),o=r(796);e.exports=function(e,t){return o(n(e,t,i),e+"")}},4066:e=>{var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},4171:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(4204),n=r(5289),o=r(8475),s=r(1366),a=r(6168),l=r(186),c=function(){function e(){}return e.convert=function(t,r){if(!Array.isArray(t))return[];for(var n,o,l=[],c=0,h=[].concat.apply([],t.map(a.InsertOpDenormalizer.denormalize));c<h.length;c++){var u=h[c];u.insert&&(n=e.convertInsertVal(u.insert,r))&&(o=s.OpAttributeSanitizer.sanitize(u.attributes,r),l.push(new i.DeltaInsertOp(n,o)))}return l},e.convertInsertVal=function(e,t){if("string"==typeof e)return new o.InsertDataQuill(n.DataType.Text,e);if(!e||"object"!=typeof e)return null;var r=Object.keys(e);return r.length?n.DataType.Image in e?new o.InsertDataQuill(n.DataType.Image,l.OpLinkSanitizer.sanitize(e[n.DataType.Image]+"",t)):n.DataType.Video in e?new o.InsertDataQuill(n.DataType.Video,l.OpLinkSanitizer.sanitize(e[n.DataType.Video]+"",t)):n.DataType.Formula in e?new o.InsertDataQuill(n.DataType.Formula,e[n.DataType.Formula]):new o.InsertDataCustom(r[0],e[r[0]]):null},e}();t.InsertOpsConverter=c},4204:function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(5289),o=r(8475),s=i(r(8677)),a=function(){function e(e,t){"string"==typeof e&&(e=new o.InsertDataQuill(n.DataType.Text,e+"")),this.insert=e,this.attributes=t||{}}return e.createNewLineOp=function(){return new e(n.NewLine)},e.prototype.isContainerBlock=function(){return this.isBlockquote()||this.isList()||this.isTable()||this.isCodeBlock()||this.isHeader()||this.isBlockAttribute()||this.isCustomTextBlock()},e.prototype.isBlockAttribute=function(){var e=this.attributes;return!!(e.align||e.direction||e.indent)},e.prototype.isBlockquote=function(){return!!this.attributes.blockquote},e.prototype.isHeader=function(){return!!this.attributes.header},e.prototype.isTable=function(){return!!this.attributes.table},e.prototype.isSameHeaderAs=function(e){return e.attributes.header===this.attributes.header&&this.isHeader()},e.prototype.hasSameAdiAs=function(e){return this.attributes.align===e.attributes.align&&this.attributes.direction===e.attributes.direction&&this.attributes.indent===e.attributes.indent},e.prototype.hasSameIndentationAs=function(e){return this.attributes.indent===e.attributes.indent},e.prototype.hasSameAttr=function(e){return s.default(this.attributes,e.attributes)},e.prototype.hasHigherIndentThan=function(e){return(Number(this.attributes.indent)||0)>(Number(e.attributes.indent)||0)},e.prototype.isInline=function(){return!(this.isContainerBlock()||this.isVideo()||this.isCustomEmbedBlock())},e.prototype.isCodeBlock=function(){return!!this.attributes["code-block"]},e.prototype.hasSameLangAs=function(e){return this.attributes["code-block"]===e.attributes["code-block"]},e.prototype.isJustNewline=function(){return this.insert.value===n.NewLine},e.prototype.isList=function(){return this.isOrderedList()||this.isBulletList()||this.isCheckedList()||this.isUncheckedList()},e.prototype.isOrderedList=function(){return this.attributes.list===n.ListType.Ordered},e.prototype.isBulletList=function(){return this.attributes.list===n.ListType.Bullet},e.prototype.isCheckedList=function(){return this.attributes.list===n.ListType.Checked},e.prototype.isUncheckedList=function(){return this.attributes.list===n.ListType.Unchecked},e.prototype.isACheckList=function(){return this.attributes.list==n.ListType.Unchecked||this.attributes.list===n.ListType.Checked},e.prototype.isSameListAs=function(e){return!!e.attributes.list&&(this.attributes.list===e.attributes.list||e.isACheckList()&&this.isACheckList())},e.prototype.isSameTableRowAs=function(e){return!!e.isTable()&&this.isTable()&&this.attributes.table===e.attributes.table},e.prototype.isText=function(){return this.insert.type===n.DataType.Text},e.prototype.isImage=function(){return this.insert.type===n.DataType.Image},e.prototype.isFormula=function(){return this.insert.type===n.DataType.Formula},e.prototype.isVideo=function(){return this.insert.type===n.DataType.Video},e.prototype.isLink=function(){return this.isText()&&!!this.attributes.link},e.prototype.isCustomEmbed=function(){return this.insert instanceof o.InsertDataCustom},e.prototype.isCustomEmbedBlock=function(){return this.isCustomEmbed()&&!!this.attributes.renderAsBlock},e.prototype.isCustomTextBlock=function(){return this.isText()&&!!this.attributes.renderAsBlock},e.prototype.isMentions=function(){return this.isText()&&!!this.attributes.mentions},e}();t.DeltaInsertOp=a},4354:e=>{e.exports=function(e,t){var r=-1,i=e.length;for(t||(t=Array(i));++r<i;)t[r]=e[r];return t}},4627:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sanitize=function(e){var t=e;return t=t.replace(/^\s*/gm,""),/^((https?|s?ftp|file|blob|mailto|tel):|#|\/|data:image\/)/.test(t)?t:"unsafe:"+t}},4715:(e,t,r)=>{var i=r(9624),n=r(155);e.exports=function(e,t){var r=n(e,t);return i(r)?r:void 0}},4759:(e,t,r)=>{var i,n=r(1950),o=(i=/[^.]+$/.exec(n&&n.keys&&n.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"";e.exports=function(e){return!!o&&o in e}},4772:(e,t,r)=>{r(3317)},4872:(e,t,r)=>{e.exports={deltaToMarkdown:r(927)}},4967:(e,t,r)=>{var i="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g;e.exports=i},5111:e=>{e.exports=function(e,t){for(var r=-1,i=null==e?0:e.length,n=Array(i);++r<i;)n[r]=t(e[r],r,e);return n}},5234:(e,t,r)=>{var i=r(6912),n=Math.max;e.exports=function(e,t,r){return t=n(void 0===t?e.length-1:t,0),function(){for(var o=arguments,s=-1,a=n(o.length-t,0),l=Array(a);++s<a;)l[s]=o[t+s];s=-1;for(var c=Array(t+1);++s<t;)c[s]=o[s];return c[t]=r(l),i(e,this,c)}}},5243:(e,t,r)=>{var i=r(2291);e.exports=function(e){return null==e?"":i(e)}},5250:e=>{e.exports={encodeLink:e=>encodeURI(e).replace(/\(/i,"%28").replace(/\)/i,"%29").replace(/(\?|&)response-content-disposition=attachment.*$/,"")}},5289:(e,t)=>{"use strict";var r,i,n,o,s,a;Object.defineProperty(t,"__esModule",{value:!0}),t.NewLine="\n",function(e){e.Ordered="ordered",e.Bullet="bullet",e.Checked="checked",e.Unchecked="unchecked"}(r||(r={})),t.ListType=r,function(e){e.Sub="sub",e.Super="super"}(i||(i={})),t.ScriptType=i,function(e){e.Rtl="rtl"}(n||(n={})),t.DirectionType=n,function(e){e.Left="left",e.Center="center",e.Right="right",e.Justify="justify"}(o||(o={})),t.AlignType=o,function(e){e.Image="image",e.Video="video",e.Formula="formula",e.Text="text"}(s||(s={})),t.DataType=s,function(e){e.Block="block",e.InlineGroup="inline-group",e.List="list",e.Video="video",e.Table="table"}(a||(a={})),t.GroupType=a},5395:(e,t,r)=>{"use strict";r(275).QuillDeltaToHtmlConverter,r(1913).OpToHtmlConverter;var i=r(8840);i.InlineGroup,i.VideoItem,i.BlockGroup,i.ListGroup,i.ListItem,i.BlotBlock,r(4204).DeltaInsertOp;var n=r(8475);n.InsertDataQuill,n.InsertDataCustom;var o=r(5289);o.NewLine,o.ListType,o.ScriptType,o.DirectionType,o.AlignType,o.DataType,o.GroupType},5528:(e,t,r)=>{const i=r(8227),{encodeLink:n}=r(5250);e.exports={embed:{image:function(e){this.append("![]("+n(e)+")")},thematic_break:function(){this.open="\n---\n"+this.open}},inline:{italic:function(){return["_","_"]},bold:function(){return["**","**"]},link:function(e){return["[","]("+e+")"]}},block:{header:function({header:e}){this.open="#".repeat(e)+" "+this.open},blockquote:function(){this.open="> "+this.open},list:{group:function(){return new i(["","\n"])},line:function(e,t){if("bullet"===e.list)this.open="- "+this.open;else if("checked"===e.list)this.open="- [x] "+this.open;else if("unchecked"===e.list)this.open="- [ ] "+this.open;else if("ordered"===e.list){t.count=t.count||0;var r=++t.count;this.open=r+". "+this.open}}}}}},5650:(e,t,r)=>{var i=r(8942).Symbol;e.exports=i},6168:function(e,t,r){"use strict";var i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var n=r(5289),o=i(r(8537)),s=i(r(1439)),a=function(){function e(){}return e.denormalize=function(e){if(!e||"object"!=typeof e)return[];if("object"==typeof e.insert||e.insert===n.NewLine)return[e];var t=o.tokenizeWithNewLines(e.insert+"");if(1===t.length)return[e];var r=s.assign({},e,{insert:n.NewLine});return t.map(function(t){return t===n.NewLine?r:s.assign({},e,{insert:t})})},e}();t.InsertOpDenormalizer=a},6465:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logLevelSeverity=t.makeConsoleLogger=t.LogLevel=void 0;const i=r(6745);var n;!function(e){e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(n=t.LogLevel||(t.LogLevel={})),t.makeConsoleLogger=function(e){return(t,r,i)=>{console[t](`${e} ${t}:`,r,i)}},t.logLevelSeverity=function(e){switch(e){case n.DEBUG:return 20;case n.INFO:return 40;case n.WARN:return 60;case n.ERROR:return 80;default:return(0,i.assertNever)(e)}}},6745:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isObject=t.pick=t.assertNever=void 0,t.assertNever=function(e){throw new Error(`Unexpected value should never occur: ${e}`)},t.pick=function(e,t){const r=t.map(t=>[t,null==e?void 0:e[t]]);return Object.fromEntries(r)},t.isObject=function(e){return"object"==typeof e&&null!==e}},6912:e=>{e.exports=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}},7250:e=>{e.exports=function(e,t,r,i){for(var n=e.length,o=r+(i?1:-1);i?o--:++o<n;)if(t(e[o],o,e))return o;return-1}},7292:(e,t,r)=>{var i=r(3945)(r(581));e.exports=i},7379:(e,t,r)=>{var i=r(5650),n=r(8870),o=r(9005),s=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":s&&s in Object(e)?n(e):o(e)}},7403:(e,t,r)=>{var i=r(2619),n=r(2532),o=r(2053),s=n?function(e,t){return n(e,"toString",{configurable:!0,enumerable:!1,value:i(t),writable:!0})}:o;e.exports=s},7422:e=>{"use strict";e.exports=JSON.parse('{"name":"@notionhq/client","version":"2.3.0","description":"A simple and easy to use client for the Notion API","engines":{"node":">=12"},"homepage":"https://developers.notion.com/docs/getting-started","bugs":{"url":"https://github.com/makenotion/notion-sdk-js/issues"},"repository":{"type":"git","url":"https://github.com/makenotion/notion-sdk-js/"},"keywords":["notion","notionapi","rest","notion-api"],"main":"./build/src","types":"./build/src/index.d.ts","scripts":{"prepare":"npm run build","prepublishOnly":"npm run checkLoggedIn && npm run lint && npm run test","build":"tsc","prettier":"prettier --write .","lint":"prettier --check . && eslint . --ext .ts && cspell \'**/*\' ","test":"jest ./test","check-links":"git ls-files | grep md$ | xargs -n 1 markdown-link-check","prebuild":"npm run clean","clean":"rm -rf ./build","checkLoggedIn":"./scripts/verifyLoggedIn.sh"},"author":"","license":"MIT","files":["build/package.json","build/src/**"],"dependencies":{"@types/node-fetch":"^2.5.10","node-fetch":"^2.6.1"},"devDependencies":{"@types/jest":"^28.1.4","@typescript-eslint/eslint-plugin":"^5.39.0","@typescript-eslint/parser":"^5.39.0","cspell":"^5.4.1","eslint":"^7.24.0","jest":"^28.1.2","markdown-link-check":"^3.8.7","prettier":"^2.8.8","ts-jest":"^28.0.5","typescript":"^4.8.4"}}')},7426:(e,t,r)=>{var i=r(2291),n=r(8931),o=r(8774),s=r(2237),a=r(5243),l=r(2945);e.exports=function(e,t,r){if((e=a(e))&&(r||void 0===t))return e.slice(0,l(e)+1);if(!e||!(t=i(t)))return e;var c=s(e),h=o(c,s(t))+1;return n(c,0,h).join("")}},7706:e=>{e.exports=function(e,t,r){for(var i=r-1,n=e.length;++i<n;)if(e[i]===t)return i;return-1}},8138:(e,t,r)=>{var i=r(7379),n=r(3142),o=r(547);e.exports=function(e){return"string"==typeof e||!n(e)&&o(e)&&"[object String]"==i(e)}},8203:(e,t,r)=>{"use strict";var i=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw new Error("unable to locate global object")}();e.exports=t=i.fetch,i.fetch&&(t.default=i.fetch.bind(i)),t.Headers=i.Headers,t.Request=i.Request,t.Response=i.Response},8227:(e,t,r)=>{const i=r(3142),n=r(8138),o=r(7292);var s=0;class a{constructor(e){this.id=++s,i(e)?(this.open=e[0],this.close=e[1]):n(e)&&(this.text=e),this.children=[]}append(e){e instanceof a||(e=new a(e)),e._parent&&o(e._parent.children,e),e._parent=this,this.children=this.children.concat(e)}render(){var e="";this.open&&(e+=this.open),this.text&&(e+=this.text);for(var t=0;t<this.children.length;t++)e+=this.children[t].render();return this.close&&(e+=this.close),e}parent(){return this._parent}}e.exports=a},8250:e=>{e.exports=function(e,t,r,i){for(var n=r-1,o=e.length;++n<o;)if(i(e[n],t))return n;return-1}},8288:(e,t,r)=>{"use strict";r(3449),r(6465),r(1073),r(9885)},8475:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.InsertDataQuill=function(e,t){this.type=e,this.value=t};t.InsertDataCustom=function(e,t){this.type=e,this.value=t}},8537:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tokenizeWithNewLines=function(e){var t="\n";if(e===t)return[e];var r=e.split(t);if(1===r.length)return r;var i=r.length-1;return r.reduce(function(e,r,n){return n!==i?""!==r?e=e.concat(r,t):e.push(t):""!==r&&e.push(r),e},[])}},8677:(e,t,r)=>{e=r.nmd(e);var i="__lodash_hash_undefined__",n=9007199254740991,o="[object Arguments]",s="[object Array]",a="[object Boolean]",l="[object Date]",c="[object Error]",h="[object Function]",u="[object Map]",d="[object Number]",g="[object Object]",f="[object Promise]",p="[object RegExp]",m="[object Set]",y="[object String]",b="[object WeakMap]",T="[object ArrayBuffer]",_="[object DataView]",A=/^\[object .+?Constructor\]$/,v=/^(?:0|[1-9]\d*)$/,w={};w["[object Float32Array]"]=w["[object Float64Array]"]=w["[object Int8Array]"]=w["[object Int16Array]"]=w["[object Int32Array]"]=w["[object Uint8Array]"]=w["[object Uint8ClampedArray]"]=w["[object Uint16Array]"]=w["[object Uint32Array]"]=!0,w[o]=w[s]=w[T]=w[a]=w[_]=w[l]=w[c]=w[h]=w[u]=w[d]=w[g]=w[p]=w[m]=w[y]=w[b]=!1;var E="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,S="object"==typeof self&&self&&self.Object===Object&&self,I=E||S||Function("return this")(),N=t&&!t.nodeType&&t,O=N&&e&&!e.nodeType&&e,k=O&&O.exports===N,C=k&&E.process,L=function(){try{return C&&C.binding&&C.binding("util")}catch(e){}}(),D=L&&L.isTypedArray;function R(e,t){for(var r=-1,i=null==e?0:e.length;++r<i;)if(t(e[r],r,e))return!0;return!1}function P(e){var t=-1,r=Array(e.size);return e.forEach(function(e,i){r[++t]=[i,e]}),r}function x(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}var G,B,U,M=Array.prototype,j=Function.prototype,F=Object.prototype,$=I["__core-js_shared__"],H=j.toString,W=F.hasOwnProperty,V=(G=/[^.]+$/.exec($&&$.keys&&$.keys.IE_PROTO||""))?"Symbol(src)_1."+G:"",q=F.toString,z=RegExp("^"+H.call(W).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),K=k?I.Buffer:void 0,Y=I.Symbol,X=I.Uint8Array,J=F.propertyIsEnumerable,Z=M.splice,Q=Y?Y.toStringTag:void 0,ee=Object.getOwnPropertySymbols,te=K?K.isBuffer:void 0,re=(B=Object.keys,U=Object,function(e){return B(U(e))}),ie=Oe(I,"DataView"),ne=Oe(I,"Map"),oe=Oe(I,"Promise"),se=Oe(I,"Set"),ae=Oe(I,"WeakMap"),le=Oe(Object,"create"),ce=De(ie),he=De(ne),ue=De(oe),de=De(se),ge=De(ae),fe=Y?Y.prototype:void 0,pe=fe?fe.valueOf:void 0;function me(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function ye(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function be(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function Te(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new be;++t<r;)this.add(e[t])}function _e(e){var t=this.__data__=new ye(e);this.size=t.size}function Ae(e,t){for(var r=e.length;r--;)if(Re(e[r][0],t))return r;return-1}function ve(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Q&&Q in Object(e)?function(e){var t=W.call(e,Q),r=e[Q];try{e[Q]=void 0;var i=!0}catch(e){}var n=q.call(e);return i&&(t?e[Q]=r:delete e[Q]),n}(e):function(e){return q.call(e)}(e)}function we(e){return je(e)&&ve(e)==o}function Ee(e,t,r,i,n){return e===t||(null==e||null==t||!je(e)&&!je(t)?e!=e&&t!=t:function(e,t,r,i,n,h){var f=xe(e),b=xe(t),A=f?s:Ce(e),v=b?s:Ce(t),w=(A=A==o?g:A)==g,E=(v=v==o?g:v)==g,S=A==v;if(S&&Ge(e)){if(!Ge(t))return!1;f=!0,w=!1}if(S&&!w)return h||(h=new _e),f||Fe(e)?Se(e,t,r,i,n,h):function(e,t,r,i,n,o,s){switch(r){case _:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case T:return!(e.byteLength!=t.byteLength||!o(new X(e),new X(t)));case a:case l:case d:return Re(+e,+t);case c:return e.name==t.name&&e.message==t.message;case p:case y:return e==t+"";case u:var h=P;case m:var g=1&i;if(h||(h=x),e.size!=t.size&&!g)return!1;var f=s.get(e);if(f)return f==t;i|=2,s.set(e,t);var b=Se(h(e),h(t),i,n,o,s);return s.delete(e),b;case"[object Symbol]":if(pe)return pe.call(e)==pe.call(t)}return!1}(e,t,A,r,i,n,h);if(!(1&r)){var I=w&&W.call(e,"__wrapped__"),N=E&&W.call(t,"__wrapped__");if(I||N){var O=I?e.value():e,k=N?t.value():t;return h||(h=new _e),n(O,k,r,i,h)}}return!!S&&(h||(h=new _e),function(e,t,r,i,n,o){var s=1&r,a=Ie(e),l=a.length;if(l!=Ie(t).length&&!s)return!1;for(var c=l;c--;){var h=a[c];if(!(s?h in t:W.call(t,h)))return!1}var u=o.get(e);if(u&&o.get(t))return u==t;var d=!0;o.set(e,t),o.set(t,e);for(var g=s;++c<l;){var f=e[h=a[c]],p=t[h];if(i)var m=s?i(p,f,h,t,e,o):i(f,p,h,e,t,o);if(!(void 0===m?f===p||n(f,p,r,i,o):m)){d=!1;break}g||(g="constructor"==h)}if(d&&!g){var y=e.constructor,b=t.constructor;y==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b||(d=!1)}return o.delete(e),o.delete(t),d}(e,t,r,i,n,h))}(e,t,r,i,Ee,n))}function Se(e,t,r,i,n,o){var s=1&r,a=e.length,l=t.length;if(a!=l&&!(s&&l>a))return!1;var c=o.get(e);if(c&&o.get(t))return c==t;var h=-1,u=!0,d=2&r?new Te:void 0;for(o.set(e,t),o.set(t,e);++h<a;){var g=e[h],f=t[h];if(i)var p=s?i(f,g,h,t,e,o):i(g,f,h,e,t,o);if(void 0!==p){if(p)continue;u=!1;break}if(d){if(!R(t,function(e,t){if(s=t,!d.has(s)&&(g===e||n(g,e,r,i,o)))return d.push(t);var s})){u=!1;break}}else if(g!==f&&!n(g,f,r,i,o)){u=!1;break}}return o.delete(e),o.delete(t),u}function Ie(e){return function(e,t,r){var i=t(e);return xe(e)?i:function(e,t){for(var r=-1,i=t.length,n=e.length;++r<i;)e[n+r]=t[r];return e}(i,r(e))}(e,$e,ke)}function Ne(e,t){var r,i,n=e.__data__;return("string"==(i=typeof(r=t))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==r:null===r)?n["string"==typeof t?"string":"hash"]:n.map}function Oe(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return function(e){return!(!Me(e)||function(e){return!!V&&V in e}(e))&&(Be(e)?z:A).test(De(e))}(r)?r:void 0}me.prototype.clear=function(){this.__data__=le?le(null):{},this.size=0},me.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},me.prototype.get=function(e){var t=this.__data__;if(le){var r=t[e];return r===i?void 0:r}return W.call(t,e)?t[e]:void 0},me.prototype.has=function(e){var t=this.__data__;return le?void 0!==t[e]:W.call(t,e)},me.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=le&&void 0===t?i:t,this},ye.prototype.clear=function(){this.__data__=[],this.size=0},ye.prototype.delete=function(e){var t=this.__data__,r=Ae(t,e);return!(r<0||(r==t.length-1?t.pop():Z.call(t,r,1),--this.size,0))},ye.prototype.get=function(e){var t=this.__data__,r=Ae(t,e);return r<0?void 0:t[r][1]},ye.prototype.has=function(e){return Ae(this.__data__,e)>-1},ye.prototype.set=function(e,t){var r=this.__data__,i=Ae(r,e);return i<0?(++this.size,r.push([e,t])):r[i][1]=t,this},be.prototype.clear=function(){this.size=0,this.__data__={hash:new me,map:new(ne||ye),string:new me}},be.prototype.delete=function(e){var t=Ne(this,e).delete(e);return this.size-=t?1:0,t},be.prototype.get=function(e){return Ne(this,e).get(e)},be.prototype.has=function(e){return Ne(this,e).has(e)},be.prototype.set=function(e,t){var r=Ne(this,e),i=r.size;return r.set(e,t),this.size+=r.size==i?0:1,this},Te.prototype.add=Te.prototype.push=function(e){return this.__data__.set(e,i),this},Te.prototype.has=function(e){return this.__data__.has(e)},_e.prototype.clear=function(){this.__data__=new ye,this.size=0},_e.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},_e.prototype.get=function(e){return this.__data__.get(e)},_e.prototype.has=function(e){return this.__data__.has(e)},_e.prototype.set=function(e,t){var r=this.__data__;if(r instanceof ye){var i=r.__data__;if(!ne||i.length<199)return i.push([e,t]),this.size=++r.size,this;r=this.__data__=new be(i)}return r.set(e,t),this.size=r.size,this};var ke=ee?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var r=-1,i=null==e?0:e.length,n=0,o=[];++r<i;){var s=e[r];t(s)&&(o[n++]=s)}return o}(ee(e),function(t){return J.call(e,t)}))}:function(){return[]},Ce=ve;function Le(e,t){return!!(t=null==t?n:t)&&("number"==typeof e||v.test(e))&&e>-1&&e%1==0&&e<t}function De(e){if(null!=e){try{return H.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Re(e,t){return e===t||e!=e&&t!=t}(ie&&Ce(new ie(new ArrayBuffer(1)))!=_||ne&&Ce(new ne)!=u||oe&&Ce(oe.resolve())!=f||se&&Ce(new se)!=m||ae&&Ce(new ae)!=b)&&(Ce=function(e){var t=ve(e),r=t==g?e.constructor:void 0,i=r?De(r):"";if(i)switch(i){case ce:return _;case he:return u;case ue:return f;case de:return m;case ge:return b}return t});var Pe=we(function(){return arguments}())?we:function(e){return je(e)&&W.call(e,"callee")&&!J.call(e,"callee")},xe=Array.isArray,Ge=te||function(){return!1};function Be(e){if(!Me(e))return!1;var t=ve(e);return t==h||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Ue(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=n}function Me(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function je(e){return null!=e&&"object"==typeof e}var Fe=D?function(e){return function(t){return e(t)}}(D):function(e){return je(e)&&Ue(e.length)&&!!w[ve(e)]};function $e(e){return null!=(t=e)&&Ue(t.length)&&!Be(t)?function(e,t){var r=xe(e),i=!r&&Pe(e),n=!r&&!i&&Ge(e),o=!r&&!i&&!n&&Fe(e),s=r||i||n||o,a=s?function(e,t){for(var r=-1,i=Array(e);++r<e;)i[r]=t(r);return i}(e.length,String):[],l=a.length;for(var c in e)!t&&!W.call(e,c)||s&&("length"==c||n&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Le(c,l))||a.push(c);return a}(e):function(e){if(r=(t=e)&&t.constructor,t!==("function"==typeof r&&r.prototype||F))return re(e);var t,r,i=[];for(var n in Object(e))W.call(e,n)&&"constructor"!=n&&i.push(n);return i}(e);var t}e.exports=function(e,t){return Ee(e,t)}},8735:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.preferSecond=function(e){return 0===e.length?null:e.length>=2?e[1]:e[0]},t.flatten=function e(t){return t.reduce(function(t,r){return t.concat(Array.isArray(r)?e(r):r)},[])},t.find=function(e,t){if(Array.prototype.find)return Array.prototype.find.call(e,t);for(var r=0;r<e.length;r++)if(t(e[r]))return e[r]},t.groupConsecutiveElementsWhile=function(e,t){for(var r,i=[],n=0;n<e.length;n++)r=e[n],n>0&&t(r,e[n-1])?i[i.length-1].push(r):i.push([r]);return i.map(function(e){return 1===e.length?e[0]:e})},t.sliceFromReverseWhile=function(e,t,r){for(var i={elements:[],sliceStartsAt:-1},n=t;n>=0&&r(e[n]);n--)i.sliceStartsAt=n,i.elements.unshift(e[n]);return i},t.intersperse=function(e,t){return e.reduce(function(r,i,n){return r.push(i),n<e.length-1&&r.push(t),r},[])}},8774:(e,t,r)=>{var i=r(2478);e.exports=function(e,t){for(var r=e.length;r--&&i(t,e[r],0)>-1;);return r}},8840:function(e,t){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});t.InlineGroup=function(e){this.ops=e};var n=function(e){this.op=e},o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(n);t.VideoItem=o;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(n);t.BlotBlock=s;t.BlockGroup=function(e,t){this.op=e,this.ops=t};t.ListGroup=function(e){this.items=e};t.ListItem=function(e,t){void 0===t&&(t=null),this.item=e,this.innerList=t};t.TableGroup=function(e){this.rows=e};t.TableRow=function(e){this.cells=e};t.TableCell=function(e){this.item=e}},8870:(e,t,r)=>{var i=r(5650),n=Object.prototype,o=n.hasOwnProperty,s=n.toString,a=i?i.toStringTag:void 0;e.exports=function(e){var t=o.call(e,a),r=e[a];try{e[a]=void 0;var i=!0}catch(e){}var n=s.call(e);return i&&(t?e[a]=r:delete e[a]),n}},8931:(e,t,r)=>{var i=r(3501);e.exports=function(e,t,r){var n=e.length;return r=void 0===r?n:r,!t&&r>=n?e:i(e,t,r)}},8942:(e,t,r)=>{var i=r(4967),n="object"==typeof self&&self&&self.Object===Object&&self,o=i||n||Function("return this")();e.exports=o},9005:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},9261:(e,t,r)=>{var i=r(5111),n=r(2478),o=r(8250),s=r(9460),a=r(4354),l=Array.prototype.splice;e.exports=function(e,t,r,c){var h=c?o:n,u=-1,d=t.length,g=e;for(e===t&&(t=a(t)),r&&(g=i(e,s(r)));++u<d;)for(var f=0,p=t[u],m=r?r(p):p;(f=h(g,m,f,c))>-1;)g!==e&&l.call(g,f,1),l.call(e,f,1);return e}},9454:e=>{e.exports=function(e){return e!=e}},9460:e=>{e.exports=function(e){return function(t){return e(t)}}},9624:(e,t,r)=>{var i=r(3655),n=r(4759),o=r(1580),s=r(4066),a=/^\[object .+?Constructor\]$/,l=Function.prototype,c=Object.prototype,h=l.toString,u=c.hasOwnProperty,d=RegExp("^"+h.call(u).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||n(e))&&(i(e)?d:a).test(s(e))}},9885:(e,t)=>{"use strict";async function*r(e,t){let r=t.start_cursor;do{const i=await e({...t,start_cursor:r});yield*i.results,r=i.next_cursor}while(r)}function i(e){return"page"===e.object&&"url"in e}function n(e){return"database"===e.object&&"title"in e}Object.defineProperty(t,"__esModule",{value:!0}),t.isMentionRichTextItemResponse=t.isEquationRichTextItemResponse=t.isTextRichTextItemResponse=t.isFullComment=t.isFullUser=t.isFullPageOrDatabase=t.isFullDatabase=t.isFullPage=t.isFullBlock=t.collectPaginatedAPI=t.iteratePaginatedAPI=void 0,t.iteratePaginatedAPI=r,t.collectPaginatedAPI=async function(e,t){const i=[];for await(const n of r(e,t))i.push(n);return i},t.isFullBlock=function(e){return"block"===e.object&&"type"in e},t.isFullPage=i,t.isFullDatabase=n,t.isFullPageOrDatabase=function(e){return"database"===e.object?n(e):i(e)},t.isFullUser=function(e){return"type"in e},t.isFullComment=function(e){return"created_by"in e},t.isTextRichTextItemResponse=function(e){return"text"===e.type},t.isEquationRichTextItemResponse=function(e){return"equation"===e.type},t.isMentionRichTextItemResponse=function(e){return"mention"===e.type}}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={id:i,loaded:!1,exports:{}};return e[i].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}return r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{"use strict";function e(e,t){return Array(t+1).join(e)}r(5395);var t={};function i(e){return e?e.replace(/(\n+\s*)+/g,"\n"):""}function n(e){for(var t in this.options=e,this._keep=[],this._remove=[],this.blankRule={replacement:e.blankReplacement},this.keepReplacement=e.keepReplacement,this.defaultRule={replacement:e.defaultReplacement},this.array=[],e.rules)this.array.push(e.rules[t])}function o(e,t,r){for(var i=0;i<e.length;i++){var n=e[i];if(s(n,t,r))return n}}function s(e,t,r){var i=e.filter;if("string"==typeof i){if(i===t.nodeName.toLowerCase())return!0}else if(Array.isArray(i)){if(i.indexOf(t.nodeName.toLowerCase())>-1)return!0}else{if("function"!=typeof i)throw new TypeError("`filter` needs to be a string, array, or function");if(i.call(e,t,r))return!0}}t.paragraph={filter:"p",replacement:function(e){return"\n\n"+e+"\n\n"}},t.lineBreak={filter:"br",replacement:function(e,t,r){return r.br+"\n"}},t.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(t,r,i){var n=Number(r.nodeName.charAt(1));return"setext"===i.headingStyle&&n<3?"\n\n"+t+"\n"+e(1===n?"=":"-",t.length)+"\n\n":"\n\n"+e("#",n)+" "+t+"\n\n"}},t.blockquote={filter:"blockquote",replacement:function(e){return"\n\n"+(e=(e=e.replace(/^\n+|\n+$/g,"")).replace(/^/gm,"> "))+"\n\n"}},t.list={filter:["ul","ol"],replacement:function(e,t){var r=t.parentNode;return"LI"===r.nodeName&&r.lastElementChild===t?"\n"+e:"\n\n"+e+"\n\n"}},t.listItem={filter:"li",replacement:function(e,t,r){var i=r.bulletListMarker+"   ",n=t.parentNode;if("OL"===n.nodeName){var o=n.getAttribute("start"),s=Array.prototype.indexOf.call(n.children,t);i=(o?Number(o)+s:s+1)+".  "}return i+(e=e.replace(/^\n+/,"").replace(/\n+$/,"\n").replace(/\n/gm,"\n"+" ".repeat(i.length)))+(t.nextSibling&&!/\n$/.test(e)?"\n":"")}},t.indentedCodeBlock={filter:function(e,t){return"indented"===t.codeBlockStyle&&"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName},replacement:function(e,t,r){return"\n\n    "+t.firstChild.textContent.replace(/\n/g,"\n    ")+"\n\n"}},t.fencedCodeBlock={filter:function(e,t){return"fenced"===t.codeBlockStyle&&"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName},replacement:function(t,r,i){for(var n,o=((r.firstChild.getAttribute("class")||"").match(/language-(\S+)/)||[null,""])[1],s=r.firstChild.textContent,a=i.fence.charAt(0),l=3,c=new RegExp("^"+a+"{3,}","gm");n=c.exec(s);)n[0].length>=l&&(l=n[0].length+1);var h=e(a,l);return"\n\n"+h+o+"\n"+s.replace(/\n$/,"")+"\n"+h+"\n\n"}},t.horizontalRule={filter:"hr",replacement:function(e,t,r){return"\n\n"+r.hr+"\n\n"}},t.inlineLink={filter:function(e,t){return"inlined"===t.linkStyle&&"A"===e.nodeName&&e.getAttribute("href")},replacement:function(e,t){var r=t.getAttribute("href");r&&(r=r.replace(/([()])/g,"\\$1"));var n=i(t.getAttribute("title"));return n&&(n=' "'+n.replace(/"/g,'\\"')+'"'),"["+e+"]("+r+n+")"}},t.referenceLink={filter:function(e,t){return"referenced"===t.linkStyle&&"A"===e.nodeName&&e.getAttribute("href")},replacement:function(e,t,r){var n,o,s=t.getAttribute("href"),a=i(t.getAttribute("title"));switch(a&&(a=' "'+a+'"'),r.linkReferenceStyle){case"collapsed":n="["+e+"][]",o="["+e+"]: "+s+a;break;case"shortcut":n="["+e+"]",o="["+e+"]: "+s+a;break;default:var l=this.references.length+1;n="["+e+"]["+l+"]",o="["+l+"]: "+s+a}return this.references.push(o),n},references:[],append:function(e){var t="";return this.references.length&&(t="\n\n"+this.references.join("\n")+"\n\n",this.references=[]),t}},t.emphasis={filter:["em","i"],replacement:function(e,t,r){return e.trim()?r.emDelimiter+e+r.emDelimiter:""}},t.strong={filter:["strong","b"],replacement:function(e,t,r){return e.trim()?r.strongDelimiter+e+r.strongDelimiter:""}},t.code={filter:function(e){var t=e.previousSibling||e.nextSibling,r="PRE"===e.parentNode.nodeName&&!t;return"CODE"===e.nodeName&&!r},replacement:function(e){if(!e)return"";e=e.replace(/\r?\n|\r/g," ");for(var t=/^`|^ .*?[^ ].* $|`$/.test(e)?" ":"",r="`",i=e.match(/`+/gm)||[];-1!==i.indexOf(r);)r+="`";return r+t+e+t+r}},t.image={filter:"img",replacement:function(e,t){var r=i(t.getAttribute("alt")),n=t.getAttribute("src")||"",o=i(t.getAttribute("title"));return n?"!["+r+"]("+n+(o?' "'+o+'"':"")+")":""}},n.prototype={add:function(e,t){this.array.unshift(t)},keep:function(e){this._keep.unshift({filter:e,replacement:this.keepReplacement})},remove:function(e){this._remove.unshift({filter:e,replacement:function(){return""}})},forNode:function(e){return e.isBlank?this.blankRule:(t=o(this.array,e,this.options))||(t=o(this._keep,e,this.options))||(t=o(this._remove,e,this.options))?t:this.defaultRule;var t},forEach:function(e){for(var t=0;t<this.array.length;t++)e(this.array[t],t)}};var a,l="undefined"!=typeof window?window:{};!function(){var e=l.DOMParser,t=!1;try{(new e).parseFromString("","text/html")&&(t=!0)}catch(e){}return t}()?(a=function(){},function(){var e=!1;try{document.implementation.createHTMLDocument("").open()}catch(t){l.ActiveXObject&&(e=!0)}return e}()?a.prototype.parseFromString=function(e){var t=new window.ActiveXObject("htmlfile");return t.designMode="on",t.open(),t.write(e),t.close(),t}:a.prototype.parseFromString=function(e){var t=document.implementation.createHTMLDocument("");return t.open(),t.write(e),t.close(),t}):l.DOMParser;Array.prototype.reduce;r(4872),r(4772),r(8288);var c=Object.defineProperty,h=(e,t,r)=>((e,t,r)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r),u=(e=>(e.webApp="webApp",e.highlighter="highlighter",e.youtubeHighlighter="youtubeHighlighter",e.reader="reader",e))(u||{});const d={title:"PDF & Web Highlighter",path:"pdf-web-highlighter"},g={title:"Reader Mode + AI Summary, Notes & Annotations",path:"reader-mode"},f={...d,appId:"webhighlights",appType:"highlighter",browserType:"chrome",appDisplayname:"Web Highlights",isWebApp:!1,isExtension:!0,extensionId:"hldjnlbobkdkghfidgoecgmklcemanhm",uninstallURL:"https://tooltivity.com/extensions/youtube-highlighter/partners?ref=web-highlights",uninstallSurveyURL:"https://forms.gle/VQZnfwAqtEpLQGjB8",installedRedirectUrl:"https://web-highlights.com/blog/welcome",storePublishUrl:"https://chromewebstore.google.com/detail/web-highlights-pdf-web-hi/hldjnlbobkdkghfidgoecgmklcemanhm",featureIsEnabled:{givefreely:!0}},p={...d,appId:"webhighlights-firefox",appType:"highlighter",browserType:"firefox",isWebApp:!1,isExtension:!0,appDisplayname:"Web Highlights",extensionId:"firefox@web-highlights.com",uninstallURL:"https://tooltivity.com/extensions/youtube-highlighter/partners?ref=web-highlights",uninstallSurveyURL:"https://forms.gle/VQZnfwAqtEpLQGjB8",installedRedirectUrl:"https://web-highlights.com/blog/welcome",storePublishUrl:"https://addons.mozilla.org/firefox/addon/web-highlights-pdf-web-highlig/",featureIsEnabled:{givefreely:!1}},m={...g,appId:"reader-chrome",appType:"reader",browserType:"chrome",appDisplayname:"Reader Mode",isWebApp:!1,isExtension:!0,extensionId:"cbjbjjgipedbjgbamfodgihnfdlghcaf",extensionIdDev:"fhlkcinmabhnlpdkeffhkpppcinfmnhg",uninstallURL:"https://tooltivity.com/extensions/web-highlights/partners?ref=reader",uninstallSurveyURL:"https://forms.gle/VQZnfwAqtEpLQGjB8",installedRedirectUrl:"https://web-highlights.com/extensions/reader-mode/welcome",storePublishUrl:"https://chromewebstore.google.com/detail/cbjbjjgipedbjgbamfodgihnfdlghcaf",featureIsEnabled:{givefreely:!1}},y={title:"Youtube Highlighter & AI Summary",path:"youtube-highlighter",appId:"youtube-highlighter-chrome",appType:"youtubeHighlighter",browserType:"chrome",appDisplayname:"YouTube Highlighter",isWebApp:!1,isExtension:!0,extensionId:"jipmbenpdoghkhgapoppkjndfmcoechc",extensionIdDev:"cnpofeldfiibfdekdedbpapalneidboo",uninstallURL:"https://tooltivity.com/extensions/web-highlights/partners?ref=youtube-highlighter",uninstallSurveyURL:"https://forms.gle/VQZnfwAqtEpLQGjB8",installedRedirectUrl:"https://web-highlights.com/docs/tutorials/youtube-highlighting",storePublishUrl:"https://chromewebstore.google.com/detail/jipmbenpdoghkhgapoppkjndfmcoechc",featureIsEnabled:{givefreely:!1}},b={...g,appId:"reader-firefox",appType:"reader",browserType:"firefox",appDisplayname:"Reader Mode",isWebApp:!1,isExtension:!0,extensionId:"reader@web-highlights.com",uninstallURL:"https://tooltivity.com/extensions/web-highlights/partners?ref=reader",uninstallSurveyURL:"https://forms.gle/VQZnfwAqtEpLQGjB8",installedRedirectUrl:"https://web-highlights.com/extensions/reader-mode/welcome",storePublishUrl:"",featureIsEnabled:{givefreely:!1}},T="Not set";var _=(e=>(e.COMMANDS="COMMANDS",e))(_||{});const A=new class{sendMessage(e){try{return chrome.tabs.query({active:!0,currentWindow:!0},t=>{var r;null!=(r=t[0])&&r.id&&chrome.tabs.sendMessage(t[0].id,e)}),!0}catch{return!1}}sendRuntimeMessage(e,t){try{return t?chrome.runtime.sendMessage(e,t):chrome.runtime.sendMessage(e),!0}catch{return!1}}async readDataFromBackgroundScript(e){try{return await this.sendRuntimePortMessage(e)}catch{return"COMMANDS"===e?u.highlighter===u.reader?[{description:"Open in reader",name:"open-in-reader",shortcut:"R"},{description:"Toggle Sidebar",name:"toggle-sidebar",shortcut:"W"},{description:"Highlight Text",name:"highlight-text",shortcut:"S"},{description:"Highlight (Same Format)",name:"highlight-last-format",shortcut:"A"}]:[{description:"Highlight Text",name:"highlight-text",shortcut:"S"},{description:"Highlight (Same Format)",name:"highlight-last-format",shortcut:"A"},{description:"Toggle Sidebar",name:"toggle-sidebar",shortcut:"W"},{description:"Bookmark Page",name:"toggle-bookmark",shortcut:"B"},{description:"Open in reader",name:"open-in-reader",shortcut:"R"}]:{}}}async readCommands(){return this.readDataFromBackgroundScript("COMMANDS")}async findSpecificCommand(e){return(await this.readCommands()).find(t=>t.name===e)}async sendRuntimePortMessage(e){return new Promise((t,r)=>{var i,n;(typeof chrome>"u"||null==(i=null==chrome?void 0:chrome.runtime)||!i.connect)&&r("Chrome Runtime API is not available.");try{const i=null==(n=null==chrome?void 0:chrome.runtime)?void 0:n.connect({name:e}),o=e=>{i.onMessage.removeListener(o),i.disconnect(),t(e)},s=()=>{r("Port disconnected unexpectedly.")};i.onMessage.addListener(o),i.onDisconnect.addListener(s)}catch(e){r(e)}})}};function v(e,t){return"string"==typeof(null==t?void 0:t.method)&&typeof e[null==t?void 0:t.method]<"u"}function w(e){this.message=e}w.prototype=new Error,w.prototype.name="InvalidCharacterError";var E=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new w("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,i,n=0,o=0,s="";i=t.charAt(o++);~i&&(r=n%4?64*r+i:i,n++%4)?s+=String.fromCharCode(255&r>>(-2*n&6)):0)i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(i);return s};function S(e){this.message=e}S.prototype=new Error,S.prototype.name="InvalidTokenError";const I="jwt_webmarker";function N(e){try{return function(e,t){if("string"!=typeof e)throw new S("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(E(e).replace(/(.)/g,function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}(t)}catch{return E(t)}}(e.split(".")[r]))}catch(e){throw new S("Invalid token specified: "+e.message)}}(e)||void 0}catch{return}}class O{constructor(e=I){this.key=e}async getJwt(){return typeof window>"u"?"":localStorage[this.key]}async getJwtPayload(){return function(e=I){try{return N(localStorage[e])}catch{return}}(this.key)}setJwt(e){try{localStorage[this.key]=e}catch{}}}const k={production:!0,mode:"prod",MISC_SERVER_URL:"https://web-highlights-misc-server.herokuapp.com",BACKEND_URL:"https://web-highlights-a56e6dd216b0.herokuapp.com",BACKEND_URL_FALLBACK:"https://pre-web-highlights-385df81be2dc.herokuapp.com",BLOG_URL:"https://web-highlights.com/blog",WEBSITE_URL:"https://web-highlights.com",DOCS_URL:"https://web-highlights.com/docs/",FRONTEND_URL:"https://app.web-highlights.com",PRIVACY_URL:"https://web-highlights.com/legal/privacy-policy",EXTENSION_ID:"hldjnlbobkdkghfidgoecgmklcemanhm",PADDLE_VENDOR_ID:169421},C="mnjhhninaaaldmcgodimaadhpkaigbpp",L=function(){var e;const t=(null==(e=di())?void 0:e.environment)??k,r="https://app.web-highlights.com/oauth/notion";return{LINKED_IN_URL:"https://www.linkedin.com/company/86328566",FACEBOOK_URL:"https://www.facebook.com/webhighlightscom/",INSTAGRAM_URL:"https://www.instagram.com/web_highlights/",LINKED_IN_URL_PRIVATE:"https://www.linkedin.com/in/marius-bongarts-6b3638171",TWITTER_URL:"https://twitter.com/WebHighlights_",TWITTER_URL_PRIVATE:"https://twitter.com/MariusBongarts",GITHUB_LINK_PRIVATE:"https://github.com/MariusBongarts",LINK_TREE_PRIVATE:"https://linktr.ee/MariusBongarts",GITHUB_LINK:"https://github.com/Web-Highlights",AVATAR_MARIUS_B:"https://avatars.githubusercontent.com/u/38838885?s=256&v=4",AVATAR_WEB_HIGHLIGHTS:"https://avatars.githubusercontent.com/u/110981256?s=256&v=4",MEDIUM_URL_PRIVATE:"https://medium.com/@mariusbongarts",LEGAL_TOS_LINK:`${t.WEBSITE_URL}/legal/terms-of-service`,DISCOVER_LINK:`${t.WEBSITE_URL}/discover`,LEGAL_PRIVACY_LINK:`${t.WEBSITE_URL}/legal/privacy-policy`,LEGAL_IMPRINT_LINK:`${t.WEBSITE_URL}/legal/imprint`,FAQ_LINK:`${t.WEBSITE_URL}/faq`,BLOG_LINK:`${t.WEBSITE_URL}/blog`,RELEASE_NOTES_LINK:`${t.WEBSITE_URL}/blog/release-notes`,markIdAttrKey:"markid",markMediatypeAttrKey:"media-type",TOOLBOX_CONTAINS_HIGHLIGHT_CLASS:"contains-highlight",HIGHLIGHT_CLASS:"webhighlights-highlight",CONTAINS_TAGS_CLASS:"webhighlight-with-tags",CONTAINS_NOTES_CLASS:"webhighlight-with-notes",CHROME_EXTENSION_LINK:"https://chromewebstore.google.com/detail/web-highlights-pdf-web-hi/hldjnlbobkdkghfidgoecgmklcemanhm",EDGE_EXTENSION_LINK:"https://microsoftedge.microsoft.com/addons/detail/web-highlights-pdf-we/ghdpaajjhmlfkogblgeibaabcpjfgldn",SIDEBAR_HTML_ATTRS:{ALIGNMENT:"alignment",SIDEBAR_WIDTH:"sidebar-width"},NOTION_REDIRECT_URL:r,NOTION_AUTH_URL:`https://api.notion.com/v1/oauth/authorize?client_id=4f5934df-e74b-4318-b381-604df7b3e06d&response_type=code&owner=user&redirect_uri=${encodeURIComponent(r)}`,DAILY_NOTION_API_EXPORT_LIMIT:1,DAILY_CAPACITIES_API_EXPORT_LIMIT:1,DAILY_YOUTUBE_VIDEO_LIMIT:1,DAILY_AI_SUMMARY_LIMIT:1,DAILY_AI_CHATS_LIMIT:1,GLOBAL_STYLE_VARIABLES_ID:"web-highlights-global-style-variables"}}();function D(e,t){const r=function(e){const t=function(e){return document.getElementById(e)}(e);if(t)return t;const r=document.createElement("style");return r.id=e,document.body.append(r),r}(e);r.innerHTML!==t&&(r.innerHTML=t)}const R={slate:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a",950:"#020617"},primary:{50:"rgb(188, 220, 205)",100:"rgb(154, 208, 185)",200:"rgb(120, 197, 164)",300:"rgb(86, 186, 144)",400:"rgb(53, 176, 125)",500:"rgb(0, 179, 122)",600:"hsl(161, 100%, 33%)",700:"hsl(161, 100%, 31%)",800:"hsl(161, 100%, 29%)",900:"hsl(161, 100%, 25%)",950:"hsl(161, 100%, 20%)"},secondary:{50:"hsl(218, 22%, 27%)",100:"hsl(218, 22%, 23%)",200:"hsl(218, 22%, 22%)",300:"hsl(218, 22%, 19%)",400:"hsl(218, 22%, 17%)",500:"hsl(218, 22%, 15%)",600:"hsl(218, 22%, 13%)",700:"hsl(218, 22%, 11%)",800:"hsl(218, 22%, 9%)",900:"hsl(218, 22%, 5%)",950:"hsl(218, 22%, 3%)"},gray:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827",950:"#030712"},zinc:{50:"#fafafa",100:"#f4f4f5",200:"#e4e4e7",300:"#d4d4d8",400:"#a1a1aa",500:"#71717a",600:"#52525b",700:"#3f3f46",800:"#27272a",900:"#18181b",950:"#09090b"},neutral:{50:"#fafafa",100:"#f5f5f5",200:"#e5e5e5",300:"#d4d4d4",400:"#a3a3a3",500:"#737373",600:"#525252",700:"#404040",800:"#262626",900:"#171717",950:"#0a0a0a"},stone:{50:"#fafaf9",100:"#f5f5f4",200:"#e7e5e4",300:"#d6d3d1",400:"#a8a29e",500:"#78716c",600:"#57534e",700:"#44403c",800:"#292524",900:"#1c1917",950:"#0c0a09"},red:{50:"#fef2f2",100:"#fee2e2",200:"#fecaca",300:"#fca5a5",400:"#f87171",500:"#ef4444",600:"#dc2626",700:"#b91c1c",800:"#991b1b",900:"#7f1d1d",950:"#450a0a"},orange:{50:"#fff7ed",100:"#ffedd5",200:"#fed7aa",300:"#fdba74",400:"#fb923c",500:"#f97316",600:"#ea580c",700:"#c2410c",800:"#9a3412",900:"#7c2d12",950:"#431407"},amber:{50:"#fffbeb",100:"#fef3c7",200:"#fde68a",300:"#fcd34d",400:"#fbbf24",500:"#f59e0b",600:"#d97706",700:"#b45309",800:"#92400e",900:"#78350f",950:"#451a03"},yellow:{50:"#fefce8",100:"#fef9c3",200:"#fef08a",300:"#fde047",400:"#facc15",500:"#eab308",600:"#ca8a04",700:"#a16207",800:"#854d0e",900:"#713f12",950:"#422006"},lime:{50:"#f7fee7",100:"#ecfccb",200:"#d9f99d",300:"#bef264",400:"#a3e635",500:"#84cc16",600:"#65a30d",700:"#4d7c0f",800:"#3f6212",900:"#365314",950:"#1a2e05"},green:{50:"#f0fdf4",100:"#dcfce7",200:"#bbf7d0",300:"#86efac",400:"#4ade80",500:"#22c55e",600:"#16a34a",700:"#15803d",800:"#166534",900:"#14532d",950:"#052e16"},emerald:{50:"#ecfdf5",100:"#d1fae5",200:"#a7f3d0",300:"#6ee7b7",400:"#34d399",500:"#10b981",600:"#059669",700:"#047857",800:"#065f46",900:"#064e3b",950:"#022c22"},teal:{50:"#f0fdfa",100:"#ccfbf1",200:"#99f6e4",300:"#5eead4",400:"#2dd4bf",500:"#14b8a6",600:"#0d9488",700:"#0f766e",800:"#115e59",900:"#134e4a",950:"#042f2e"},cyan:{50:"#ecfeff",100:"#cffafe",200:"#a5f3fc",300:"#67e8f9",400:"#22d3ee",500:"#06b6d4",600:"#0891b2",700:"#0e7490",800:"#155e75",900:"#164e63",950:"#083344"},sky:{50:"#f0f9ff",100:"#e0f2fe",200:"#bae6fd",300:"#7dd3fc",400:"#38bdf8",500:"#0ea5e9",600:"#0284c7",700:"#0369a1",800:"#075985",900:"#0c4a6e",950:"#082f49"},blue:{50:"#eff6ff",100:"#dbeafe",200:"#bfdbfe",300:"#93c5fd",400:"#60a5fa",500:"#3b82f6",600:"#2563eb",700:"#1d4ed8",800:"#1e40af",900:"#1e3a8a",950:"#172554"},indigo:{50:"#eef2ff",100:"#e0e7ff",200:"#c7d2fe",300:"#a5b4fc",400:"#818cf8",500:"#6366f1",600:"#4f46e5",700:"#4338ca",800:"#3730a3",900:"#312e81",950:"#1e1b4b"},violet:{50:"#f5f3ff",100:"#ede9fe",200:"#ddd6fe",300:"#c4b5fd",400:"#a78bfa",500:"#8b5cf6",600:"#7c3aed",700:"#6d28d9",800:"#5b21b6",900:"#4c1d95",950:"#2e1065"},purple:{50:"#faf5ff",100:"#f3e8ff",200:"#e9d5ff",300:"#d8b4fe",400:"#c084fc",500:"#a855f7",600:"#9333ea",700:"#7e22ce",800:"#6b21a8",900:"#581c87",950:"#3b0764"},fuchsia:{50:"#fdf4ff",100:"#fae8ff",200:"#f5d0fe",300:"#f0abfc",400:"#e879f9",500:"#d946ef",600:"#c026d3",700:"#a21caf",800:"#86198f",900:"#701a75",950:"#4a044e"},pink:{50:"#fdf2f8",100:"#fce7f3",200:"#fbcfe8",300:"#f9a8d4",400:"#f472b6",500:"#ec4899",600:"#db2777",700:"#be185d",800:"#9d174d",900:"#831843",950:"#500724"},rose:{50:"#fff1f2",100:"#ffe4e6",200:"#fecdd3",300:"#fda4af",400:"#fb7185",500:"#f43f5e",600:"#e11d48",700:"#be123c",800:"#9f1239",900:"#881337",950:"#4c0519"}},P={"wh-primary-color":"var(--wh-primary-500)","wh-primary-color-hover":"#00a16e","wh-primary-color-transparent":"#00aa7424","wh-primary-color-transparent-light":"#00a8730f","wh-primary-color-transparent-strong":"#00a87340","wh-primary-light":"#53e3a6","wh-primary-dark":"#007f4b","wh-primary-dark-hover":"#017444","wh-primary-shadow":"#00b07841","wh-primary-shadow-2":"#00b07870","wh-primary-border-color":"#c8c8c870","wh-warning-color":"#ff5a1f","wh-warning-color-light":"#feecdc","wh-ai-primary-decimal":"167, 139, 250","wh-ai-secondary-decimal  ":"147, 51, 234","wh-ai-accent-decimal":"244, 114, 182","wh-ai-primary":"rgba(var(--wh-ai-primary-decimal), 1)","wh-ai-secondary":"rgba(var(--wh-ai-secondary-decimal), 1)","wh-ai-accent":"rgba(var(--wh-ai-accent-decimal), 1)","secondary-color":"#3d4455","secondary-color-hover":"#3a4052","secondary-color-transparent":"#3d44556b","secondary-light":"#4c556d","secondary-dark":"#252934","secondary-dark-hover":"#191b22","secondary-dark-transparent":"#2e2d2d46","highlight-color":"#92ffaa","error-color":"#d62d4c","error-color-light":"#fde8e8","error-info":"#14854e","success-color":"#0e9f6e","success-color-light":"#def7ec","font-color":"#2f3237","font-color-light":"#626364","font-color-dark":"#252525","wh-font-family":'\'SF Pro Display\', \'Inter\', ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"',"font-family":"var(--wh-font-family)","font-size":"12px","webhighlights-font-size":"12px","link-color":"#1d9bf0","wh-form-active-color":"#3b82f6","wh-accent-blue":"#1f6feb","wh-mobile-breakpoint":"767px",BREAKPOINT_XS:"575px",BREAKPOINT_S:"767px",BREAKPOINT_M:"991px",BREAKPOINT_L:"1199px",BREAKPOINT_XL:"1399px",BREAKPOINT_XXL:"1699px","wh-danger-color":"var(--wh-red-600)","wh-danger-color-hover":"var(--wh-red-700)","wh-font-size":"13px","wh-blockquote-line-height":"1.3"},x=[...Object.keys(R).map(e=>Object.keys(R[e]).map(t=>{const r=R[e][t];return{property:`wh-${e}-${t}`,value:{dark:r,light:r}}})).flat(),...Object.keys(P).map(e=>({property:e,value:{dark:P[e],light:P[e]}})),{property:"wh-bg-base",value:{dark:"var(--wh-secondary-600)",light:"hsl(0, 0%, 100%)"}},{property:"wh-bg-base-hover",value:{dark:"var(--wh-secondary-500)",light:"var(--wh-gray-50)"}},{property:"wh-border-base",value:{dark:"var(--wh-secondary-200)",light:"hsl(20, 6%, 94%)"}},{property:"wh-border-base-hover",value:{dark:"var(--wh-secondary-100)",light:"hsl(20, 6%, 90%)"}},{property:"wh-border-base-strong",value:{dark:"var(--wh-secondary-100)",light:"hsl(24, 6%, 85%)"}},{property:"wh-border-base-strong-hover",value:{dark:"var(--wh-secondary-50)",light:"hsl(24, 6%, 70%)"}},{property:"wh-bg-base-hover-strong",value:{dark:"var(--wh-secondary-300)",light:"var(--wh-gray-100)"}},{property:"wh-bg-back",value:{dark:"var(--wh-secondary-700)",light:"hsl(0, 0%, 100%)"}},{property:"wh-bg-back-strong",value:{dark:"var(--wh-secondary-800)",light:"var(--wh-gray-100)"}},{property:"wh-bg-back-strong-hover",value:{dark:"var(--wh-secondary-900)",light:"var(--wh-gray-200)"}},{property:"wh-bg-back-hover",value:{dark:"var(--wh-secondary-600)",light:"var(--wh-neutral-50)"}},{property:"wh-bg-back-hover-strong",value:{dark:"var(--wh-secondary-800)",light:"var(--wh-neutral-100)"}},{property:"wh-border-back",value:{dark:"var(--wh-secondary-100)",light:"#e7e5e4"}},{property:"wh-border-back-strong",value:{dark:"var(--wh-secondary-50)",light:"#d6d3d1"}},{property:"wh-bg-front",value:{dark:"var(--wh-secondary-400)",light:"hsl(0, 0%, 100%)"}},{property:"wh-bg-front-strong",value:{dark:"var(--wh-secondary-200)",light:"var(--wh-neutral-100)"}},{property:"wh-bg-front-strong-hover",value:{dark:"var(--wh-secondary-50)",light:"var(--wh-neutral-200)"}},{property:"wh-bg-front-hover",value:{dark:"var(--wh-secondary-300)",light:"hsl(0, 0%, 98%)"}},{property:"wh-bg-front-hover-strong",value:{dark:"var(--wh-secondary-200)",light:"hsl(0, 0%, 95%)"}},{property:"wh-border-front",value:{dark:"hsl(227, 20%, 25%)",light:"#e7e5e4"}},{property:"wh-border-front-strong",value:{dark:"hsl(227, 20%, 35%)",light:"#d6d3d1"}},{property:"wh-text-stronger",value:{dark:"hsla(0, 0%, 100%, 0.95)",light:"hsl(45, 8%, 25%)"}},{property:"wh-text-strongest",value:{dark:"hsla(0, 0%, 100%, 1)",light:"hsl(45, 8%, 20%)"}},{property:"wh-text-strong",value:{dark:"rgba(255, 255, 255, 0.9)",light:"rgb(55, 53, 47)"}},{property:"wh-text",value:{dark:"rgba(255, 255, 255, 0.85)",light:"rgb(55, 53, 47)"}},{property:"wh-text-hover",value:{dark:"var(--wh-text-strong)",light:"var(--wh-text-strong)"}},{property:"wh-text-light",value:{dark:"rgba(255, 255, 255, 0.78)",light:"rgb(55, 53, 47, 0.9)"}},{property:"wh-text-lighter",value:{dark:"rgba(255, 255, 255, 0.66)",light:"rgb(55, 53, 47, 0.7)"}},{property:"wh-text-lightest",value:{dark:"rgba(255, 255, 255, 0.55)",light:"rgb(55, 53, 47, 0.5)"}},{property:"wh-border-color",value:{dark:"hsla(0, 0%, 100%, 0.15)",light:"var(--wh-gray-300)"}},{property:"wh-border-color-strong",value:{dark:"hsla(0, 0%, 100%, 0.25)",light:"var(--wh-gray-400)"}},{property:"wh-note-editor-bg-color",value:{dark:"hsl(221, 27%, 17%)",light:"rgb(247, 246, 243)"}},{property:"wh-note-editor-bg-color-preview",value:{dark:"hsl(221, 27%, 15%)",light:"rgba(247, 246, 243, 0.85)"}},{property:"wh-bg-tags",value:{dark:"var(--wh-secondary-300)",light:"var(--wh-bg-front-strong)"}},{property:"wh-bg-tags-hover",value:{dark:"var(--wh-secondary-200)",light:"var(--wh-bg-front-strong-hover)"}},{property:"wh-syntax-bg-color",value:{dark:"rgba(255, 255, 255, 0.05)",light:"rgb(230, 230, 230)"}},{property:"wh-fallback-img-color",value:{dark:"var(--wh-secondary-600)",light:"var(--wh-gray-100)"}},{property:"wh-bg-disabled",value:{dark:"hsl(220, 22%, 18%)",light:"#e7e9ec"}},{property:"wh-bg-notification-unread",value:{dark:"hsla(161, 100%, 20%, 0.15)",light:"rgba(187, 219, 204, 0.2)"}},{property:"wh-bg-notification-unread-hover",value:{dark:"hsla(161, 100%, 20%, 0.05)",light:"rgba(187, 219, 204, 0.1)"}},{property:"wh-subtle-gray",value:{dark:"rgb(255, 255, 255, 0.1)",light:"rgb(128, 128, 128, 0.15)"}},{property:"wh-shadow",value:{dark:"inset 0 0 0.5px 1px hsla(0, 0%, 100%, 0.1),\n      /* 2. shadow ring  */ 0 0 0 1px hsla(230, 13%, 9%, 0.075),\n      /* 3. multiple soft shadows  */ 0 0.3px 0.4px hsla(230, 13%, 9%, 0.02),\n      0 0.9px 1.5px hsla(230, 13%, 9%, 0.045),\n      0 3.5px 6px hsla(230, 13%, 9%, 0.09)",light:"inset 0 0 0.5px 1px hsla(0, 0%, 100%, 0.1),\n      /* 2. shadow ring  */ 0 0 0 1px hsla(230, 13%, 9%, 0.075),\n      /* 3. multiple soft shadows  */ 0 0.3px 0.4px hsla(230, 13%, 9%, 0.02),\n      0 0.9px 1.5px hsla(230, 13%, 9%, 0.045),\n      0 3.5px 6px hsla(230, 13%, 9%, 0.09)"}},{property:"wh-shadow-primary",value:{dark:"var(--wh-primary-500) 0px 0px 0px 1px inset,\n      var(--wh-primary-500) 0px 0px 1px",light:"var(--wh-primary-500) 0px 0px 0px 1px inset,\n      var(--wh-primary-500) 0px 0px 1px"}},{property:"wh-skeleton-bg",value:{dark:"var(--wh-secondary-300)",light:"var(--wh-gray-200)"}},{property:"wh-skeleton-bg-hover",value:{dark:"var(--wh-secondary-200)",light:"var(--wh-gray-300)"}},{property:"wh-skeleton-bg-strong",value:{dark:"var(--wh-secondary-200)",light:"var(--wh-gray-300)"}},{property:"wh-skeleton-bg-strong-hover",value:{dark:"var(--wh-secondary-100)",light:"var(--wh-gray-400)"}}];function G(e){const t=e??(typeof window>"u"||"function"!=typeof window.matchMedia?"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),r=x.map(e=>((e,t)=>({property:e.property,value:e.value[t]}))(e,t));!function(e){const t=function(e){return`:root { ${e.map(({property:e,value:t})=>`${e.startsWith("--")?e:`--${e}`}: ${t};`).join("")} }`}(e);D(L.GLOBAL_STYLE_VARIABLES_ID,t)}(r)}!function(e){function t(e,t){if(t&&t.documentElement)e=t,t=arguments[2];else if(!e||!e.documentElement)throw new Error("First argument to Readability constructor should be a document object.");if(t=t||{},this._doc=e,this._docJSDOMParser=this._doc.firstChild.__JSDOMParser__,this._articleTitle=null,this._articleByline=null,this._articleDir=null,this._articleSiteName=null,this._attempts=[],this._metadata={},this._debug=!!t.debug,this._maxElemsToParse=t.maxElemsToParse||this.DEFAULT_MAX_ELEMS_TO_PARSE,this._nbTopCandidates=t.nbTopCandidates||this.DEFAULT_N_TOP_CANDIDATES,this._charThreshold=t.charThreshold||this.DEFAULT_CHAR_THRESHOLD,this._classesToPreserve=this.CLASSES_TO_PRESERVE.concat(t.classesToPreserve||[]),this._keepClasses=!!t.keepClasses,this._serializer=t.serializer||function(e){return e.innerHTML},this._disableJSONLD=!!t.disableJSONLD,this._allowedVideoRegex=t.allowedVideoRegex||this.REGEXPS.videos,this._linkDensityModifier=t.linkDensityModifier||0,this._flags=this.FLAG_STRIP_UNLIKELYS|this.FLAG_WEIGHT_CLASSES|this.FLAG_CLEAN_CONDITIONALLY,this._debug){let e=function(e){if(e.nodeType==e.TEXT_NODE)return`${e.nodeName} ("${e.textContent}")`;let t=Array.from(e.attributes||[],function(e){return`${e.name}="${e.value}"`}).join(" ");return`<${e.localName} ${t}>`};this.log=function(){if(typeof console<"u"){let t=Array.from(arguments,t=>t&&t.nodeType==this.ELEMENT_NODE?e(t):t);t.unshift("Reader: (Readability)"),console.log(...t)}else if(typeof dump<"u"){var t=Array.prototype.map.call(arguments,function(t){return t&&t.nodeName?e(t):t}).join(" ");dump("Reader: (Readability) "+t+"\n")}}}else this.log=function(){}}t.prototype={FLAG_STRIP_UNLIKELYS:1,FLAG_WEIGHT_CLASSES:2,FLAG_CLEAN_CONDITIONALLY:4,ELEMENT_NODE:1,TEXT_NODE:3,DEFAULT_MAX_ELEMS_TO_PARSE:0,DEFAULT_N_TOP_CANDIDATES:5,DEFAULT_TAGS_TO_SCORE:"section,h2,h3,h4,h5,h6,p,td,pre".toUpperCase().split(","),DEFAULT_CHAR_THRESHOLD:500,REGEXPS:{unlikelyCandidates:/-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|content|main|shadow/i,positive:/article|body|content|entry|hentry|h-entry|main|page|pagination|post|text|blog|story/i,negative:/-ad-|hidden|^hid$| hid$| hid |^hid |banner|combx|comment|com-|contact|footer|gdpr|masthead|media|meta|outbrain|promo|related|scroll|share|shoutbox|sidebar|skyscraper|sponsor|shopping|tags|widget/i,extraneous:/print|archive|comment|discuss|e[\-]?mail|share|reply|all|login|sign|single|utility/i,byline:/byline|author|dateline|writtenby|p-author/i,replaceFonts:/<(\/?)font[^>]*>/gi,normalize:/\s{2,}/g,videos:/\/\/(www\.)?((dailymotion|youtube|youtube-nocookie|player\.vimeo|v\.qq)\.com|(archive|upload\.wikimedia)\.org|player\.twitch\.tv)/i,shareElements:/(\b|_)(share|sharedaddy)(\b|_)/i,nextLink:/(next|weiter|continue|>([^\|]|$)|([^\|]|$))/i,prevLink:/(prev|earl|old|new|<|)/i,tokenize:/\W+/g,whitespace:/^\s*$/,hasContent:/\S$/,hashUrl:/^#.+/,srcsetUrl:/(\S+)(\s+[\d.]+[xw])?(\s*(?:,|$))/g,b64DataUrl:/^data:\s*([^\s;,]+)\s*;\s*base64\s*,/i,commas:/\u002C|\u060C|\uFE50|\uFE10|\uFE11|\u2E41|\u2E34|\u2E32|\uFF0C/g,jsonLdArticleTypes:/^Article|AdvertiserContentArticle|NewsArticle|AnalysisNewsArticle|AskPublicNewsArticle|BackgroundNewsArticle|OpinionNewsArticle|ReportageNewsArticle|ReviewNewsArticle|Report|SatiricalArticle|ScholarlyArticle|MedicalScholarlyArticle|SocialMediaPosting|BlogPosting|LiveBlogPosting|DiscussionForumPosting|TechArticle|APIReference$/,adWords:/^(ad(vertising|vertisement)?|pub(licit)?|werb(ung)?|||Anuncio)$/iu,loadingWords:/^((loading|||chargement|cargando)(|\.\.\.)?)$/iu},UNLIKELY_ROLES:["menu","menubar","complementary","navigation","alert","alertdialog","dialog"],DIV_TO_P_ELEMS:new Set(["BLOCKQUOTE","DL","DIV","IMG","OL","P","PRE","TABLE","UL"]),ALTER_TO_DIV_EXCEPTIONS:["DIV","ARTICLE","SECTION","P","OL","UL"],PRESENTATIONAL_ATTRIBUTES:["align","background","bgcolor","border","cellpadding","cellspacing","frame","hspace","rules","style","valign","vspace"],DEPRECATED_SIZE_ATTRIBUTE_ELEMS:["TABLE","TH","TD","HR","PRE"],PHRASING_ELEMS:["ABBR","AUDIO","B","BDO","BR","BUTTON","CITE","CODE","DATA","DATALIST","DFN","EM","EMBED","I","IMG","INPUT","KBD","LABEL","MARK","MATH","METER","NOSCRIPT","OBJECT","OUTPUT","PROGRESS","Q","RUBY","SAMP","SCRIPT","SELECT","SMALL","SPAN","STRONG","SUB","SUP","TEXTAREA","TIME","VAR","WBR"],CLASSES_TO_PRESERVE:["page"],HTML_ESCAPE_MAP:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"},_postProcessContent(e){this._fixRelativeUris(e),this._simplifyNestedElements(e),this._keepClasses||this._cleanClasses(e)},_removeNodes(e,t){if(this._docJSDOMParser&&e._isLiveNodeList)throw new Error("Do not pass live node lists to _removeNodes");for(var r=e.length-1;r>=0;r--){var i=e[r],n=i.parentNode;n&&(!t||t.call(this,i,r,e))&&n.removeChild(i)}},_replaceNodeTags(e,t){if(this._docJSDOMParser&&e._isLiveNodeList)throw new Error("Do not pass live node lists to _replaceNodeTags");for(const r of e)this._setNodeTag(r,t)},_forEachNode(e,t){Array.prototype.forEach.call(e,t,this)},_findNode(e,t){return Array.prototype.find.call(e,t,this)},_someNode(e,t){return Array.prototype.some.call(e,t,this)},_everyNode(e,t){return Array.prototype.every.call(e,t,this)},_getAllNodesWithTag:(e,t)=>e.querySelectorAll?e.querySelectorAll(t.join(",")):[].concat.apply([],t.map(function(t){var r=e.getElementsByTagName(t);return Array.isArray(r)?r:Array.from(r)})),_cleanClasses(e){var t=this._classesToPreserve,r=(e.getAttribute("class")||"").split(/\s+/).filter(e=>t.includes(e)).join(" ");for(r?e.setAttribute("class",r):e.removeAttribute("class"),e=e.firstElementChild;e;e=e.nextElementSibling)this._cleanClasses(e)},_isUrl(e){try{return new URL(e),!0}catch{return!1}},_fixRelativeUris(e){var t=this._doc.baseURI,r=this._doc.documentURI;function i(e){if(t==r&&"#"==e.charAt(0))return e;try{return new URL(e,t).href}catch{}return e}var n=this._getAllNodesWithTag(e,["a"]);this._forEachNode(n,function(e){var t=e.getAttribute("href");if(t)if(0===t.indexOf("javascript:"))if(1===e.childNodes.length&&e.childNodes[0].nodeType===this.TEXT_NODE){var r=this._doc.createTextNode(e.textContent);e.parentNode.replaceChild(r,e)}else{for(var n=this._doc.createElement("span");e.firstChild;)n.appendChild(e.firstChild);e.parentNode.replaceChild(n,e)}else e.setAttribute("href",i(t))});var o=this._getAllNodesWithTag(e,["img","picture","figure","video","audio","source"]);this._forEachNode(o,function(e){var t=e.getAttribute("src"),r=e.getAttribute("poster"),n=e.getAttribute("srcset");if(t&&e.setAttribute("src",i(t)),r&&e.setAttribute("poster",i(r)),n){var o=n.replace(this.REGEXPS.srcsetUrl,function(e,t,r,n){return i(t)+(r||"")+n});e.setAttribute("srcset",o)}})},_simplifyNestedElements(e){for(var t=e;t;){if(t.parentNode&&["DIV","SECTION"].includes(t.tagName)&&(!t.id||!t.id.startsWith("readability"))){if(this._isElementWithoutContent(t)){t=this._removeAndGetNext(t);continue}if(this._hasSingleTagInsideElement(t,"DIV")||this._hasSingleTagInsideElement(t,"SECTION")){for(var r=t.children[0],i=0;i<t.attributes.length;i++)r.setAttributeNode(t.attributes[i].cloneNode());t.parentNode.replaceChild(r,t),t=r;continue}}t=this._getNextNode(t)}},_getArticleTitle(){var e=this._doc,t="",r="";try{"string"!=typeof(t=r=e.title.trim())&&(t=r=this._getInnerText(e.getElementsByTagName("title")[0]))}catch{}var i=!1;function n(e){return e.split(/\s+/).length}if(/ [\|\-\\\/>] /.test(t)){i=/ [\\\/>] /.test(t);let e=Array.from(r.matchAll(/ [\|\-\\\/>] /gi));n(t=r.substring(0,e.pop().index))<3&&(t=r.replace(/^[^\|\-\\\/>]*[\|\-\\\/>]/gi,""))}else if(t.includes(": ")){var o=this._getAllNodesWithTag(e,["h1","h2"]),s=t.trim(),a=this._someNode(o,function(e){return e.textContent.trim()===s});a||(n(t=r.substring(r.lastIndexOf(":")+1))<3?t=r.substring(r.indexOf(":")+1):n(r.substr(0,r.indexOf(":")))>5&&(t=r))}else if(t.length>150||t.length<15){var l=e.getElementsByTagName("h1");1===l.length&&(t=this._getInnerText(l[0]))}var c=n(t=t.trim().replace(this.REGEXPS.normalize," "));return c<=4&&(!i||c!=n(r.replace(/[\|\-\\\/>]+/g,""))-1)&&(t=r),t},_prepDocument(){var e=this._doc;this._removeNodes(this._getAllNodesWithTag(e,["style"])),e.body&&this._replaceBrs(e.body),this._replaceNodeTags(this._getAllNodesWithTag(e,["font"]),"SPAN")},_nextNode(e){for(var t=e;t&&t.nodeType!=this.ELEMENT_NODE&&this.REGEXPS.whitespace.test(t.textContent);)t=t.nextSibling;return t},_replaceBrs(e){this._forEachNode(this._getAllNodesWithTag(e,["br"]),function(e){for(var t=e.nextSibling,r=!1;(t=this._nextNode(t))&&"BR"==t.tagName;){r=!0;var i=t.nextSibling;t.remove(),t=i}if(r){var n=this._doc.createElement("p");for(e.parentNode.replaceChild(n,e),t=n.nextSibling;t;){if("BR"==t.tagName){var o=this._nextNode(t.nextSibling);if(o&&"BR"==o.tagName)break}if(!this._isPhrasingContent(t))break;var s=t.nextSibling;n.appendChild(t),t=s}for(;n.lastChild&&this._isWhitespace(n.lastChild);)n.lastChild.remove();"P"===n.parentNode.tagName&&this._setNodeTag(n.parentNode,"DIV")}})},_setNodeTag(e,t){if(this.log("_setNodeTag",e,t),this._docJSDOMParser)return e.localName=t.toLowerCase(),e.tagName=t.toUpperCase(),e;for(var r=e.ownerDocument.createElement(t);e.firstChild;)r.appendChild(e.firstChild);e.parentNode.replaceChild(r,e),e.readability&&(r.readability=e.readability);for(var i=0;i<e.attributes.length;i++)r.setAttributeNode(e.attributes[i].cloneNode());return r},_prepArticle(e){this._cleanStyles(e),this._markDataTables(e),this._fixLazyImages(e),this._cleanConditionally(e,"form"),this._cleanConditionally(e,"fieldset"),this._clean(e,"object"),this._clean(e,"embed"),this._clean(e,"footer"),this._clean(e,"link"),this._clean(e,"aside");var t=this.DEFAULT_CHAR_THRESHOLD;this._forEachNode(e.children,function(e){this._cleanMatchedNodes(e,function(e,r){return this.REGEXPS.shareElements.test(r)&&e.textContent.length<t})}),this._clean(e,"iframe"),this._clean(e,"input"),this._clean(e,"textarea"),this._clean(e,"select"),this._clean(e,"button"),this._cleanHeaders(e),this._cleanConditionally(e,"table"),this._cleanConditionally(e,"ul"),this._cleanConditionally(e,"div"),this._replaceNodeTags(this._getAllNodesWithTag(e,["h1"]),"h2"),this._removeNodes(this._getAllNodesWithTag(e,["p"]),function(e){return 0===this._getAllNodesWithTag(e,["img","embed","object","iframe"]).length&&!this._getInnerText(e,!1)}),this._forEachNode(this._getAllNodesWithTag(e,["br"]),function(e){var t=this._nextNode(e.nextSibling);t&&"P"==t.tagName&&e.remove()}),this._forEachNode(this._getAllNodesWithTag(e,["table"]),function(e){var t=this._hasSingleTagInsideElement(e,"TBODY")?e.firstElementChild:e;if(this._hasSingleTagInsideElement(t,"TR")){var r=t.firstElementChild;if(this._hasSingleTagInsideElement(r,"TD")){var i=r.firstElementChild;i=this._setNodeTag(i,this._everyNode(i.childNodes,this._isPhrasingContent)?"P":"DIV"),e.parentNode.replaceChild(i,e)}}})},_initializeNode(e){switch(e.readability={contentScore:0},e.tagName){case"DIV":e.readability.contentScore+=5;break;case"PRE":case"TD":case"BLOCKQUOTE":e.readability.contentScore+=3;break;case"ADDRESS":case"OL":case"UL":case"DL":case"DD":case"DT":case"LI":case"FORM":e.readability.contentScore-=3;break;case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"TH":e.readability.contentScore-=5}e.readability.contentScore+=this._getClassWeight(e)},_removeAndGetNext(e){var t=this._getNextNode(e,!0);return e.remove(),t},_getNextNode(e,t){if(!t&&e.firstElementChild)return e.firstElementChild;if(e.nextElementSibling)return e.nextElementSibling;do{e=e.parentNode}while(e&&!e.nextElementSibling);return e&&e.nextElementSibling},_textSimilarity(e,t){var r=e.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean),i=t.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean);if(!r.length||!i.length)return 0;var n=i.filter(e=>!r.includes(e));return 1-n.join(" ").length/i.join(" ").length},_isValidByline(e,t){var r=e.getAttribute("rel"),i=e.getAttribute("itemprop"),n=e.textContent.trim().length;return("author"===r||i&&i.includes("author")||this.REGEXPS.byline.test(t))&&!!n&&n<100},_getNodeAncestors(e,t){t=t||0;for(var r=0,i=[];e.parentNode&&(i.push(e.parentNode),!t||++r!==t);)e=e.parentNode;return i},_grabArticle(e){this.log("**** grabArticle ****");var t=this._doc,r=null!==e;if(!(e=e||this._doc.body))return this.log("No body found in document. Abort."),null;for(var i=e.innerHTML;;){this.log("Starting grabArticle loop");var n=this._flagIsActive(this.FLAG_STRIP_UNLIKELYS),o=[],s=this._doc.documentElement;let Y=!0;for(;s;){"HTML"===s.tagName&&(this._articleLang=s.getAttribute("lang"));var a=s.className+" "+s.id;if(this._isProbablyVisible(s))if("true"!=s.getAttribute("aria-modal")||"dialog"!=s.getAttribute("role"))if(this._articleByline||this._metadata.byline||!this._isValidByline(s,a))if(Y&&this._headerDuplicatesTitle(s))this.log("Removing header: ",s.textContent.trim(),this._articleTitle.trim()),Y=!1,s=this._removeAndGetNext(s);else{if(n){if(this.REGEXPS.unlikelyCandidates.test(a)&&!this.REGEXPS.okMaybeItsACandidate.test(a)&&!this._hasAncestorTag(s,"table")&&!this._hasAncestorTag(s,"code")&&"BODY"!==s.tagName&&"A"!==s.tagName){this.log("Removing unlikely candidate - "+a),s=this._removeAndGetNext(s);continue}if(this.UNLIKELY_ROLES.includes(s.getAttribute("role"))){this.log("Removing content with role "+s.getAttribute("role")+" - "+a),s=this._removeAndGetNext(s);continue}}if("DIV"!==s.tagName&&"SECTION"!==s.tagName&&"HEADER"!==s.tagName&&"H1"!==s.tagName&&"H2"!==s.tagName&&"H3"!==s.tagName&&"H4"!==s.tagName&&"H5"!==s.tagName&&"H6"!==s.tagName||!this._isElementWithoutContent(s)){if(this.DEFAULT_TAGS_TO_SCORE.includes(s.tagName)&&o.push(s),"DIV"===s.tagName){for(var l=null,c=s.firstChild;c;){var h=c.nextSibling;if(this._isPhrasingContent(c))null!==l?l.appendChild(c):this._isWhitespace(c)||(l=t.createElement("p"),s.replaceChild(l,c),l.appendChild(c));else if(null!==l){for(;l.lastChild&&this._isWhitespace(l.lastChild);)l.lastChild.remove();l=null}c=h}if(this._hasSingleTagInsideElement(s,"P")&&this._getLinkDensity(s)<.25){var u=s.children[0];s.parentNode.replaceChild(u,s),s=u,o.push(s)}else this._hasChildBlockElement(s)||(s=this._setNodeTag(s,"P"),o.push(s))}s=this._getNextNode(s)}else s=this._removeAndGetNext(s)}else{for(var d=this._getNextNode(s,!0),g=this._getNextNode(s),f=null;g&&g!=d;){var p=g.getAttribute("itemprop");if(p&&p.includes("name")){f=g;break}g=this._getNextNode(g)}this._articleByline=(f??s).textContent.trim(),s=this._removeAndGetNext(s)}else s=this._removeAndGetNext(s);else this.log("Removing hidden node - "+a),s=this._removeAndGetNext(s)}var m=[];this._forEachNode(o,function(e){if(e.parentNode&&!(typeof e.parentNode.tagName>"u")){var t=this._getInnerText(e);if(!(t.length<25)){var r=this._getNodeAncestors(e,5);if(0!==r.length){var i=0;i+=1,i+=t.split(this.REGEXPS.commas).length,i+=Math.min(Math.floor(t.length/100),3),this._forEachNode(r,function(e,t){if(e.tagName&&e.parentNode&&!(typeof e.parentNode.tagName>"u")){if(typeof e.readability>"u"&&(this._initializeNode(e),m.push(e)),0===t)var r=1;else r=1===t?2:3*t;e.readability.contentScore+=i/r}})}}}});for(var y=[],b=0,T=m.length;b<T;b+=1){var _=m[b],A=_.readability.contentScore*(1-this._getLinkDensity(_));_.readability.contentScore=A,this.log("Candidate:",_,"with score "+A);for(var v=0;v<this._nbTopCandidates;v++){var w=y[v];if(!w||A>w.readability.contentScore){y.splice(v,0,_),y.length>this._nbTopCandidates&&y.pop();break}}}var E,S=y[0]||null,I=!1;if(null===S||"BODY"===S.tagName){for(S=t.createElement("DIV"),I=!0;e.firstChild;)this.log("Moving child out:",e.firstChild),S.appendChild(e.firstChild);e.appendChild(S),this._initializeNode(S)}else if(S){for(var N=[],O=1;O<y.length;O++)y[O].readability.contentScore/S.readability.contentScore>=.75&&N.push(this._getNodeAncestors(y[O]));if(N.length>=3)for(E=S.parentNode;"BODY"!==E.tagName;){for(var k=0,C=0;C<N.length&&k<3;C++)k+=Number(N[C].includes(E));if(k>=3){S=E;break}E=E.parentNode}S.readability||this._initializeNode(S),E=S.parentNode;for(var L=S.readability.contentScore,D=L/3;"BODY"!==E.tagName;)if(E.readability){var R=E.readability.contentScore;if(R<D)break;if(R>L){S=E;break}L=E.readability.contentScore,E=E.parentNode}else E=E.parentNode;for(E=S.parentNode;"BODY"!=E.tagName&&1==E.children.length;)E=(S=E).parentNode;S.readability||this._initializeNode(S)}var P=t.createElement("DIV");r&&(P.id="readability-content");for(var x=Math.max(10,.2*S.readability.contentScore),G=(E=S.parentNode).children,B=0,U=G.length;B<U;B++){var M=G[B],j=!1;if(this.log("Looking at sibling node:",M,M.readability?"with score "+M.readability.contentScore:""),this.log("Sibling has score",M.readability?M.readability.contentScore:"Unknown"),M===S)j=!0;else{var F=0;if(M.className===S.className&&""!==S.className&&(F+=.2*S.readability.contentScore),M.readability&&M.readability.contentScore+F>=x)j=!0;else if("P"===M.nodeName){var $=this._getLinkDensity(M),H=this._getInnerText(M),W=H.length;(W>80&&$<.25||W<80&&W>0&&0===$&&-1!==H.search(/\.( |$)/))&&(j=!0)}}j&&(this.log("Appending node:",M),this.ALTER_TO_DIV_EXCEPTIONS.includes(M.nodeName)||(this.log("Altering sibling:",M,"to div."),M=this._setNodeTag(M,"DIV")),P.appendChild(M),G=E.children,B-=1,U-=1)}if(this._debug&&this.log("Article content pre-prep: "+P.innerHTML),this._prepArticle(P),this._debug&&this.log("Article content post-prep: "+P.innerHTML),I)S.id="readability-page-1",S.className="page";else{var V=t.createElement("DIV");for(V.id="readability-page-1",V.className="page";P.firstChild;)V.appendChild(P.firstChild);P.appendChild(V)}this._debug&&this.log("Article content after paging: "+P.innerHTML);var q=!0,z=this._getInnerText(P,!0).length;if(z<this._charThreshold)if(q=!1,e.innerHTML=i,this._attempts.push({articleContent:P,textLength:z}),this._flagIsActive(this.FLAG_STRIP_UNLIKELYS))this._removeFlag(this.FLAG_STRIP_UNLIKELYS);else if(this._flagIsActive(this.FLAG_WEIGHT_CLASSES))this._removeFlag(this.FLAG_WEIGHT_CLASSES);else if(this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY))this._removeFlag(this.FLAG_CLEAN_CONDITIONALLY);else{if(this._attempts.sort(function(e,t){return t.textLength-e.textLength}),!this._attempts[0].textLength)return null;P=this._attempts[0].articleContent,q=!0}if(q){var K=[E,S].concat(this._getNodeAncestors(E));return this._someNode(K,function(e){if(!e.tagName)return!1;var t=e.getAttribute("dir");return!!t&&(this._articleDir=t,!0)}),P}}},_unescapeHtmlEntities(e){if(!e)return e;var t=this.HTML_ESCAPE_MAP;return e.replace(/&(quot|amp|apos|lt|gt);/g,function(e,r){return t[r]}).replace(/&#(?:x([0-9a-f]+)|([0-9]+));/gi,function(e,t,r){var i=parseInt(t||r,t?16:10);return(0==i||i>1114111||i>=55296&&i<=57343)&&(i=65533),String.fromCodePoint(i)})},_getJSONLD(e){var t,r=this._getAllNodesWithTag(e,["script"]);return this._forEachNode(r,function(e){if(!t&&"application/ld+json"===e.getAttribute("type"))try{var r=e.textContent.replace(/^\s*<!\[CDATA\[|\]\]>\s*$/g,""),i=JSON.parse(r);if(Array.isArray(i)&&(i=i.find(e=>e["@type"]&&e["@type"].match(this.REGEXPS.jsonLdArticleTypes)),!i))return;var n=/^https?\:\/\/schema\.org\/?$/;if(!(("string"==typeof i["@context"]&&i["@context"].match(n)||"object"==typeof i["@context"]&&"string"==typeof i["@context"]["@vocab"]&&i["@context"]["@vocab"].match(n))&&(!i["@type"]&&Array.isArray(i["@graph"])&&(i=i["@graph"].find(e=>(e["@type"]||"").match(this.REGEXPS.jsonLdArticleTypes))),i&&i["@type"]&&i["@type"].match(this.REGEXPS.jsonLdArticleTypes))))return;if(t={},"string"==typeof i.name&&"string"==typeof i.headline&&i.name!==i.headline){var o=this._getArticleTitle(),s=this._textSimilarity(i.name,o)>.75,a=this._textSimilarity(i.headline,o)>.75;t.title=a&&!s?i.headline:i.name}else"string"==typeof i.name?t.title=i.name.trim():"string"==typeof i.headline&&(t.title=i.headline.trim());i.author&&("string"==typeof i.author.name?t.byline=i.author.name.trim():Array.isArray(i.author)&&i.author[0]&&"string"==typeof i.author[0].name&&(t.byline=i.author.filter(function(e){return e&&"string"==typeof e.name}).map(function(e){return e.name.trim()}).join(", "))),"string"==typeof i.description&&(t.excerpt=i.description.trim()),i.publisher&&"string"==typeof i.publisher.name&&(t.siteName=i.publisher.name.trim()),"string"==typeof i.datePublished&&(t.datePublished=i.datePublished.trim())}catch(e){this.log(e.message)}}),t||{}},_getArticleMetadata(e){var t={},r={},i=this._doc.getElementsByTagName("meta"),n=/\s*(article|dc|dcterm|og|twitter)\s*:\s*(author|creator|description|published_time|title|site_name)\s*/gi,o=/^\s*(?:(dc|dcterm|og|twitter|parsely|weibo:(article|webpage))\s*[-\.:]\s*)?(author|creator|pub-date|description|title|site_name)\s*$/i;this._forEachNode(i,function(e){var t=e.getAttribute("name"),i=e.getAttribute("property"),s=e.getAttribute("content");if(s){var a=null,l=null;i&&(a=i.match(n))&&(l=a[0].toLowerCase().replace(/\s/g,""),r[l]=s.trim()),!a&&t&&o.test(t)&&(l=t,s&&(l=l.toLowerCase().replace(/\s/g,"").replace(/\./g,":"),r[l]=s.trim()))}}),t.title=e.title||r["dc:title"]||r["dcterm:title"]||r["og:title"]||r["weibo:article:title"]||r["weibo:webpage:title"]||r.title||r["twitter:title"]||r["parsely-title"],t.title||(t.title=this._getArticleTitle());const s="string"!=typeof r["article:author"]||this._isUrl(r["article:author"])?void 0:r["article:author"];return t.byline=e.byline||r["dc:creator"]||r["dcterm:creator"]||r.author||r["parsely-author"]||s,t.excerpt=e.excerpt||r["dc:description"]||r["dcterm:description"]||r["og:description"]||r["weibo:article:description"]||r["weibo:webpage:description"]||r.description||r["twitter:description"],t.siteName=e.siteName||r["og:site_name"],t.publishedTime=e.datePublished||r["article:published_time"]||r["parsely-pub-date"]||null,t.title=this._unescapeHtmlEntities(t.title),t.byline=this._unescapeHtmlEntities(t.byline),t.excerpt=this._unescapeHtmlEntities(t.excerpt),t.siteName=this._unescapeHtmlEntities(t.siteName),t.publishedTime=this._unescapeHtmlEntities(t.publishedTime),t},_isSingleImage(e){for(;e;){if("IMG"===e.tagName)return!0;if(1!==e.children.length||""!==e.textContent.trim())return!1;e=e.children[0]}return!1},_unwrapNoscriptImages(e){var t=Array.from(e.getElementsByTagName("img"));this._forEachNode(t,function(e){for(var t=0;t<e.attributes.length;t++){var r=e.attributes[t];switch(r.name){case"src":case"srcset":case"data-src":case"data-srcset":return}if(/\.(jpg|jpeg|png|webp)/i.test(r.value))return}e.remove()});var r=Array.from(e.getElementsByTagName("noscript"));this._forEachNode(r,function(t){if(this._isSingleImage(t)){var r=e.createElement("div");r.innerHTML=t.innerHTML;var i=t.previousElementSibling;if(i&&this._isSingleImage(i)){var n=i;"IMG"!==n.tagName&&(n=i.getElementsByTagName("img")[0]);for(var o=r.getElementsByTagName("img")[0],s=0;s<n.attributes.length;s++){var a=n.attributes[s];if(""!==a.value&&("src"===a.name||"srcset"===a.name||/\.(jpg|jpeg|png|webp)/i.test(a.value))){if(o.getAttribute(a.name)===a.value)continue;var l=a.name;o.hasAttribute(l)&&(l="data-old-"+l),o.setAttribute(l,a.value)}}t.parentNode.replaceChild(r.firstElementChild,i)}}})},_removeScripts(e){this._removeNodes(this._getAllNodesWithTag(e,["script","noscript"]))},_hasSingleTagInsideElement(e,t){return 1==e.children.length&&e.children[0].tagName===t&&!this._someNode(e.childNodes,function(e){return e.nodeType===this.TEXT_NODE&&this.REGEXPS.hasContent.test(e.textContent)})},_isElementWithoutContent(e){return!(e.nodeType!==this.ELEMENT_NODE||e.textContent.trim().length||e.children.length&&e.children.length!=e.getElementsByTagName("br").length+e.getElementsByTagName("hr").length)},_hasChildBlockElement(e){return this._someNode(e.childNodes,function(e){return this.DIV_TO_P_ELEMS.has(e.tagName)||this._hasChildBlockElement(e)})},_isPhrasingContent(e){return e.nodeType===this.TEXT_NODE||this.PHRASING_ELEMS.includes(e.tagName)||("A"===e.tagName||"DEL"===e.tagName||"INS"===e.tagName)&&this._everyNode(e.childNodes,this._isPhrasingContent)},_isWhitespace(e){return e.nodeType===this.TEXT_NODE&&0===e.textContent.trim().length||e.nodeType===this.ELEMENT_NODE&&"BR"===e.tagName},_getInnerText(e,t){t=typeof t>"u"||t;var r=e.textContent.trim();return t?r.replace(this.REGEXPS.normalize," "):r},_getCharCount(e,t){return t=t||",",this._getInnerText(e).split(t).length-1},_cleanStyles(e){if(e&&"svg"!==e.tagName.toLowerCase()){for(var t=0;t<this.PRESENTATIONAL_ATTRIBUTES.length;t++)e.removeAttribute(this.PRESENTATIONAL_ATTRIBUTES[t]);this.DEPRECATED_SIZE_ATTRIBUTE_ELEMS.includes(e.tagName)&&(e.removeAttribute("width"),e.removeAttribute("height"));for(var r=e.firstElementChild;null!==r;)this._cleanStyles(r),r=r.nextElementSibling}},_getLinkDensity(e){var t=this._getInnerText(e).length;if(0===t)return 0;var r=0;return this._forEachNode(e.getElementsByTagName("a"),function(e){var t=e.getAttribute("href"),i=t&&this.REGEXPS.hashUrl.test(t)?.3:1;r+=this._getInnerText(e).length*i}),r/t},_getClassWeight(e){if(!this._flagIsActive(this.FLAG_WEIGHT_CLASSES))return 0;var t=0;return"string"==typeof e.className&&""!==e.className&&(this.REGEXPS.negative.test(e.className)&&(t-=25),this.REGEXPS.positive.test(e.className)&&(t+=25)),"string"==typeof e.id&&""!==e.id&&(this.REGEXPS.negative.test(e.id)&&(t-=25),this.REGEXPS.positive.test(e.id)&&(t+=25)),t},_clean(e,t){var r=["object","embed","iframe"].includes(t);this._removeNodes(this._getAllNodesWithTag(e,[t]),function(e){if(r){for(var t=0;t<e.attributes.length;t++)if(this._allowedVideoRegex.test(e.attributes[t].value))return!1;if("object"===e.tagName&&this._allowedVideoRegex.test(e.innerHTML))return!1}return!0})},_hasAncestorTag(e,t,r,i){r=r||3,t=t.toUpperCase();for(var n=0;e.parentNode;){if(r>0&&n>r)return!1;if(e.parentNode.tagName===t&&(!i||i(e.parentNode)))return!0;e=e.parentNode,n++}return!1},_getRowAndColumnCount(e){for(var t=0,r=0,i=e.getElementsByTagName("tr"),n=0;n<i.length;n++){var o=i[n].getAttribute("rowspan")||0;o&&(o=parseInt(o,10)),t+=o||1;for(var s=0,a=i[n].getElementsByTagName("td"),l=0;l<a.length;l++){var c=a[l].getAttribute("colspan")||0;c&&(c=parseInt(c,10)),s+=c||1}r=Math.max(r,s)}return{rows:t,columns:r}},_markDataTables(e){for(var t=e.getElementsByTagName("table"),r=0;r<t.length;r++){var i=t[r];if("presentation"!=i.getAttribute("role"))if("0"!=i.getAttribute("datatable"))if(i.getAttribute("summary"))i._readabilityDataTable=!0;else{var n=i.getElementsByTagName("caption")[0];if(n&&n.childNodes.length)i._readabilityDataTable=!0;else{var o=function(e){return!!i.getElementsByTagName(e)[0]};if(["col","colgroup","tfoot","thead","th"].some(o))this.log("Data table because found data-y descendant"),i._readabilityDataTable=!0;else if(i.getElementsByTagName("table")[0])i._readabilityDataTable=!1;else{var s=this._getRowAndColumnCount(i);1!=s.columns&&1!=s.rows?s.rows>=10||s.columns>4?i._readabilityDataTable=!0:i._readabilityDataTable=s.rows*s.columns>10:i._readabilityDataTable=!1}}}else i._readabilityDataTable=!1;else i._readabilityDataTable=!1}},_fixLazyImages(e){this._forEachNode(this._getAllNodesWithTag(e,["img","picture","figure"]),function(e){if(e.src&&this.REGEXPS.b64DataUrl.test(e.src)){var t=this.REGEXPS.b64DataUrl.exec(e.src);if("image/svg+xml"===t[1])return;for(var r=!1,i=0;i<e.attributes.length;i++){var n=e.attributes[i];if("src"!==n.name&&/\.(jpg|jpeg|png|webp)/i.test(n.value)){r=!0;break}}if(r){var o=t[0].length;e.src.length-o<133&&e.removeAttribute("src")}}if(!(e.src||e.srcset&&"null"!=e.srcset)||e.className.toLowerCase().includes("lazy"))for(var s=0;s<e.attributes.length;s++)if("src"!==(n=e.attributes[s]).name&&"srcset"!==n.name&&"alt"!==n.name){var a=null;if(/\.(jpg|jpeg|png|webp)\s+\d/.test(n.value)?a="srcset":/^\s*\S+\.(jpg|jpeg|png|webp)\S*\s*$/.test(n.value)&&(a="src"),a)if("IMG"===e.tagName||"PICTURE"===e.tagName)e.setAttribute(a,n.value);else if("FIGURE"===e.tagName&&!this._getAllNodesWithTag(e,["img","picture"]).length){var l=this._doc.createElement("img");l.setAttribute(a,n.value),e.appendChild(l)}}})},_getTextDensity(e,t){var r=this._getInnerText(e,!0).length;if(0===r)return 0;var i=0,n=this._getAllNodesWithTag(e,t);return this._forEachNode(n,e=>i+=this._getInnerText(e,!0).length),i/r},_cleanConditionally(e,t){this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY)&&this._removeNodes(this._getAllNodesWithTag(e,[t]),function(e){var r=function(e){return e._readabilityDataTable},i="ul"===t||"ol"===t;if(!i){var n=0,o=this._getAllNodesWithTag(e,["ul","ol"]);this._forEachNode(o,e=>n+=this._getInnerText(e).length),i=n/this._getInnerText(e).length>.9}if("table"===t&&r(e)||this._hasAncestorTag(e,"table",-1,r)||this._hasAncestorTag(e,"code")||[...e.getElementsByTagName("table")].some(e=>e._readabilityDataTable))return!1;var s=this._getClassWeight(e);if(this.log("Cleaning Conditionally",e),s+0<0)return!0;if(this._getCharCount(e,",")<10){for(var a=e.getElementsByTagName("p").length,l=e.getElementsByTagName("img").length,c=e.getElementsByTagName("li").length-100,h=e.getElementsByTagName("input").length,u=this._getTextDensity(e,["h1","h2","h3","h4","h5","h6"]),d=0,g=this._getAllNodesWithTag(e,["object","embed","iframe"]),f=0;f<g.length;f++){for(var p=0;p<g[f].attributes.length;p++)if(this._allowedVideoRegex.test(g[f].attributes[p].value))return!1;if("object"===g[f].tagName&&this._allowedVideoRegex.test(g[f].innerHTML))return!1;d++}var m=this._getInnerText(e);if(this.REGEXPS.adWords.test(m)||this.REGEXPS.loadingWords.test(m))return!0;var y=m.length,b=this._getLinkDensity(e),T=["SPAN","LI","TD"].concat(Array.from(this.DIV_TO_P_ELEMS)),_=this._getTextDensity(e,T),A=this._hasAncestorTag(e,"figure"),v=(()=>{const e=[];return!A&&l>1&&a/l<.5&&e.push(`Bad p to img ratio (img=${l}, p=${a})`),!i&&c>a&&e.push(`Too many li's outside of a list. (li=${c} > p=${a})`),h>Math.floor(a/3)&&e.push(`Too many inputs per p. (input=${h}, p=${a})`),!i&&!A&&u<.9&&y<25&&(0===l||l>2)&&b>0&&e.push(`Suspiciously short. (headingDensity=${u}, img=${l}, linkDensity=${b})`),!i&&s<25&&b>.2+this._linkDensityModifier&&e.push(`Low weight and a little linky. (linkDensity=${b})`),s>=25&&b>.5+this._linkDensityModifier&&e.push(`High weight and mostly links. (linkDensity=${b})`),(1===d&&y<75||d>1)&&e.push(`Suspicious embed. (embedCount=${d}, contentLength=${y})`),0===l&&0===_&&e.push(`No useful content. (img=${l}, textDensity=${_})`),!!e.length&&(this.log("Checks failed",e),!0)})();if(i&&v){for(var w=0;w<e.children.length;w++)if(e.children[w].children.length>1)return v;let t=e.getElementsByTagName("li").length;if(l==t)return!1}return v}return!1})},_cleanMatchedNodes(e,t){for(var r=this._getNextNode(e,!0),i=this._getNextNode(e);i&&i!=r;)i=t.call(this,i,i.className+" "+i.id)?this._removeAndGetNext(i):this._getNextNode(i)},_cleanHeaders(e){let t=this._getAllNodesWithTag(e,["h1","h2"]);this._removeNodes(t,function(e){let t=this._getClassWeight(e)<0;return t&&this.log("Removing header with low class weight:",e),t})},_headerDuplicatesTitle(e){if("H1"!=e.tagName&&"H2"!=e.tagName)return!1;var t=this._getInnerText(e,!1);return this.log("Evaluating similarity of header:",t,this._articleTitle),this._textSimilarity(this._articleTitle,t)>.75},_flagIsActive(e){return(this._flags&e)>0},_removeFlag(e){this._flags=this._flags&~e},_isProbablyVisible:e=>(!e.style||"none"!=e.style.display)&&(!e.style||"hidden"!=e.style.visibility)&&!e.hasAttribute("hidden")&&(!e.hasAttribute("aria-hidden")||"true"!=e.getAttribute("aria-hidden")||e.className&&e.className.includes&&e.className.includes("fallback-image")),parse(){if(this._maxElemsToParse>0){var e=this._doc.getElementsByTagName("*").length;if(e>this._maxElemsToParse)throw new Error("Aborting parsing document; "+e+" elements found")}this._unwrapNoscriptImages(this._doc);var t=this._disableJSONLD?{}:this._getJSONLD(this._doc);this._removeScripts(this._doc),this._prepDocument();var r=this._getArticleMetadata(t);this._metadata=r,this._articleTitle=r.title;var i=this._grabArticle();if(!i)return null;if(this.log("Grabbed: "+i.innerHTML),this._postProcessContent(i),!r.excerpt){var n=i.getElementsByTagName("p");n.length&&(r.excerpt=n[0].textContent.trim())}var o=i.textContent;return{title:this._articleTitle,byline:r.byline||this._articleByline,dir:this._articleDir,lang:this._articleLang,content:this._serializer(i),textContent:o,length:o.length,excerpt:r.excerpt,siteName:r.siteName||this._articleSiteName,publishedTime:r.publishedTime}}},e.exports=t}({exports:{}});!function(e){var t={unlikelyCandidates:/-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|content|main|shadow/i};function r(e){return(!e.style||"none"!=e.style.display)&&!e.hasAttribute("hidden")&&(!e.hasAttribute("aria-hidden")||"true"!=e.getAttribute("aria-hidden")||e.className&&e.className.includes&&e.className.includes("fallback-image"))}e.exports=function(e,i={}){"function"==typeof i&&(i={visibilityChecker:i});var n={minScore:20,minContentLength:140,visibilityChecker:r};i=Object.assign(n,i);var o=e.querySelectorAll("p, pre, article"),s=e.querySelectorAll("div > br");if(s.length){var a=new Set(o);[].forEach.call(s,function(e){a.add(e.parentNode)}),o=Array.from(a)}var l=0;return[].some.call(o,function(e){if(!i.visibilityChecker(e))return!1;var r=e.className+" "+e.id;if(t.unlikelyCandidates.test(r)&&!t.okMaybeItsACandidate.test(r)||e.matches("li p"))return!1;var n=e.textContent.trim().length;return!(n<i.minContentLength)&&(l+=Math.sqrt(n-i.minContentLength))>i.minScore})}}({exports:{}});function B(e,{timeZone:t,todayOffset:r}={}){const i=new Date(Date.now()+864e5*(r??0));try{return e.toLocaleDateString(void 0,{timeZone:t})===i.toLocaleDateString(void 0,{timeZone:t})}catch{return e.toLocaleDateString()===i.toLocaleDateString()}}for(var U=[],M=[],j=typeof Uint8Array<"u"?Uint8Array:Array,F="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",$=0;$<64;++$)U[$]=F[$],M[F.charCodeAt($)]=$;function H(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function W(e){return U[e>>18&63]+U[e>>12&63]+U[e>>6&63]+U[63&e]}function V(e,t,r){for(var i,n=[],o=t;o<r;o+=3)i=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),n.push(W(i));return n.join("")}M[45]=62,M[95]=63;var q=function(e){var t,r,i=H(e),n=i[0],o=i[1],s=new j(function(e,t,r){return 3*(t+r)/4-r}(0,n,o)),a=0,l=o>0?n-4:n;for(r=0;r<l;r+=4)t=M[e.charCodeAt(r)]<<18|M[e.charCodeAt(r+1)]<<12|M[e.charCodeAt(r+2)]<<6|M[e.charCodeAt(r+3)],s[a++]=t>>16&255,s[a++]=t>>8&255,s[a++]=255&t;return 2===o&&(t=M[e.charCodeAt(r)]<<2|M[e.charCodeAt(r+1)]>>4,s[a++]=255&t),1===o&&(t=M[e.charCodeAt(r)]<<10|M[e.charCodeAt(r+1)]<<4|M[e.charCodeAt(r+2)]>>2,s[a++]=t>>8&255,s[a++]=255&t),s},z=function(e){for(var t,r=e.length,i=r%3,n=[],o=16383,s=0,a=r-i;s<a;s+=o)n.push(V(e,s,s+o>a?a:s+o));return 1===i?(t=e[r-1],n.push(U[t>>2]+U[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],n.push(U[t>>10]+U[t>>4&63]+U[t<<2&63]+"=")),n.join("")},K=function(e,t,r,i,n){var o,s,a=8*n-i-1,l=(1<<a)-1,c=l>>1,h=-7,u=r?n-1:0,d=r?-1:1,g=e[t+u];for(u+=d,o=g&(1<<-h)-1,g>>=-h,h+=a;h>0;o=256*o+e[t+u],u+=d,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=i;h>0;s=256*s+e[t+u],u+=d,h-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(g?-1:1);s+=Math.pow(2,i),o-=c}return(g?-1:1)*s*Math.pow(2,o-i)},Y=function(e,t,r,i,n,o){var s,a,l,c=8*o-n-1,h=(1<<c)-1,u=h>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,g=i?0:o-1,f=i?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=h):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+u>=1?d/l:d*Math.pow(2,1-u))*l>=2&&(s++,l/=2),s+u>=h?(a=0,s=h):s+u>=1?(a=(t*l-1)*Math.pow(2,n),s+=u):(a=t*Math.pow(2,u-1)*Math.pow(2,n),s=0));n>=8;e[r+g]=255&a,g+=f,a/=256,n-=8);for(s=s<<n|a,c+=n;c>0;e[r+g]=255&s,g+=f,s/=256,c-=8);e[r+g-f]|=128*p},X=function(e,t){return function(e,t){var r="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50;var i=2147483647;function n(e){if(e>i)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return l(e)}return s(e,t,r)}function s(e,t,r){if("string"==typeof e)return function(e,t){if(("string"!=typeof t||""===t)&&(t="utf8"),!o.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|d(e,t),i=n(r),s=i.write(e,t);return s!==r&&(i=i.slice(0,s)),i}(e,t);if(ArrayBuffer.isView(e))return function(e){if(U(e,Uint8Array)){var t=new Uint8Array(e);return h(t.buffer,t.byteOffset,t.byteLength)}return c(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers.typeof(e));if(U(e,ArrayBuffer)||e&&U(e.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(U(e,SharedArrayBuffer)||e&&U(e.buffer,SharedArrayBuffer)))return h(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var i=e.valueOf&&e.valueOf();if(null!=i&&i!==e)return o.from(i,t,r);var s=function(e){if(o.isBuffer(e)){var t=0|u(e.length),r=n(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||M(e.length)?n(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(s)return s;if(typeof Symbol<"u"&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers.typeof(e))}function a(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function l(e){return a(e),n(e<0?0:0|u(e))}function c(e){for(var t=e.length<0?0:0|u(e.length),r=n(t),i=0;i<t;i+=1)r[i]=255&e[i];return r}function h(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var i;return i=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(i,o.prototype),i}function u(e){if(e>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return 0|e}function d(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||U(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+babelHelpers.typeof(e));var r=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return x(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return G(e).length;default:if(n)return i?-1:x(e).length;t=(""+t).toLowerCase(),n=!0}}function g(e,t,r){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0)||(r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return N(this,t,r);case"utf8":case"utf-8":return w(this,t,r);case"ascii":return S(this,t,r);case"latin1":case"binary":return I(this,t,r);case"base64":return v(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,r);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function f(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function p(e,t,r,i,n){if(0===e.length)return-1;if("string"==typeof r?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),M(r=+r)&&(r=n?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(n)return-1;r=e.length-1}else if(r<0){if(!n)return-1;r=0}if("string"==typeof t&&(t=o.from(t,i)),o.isBuffer(t))return 0===t.length?-1:m(e,t,r,i,n);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):m(e,[t],r,i,n);throw new TypeError("val must be string, number or Buffer")}function m(e,t,r,i,n){var o,s=1,a=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;s=2,a/=2,l/=2,r/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(n){var h=-1;for(o=r;o<a;o++)if(c(e,o)===c(t,-1===h?0:o-h)){if(-1===h&&(h=o),o-h+1===l)return h*s}else-1!==h&&(o-=o-h),h=-1}else for(r+l>a&&(r=a-l),o=r;o>=0;o--){for(var u=!0,d=0;d<l;d++)if(c(e,o+d)!==c(t,d)){u=!1;break}if(u)return o}return-1}function y(e,t,r,i){r=Number(r)||0;var n=e.length-r;i?(i=Number(i))>n&&(i=n):i=n;var o=t.length;i>o/2&&(i=o/2);for(var s=0;s<i;++s){var a=parseInt(t.substr(2*s,2),16);if(M(a))return s;e[r+s]=a}return s}function b(e,t,r,i){return B(x(t,e.length-r),e,r,i)}function T(e,t,r,i){return B(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,i)}function _(e,t,r,i){return B(G(t),e,r,i)}function A(e,t,r,i){return B(function(e,t){for(var r,i,n,o=[],s=0;s<e.length&&!((t-=2)<0);++s)i=(r=e.charCodeAt(s))>>8,n=r%256,o.push(n),o.push(i);return o}(t,e.length-r),e,r,i)}function v(e,t,r){return 0===t&&r===e.length?z(e):z(e.slice(t,r))}function w(e,t,r){r=Math.min(e.length,r);for(var i=[],n=t;n<r;){var o,s,a,l,c=e[n],h=null,u=c>239?4:c>223?3:c>191?2:1;if(n+u<=r)switch(u){case 1:c<128&&(h=c);break;case 2:128==(192&(o=e[n+1]))&&(l=(31&c)<<6|63&o)>127&&(h=l);break;case 3:o=e[n+1],s=e[n+2],128==(192&o)&&128==(192&s)&&(l=(15&c)<<12|(63&o)<<6|63&s)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:o=e[n+1],s=e[n+2],a=e[n+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(l=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&l<1114112&&(h=l)}null===h?(h=65533,u=1):h>65535&&(h-=65536,i.push(h>>>10&1023|55296),h=56320|1023&h),i.push(h),n+=u}return function(e){var t=e.length;if(t<=E)return String.fromCharCode.apply(String,e);for(var r="",i=0;i<t;)r+=String.fromCharCode.apply(String,e.slice(i,i+=E));return r}(i)}t.kMaxLength=i,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch{return!1}}(),!o.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return s(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return function(e,t,r){return a(e),e<=0?n(e):void 0!==t?"string"==typeof r?n(e).fill(t,r):n(e).fill(t):n(e)}(e,t,r)},o.allocUnsafe=function(e){return l(e)},o.allocUnsafeSlow=function(e){return l(e)},o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(U(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),U(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,i=t.length,n=0,s=Math.min(r,i);n<s;++n)if(e[n]!==t[n]){r=e[n],i=t[n];break}return r<i?-1:i<r?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var i=o.allocUnsafe(t),n=0;for(r=0;r<e.length;++r){var s=e[r];if(U(s,Uint8Array))n+s.length>i.length?o.from(s).copy(i,n):Uint8Array.prototype.set.call(i,s,n);else{if(!o.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(i,n)}n+=s.length}return i},o.byteLength=d,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)f(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)f(this,t,t+3),f(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)f(this,t,t+7),f(this,t+1,t+6),f(this,t+2,t+5),f(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?w(this,0,e):g.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},r&&(o.prototype[r]=o.prototype.inspect),o.prototype.compare=function(e,t,r,i,n){if(U(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+babelHelpers.typeof(e));if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),t<0||r>e.length||i<0||n>this.length)throw new RangeError("out of range index");if(i>=n&&t>=r)return 0;if(i>=n)return-1;if(t>=r)return 1;if(this===e)return 0;for(var s=(n>>>=0)-(i>>>=0),a=(r>>>=0)-(t>>>=0),l=Math.min(s,a),c=this.slice(i,n),h=e.slice(t,r),u=0;u<l;++u)if(c[u]!==h[u]){s=c[u],a=h[u];break}return s<a?-1:a<s?1:0},o.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return p(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return p(this,e,t,r,!1)},o.prototype.write=function(e,t,r,i){if(void 0===t)i="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)i=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===i&&(i="utf8")):(i=r,r=void 0)}var n=this.length-t;if((void 0===r||r>n)&&(r=n),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return y(this,e,t,r);case"utf8":case"utf-8":return b(this,e,t,r);case"ascii":case"latin1":case"binary":return T(this,e,t,r);case"base64":return _(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var E=4096;function S(e,t,r){var i="";r=Math.min(e.length,r);for(var n=t;n<r;++n)i+=String.fromCharCode(127&e[n]);return i}function I(e,t,r){var i="";r=Math.min(e.length,r);for(var n=t;n<r;++n)i+=String.fromCharCode(e[n]);return i}function N(e,t,r){var i=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>i)&&(r=i);for(var n="",o=t;o<r;++o)n+=j[e[o]];return n}function O(e,t,r){for(var i=e.slice(t,r),n="",o=0;o<i.length-1;o+=2)n+=String.fromCharCode(i[o]+256*i[o+1]);return n}function k(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function C(e,t,r,i,n,s){if(!o.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<s)throw new RangeError('"value" argument is out of bounds');if(r+i>e.length)throw new RangeError("Index out of range")}function L(e,t,r,i,n,o){if(r+i>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function D(e,t,r,i,n){return t=+t,r>>>=0,n||L(e,0,r,4),Y(e,t,r,i,23,4),r+4}function R(e,t,r,i,n){return t=+t,r>>>=0,n||L(e,0,r,8),Y(e,t,r,i,52,8),r+8}o.prototype.slice=function(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var i=this.subarray(e,t);return Object.setPrototypeOf(i,o.prototype),i},o.prototype.readUintLE=o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||k(e,t,this.length);for(var i=this[e],n=1,o=0;++o<t&&(n*=256);)i+=this[e+o]*n;return i},o.prototype.readUintBE=o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||k(e,t,this.length);for(var i=this[e+--t],n=1;t>0&&(n*=256);)i+=this[e+--t]*n;return i},o.prototype.readUint8=o.prototype.readUInt8=function(e,t){return e>>>=0,t||k(e,1,this.length),this[e]},o.prototype.readUint16LE=o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||k(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUint16BE=o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||k(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUint32LE=o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||k(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUint32BE=o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||k(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||k(e,t,this.length);for(var i=this[e],n=1,o=0;++o<t&&(n*=256);)i+=this[e+o]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*t)),i},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||k(e,t,this.length);for(var i=t,n=1,o=this[e+--i];i>0&&(n*=256);)o+=this[e+--i]*n;return o>=(n*=128)&&(o-=Math.pow(2,8*t)),o},o.prototype.readInt8=function(e,t){return e>>>=0,t||k(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||k(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||k(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||k(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||k(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||k(e,4,this.length),K(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||k(e,4,this.length),K(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||k(e,8,this.length),K(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||k(e,8,this.length),K(this,e,!1,52,8)},o.prototype.writeUintLE=o.prototype.writeUIntLE=function(e,t,r,i){e=+e,t>>>=0,r>>>=0,i||C(this,e,t,r,Math.pow(2,8*r)-1,0);var n=1,o=0;for(this[t]=255&e;++o<r&&(n*=256);)this[t+o]=e/n&255;return t+r},o.prototype.writeUintBE=o.prototype.writeUIntBE=function(e,t,r,i){e=+e,t>>>=0,r>>>=0,i||C(this,e,t,r,Math.pow(2,8*r)-1,0);var n=r-1,o=1;for(this[t+n]=255&e;--n>=0&&(o*=256);)this[t+n]=e/o&255;return t+r},o.prototype.writeUint8=o.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUint16LE=o.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUint16BE=o.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUint32LE=o.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUint32BE=o.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,i){if(e=+e,t>>>=0,!i){var n=Math.pow(2,8*r-1);C(this,e,t,r,n-1,-n)}var o=0,s=1,a=0;for(this[t]=255&e;++o<r&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s|0)-a&255;return t+r},o.prototype.writeIntBE=function(e,t,r,i){if(e=+e,t>>>=0,!i){var n=Math.pow(2,8*r-1);C(this,e,t,r,n-1,-n)}var o=r-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s|0)-a&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return D(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return D(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return R(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return R(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,i){if(!o.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),!i&&0!==i&&(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<r&&(i=r),i===r||0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-r&&(i=e.length-t+r);var n=i-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,i):Uint8Array.prototype.set.call(e,this.subarray(r,i),t),n},o.prototype.fill=function(e,t,r,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!o.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===e.length){var n=e.charCodeAt(0);("utf8"===i&&n<128||"latin1"===i)&&(e=n)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var s;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(s=t;s<r;++s)this[s]=e;else{var a=o.isBuffer(e)?e:o.from(e,i),l=a.length;if(0===l)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<r-t;++s)this[s+t]=a[s%l]}return this};var P=/[^+/0-9A-Za-z-_]/g;function x(e,t){t=t||1/0;for(var r,i=e.length,n=null,o=[],s=0;s<i;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!n){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===i){(t-=3)>-1&&o.push(239,191,189);continue}n=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),n=r;continue}r=65536+(n-55296<<10|r-56320)}else n&&(t-=3)>-1&&o.push(239,191,189);if(n=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function G(e){return q(function(e){if((e=(e=e.split("=")[0]).trim().replace(P,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function B(e,t,r,i){for(var n=0;n<i&&!(n+r>=t.length||n>=e.length);++n)t[n+r]=e[n];return n}function U(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function M(e){return e!=e}var j=function(){for(var e="0123456789abcdef",t=new Array(256),r=0;r<16;++r)for(var i=16*r,n=0;n<16;++n)t[i+n]=e[r]+e[n];return t}()}(t={exports:{}},t.exports),t.exports}(),J=X.Buffer;X.SlowBuffer,X.INSPECT_MAX_BYTES,X.kMaxLength;var Z=function(e,t){return Z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},Z(e,t)};function Q(e,t){function r(){this.constructor=e}Z(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var ee=function(e){function t(r){var i=e.call(this,r)||this;return Object.setPrototypeOf(i,t.prototype),i}return Q(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"BSONError"},enumerable:!1,configurable:!0}),t}(Error),te=function(e){function t(r){var i=e.call(this,r)||this;return Object.setPrototypeOf(i,t.prototype),i}return Q(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"BSONTypeError"},enumerable:!1,configurable:!0}),t}(TypeError);function re(e){return e&&e.Math==Math&&e}function ie(){return re("object"==typeof globalThis&&globalThis)||re("object"==typeof window&&window)||re("object"==typeof self&&self)||re("object"==typeof global&&global)||Function("return this")()}var ne=function(e){var t,r="object"==typeof(t=ie()).navigator&&"ReactNative"===t.navigator.product?"BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values.":"BSON: No cryptographic implementation for random bytes present, falling back to a less secure implementation.";console.warn(r);for(var i=J.alloc(e),n=0;n<e;++n)i[n]=Math.floor(256*Math.random());return i},oe=function(){if(typeof window<"u"){var e=window.crypto||window.msCrypto;if(e&&e.getRandomValues)return function(t){return e.getRandomValues(J.alloc(t))}}return typeof global<"u"&&global.crypto&&global.crypto.getRandomValues?function(e){return global.crypto.getRandomValues(J.alloc(e))}:ne}();function se(e){return"[object Uint8Array]"===Object.prototype.toString.call(e)}function ae(e){return"object"==typeof e&&null!==e}function le(e,t){var r=!1;return function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];return r||(console.warn(t),r=!0),e.apply(this,i)}}function ce(e){if(ArrayBuffer.isView(e))return J.from(e.buffer,e.byteOffset,e.byteLength);if(function(e){return["[object ArrayBuffer]","[object SharedArrayBuffer]"].includes(Object.prototype.toString.call(e))}(e))return J.from(e);throw new te("Must use either Buffer or TypedArray")}var he=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|[0-9a-f]{12}4[0-9a-f]{3}[89ab][0-9a-f]{15})$/i,ue=function(e){return"string"==typeof e&&he.test(e)},de=function(e){if(!ue(e))throw new te('UUID string representations must be a 32 or 36 character hex string (dashes excluded/included). Format: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" or "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".');var t=e.replace(/-/g,"");return J.from(t,"hex")},ge=function(e,t){return void 0===t&&(t=!0),t?e.toString("hex",0,4)+"-"+e.toString("hex",4,6)+"-"+e.toString("hex",6,8)+"-"+e.toString("hex",8,10)+"-"+e.toString("hex",10,16):e.toString("hex")},fe=Math.pow(2,53),pe=-Math.pow(2,53),me=function(){function e(t,r){if(!(this instanceof e))return new e(t,r);if(!(null==t||"string"==typeof t||ArrayBuffer.isView(t)||t instanceof ArrayBuffer||Array.isArray(t)))throw new te("Binary can only be constructed from string, Buffer, TypedArray, or Array<number>");this.sub_type=r??e.BSON_BINARY_SUBTYPE_DEFAULT,null==t?(this.buffer=J.alloc(e.BUFFER_SIZE),this.position=0):("string"==typeof t?this.buffer=J.from(t,"binary"):Array.isArray(t)?this.buffer=J.from(t):this.buffer=ce(t),this.position=this.buffer.byteLength)}return e.prototype.put=function(t){if("string"==typeof t&&1!==t.length)throw new te("only accepts single character String");if("number"!=typeof t&&1!==t.length)throw new te("only accepts single character Uint8Array or Array");var r;if((r="string"==typeof t?t.charCodeAt(0):"number"==typeof t?t:t[0])<0||r>255)throw new te("only accepts number in a valid unsigned byte range 0-255");if(this.buffer.length>this.position)this.buffer[this.position++]=r;else{var i=J.alloc(e.BUFFER_SIZE+this.buffer.length);this.buffer.copy(i,0,0,this.buffer.length),this.buffer=i,this.buffer[this.position++]=r}},e.prototype.write=function(e,t){if(t="number"==typeof t?t:this.position,this.buffer.length<t+e.length){var r=J.alloc(this.buffer.length+e.length);this.buffer.copy(r,0,0,this.buffer.length),this.buffer=r}ArrayBuffer.isView(e)?(this.buffer.set(ce(e),t),this.position=t+e.byteLength>this.position?t+e.length:this.position):"string"==typeof e&&(this.buffer.write(e,t,e.length,"binary"),this.position=t+e.length>this.position?t+e.length:this.position)},e.prototype.read=function(e,t){return t=t&&t>0?t:this.position,this.buffer.slice(e,e+t)},e.prototype.value=function(e){return(e=!!e)&&this.buffer.length===this.position?this.buffer:e?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position)},e.prototype.length=function(){return this.position},e.prototype.toJSON=function(){return this.buffer.toString("base64")},e.prototype.toString=function(e){return this.buffer.toString(e)},e.prototype.toExtendedJSON=function(e){e=e||{};var t=this.buffer.toString("base64"),r=Number(this.sub_type).toString(16);return e.legacy?{$binary:t,$type:1===r.length?"0"+r:r}:{$binary:{base64:t,subType:1===r.length?"0"+r:r}}},e.prototype.toUUID=function(){if(this.sub_type===e.SUBTYPE_UUID)return new ye(this.buffer.slice(0,this.position));throw new ee('Binary sub_type "'.concat(this.sub_type,'" is not supported for converting to UUID. Only "').concat(e.SUBTYPE_UUID,'" is currently supported.'))},e.fromExtendedJSON=function(t,r){var i,n;if(r=r||{},"$binary"in t?r.legacy&&"string"==typeof t.$binary&&"$type"in t?(n=t.$type?parseInt(t.$type,16):0,i=J.from(t.$binary,"base64")):"string"!=typeof t.$binary&&(n=t.$binary.subType?parseInt(t.$binary.subType,16):0,i=J.from(t.$binary.base64,"base64")):"$uuid"in t&&(n=4,i=de(t.$uuid)),!i)throw new te("Unexpected Binary Extended JSON format ".concat(JSON.stringify(t)));return 4===n?new ye(i):new e(i,n)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var e=this.value(!0);return'new Binary(Buffer.from("'.concat(e.toString("hex"),'", "hex"), ').concat(this.sub_type,")")},e.BSON_BINARY_SUBTYPE_DEFAULT=0,e.BUFFER_SIZE=256,e.SUBTYPE_DEFAULT=0,e.SUBTYPE_FUNCTION=1,e.SUBTYPE_BYTE_ARRAY=2,e.SUBTYPE_UUID_OLD=3,e.SUBTYPE_UUID=4,e.SUBTYPE_MD5=5,e.SUBTYPE_ENCRYPTED=6,e.SUBTYPE_COLUMN=7,e.SUBTYPE_USER_DEFINED=128,e}();Object.defineProperty(me.prototype,"_bsontype",{value:"Binary"});var ye=function(e){function t(r){var i,n,o=this;if(null==r)i=t.generate();else if(r instanceof t)i=J.from(r.buffer),n=r.__id;else if(ArrayBuffer.isView(r)&&16===r.byteLength)i=ce(r);else{if("string"!=typeof r)throw new te("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).");i=de(r)}return(o=e.call(this,i,4)||this).__id=n,o}return Q(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this.buffer},set:function(e){this.buffer=e,t.cacheHexString&&(this.__id=ge(e))},enumerable:!1,configurable:!0}),t.prototype.toHexString=function(e){if(void 0===e&&(e=!0),t.cacheHexString&&this.__id)return this.__id;var r=ge(this.id,e);return t.cacheHexString&&(this.__id=r),r},t.prototype.toString=function(e){return e?this.id.toString(e):this.toHexString()},t.prototype.toJSON=function(){return this.toHexString()},t.prototype.equals=function(e){if(!e)return!1;if(e instanceof t)return e.id.equals(this.id);try{return new t(e).id.equals(this.id)}catch{return!1}},t.prototype.toBinary=function(){return new me(this.id,me.SUBTYPE_UUID)},t.generate=function(){var e=oe(16);return e[6]=15&e[6]|64,e[8]=63&e[8]|128,J.from(e)},t.isValid=function(e){return!!e&&(e instanceof t||("string"==typeof e?ue(e):!(!se(e)||16!==e.length||64!=(240&e[6])||128&~e[8])))},t.createFromHexString=function(e){return new t(de(e))},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return'new UUID("'.concat(this.toHexString(),'")')},t}(me),be=function(){function e(t,r){if(!(this instanceof e))return new e(t,r);this.code=t,this.scope=r}return e.prototype.toJSON=function(){return{code:this.code,scope:this.scope}},e.prototype.toExtendedJSON=function(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}},e.fromExtendedJSON=function(t){return new e(t.$code,t.$scope)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var e=this.toJSON();return'new Code("'.concat(String(e.code),'"').concat(e.scope?", ".concat(JSON.stringify(e.scope)):"",")")},e}();Object.defineProperty(be.prototype,"_bsontype",{value:"Code"});var Te=function(){function e(t,r,i,n){if(!(this instanceof e))return new e(t,r,i,n);var o=t.split(".");2===o.length&&(i=o.shift(),t=o.shift()),this.collection=t,this.oid=r,this.db=i,this.fields=n||{}}return Object.defineProperty(e.prototype,"namespace",{get:function(){return this.collection},set:function(e){this.collection=e},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){var e=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return null!=this.db&&(e.$db=this.db),e},e.prototype.toExtendedJSON=function(e){e=e||{};var t={$ref:this.collection,$id:this.oid};return e.legacy||(this.db&&(t.$db=this.db),t=Object.assign(t,this.fields)),t},e.fromExtendedJSON=function(t){var r=Object.assign({},t);return delete r.$ref,delete r.$id,delete r.$db,new e(t.$ref,t.$id,t.$db,r)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var e=void 0===this.oid||void 0===this.oid.toString?this.oid:this.oid.toString();return'new DBRef("'.concat(this.namespace,'", new ObjectId("').concat(String(e),'")').concat(this.db?', "'.concat(this.db,'"'):"",")")},e}();Object.defineProperty(Te.prototype,"_bsontype",{value:"DBRef"});var _e=void 0;try{_e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}var Ae=4294967296,ve=Ae*Ae,we=ve/2,Ee={},Se={},Ie=function(){function e(t,r,i){if(void 0===t&&(t=0),!(this instanceof e))return new e(t,r,i);"bigint"==typeof t?Object.assign(this,e.fromBigInt(t,!!r)):"string"==typeof t?Object.assign(this,e.fromString(t,!!r)):(this.low=0|t,this.high=0|r,this.unsigned=!!i),Object.defineProperty(this,"__isLong__",{value:!0,configurable:!1,writable:!1,enumerable:!1})}return e.fromBits=function(t,r,i){return new e(t,r,i)},e.fromInt=function(t,r){var i,n,o;return r?(o=0<=(t>>>=0)&&t<256)&&(n=Se[t])?n:(i=e.fromBits(t,(0|t)<0?-1:0,!0),o&&(Se[t]=i),i):(o=-128<=(t|=0)&&t<128)&&(n=Ee[t])?n:(i=e.fromBits(t,t<0?-1:0,!1),o&&(Ee[t]=i),i)},e.fromNumber=function(t,r){if(isNaN(t))return r?e.UZERO:e.ZERO;if(r){if(t<0)return e.UZERO;if(t>=ve)return e.MAX_UNSIGNED_VALUE}else{if(t<=-we)return e.MIN_VALUE;if(t+1>=we)return e.MAX_VALUE}return t<0?e.fromNumber(-t,r).neg():e.fromBits(t%Ae|0,t/Ae|0,r)},e.fromBigInt=function(t,r){return e.fromString(t.toString(),r)},e.fromString=function(t,r,i){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return e.ZERO;if("number"==typeof r?(i=r,r=!1):r=!!r,(i=i||10)<2||36<i)throw RangeError("radix");var n;if((n=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return e.fromString(t.substring(1),r,i).neg();for(var o=e.fromNumber(Math.pow(i,8)),s=e.ZERO,a=0;a<t.length;a+=8){var l=Math.min(8,t.length-a),c=parseInt(t.substring(a,a+l),i);if(l<8){var h=e.fromNumber(Math.pow(i,l));s=s.mul(h).add(e.fromNumber(c))}else s=(s=s.mul(o)).add(e.fromNumber(c))}return s.unsigned=r,s},e.fromBytes=function(t,r,i){return i?e.fromBytesLE(t,r):e.fromBytesBE(t,r)},e.fromBytesLE=function(t,r){return new e(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,r)},e.fromBytesBE=function(t,r){return new e(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],r)},e.isLong=function(e){return ae(e)&&!0===e.__isLong__},e.fromValue=function(t,r){return"number"==typeof t?e.fromNumber(t,r):"string"==typeof t?e.fromString(t,r):e.fromBits(t.low,t.high,"boolean"==typeof r?r:t.unsigned)},e.prototype.add=function(t){e.isLong(t)||(t=e.fromValue(t));var r=this.high>>>16,i=65535&this.high,n=this.low>>>16,o=65535&this.low,s=t.high>>>16,a=65535&t.high,l=t.low>>>16,c=0,h=0,u=0,d=0;return u+=(d+=o+(65535&t.low))>>>16,d&=65535,h+=(u+=n+l)>>>16,u&=65535,c+=(h+=i+a)>>>16,h&=65535,c+=r+s,c&=65535,e.fromBits(u<<16|d,c<<16|h,this.unsigned)},e.prototype.and=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low&t.low,this.high&t.high,this.unsigned)},e.prototype.compare=function(t){if(e.isLong(t)||(t=e.fromValue(t)),this.eq(t))return 0;var r=this.isNegative(),i=t.isNegative();return r&&!i?-1:!r&&i?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},e.prototype.comp=function(e){return this.compare(e)},e.prototype.divide=function(t){if(e.isLong(t)||(t=e.fromValue(t)),t.isZero())throw Error("division by zero");if(_e){if(!this.unsigned&&-2147483648===this.high&&-1===t.low&&-1===t.high)return this;var r=(this.unsigned?_e.div_u:_e.div_s)(this.low,this.high,t.low,t.high);return e.fromBits(r,_e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?e.UZERO:e.ZERO;var i,n,o;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return e.UZERO;if(t.gt(this.shru(1)))return e.UONE;o=e.UZERO}else{if(this.eq(e.MIN_VALUE))return t.eq(e.ONE)||t.eq(e.NEG_ONE)?e.MIN_VALUE:t.eq(e.MIN_VALUE)?e.ONE:(i=this.shr(1).div(t).shl(1)).eq(e.ZERO)?t.isNegative()?e.ONE:e.NEG_ONE:(n=this.sub(t.mul(i)),o=i.add(n.div(t)));if(t.eq(e.MIN_VALUE))return this.unsigned?e.UZERO:e.ZERO;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();o=e.ZERO}for(n=this;n.gte(t);){i=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var s=Math.ceil(Math.log(i)/Math.LN2),a=s<=48?1:Math.pow(2,s-48),l=e.fromNumber(i),c=l.mul(t);c.isNegative()||c.gt(n);)i-=a,c=(l=e.fromNumber(i,this.unsigned)).mul(t);l.isZero()&&(l=e.ONE),o=o.add(l),n=n.sub(c)}return o},e.prototype.div=function(e){return this.divide(e)},e.prototype.equals=function(t){return e.isLong(t)||(t=e.fromValue(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},e.prototype.eq=function(e){return this.equals(e)},e.prototype.getHighBits=function(){return this.high},e.prototype.getHighBitsUnsigned=function(){return this.high>>>0},e.prototype.getLowBits=function(){return this.low},e.prototype.getLowBitsUnsigned=function(){return this.low>>>0},e.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(e.MIN_VALUE)?64:this.neg().getNumBitsAbs();var t,r=0!==this.high?this.high:this.low;for(t=31;t>0&&!(r&1<<t);t--);return 0!==this.high?t+33:t+1},e.prototype.greaterThan=function(e){return this.comp(e)>0},e.prototype.gt=function(e){return this.greaterThan(e)},e.prototype.greaterThanOrEqual=function(e){return this.comp(e)>=0},e.prototype.gte=function(e){return this.greaterThanOrEqual(e)},e.prototype.ge=function(e){return this.greaterThanOrEqual(e)},e.prototype.isEven=function(){return!(1&this.low)},e.prototype.isNegative=function(){return!this.unsigned&&this.high<0},e.prototype.isOdd=function(){return!(1&~this.low)},e.prototype.isPositive=function(){return this.unsigned||this.high>=0},e.prototype.isZero=function(){return 0===this.high&&0===this.low},e.prototype.lessThan=function(e){return this.comp(e)<0},e.prototype.lt=function(e){return this.lessThan(e)},e.prototype.lessThanOrEqual=function(e){return this.comp(e)<=0},e.prototype.lte=function(e){return this.lessThanOrEqual(e)},e.prototype.modulo=function(t){if(e.isLong(t)||(t=e.fromValue(t)),_e){var r=(this.unsigned?_e.rem_u:_e.rem_s)(this.low,this.high,t.low,t.high);return e.fromBits(r,_e.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))},e.prototype.mod=function(e){return this.modulo(e)},e.prototype.rem=function(e){return this.modulo(e)},e.prototype.multiply=function(t){if(this.isZero())return e.ZERO;if(e.isLong(t)||(t=e.fromValue(t)),_e){var r=_e.mul(this.low,this.high,t.low,t.high);return e.fromBits(r,_e.get_high(),this.unsigned)}if(t.isZero())return e.ZERO;if(this.eq(e.MIN_VALUE))return t.isOdd()?e.MIN_VALUE:e.ZERO;if(t.eq(e.MIN_VALUE))return this.isOdd()?e.MIN_VALUE:e.ZERO;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(e.TWO_PWR_24)&&t.lt(e.TWO_PWR_24))return e.fromNumber(this.toNumber()*t.toNumber(),this.unsigned);var i=this.high>>>16,n=65535&this.high,o=this.low>>>16,s=65535&this.low,a=t.high>>>16,l=65535&t.high,c=t.low>>>16,h=65535&t.low,u=0,d=0,g=0,f=0;return g+=(f+=s*h)>>>16,f&=65535,d+=(g+=o*h)>>>16,g&=65535,d+=(g+=s*c)>>>16,g&=65535,u+=(d+=n*h)>>>16,d&=65535,u+=(d+=o*c)>>>16,d&=65535,u+=(d+=s*l)>>>16,d&=65535,u+=i*h+n*c+o*l+s*a,u&=65535,e.fromBits(g<<16|f,u<<16|d,this.unsigned)},e.prototype.mul=function(e){return this.multiply(e)},e.prototype.negate=function(){return!this.unsigned&&this.eq(e.MIN_VALUE)?e.MIN_VALUE:this.not().add(e.ONE)},e.prototype.neg=function(){return this.negate()},e.prototype.not=function(){return e.fromBits(~this.low,~this.high,this.unsigned)},e.prototype.notEquals=function(e){return!this.equals(e)},e.prototype.neq=function(e){return this.notEquals(e)},e.prototype.ne=function(e){return this.notEquals(e)},e.prototype.or=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low|t.low,this.high|t.high,this.unsigned)},e.prototype.shiftLeft=function(t){return e.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?e.fromBits(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):e.fromBits(0,this.low<<t-32,this.unsigned)},e.prototype.shl=function(e){return this.shiftLeft(e)},e.prototype.shiftRight=function(t){return e.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?e.fromBits(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):e.fromBits(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},e.prototype.shr=function(e){return this.shiftRight(e)},e.prototype.shiftRightUnsigned=function(t){if(e.isLong(t)&&(t=t.toInt()),0==(t&=63))return this;var r=this.high;if(t<32){var i=this.low;return e.fromBits(i>>>t|r<<32-t,r>>>t,this.unsigned)}return 32===t?e.fromBits(r,0,this.unsigned):e.fromBits(r>>>t-32,0,this.unsigned)},e.prototype.shr_u=function(e){return this.shiftRightUnsigned(e)},e.prototype.shru=function(e){return this.shiftRightUnsigned(e)},e.prototype.subtract=function(t){return e.isLong(t)||(t=e.fromValue(t)),this.add(t.neg())},e.prototype.sub=function(e){return this.subtract(e)},e.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},e.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*Ae+(this.low>>>0):this.high*Ae+(this.low>>>0)},e.prototype.toBigInt=function(){return BigInt(this.toString())},e.prototype.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},e.prototype.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},e.prototype.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},e.prototype.toSigned=function(){return this.unsigned?e.fromBits(this.low,this.high,!1):this},e.prototype.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(e.MIN_VALUE)){var r=e.fromNumber(t),i=this.div(r),n=i.mul(r).sub(this);return i.toString(t)+n.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var o=e.fromNumber(Math.pow(t,6),this.unsigned),s=this,a="";;){var l=s.div(o),c=(s.sub(l.mul(o)).toInt()>>>0).toString(t);if((s=l).isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}},e.prototype.toUnsigned=function(){return this.unsigned?this:e.fromBits(this.low,this.high,!0)},e.prototype.xor=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low^t.low,this.high^t.high,this.unsigned)},e.prototype.eqz=function(){return this.isZero()},e.prototype.le=function(e){return this.lessThanOrEqual(e)},e.prototype.toExtendedJSON=function(e){return e&&e.relaxed?this.toNumber():{$numberLong:this.toString()}},e.fromExtendedJSON=function(t,r){var i=e.fromString(t.$numberLong);return r&&r.relaxed?i.toNumber():i},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new Long("'.concat(this.toString(),'"').concat(this.unsigned?", true":"",")")},e.TWO_PWR_24=e.fromInt(16777216),e.MAX_UNSIGNED_VALUE=e.fromBits(-1,-1,!0),e.ZERO=e.fromInt(0),e.UZERO=e.fromInt(0,!0),e.ONE=e.fromInt(1),e.UONE=e.fromInt(1,!0),e.NEG_ONE=e.fromInt(-1),e.MAX_VALUE=e.fromBits(-1,2147483647,!1),e.MIN_VALUE=e.fromBits(0,-2147483648,!1),e}();Object.defineProperty(Ie.prototype,"__isLong__",{value:!0}),Object.defineProperty(Ie.prototype,"_bsontype",{value:"Long"});var Ne=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,Oe=/^(\+|-)?(Infinity|inf)$/i,ke=/^(\+|-)?NaN$/i,Ce=6111,Le=-6176,De=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),Re=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),Pe=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),xe=/^([-+])?(\d+)?$/;function Ge(e){return!isNaN(parseInt(e,10))}function Be(e){var t=Ie.fromNumber(1e9),r=Ie.fromNumber(0);if(!(e.parts[0]||e.parts[1]||e.parts[2]||e.parts[3]))return{quotient:e,rem:r};for(var i=0;i<=3;i++)r=(r=r.shiftLeft(32)).add(new Ie(e.parts[i],0)),e.parts[i]=r.div(t).low,r=r.modulo(t);return{quotient:e,rem:r}}function Ue(e,t){throw new te('"'.concat(e,'" is not a valid Decimal128 string - ').concat(t))}var Me=function(){function e(t){if(!(this instanceof e))return new e(t);if("string"==typeof t)this.bytes=e.fromString(t).bytes;else{if(!se(t))throw new te("Decimal128 must take a Buffer or string");if(16!==t.byteLength)throw new te("Decimal128 must take a Buffer of 16 bytes");this.bytes=t}}return e.fromString=function(t){var r,i=!1,n=!1,o=!1,s=0,a=0,l=0,c=0,h=0,u=[0],d=0,g=0,f=0,p=0,m=0,y=0,b=new Ie(0,0),T=new Ie(0,0),_=0;if(t.length>=7e3)throw new te(t+" not a valid Decimal128 string");var A=t.match(Ne),v=t.match(Oe),w=t.match(ke);if(!A&&!v&&!w||0===t.length)throw new te(t+" not a valid Decimal128 string");if(A){var E=A[2],S=A[4],I=A[5],N=A[6];S&&void 0===N&&Ue(t,"missing exponent power"),S&&void 0===E&&Ue(t,"missing exponent base"),void 0===S&&(I||N)&&Ue(t,"missing e before exponent")}if(("+"===t[_]||"-"===t[_])&&(i="-"===t[_++]),!Ge(t[_])&&"."!==t[_]){if("i"===t[_]||"I"===t[_])return new e(J.from(i?Re:Pe));if("N"===t[_])return new e(J.from(De))}for(;Ge(t[_])||"."===t[_];)"."!==t[_]?(d<34&&("0"!==t[_]||o)&&(o||(h=a),o=!0,u[g++]=parseInt(t[_],10),d+=1),o&&(l+=1),n&&(c+=1),a+=1,_+=1):(n&&Ue(t,"contains multiple periods"),n=!0,_+=1);if(n&&!a)throw new te(t+" not a valid Decimal128 string");if("e"===t[_]||"E"===t[_]){var O=t.substr(++_).match(xe);if(!O||!O[2])return new e(J.from(De));m=parseInt(O[0],10),_+=O[0].length}if(t[_])return new e(J.from(De));if(f=0,d){if(p=d-1,1!==(s=l))for(;0===u[h+s-1];)s-=1}else f=0,p=0,u[0]=0,l=1,d=1,s=0;for(m<=c&&c-m>16384?m=Le:m-=c;m>Ce;){if((p+=1)-f>34){if(u.join("").match(/^0+$/)){m=Ce;break}Ue(t,"overflow")}m-=1}for(;m<Le||d<l;){if(0===p&&s<d){m=Le,s=0;break}if(d<l?l-=1:p-=1,m<Ce)m+=1;else{if(u.join("").match(/^0+$/)){m=Ce;break}Ue(t,"overflow")}}if(p-f+1<s){var k=a;n&&(h+=1,k+=1),i&&(h+=1,k+=1);var C=parseInt(t[h+p+1],10),L=0;if(C>=5&&(L=1,5===C))for(L=u[p]%2==1?1:0,y=h+p+2;y<k;y++)if(parseInt(t[y],10)){L=1;break}if(L)for(var D=p;D>=0;D--)if(++u[D]>9&&(u[D]=0,0===D)){if(!(m<Ce))return new e(J.from(i?Re:Pe));m+=1,u[D]=1}}if(b=Ie.fromNumber(0),T=Ie.fromNumber(0),0===s)b=Ie.fromNumber(0),T=Ie.fromNumber(0);else if(p-f<17)for(D=f,T=Ie.fromNumber(u[D++]),b=new Ie(0,0);D<=p;D++)T=(T=T.multiply(Ie.fromNumber(10))).add(Ie.fromNumber(u[D]));else{for(D=f,b=Ie.fromNumber(u[D++]);D<=p-17;D++)b=(b=b.multiply(Ie.fromNumber(10))).add(Ie.fromNumber(u[D]));for(T=Ie.fromNumber(u[D++]);D<=p;D++)T=(T=T.multiply(Ie.fromNumber(10))).add(Ie.fromNumber(u[D]))}var R=function(e,t){if(!e&&!t)return{high:Ie.fromNumber(0),low:Ie.fromNumber(0)};var r=e.shiftRightUnsigned(32),i=new Ie(e.getLowBits(),0),n=t.shiftRightUnsigned(32),o=new Ie(t.getLowBits(),0),s=r.multiply(n),a=r.multiply(o),l=i.multiply(n),c=i.multiply(o);return s=s.add(a.shiftRightUnsigned(32)),a=new Ie(a.getLowBits(),0).add(l).add(c.shiftRightUnsigned(32)),{high:s=s.add(a.shiftRightUnsigned(32)),low:c=a.shiftLeft(32).add(new Ie(c.getLowBits(),0))}}(b,Ie.fromString("100000000000000000"));R.low=R.low.add(T),function(e,t){var r=e.high>>>0,i=t.high>>>0;return r<i||r===i&&e.low>>>0<t.low>>>0}(R.low,T)&&(R.high=R.high.add(Ie.fromNumber(1))),r=m+6176;var P={low:Ie.fromNumber(0),high:Ie.fromNumber(0)};R.high.shiftRightUnsigned(49).and(Ie.fromNumber(1)).equals(Ie.fromNumber(1))?(P.high=P.high.or(Ie.fromNumber(3).shiftLeft(61)),P.high=P.high.or(Ie.fromNumber(r).and(Ie.fromNumber(16383).shiftLeft(47))),P.high=P.high.or(R.high.and(Ie.fromNumber(0x7fffffffffff)))):(P.high=P.high.or(Ie.fromNumber(16383&r).shiftLeft(49)),P.high=P.high.or(R.high.and(Ie.fromNumber(562949953421311)))),P.low=R.low,i&&(P.high=P.high.or(Ie.fromString("9223372036854775808")));var x=J.alloc(16);return _=0,x[_++]=255&P.low.low,x[_++]=P.low.low>>8&255,x[_++]=P.low.low>>16&255,x[_++]=P.low.low>>24&255,x[_++]=255&P.low.high,x[_++]=P.low.high>>8&255,x[_++]=P.low.high>>16&255,x[_++]=P.low.high>>24&255,x[_++]=255&P.high.low,x[_++]=P.high.low>>8&255,x[_++]=P.high.low>>16&255,x[_++]=P.high.low>>24&255,x[_++]=255&P.high.high,x[_++]=P.high.high>>8&255,x[_++]=P.high.high>>16&255,x[_++]=P.high.high>>24&255,new e(x)},e.prototype.toString=function(){for(var e,t=0,r=new Array(36),i=0;i<r.length;i++)r[i]=0;var n,o,s,a=0,l=!1,c={parts:[0,0,0,0]},h=[];a=0;var u=this.bytes,d=u[a++]|u[a++]<<8|u[a++]<<16|u[a++]<<24,g=u[a++]|u[a++]<<8|u[a++]<<16|u[a++]<<24,f=u[a++]|u[a++]<<8|u[a++]<<16|u[a++]<<24,p=u[a++]|u[a++]<<8|u[a++]<<16|u[a++]<<24;a=0,(new Ie(d,g),new Ie(f,p)).lessThan(Ie.ZERO)&&h.push("-");var m=p>>26&31;if(m>>3==3){if(30===m)return h.join("")+"Infinity";if(31===m)return"NaN";e=p>>15&16383,n=8+(p>>14&1)}else n=p>>14&7,e=p>>17&16383;var y=e-6176;if(c.parts[0]=(16383&p)+((15&n)<<14),c.parts[1]=f,c.parts[2]=g,c.parts[3]=d,0===c.parts[0]&&0===c.parts[1]&&0===c.parts[2]&&0===c.parts[3])l=!0;else for(s=3;s>=0;s--){var b=0,T=Be(c);if(c=T.quotient,b=T.rem.low)for(o=8;o>=0;o--)r[9*s+o]=b%10,b=Math.floor(b/10)}if(l)t=1,r[a]=0;else for(t=36;!r[a];)t-=1,a+=1;var _=t-1+y;if(_>=34||_<=-7||y>0){if(t>34)return h.push("".concat(0)),y>0?h.push("E+".concat(y)):y<0&&h.push("E".concat(y)),h.join("");for(h.push("".concat(r[a++])),(t-=1)&&h.push("."),i=0;i<t;i++)h.push("".concat(r[a++]));h.push("E"),_>0?h.push("+".concat(_)):h.push("".concat(_))}else if(y>=0)for(i=0;i<t;i++)h.push("".concat(r[a++]));else{var A=t+y;if(A>0)for(i=0;i<A;i++)h.push("".concat(r[a++]));else h.push("0");for(h.push(".");A++<0;)h.push("0");for(i=0;i<t-Math.max(A-1,0);i++)h.push("".concat(r[a++]))}return h.join("")},e.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},e.prototype.toExtendedJSON=function(){return{$numberDecimal:this.toString()}},e.fromExtendedJSON=function(t){return e.fromString(t.$numberDecimal)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new Decimal128("'.concat(this.toString(),'")')},e}();Object.defineProperty(Me.prototype,"_bsontype",{value:"Decimal128"});var je=function(){function e(t){if(!(this instanceof e))return new e(t);t instanceof Number&&(t=t.valueOf()),this.value=+t}return e.prototype.valueOf=function(){return this.value},e.prototype.toJSON=function(){return this.value},e.prototype.toString=function(e){return this.value.toString(e)},e.prototype.toExtendedJSON=function(e){return e&&(e.legacy||e.relaxed&&isFinite(this.value))?this.value:Object.is(Math.sign(this.value),-0)?{$numberDouble:"-".concat(this.value.toFixed(1))}:{$numberDouble:Number.isInteger(this.value)?this.value.toFixed(1):this.value.toString()}},e.fromExtendedJSON=function(t,r){var i=parseFloat(t.$numberDouble);return r&&r.relaxed?i:new e(i)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var e=this.toExtendedJSON();return"new Double(".concat(e.$numberDouble,")")},e}();Object.defineProperty(je.prototype,"_bsontype",{value:"Double"});var Fe=function(){function e(t){if(!(this instanceof e))return new e(t);t instanceof Number&&(t=t.valueOf()),this.value=0|+t}return e.prototype.valueOf=function(){return this.value},e.prototype.toString=function(e){return this.value.toString(e)},e.prototype.toJSON=function(){return this.value},e.prototype.toExtendedJSON=function(e){return e&&(e.relaxed||e.legacy)?this.value:{$numberInt:this.value.toString()}},e.fromExtendedJSON=function(t,r){return r&&r.relaxed?parseInt(t.$numberInt,10):new e(t.$numberInt)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new Int32(".concat(this.valueOf(),")")},e}();Object.defineProperty(Fe.prototype,"_bsontype",{value:"Int32"});var $e=function(){function e(){if(!(this instanceof e))return new e}return e.prototype.toExtendedJSON=function(){return{$maxKey:1}},e.fromExtendedJSON=function(){return new e},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new MaxKey()"},e}();Object.defineProperty($e.prototype,"_bsontype",{value:"MaxKey"});var He=function(){function e(){if(!(this instanceof e))return new e}return e.prototype.toExtendedJSON=function(){return{$minKey:1}},e.fromExtendedJSON=function(){return new e},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new MinKey()"},e}();Object.defineProperty(He.prototype,"_bsontype",{value:"MinKey"});var We=new RegExp("^[0-9a-fA-F]{24}$"),Ve=null,qe=Symbol("id"),ze=function(){function e(t){if(!(this instanceof e))return new e(t);var r;if("object"==typeof t&&t&&"id"in t){if("string"!=typeof t.id&&!ArrayBuffer.isView(t.id))throw new te("Argument passed in must have an id that is of type string or Buffer");r="toHexString"in t&&"function"==typeof t.toHexString?J.from(t.toHexString(),"hex"):t.id}else r=t;if(null==r||"number"==typeof r)this[qe]=e.generate("number"==typeof r?r:void 0);else if(ArrayBuffer.isView(r)&&12===r.byteLength)this[qe]=r instanceof J?r:ce(r);else{if("string"!=typeof r)throw new te("Argument passed in does not match the accepted types");if(12===r.length){var i=J.from(r);if(12!==i.byteLength)throw new te("Argument passed in must be a string of 12 bytes");this[qe]=i}else{if(24!==r.length||!We.test(r))throw new te("Argument passed in must be a string of 12 bytes or a string of 24 hex characters or an integer");this[qe]=J.from(r,"hex")}}e.cacheHexString&&(this.__id=this.id.toString("hex"))}return Object.defineProperty(e.prototype,"id",{get:function(){return this[qe]},set:function(t){this[qe]=t,e.cacheHexString&&(this.__id=t.toString("hex"))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"generationTime",{get:function(){return this.id.readInt32BE(0)},set:function(e){this.id.writeUInt32BE(e,0)},enumerable:!1,configurable:!0}),e.prototype.toHexString=function(){if(e.cacheHexString&&this.__id)return this.__id;var t=this.id.toString("hex");return e.cacheHexString&&!this.__id&&(this.__id=t),t},e.getInc=function(){return e.index=(e.index+1)%16777215},e.generate=function(t){"number"!=typeof t&&(t=Math.floor(Date.now()/1e3));var r=e.getInc(),i=J.alloc(12);return i.writeUInt32BE(t,0),null===Ve&&(Ve=oe(5)),i[4]=Ve[0],i[5]=Ve[1],i[6]=Ve[2],i[7]=Ve[3],i[8]=Ve[4],i[11]=255&r,i[10]=r>>8&255,i[9]=r>>16&255,i},e.prototype.toString=function(e){return e?this.id.toString(e):this.toHexString()},e.prototype.toJSON=function(){return this.toHexString()},e.prototype.equals=function(t){if(null==t)return!1;if(t instanceof e)return this[qe][11]===t[qe][11]&&this[qe].equals(t[qe]);if("string"==typeof t&&e.isValid(t)&&12===t.length&&se(this.id))return t===J.prototype.toString.call(this.id,"latin1");if("string"==typeof t&&e.isValid(t)&&24===t.length)return t.toLowerCase()===this.toHexString();if("string"==typeof t&&e.isValid(t)&&12===t.length)return J.from(t).equals(this.id);if("object"==typeof t&&"toHexString"in t&&"function"==typeof t.toHexString){var r=t.toHexString(),i=this.toHexString().toLowerCase();return"string"==typeof r&&r.toLowerCase()===i}return!1},e.prototype.getTimestamp=function(){var e=new Date,t=this.id.readUInt32BE(0);return e.setTime(1e3*Math.floor(t)),e},e.createPk=function(){return new e},e.createFromTime=function(t){var r=J.from([0,0,0,0,0,0,0,0,0,0,0,0]);return r.writeUInt32BE(t,0),new e(r)},e.createFromHexString=function(t){if(typeof t>"u"||null!=t&&24!==t.length)throw new te("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");return new e(J.from(t,"hex"))},e.isValid=function(t){if(null==t)return!1;try{return new e(t),!0}catch{return!1}},e.prototype.toExtendedJSON=function(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}},e.fromExtendedJSON=function(t){return new e(t.$oid)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new ObjectId("'.concat(this.toHexString(),'")')},e.index=Math.floor(16777215*Math.random()),e}();Object.defineProperty(ze.prototype,"generate",{value:le(function(e){return ze.generate(e)},"Please use the static `ObjectId.generate(time)` instead")}),Object.defineProperty(ze.prototype,"getInc",{value:le(function(){return ze.getInc()},"Please use the static `ObjectId.getInc()` instead")}),Object.defineProperty(ze.prototype,"get_inc",{value:le(function(){return ze.getInc()},"Please use the static `ObjectId.getInc()` instead")}),Object.defineProperty(ze,"get_inc",{value:le(function(){return ze.getInc()},"Please use the static `ObjectId.getInc()` instead")}),Object.defineProperty(ze.prototype,"_bsontype",{value:"ObjectID"});var Ke=function(){function e(t,r){if(!(this instanceof e))return new e(t,r);if(this.pattern=t,this.options=function(e){return e.split("").sort().join("")}(r??""),-1!==this.pattern.indexOf("\0"))throw new ee("BSON Regex patterns cannot contain null bytes, found: ".concat(JSON.stringify(this.pattern)));if(-1!==this.options.indexOf("\0"))throw new ee("BSON Regex options cannot contain null bytes, found: ".concat(JSON.stringify(this.options)));for(var i=0;i<this.options.length;i++)if("i"!==this.options[i]&&"m"!==this.options[i]&&"x"!==this.options[i]&&"l"!==this.options[i]&&"s"!==this.options[i]&&"u"!==this.options[i])throw new ee("The regular expression option [".concat(this.options[i],"] is not supported"))}return e.parseOptions=function(e){return e?e.split("").sort().join(""):""},e.prototype.toExtendedJSON=function(e){return(e=e||{}).legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}},e.fromExtendedJSON=function(t){if("$regex"in t){if("string"==typeof t.$regex)return new e(t.$regex,e.parseOptions(t.$options));if("BSONRegExp"===t.$regex._bsontype)return t}if("$regularExpression"in t)return new e(t.$regularExpression.pattern,e.parseOptions(t.$regularExpression.options));throw new te("Unexpected BSONRegExp EJSON object form: ".concat(JSON.stringify(t)))},e}();Object.defineProperty(Ke.prototype,"_bsontype",{value:"BSONRegExp"});var Ye=function(){function e(t){if(!(this instanceof e))return new e(t);this.value=t}return e.prototype.valueOf=function(){return this.value},e.prototype.toString=function(){return this.value},e.prototype.inspect=function(){return'new BSONSymbol("'.concat(this.value,'")')},e.prototype.toJSON=function(){return this.value},e.prototype.toExtendedJSON=function(){return{$symbol:this.value}},e.fromExtendedJSON=function(t){return new e(t.$symbol)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e}();Object.defineProperty(Ye.prototype,"_bsontype",{value:"Symbol"});var Xe=function(e){function t(r,i){var n=this;return n instanceof t?(n=Ie.isLong(r)?e.call(this,r.low,r.high,!0)||this:ae(r)&&typeof r.t<"u"&&typeof r.i<"u"?e.call(this,r.i,r.t,!0)||this:e.call(this,r,i,!0)||this,Object.defineProperty(n,"_bsontype",{value:"Timestamp",writable:!1,configurable:!1,enumerable:!1}),n):new t(r,i)}return Q(t,e),t.prototype.toJSON=function(){return{$timestamp:this.toString()}},t.fromInt=function(e){return new t(Ie.fromInt(e,!0))},t.fromNumber=function(e){return new t(Ie.fromNumber(e,!0))},t.fromBits=function(e,r){return new t(e,r)},t.fromString=function(e,r){return new t(Ie.fromString(e,!0,r))},t.prototype.toExtendedJSON=function(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}},t.fromExtendedJSON=function(e){return new t(e.$timestamp)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return"new Timestamp({ t: ".concat(this.getHighBits(),", i: ").concat(this.getLowBits()," })")},t.MAX_VALUE=Ie.MAX_UNSIGNED_VALUE,t}(Ie),Je=2147483647,Ze=-2147483648,Qe=0x8000000000000000,et=-0x8000000000000000,tt={$oid:ze,$binary:me,$uuid:me,$symbol:Ye,$numberInt:Fe,$numberDecimal:Me,$numberDouble:je,$numberLong:Ie,$minKey:He,$maxKey:$e,$regex:Ke,$regularExpression:Ke,$timestamp:Xe};function rt(e,t){if(void 0===t&&(t={}),"number"==typeof e){if(t.relaxed||t.legacy)return e;if(Math.floor(e)===e){if(e>=Ze&&e<=Je)return new Fe(e);if(e>=et&&e<=Qe)return Ie.fromNumber(e)}return new je(e)}if(null==e||"object"!=typeof e)return e;if(e.$undefined)return null;for(var r=Object.keys(e).filter(function(t){return t.startsWith("$")&&null!=e[t]}),i=0;i<r.length;i++){var n=tt[r[i]];if(n)return n.fromExtendedJSON(e,t)}if(null!=e.$date){var o=e.$date,s=new Date;return t.legacy?"number"==typeof o?s.setTime(o):"string"==typeof o&&s.setTime(Date.parse(o)):"string"==typeof o?s.setTime(Date.parse(o)):Ie.isLong(o)?s.setTime(o.toNumber()):"number"==typeof o&&t.relaxed&&s.setTime(o),s}if(null!=e.$code){var a=Object.assign({},e);return e.$scope&&(a.$scope=rt(e.$scope)),be.fromExtendedJSON(e)}if(function(e){return ae(e)&&null!=e.$id&&"string"==typeof e.$ref&&(null==e.$db||"string"==typeof e.$db)}(e)||e.$dbPointer){var l=e.$ref?e:e.$dbPointer;if(l instanceof Te)return l;var c=Object.keys(l).filter(function(e){return e.startsWith("$")}),h=!0;if(c.forEach(function(e){-1===["$ref","$id","$db"].indexOf(e)&&(h=!1)}),h)return Te.fromExtendedJSON(l)}return e}function it(e){var t=e.toISOString();return 0!==e.getUTCMilliseconds()?t:t.slice(0,-5)+"Z"}function nt(e,t){if(("object"==typeof e||"function"==typeof e)&&null!==e){var r=t.seenObjects.findIndex(function(t){return t.obj===e});if(-1!==r){var i=t.seenObjects.map(function(e){return e.propertyName}),n=i.slice(0,r).map(function(e){return"".concat(e," -> ")}).join(""),o=i[r],s=" -> "+i.slice(r+1,i.length-1).map(function(e){return"".concat(e," -> ")}).join(""),a=i[i.length-1],l=" ".repeat(n.length+o.length/2),c="-".repeat(s.length+(o.length+a.length)/2-1);throw new te("Converting circular structure to EJSON:\n"+"    ".concat(n).concat(o).concat(s).concat(a,"\n")+"    ".concat(l,"\\").concat(c,"/"))}t.seenObjects[t.seenObjects.length-1].obj=e}if(Array.isArray(e))return function(e,t){return e.map(function(e,r){t.seenObjects.push({propertyName:"index ".concat(r),obj:null});try{return nt(e,t)}finally{t.seenObjects.pop()}})}(e,t);if(void 0===e)return null;if(e instanceof Date||function(e){return ae(e)&&"[object Date]"===Object.prototype.toString.call(e)}(e)){var h=e.getTime(),u=h>-1&&h<2534023188e5;return t.legacy?t.relaxed&&u?{$date:e.getTime()}:{$date:it(e)}:t.relaxed&&u?{$date:it(e)}:{$date:{$numberLong:e.getTime().toString()}}}if(!("number"!=typeof e||t.relaxed&&isFinite(e))){if(Math.floor(e)===e){var d=e>=et&&e<=Qe;if(e>=Ze&&e<=Je)return{$numberInt:e.toString()};if(d)return{$numberLong:e.toString()}}return{$numberDouble:e.toString()}}if(e instanceof RegExp||function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}(e)){var g=e.flags;if(void 0===g){var f=e.toString().match(/[gimuy]*$/);f&&(g=f[0])}return new Ke(e.source,g).toExtendedJSON(t)}return null!=e&&"object"==typeof e?function(e,t){if(null==e||"object"!=typeof e)throw new ee("not an object instance");var r=e._bsontype;if(typeof r>"u"){var i={};for(var n in e){t.seenObjects.push({propertyName:n,obj:null});try{var o=nt(e[n],t);"__proto__"===n?Object.defineProperty(i,n,{value:o,writable:!0,enumerable:!0,configurable:!0}):i[n]=o}finally{t.seenObjects.pop()}}return i}if(function(e){return ae(e)&&Reflect.has(e,"_bsontype")&&"string"==typeof e._bsontype}(e)){var s=e;if("function"!=typeof s.toExtendedJSON){var a=st[e._bsontype];if(!a)throw new te("Unrecognized or invalid _bsontype: "+e._bsontype);s=a(s)}return"Code"===r&&s.scope?s=new be(s.code,nt(s.scope,t)):"DBRef"===r&&s.oid&&(s=new Te(nt(s.collection,t),nt(s.oid,t),nt(s.db,t),nt(s.fields,t))),s.toExtendedJSON(t)}throw new ee("_bsontype must be a string, but was: "+typeof r)}(e,t):e}var ot,st={Binary:function(e){return new me(e.value(),e.sub_type)},Code:function(e){return new be(e.code,e.scope)},DBRef:function(e){return new Te(e.collection||e.namespace,e.oid,e.db,e.fields)},Decimal128:function(e){return new Me(e.bytes)},Double:function(e){return new je(e.value)},Int32:function(e){return new Fe(e.value)},Long:function(e){return Ie.fromBits(null!=e.low?e.low:e.low_,null!=e.low?e.high:e.high_,null!=e.low?e.unsigned:e.unsigned_)},MaxKey:function(){return new $e},MinKey:function(){return new He},ObjectID:function(e){return new ze(e)},ObjectId:function(e){return new ze(e)},BSONRegExp:function(e){return new Ke(e.pattern,e.options)},Symbol:function(e){return new Ye(e.value)},Timestamp:function(e){return Xe.fromBits(e.low,e.high)}};!function(e){function t(e,t){var r=Object.assign({},{relaxed:!0,legacy:!1},t);return"boolean"==typeof r.relaxed&&(r.strict=!r.relaxed),"boolean"==typeof r.strict&&(r.relaxed=!r.strict),JSON.parse(e,function(e,t){if(-1!==e.indexOf("\0"))throw new ee("BSON Document field names cannot contain null bytes, found: ".concat(JSON.stringify(e)));return rt(t,r)})}function r(e,t,r,i){null!=r&&"object"==typeof r&&(i=r,r=0),null!=t&&"object"==typeof t&&!Array.isArray(t)&&(i=t,t=void 0,r=0);var n=nt(e,Object.assign({relaxed:!0,legacy:!1},i,{seenObjects:[{propertyName:"(root)",obj:null}]}));return JSON.stringify(n,t,r)}e.parse=t,e.stringify=r,e.serialize=function(e,t){return t=t||{},JSON.parse(r(e,t))},e.deserialize=function(e,r){return r=r||{},t(JSON.stringify(e),r)}}(ot||(ot={}));var at=ie();at.Map?at.Map:function(){function e(e){void 0===e&&(e=[]),this._keys=[],this._values={};for(var t=0;t<e.length;t++)if(null!=e[t]){var r=e[t],i=r[0],n=r[1];this._keys.push(i),this._values[i]={v:n,i:this._keys.length-1}}}e.prototype.clear=function(){this._keys=[],this._values={}},e.prototype.delete=function(e){var t=this._values[e];return null!=t&&(delete this._values[e],this._keys.splice(t.i,1),!0)},e.prototype.entries=function(){var e=this,t=0;return{next:function(){var r=e._keys[t++];return{value:void 0!==r?[r,e._values[r].v]:void 0,done:void 0===r}}}},e.prototype.forEach=function(e,t){t=t||this;for(var r=0;r<this._keys.length;r++){var i=this._keys[r];e.call(t,this._values[i].v,i,t)}},e.prototype.get=function(e){return this._values[e]?this._values[e].v:void 0},e.prototype.has=function(e){return null!=this._values[e]},e.prototype.keys=function(){var e=this,t=0;return{next:function(){var r=e._keys[t++];return{value:void 0!==r?r:void 0,done:void 0===r}}}},e.prototype.set=function(e,t){return this._values[e]?(this._values[e].v=t,this):(this._keys.push(e),this._values[e]={v:t,i:this._keys.length-1},this)},e.prototype.values=function(){var e=this,t=0;return{next:function(){var r=e._keys[t++];return{value:void 0!==r?e._values[r].v:void 0,done:void 0===r}}}},Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!1,configurable:!0})}(),Ie.fromNumber(fe),Ie.fromNumber(pe);var lt=new Uint8Array(8);function ct(){return(new ze).toString()}function ht(e){return{...e,_id:ct()}}function ut(e){return e._user&&delete e._user,{...e}}function dt(e){return e.lastSync&&delete e.lastSync,{...e}}new DataView(lt.buffer,lt.byteOffset,lt.byteLength),J.alloc(17825792);var gt=(e=>(e["most-liked"]="most-liked",e.newest="newest",e))(gt||{});Object.keys(gt);const ft="createdAt";function pt(e,t,r="asc",i){return((t[i]??t[ft]??0)-(e[i]??e[ft]??0))*("desc"===r?-1:1)}function mt(e,t){return e.localeCompare(t,"en",{sensitivity:"base"})}function yt(e,t){return mt(e.name,t.name)}function bt(e,t){return mt(e.name,t.name)}const Tt=(e,t)=>t.count-e.count,_t=(e,t)=>t.matchScore!==e.matchScore?t.matchScore-e.matchScore:t.matchScore<60||e.matchScore<60?Tt(e,t):0;var At,vt,wt,Et,St,It=(e=>(e.BASIC="BASIC",e.EXPERT="EXPERT",e))(It||{});function Nt(e,t){return(Array.isArray(t)?t:[]).reduce((t,r)=>{if("string"!=typeof r)return t;try{return t[r=r.split(" ").join("")]=`${e}-${r}`,t}catch{return t}},{})}function Ot(e,t){const r=function(e,t){return e.map(e=>({tagName:e,options:t}))}(e,t);yi.dispatch("defineComponent",{detail:{componentDefinitions:r}})}(e=>{const t=class{};h(t,"TAG","AppSidebar"),h(t,"TEST_IDS",{...Nt(t.TAG,["SIDEBAR_CONTAINER","MAIN_NAV_DASHBOARD_BTN","MAIN_NAV_LEARNING_BTN","MAIN_NAV_SEARCH_BTN","MAIN_NAV_DISCOVER_BTN","MAIN_NAV_UPGRADE_BTN","FOOTER_NAV_SETTINGS_BTN","FOOTER_NAV_CHANGE_COLOR","FOOTER_NAV_LEARNING","FOOTER_NAV_LOGOUT","TAGS_VIEW","ORIGINS_VIEW","COLORS_VIEW","IMAGES_VIEW","TRIAL_WARNING","TRIAL_INFO","DOCUMENTS_VIEW"]),GRID_VIEW_BTN:e=>`GRID_VIEW_BTN-${e}`,GRID_VIEW_BTN_BADGE:e=>`GRID_VIEW_BTN_BADGE-${e}`});let r=t;e.AppSidebar=r;const i=class{};h(i,"TAG","AppLayout"),h(i,"TEST_IDS",Nt(i.TAG,["MOBILE_NAV","SIDEBAR_NAV","MOBILE_MENU_SIDEBAR_BTN","MOBILE_MENU_SEARCH_BTN","MOBILE_MENU_LEARNING_BTN","MOBILE_MENU_HOME_BTN"]));let n=i;e.AppLayout=n;const o=class{};h(o,"TAG","ImportView"),h(o,"TEST_IDS",{...Nt(o.TAG,["NO_URL","ERROR_TITLE","ERROR_DESCRIPTION","LOADING"])});let s=o;e.ImportView=s;const a=class{};h(a,"TAG","TagsOverviewComponent"),h(a,"TEST_IDS",{...Nt(a.TAG,["TAG"])});let l=a;e.TagsOverviewComponent=l;const c=class{};h(c,"TAG","WebsitesOverviewComponent"),h(c,"TEST_IDS",{...Nt(c.TAG,["TAG"])});let u=c;e.WebsitesOverviewComponent=u})(At||(At={})),(e=>{const t=class{};h(t,"TAG","ExtensionDevPage"),h(t,"TEST_IDS",{...Nt(t.TAG,["TOGGLE_SIDEBAR_BTN","HIGHLIGHT_IMAGE_1","HIGHLIGHT_IMAGE_2","TEST_TOO_LARGE_ENTITY","ADD_NEW_DOM_ELEMENT","BROWSER_ACTION_OPEN_READER_BTN","TEST_YOUTUBE_VIDEO_1","TEST_YOUTUBE_VIDEO_2"]),SHORTCUT_BTN:e=>`${t.TAG}_shortcut_btn_${e}`}),h(t,"LATER_ADDED_TEXT","This text was added programmatically");let r=t;e.ExtensionDevPage=r;const i=class{};h(i,"TAG","webhighlights-demo"),h(i,"TEST_IDS",Nt(i.TAG,[""]));let n=i;e.Demo=n})(vt||(vt={})),(e=>{const t=class{};h(t,"TAG","webhighlights-element-registry"),h(t,"TEST_IDS",Nt(t.TAG,[""]));let r=t;e.ElementRegistry=r;const i=class{};h(i,"TAG","webhighlights-image-indicator"),h(i,"TEST_IDS",Nt(i.TAG,[])),h(i,"CLASSES",{IMAGE_HIGHLIGHT_INDICATOR_CLASS:"webhighlights-image-indicator"});let n=i;e.ImageIndicator=n})(wt||(wt={})),(e=>{const t=class{};h(t,"TAG","webhighlights-browser-action-mock"),h(t,"TEST_IDS",Nt(t.TAG,["HIGHLIGHT_IMAGE_2"]));let r=t;e.BrowserActionMock=r;const i=class{};h(i,"TAG","webhighlights-kindle-import-helper"),h(i,"TEST_IDS",Nt(i.TAG,[]));let n=i;e.KindleImportHelper=n;const o=class{};h(o,"TAG","webhighlights-youtube-highlight-button"),h(o,"TEST_IDS",Nt(o.TAG,[]));let s=o;e.YoutubeHighlightButton=s;const a=class{};h(a,"TAG","webhighlights-notifications-pdf"),h(a,"TEST_IDS",Nt(a.TAG,[]));let l=a;e.NotificationsPdf=l;const c=class{};h(c,"TAG","webhighlights-pdf-local-file-info"),h(c,"TEST_IDS",Nt(c.TAG,[]));let u=c;e.PdfLocalFileInfo=u;const d=class{};h(d,"TAG","webhighlights-text-notification"),h(d,"TEST_IDS",Nt(d.TAG,[]));let g=d;e.TextNotification=g})(Et||(Et={})),(e=>{const t=class{};h(t,"TAG","webhighlights-add-content"),h(t,"CONTENT_BOX_ID","add-content-html-box"),h(t,"URL_INPUT_ID","url-input-url"),h(t,"TEST_IDS",Nt(t.TAG,["URL_INPUT","TEXT_INPUT","CREATE_BTN","CLOSE_BTN","SEARCH_BTN","text_TAB","URL_TAB","PDF_TAB"]));let r=t;e.AddContent=r;const i=class{};h(i,"TAG","webhighlights-create-bookmark"),h(i,"TEST_IDS",Nt(i.TAG,["TITLE_INPUT","URL_INPUT","DESCRIPTION_INPUT","IMAGE"]));let n=i;e.CreateBookmark=n;const o=class{};h(o,"TAG","webhighlights-account-info"),h(o,"TEST_IDS",{...Nt(o.TAG,["ACCOUNT_INFO","USER_NAME","AVATAR","EMAIL","SIGN_UP_CTA_BTN"])});let s=o;e.AccountInfo=s;const a=class{};h(a,"TAG","webhighlights-auth"),h(a,"TEST_IDS",Nt(a.TAG,["AUTH_TYPE_SWITCH_BTN","TOS_PRIVACY_INFO","TITLE"]));let l=a;e.Auth=l;const c=class{};h(c,"TAG","webhighlights-avatar"),h(c,"TEST_IDS",Nt(c.TAG,["POPUP_TOOLBOX"]));let u=c;e.Avatar=u;const d=class{};h(d,"TAG","webhighlights-backup-or-sync-prompt"),h(d,"TEST_IDS",{...Nt(d.TAG,["CTA_BACKUP","CTA_SYNC","BACKUP_INTERVAL_INPUT","DISMISS_CHECKBOX_INPUT"])});let g=d;e.BackupOrSyncPrompt=g;const f=class{};h(f,"TAG","webhighlights-blacklisted-urls"),h(f,"TEST_IDS",{...Nt(f.TAG,["ADD_URL_INPUT","ADD_URL_BTN"]),LIST_ENTRY:e=>`${f.TAG}-LIST_ENTRY_${e}`,INPUT_VALUE:e=>`${f.TAG}-INPUT_VALUE_${e}`,DELETE_BTN:e=>`${f.TAG}-DELETE_BTN_${e}`});let p=f;e.BlacklistesUrls=p;const m=class{};h(m,"TAG","webhighlights-cancel-subscription"),h(m,"TEST_IDS",{...Nt(m.TAG,["STEP_TITLE","STEP_DESCRIPTION","ERROR_MESSAGE","PROCEED_BTN","BACK_BTN","KEEP_SUBSCRIPTION_BTN","CANCEL_NOW_BTN","CLOSE_BUBBLE_BTN","FEEDBACK_TEXTAREA","CHAR_COUNT","LOADING","NO_SUBSCRIPTION_MESSAGE","CONTINUE_CANCEL_BTN","FOUNDER_BUBBLE"]),RADIO_OPTION:e=>`${m.TAG}-RADIO_OPTION-${e}`});let y=m;e.CancelSubscription=y;const b=class{};h(b,"TAG","webhighlights-reader"),h(b,"TEST_IDS",Nt(b.TAG,[]));let T=b;e.Reader=T;const _=class{};h(_,"TAG","webhighlights-bookmark-details"),h(_,"TEST_IDS",Nt(_.TAG,[]));let A=_;e.BookmarkDetails=A;const v=class{};h(v,"TAG","webhighlights-bookmark-explore-toolbar"),h(v,"TEST_IDS",Nt(v.TAG,[""]));let w=v;e.BookmarkExploreToolbar=w;const E=class{};h(E,"TAG","webhighlights-bookmark-likes"),h(E,"TEST_IDS",Nt(E.TAG,["USER_LIKE_INFO","AVATAR"]));let S=E;e.BookmarkLikes=S;const I=class{};h(I,"TAG","webhighlights-bookmark-preview"),h(I,"TEST_IDS",Nt(I.TAG,["PREVIEW_ITEM"]));let N=I;e.BookmarkPreview=N;const O=class{};h(O,"TAG","webhighlights-bookmark-preview-highlights-notes-info"),h(O,"TEST_IDS",{...Nt(O.TAG,["BADGE_HIGHLIGHTS","BADGE_NOTES"])});let k=O;e.BookmarkPreviewHighlightsNotesInfo=k;const C=class{};h(C,"TAG","webhighlights-change-color-mode"),h(C,"TEST_IDS",Nt(C.TAG,[]));let L=C;e.ChangeColorMode=L;const D=class{};h(D,"TAG","webhighlights-chrome-rating-prompt"),h(D,"TEST_IDS",{...Nt(D.TAG,["DECLINE_BTN","CONFIRM_BTN","CHROME_STORE_LINK"])});let R=D;e.ChromeRatingPrompt=R;const P=class{};h(P,"TAG","webhighlights-chrome-settings"),h(P,"TEST_IDS",{...Nt(P.TAG,[])});let x=P;e.ChromeSettings=x;const G=class{};h(G,"TAG","webhighlights-clipboard-button"),h(G,"TEST_IDS",Nt(G.TAG,[""]));let B=G;e.ClipboardButton=B;const U=class{};h(U,"TAG","webhighlights-color-picker"),h(U,"TEST_IDS",Nt(U.TAG,[""]));let M=U;e.ColorPicker=M;const j=class{};h(j,"TAG","webhighlights-datetimepicker"),h(j,"TEST_IDS",Nt(j.TAG,["PREVIEW_TEXT","DATE_INPUT","HOUR_INPUT","MINUTE_INPUT","CANCEL_BTN","CONFIRM_BTN"]));let F=j;e.DatetimePicker=F;const $=class{};h($,"TAG","webhighlights-dialog"),h($,"TEST_IDS",{...Nt($.TAG,[])});let H=$;e.Dialog=H;const W=class{};h(W,"TAG","webhighlights-discount-info"),h(W,"TEST_IDS",Nt(W.TAG,["TEXT","AVATAR"]));let V=W;e.DiscountInfo=V;const q=class{};h(q,"TAG","webhighlights-discover-feed-info"),h(q,"TEST_IDS",{...Nt(q.TAG,[])});let z=q;e.DiscoverFeedInfo=z;const K=class{};h(K,"TAG","webhighlights-dots-menu"),h(K,"TEST_IDS",{...Nt(K.TAG,["BTN"]),DROPDOWN_ITEM:e=>`${K.TAG}-dropdown-item-${e}`});let Y=K;e.DotsMenu=Y;const X=class{};h(X,"TAG","webhighlights-entity-grid"),h(X,"TEST_IDS",Nt(X.TAG,[]));let J=X;e.EntityGrid=J;const Z=class{};h(Z,"TAG","webhighlights-expiry-info"),h(Z,"TEST_IDS",Nt(Z.TAG,["EXPIRY_INFO","CTA_TEXT","CTA_BTN","BEFORE_MARCH_25_INFO"]));let Q=Z;e.ExpiryInfo=Q;const ee=class{};h(ee,"TAG","webhighlights-fallback-img"),h(ee,"TEST_IDS",{...Nt(ee.TAG,[])});let te=ee;e.FallbackImage=te;const re=class{};h(re,"TAG","webhighlights-favicon"),h(re,"TEST_IDS",Nt(re.TAG,["image"]));let ie=re;e.Favicon=ie;const ne=class{};h(ne,"TAG","webhighlights-image-with-fallback"),h(ne,"TEST_IDS",Nt(ne.TAG,["IMAGE","FALLBACK_IMAGE"]));let oe=ne;e.ImageWithFallback=oe;const se=class{};h(se,"TAG","webhighlights-ai-summary"),h(se,"TEST_IDS",{...Nt(se.TAG,["SKELETON","CONTENT","ERROR","TOOLBAR","TOGGLE_SUMMARY_DETAILS_BTN","SUMMARY_TYPE","DETAILS","AI_SUMMARY_CONTAINER","REGENERATE_SUMMARY_BTN","DELETE_SUMMARY_BTN","AI_SUMMARY_DOTS_MENU","SUMMARY_TYPE_DOTS_MENU","LENGTH_SLIDER"]),SUMMARY_TYPE_OPTION:e=>`${se.TAG}-SUMMARY_TYPE_OPTION-${e}`});let ae=se;e.AiSummary=ae;const le=class{};h(le,"TAG","webhighlights-ai-chat"),h(le,"TEST_IDS",Nt(le.TAG,["EMPTY_STATE_UPGRADE_BTN","RESTART_BTN","SEND_MESSAGE_BTN","STOP_STREAMING_BTN","INPUT","SESSION_ERROR"]));let ce=le;e.AiChat=ce;const he=class{};h(he,"TAG","webhighlights-ai-summary-btn"),h(he,"TEST_IDS",Nt(he.TAG,["BTN","TOOLTIP"]));let ue=he;e.AiSummaryBtn=ue;const de=class{};h(de,"TAG","webhighlights-grid"),h(de,"TEST_IDS",Nt(de.TAG,["PAGES_COUNT_BADGE","HIGHLIGHTS_COUNT_BADGE","SWITCH_TO_HIGHLIGHTS","SWITCH_TO_PAGES","PAGINATION_STEP_BTN","PAGINATION_STEP_PREV_BTN","PAGINATION_STEP_NEXT_BTN","PAGINATION_INFO","EMPTY_STATE"]));let ge=de;e.Grid=ge;const fe=class{};h(fe,"TAG","webhighlights-grid-toolbar"),h(fe,"TEST_IDS",Nt(fe.TAG,[]));let pe=fe;e.GridToolbar=pe;const me=class{};h(me,"TAG","webhighlights-highlighter-mode-selector"),h(me,"TEST_IDS",{...Nt(me.TAG,[]),HIGHLIGHTER_MODE_OPTION_INPUT:e=>`highlighter-mode-option-input-${e}`,HIGHLIGHTER_MODE_OPTION_CONTAINER:e=>`highlighter-mode-option-container-${e}`});let ye=me;e.HighlighterModeSelector=ye;const be=class{};h(be,"TAG","webhighlights-icon"),h(be,"TEST_IDS",Nt(be.TAG,[""]));let Te=be;e.Icon=Te;const _e=class{};h(_e,"TAG","webhighlights-image-viewer"),h(_e,"TEST_IDS",{...Nt(_e.TAG,["IMG","OUTSIDE_CONTAINER"])});let Ae=_e;e.ImageViewer=Ae;const ve=class{};h(ve,"TAG","webhighlights-imprint"),h(ve,"TEST_IDS",Nt(ve.TAG,[""]));let we=ve;e.Imprint=we;const Ee=class{};h(Ee,"TAG","webhighlights-invoices"),h(Ee,"TEST_IDS",{...Nt(Ee.TAG,[""])});let Se=Ee;e.Invoices=Se;const Ie=class{};h(Ie,"TAG","webhighlights-learning-btn"),h(Ie,"TEST_IDS",Nt(Ie.TAG,[]));let Ne=Ie;e.LearningBtn=Ne;const Oe=class{};h(Oe,"TAG","webhighlights-learning-dashboard"),h(Oe,"TEST_IDS",Nt(Oe.TAG,["POPOVER","BOOKMARK_DETAILS_POPOVER","CONFIDENCE_MAIN","GO_BACK_BTN","SELECTED_CATEGORY"]));let ke=Oe;e.LearningDashboard=ke;const Ce=class{};h(Ce,"TAG","webhighlights-learning-reminder"),h(Ce,"TEST_IDS",Nt(Ce.TAG,["CONTINUE_LEARNING_BTN"]));let Le=Ce;e.LearningReminder=Le;const De=class{};h(De,"TAG","webhighlights-learning-settings"),h(De,"TEST_IDS",{...Nt(De.TAG,["SHOW_TEASER_CHECKBOX"])});let Re=De;e.LearningSettings=Re;const Pe=class{};h(Pe,"TAG","webhighlights-learning-streak-overview"),h(Pe,"TEST_IDS",{...Nt(Pe.TAG,["MAX_STREAK","CURRENT_STREAK","DAYS_LEARNT"]),DAY_CHECK_ICON:e=>`${Pe.TAG}-DAY_CHECK_ICON-${e}`});let xe=Pe;e.LearningStreakOverview=xe;const Ge=class{};h(Ge,"TAG","webhighlights-legal-footer"),h(Ge,"TEST_IDS",Nt(Ge.TAG,["FAQ_LINK","BLOG_LINK","TOS_LINK","PRIVACY_LINK","IMPRINT_LINK","COOKIE_LINK"]));let Be=Ge;e.LegalFooter=Be;const Ue=class{};h(Ue,"TAG","webhighlights-like-button"),h(Ue,"TEST_IDS",{...Nt(Ue.TAG,["INPUT_CHECKBOX"])});let Me=Ue;e.LikeButton=Me;const je=class{};h(je,"TAG","webhighlights-link-preview"),h(je,"TEST_IDS",Nt(je.TAG,["TITLE","URL","DESCRIPTION","IMAGE"]));let Fe=je;e.LinkPreview=Fe;const $e=class{};h($e,"TAG","webhighlights-loading"),h($e,"TEST_IDS",Nt($e.TAG,[]));let He=$e;e.Loading=He;const We=class{};h(We,"TAG","webhighlights-loading-text"),h(We,"TEST_IDS",Nt(We.TAG,[""]));let Ve=We;e.LoadingText=Ve;const qe=class{};h(qe,"TAG","webhighlights-lobby-container"),h(qe,"TEST_IDS",Nt(qe.TAG,[""]));let ze=qe;e.LobbyContainer=ze;const Ke=class{};h(Ke,"TAG","webhighlights-lobby-container-extension"),h(Ke,"TEST_IDS",Nt(Ke.TAG,[""]));let Ye=Ke;e.LobbyContainerExtension=Ye;const Xe=class{};h(Xe,"TAG","webhighlights-logo"),h(Xe,"TEST_IDS",Nt(Xe.TAG,[]));let Je=Xe;e.Logo=Je;const Ze=class{};h(Ze,"TAG","webhighlights-logo-animated"),h(Ze,"TEST_IDS",Nt(Ze.TAG,[""]));let Qe=Ze;e.LogoAnimated=Qe;const et=class{};h(et,"TAG","webhighlights-mark-blockquotes-teaser"),h(et,"TEST_IDS",Nt(et.TAG,[""]));let tt=et;e.MarkBlockQuotesTeaser=tt;const rt=class{};h(rt,"TAG","webhighlights-mark-element"),h(rt,"TEST_IDS",Nt(rt.TAG,["TOOLBAR","RICH_EDITOR","TAGS","CONTAINER"]));let it=rt;e.MarkElement=it;const nt=class{static preload(){Ot([this.TAG,Te.TAG,M.TAG,B.TAG,gt.TAG])}};h(nt,"TAG","webhighlights-mark-element-toolbar"),h(nt,"TEST_IDS",Nt(nt.TAG,["CONTAINER","TOGGLE_NOTES_BTN","TOGGLE_TAGS_BTN","COLOR_PICKER","COPY_BTN","DELETE_BTN","TOGGLE_SIDEBAR_BTN","OPEN_MEDIA_TYPE_DROPDOWN_BTN"]));let ot=nt;e.MarkElementToolbar=ot;const st=class{};h(st,"TAG","webhighlights-mark-media-item"),h(st,"TEST_IDS",{...Nt(st.TAG,["DELETE_BTN","EXPAND_IMG"])});let at=st;e.MarkMediaItem=at;const lt=class{};h(lt,"TAG","webhighlights-mark-preview"),h(lt,"TEST_IDS",Nt(lt.TAG,[]));let ct=lt;e.MarkPreview=ct;const ht=class{};h(ht,"TAG","webhighlights-media-type-dropdown"),h(ht,"TEST_IDS",{...Nt(ht.TAG,[])});let ut=ht;e.MediaTypeDropdown=ut;const dt=class{};h(dt,"TAG","webhighlights-media-type-dropdown-item"),h(dt,"TEST_IDS",{...Nt(dt.TAG,[]),HIGHLIGHT_BTN:e=>`${dt.TAG}_DROPDOWN_ITEM-${e}`});let gt=dt;e.MediaTypeDropdownItem=gt;const ft=class{};h(ft,"TAG","webhighlights-media-type-menu"),h(ft,"TEST_IDS",{...Nt(ft.TAG,["ENABLE_MODE_OVERLAY","ENABLE_MODE_BTN"]),HIGHLIGHT_BTN:e=>`${ft.TAG}_HIGHLIGHT_BTN-${e}`});let pt=ft;e.MediaTypeMenu=pt;const mt=class{};h(mt,"TAG","webhighlights-modal"),h(mt,"TEST_IDS",Nt(mt.TAG,["CONTAINER","CLOSE_BTN"]));let yt=mt;e.Modal=yt;const bt=class{};h(bt,"TAG","webhighlights-notes-editor"),h(bt,"TEST_IDS",{...Nt(bt.TAG,["NOTES_CONTAINER"])});let Tt=bt;e.NotesEditor=Tt;const _t=class{};h(_t,"TAG","webhighlights-notifications-btn"),h(_t,"TEST_IDS",Nt(_t.TAG,["BTN","BADGE"]));let At=_t;e.NotificationsBtn=At;const vt=class{};h(vt,"TAG","webhighlights-notifications-list"),h(vt,"TEST_IDS",Nt(vt.TAG,[]));let wt=vt;e.NotificationsList=wt;const Et=class{};h(Et,"TAG","webhighlights-payment-method"),h(Et,"TEST_IDS",{...Nt(Et.TAG,[""])});let St=Et;e.PaymentMethod=St;const It=class{};h(It,"TAG","webhighlights-pdf-hint"),h(It,"TEST_IDS",Nt(It.TAG,[]));let kt=It;e.PdfHint=kt;const Ct=class{};h(Ct,"TAG","webhighlights-popover"),h(Ct,"TEST_IDS",{...Nt(Ct.TAG,["CLOSE_BTN"])});let Lt=Ct;e.Popover=Lt;const Dt=class{};h(Dt,"TAG","webhighlights-premium-benefits"),h(Dt,"TEST_IDS",{...Nt(Dt.TAG,[""])});let Rt=Dt;e.PremiumBenefits=Rt;const Pt=class{};h(Pt,"TAG","webhighlights-pricing"),h(Pt,"TEST_IDS",Nt(Pt.TAG,["SWITCH_TO_YEARLY_BTN","SWITCH_TO_MONTHLY_BTN","SWITCH_TO_LIFETIME","YEARLY_SAVE_INFO"]));let xt=Pt;e.Pricing=xt;const Gt=class{};h(Gt,"TAG","webhighlights-privacy-policy"),h(Gt,"TEST_IDS",Nt(Gt.TAG,[""]));let Bt=Gt;e.PrivacyPolicy=Bt;const Ut=class{};h(Ut,"TAG","webhighlights-recent-colors"),h(Ut,"TEST_IDS",Nt(Ut.TAG,[""]));let Mt=Ut;e.RecentColors=Mt;const jt=class{};h(jt,"TAG","webhighlights-reminder"),h(jt,"TEST_IDS",Nt(jt.TAG,["SNOOZE_BTN","CLOCK_ICON","DOTS_MENU","LABEL","LOADING","DELETE_BTN"]));let Ft=jt;e.Reminder=Ft;const $t=class{};h($t,"TAG","webhighlights-reset-password"),h($t,"TEST_IDS",{...Nt($t.TAG,["NEW_PASSWORD_INPUT","SUBMIT_BTN","ERROR_MSG","SUCCESSS_MSG"])});let Ht=$t;e.ResetPassword=Ht;const Wt=class{};h(Wt,"TAG","webhighlights-search"),h(Wt,"TEST_IDS",{...Nt(Wt.TAG,["LOADING","SEARCH_ENTITY","NO_RESULTS_INFO"]),SEARCH_TYPE_FILTER:e=>`SEARCH_TYPE_FILTER_${Wt.TAG}-${e}`});let Vt=Wt;e.Search=Vt;const qt=class{};h(qt,"TAG","webhighlights-searchbar"),h(qt,"TEST_IDS",{...Nt(qt.TAG,["INPUT","SUBMIT_BTN","CLEAR_BTN","CANCEL_BTN"])});let zt=qt;e.SearchBar=zt;const Kt=class{};h(Kt,"TAG","webhighlights-settings"),h(Kt,"TEST_IDS",{...Nt(Kt.TAG,["ACCOUNT_INFO"]),VIEW_BTN:e=>`${Kt.TAG}_${e}-VIEW_BTN`});let Yt=Kt;e.Settings=Yt;const Xt=class{};h(Xt,"TAG","webhighlights-share-button"),h(Xt,"TEST_IDS",{...Nt(Xt.TAG,["SHARE_BUTTON","UNSHARE_BUTTON","CONTAINER","SOCIAL_CONTAINER","SOCIAL_FACEBOOK","SOCIAL_LINKEDIN","SOCIAL_TWITTER","SHARE_TO_FEED_CHECKBOX"])});let Jt=Xt;e.ShareButton=Jt;const Zt=class{};h(Zt,"TAG","webhighlights-share-social"),h(Zt,"TEST_IDS",Nt(Zt.TAG,[""]));let Qt=Zt;e.ShareSocial=Qt;const er=class{};h(er,"TAG","webhighlights-shortcut"),h(er,"TEST_IDS",Nt(er.TAG,[""]));let tr=er;e.Shortcut=tr;const rr=class{};h(rr,"TAG","webhighlights-sign-up-prompt"),h(rr,"TEST_IDS",{...Nt(rr.TAG,["CTA","CANCEL_BTN"])});let ir=rr;e.SignUpPrompt=ir;const nr=class{};h(nr,"TAG","webhighlights-sync-indicator"),h(nr,"CLASSES",{hasTooLargeEntities:"has-too-large-payload-entities"}),h(nr,"TEST_IDS",Nt(nr.TAG,["SYNC_BTN","UNSYNCED_ENTITIES_BADGE","TOOLTIP","SYNC_PROGRESS_INFO","CLOUD_OFF_ICON","CLOUD_CHECK_ICON","UPDATING_LOADING_SPINNER"]));let or=nr;e.SyncIndicator=or;const sr=class{};h(sr,"TAG","webhighlights-sync-status-entity"),h(sr,"TEST_IDS",Nt(sr.TAG,[""]));let ar=sr;e.SyncStatusEntity=ar;const lr=class{};h(lr,"TAG","webhighlights-tag"),h(lr,"TEST_IDS",{...Nt(lr.TAG,["DELETE_BTN","BADGE","SELECT_BTN"])});let cr=lr;e.Tag=cr;const hr=class{};h(hr,"TAG","webhighlights-tags"),h(hr,"TEST_IDS",{...Nt(hr.TAG,["INPUT","EXISTING_TAG"])});let ur=hr;e.Tags=ur;const dr=class{};h(dr,"TAG","webhighlights-terms-of-service"),h(dr,"TEST_IDS",Nt(dr.TAG,[""]));let gr=dr;e.TermsOfService=gr;const fr=class{};h(fr,"TAG","webhighlights-testimonial-item"),h(fr,"TEST_IDS",{...Nt(fr.TAG,[])});let pr=fr;e.TestimonialItem=pr;const mr=class{};h(mr,"TAG","webhighlights-testimonials-grid"),h(mr,"TEST_IDS",{...Nt(mr.TAG,[])});let yr=mr;e.TestimonialsGrid=yr;const br=class{};h(br,"TAG","webhighlights-toasts"),h(br,"TEST_IDS",Nt(br.TAG,[""]));let Tr=br;e.Toasts=Tr;const _r=class{};h(_r,"TAG","webhighlights-toggle-button"),h(_r,"TEST_IDS",Nt(_r.TAG,[""]));let Ar=_r;e.ToggleButton=Ar;const vr=class{};h(vr,"TAG","webhighlights-tooltip"),h(vr,"TEST_IDS",Nt(vr.TAG,[""]));let wr=vr;e.Tooltip=wr;const Er=class{};h(Er,"TAG","webhighlights-upgrade-deal-prompt"),h(Er,"TEST_IDS",{...Nt(Er.TAG,["CTA","CANCEL_BTN"])});let Sr=Er;e.UpgradeDealPrompt=Sr;const Ir=class{};h(Ir,"TAG","webhighlights-upgrade-needed"),h(Ir,"TEST_IDS",{...Nt(Ir.TAG,["CTA_BTN","HEADLINE"])});let Nr=Ir;e.UpgradeNeeded=Nr;const Or=class{};h(Or,"TAG","webhighlights-marker"),h(Or,"TEST_IDS",Nt(Or.TAG,["POPUP_TOOLBOX"]));let kr=Or;e.Marker=kr;class Cr{}h(Cr,"TAG","webhighlights-popup-toolbox"),h(Cr,"TEST_IDS",{}),e.PopupToolbox=Cr;const Lr=class{};h(Lr,"TAG","webhighlights-sidebar"),h(Lr,"TEST_IDS",Nt(Lr.TAG,["MAIN_COMPONENT"]));let Dr=Lr;e.Sidebar=Dr;const Rr=class{};h(Rr,"TAG","webhighlights-page-content-preview"),h(Rr,"TEST_IDS",Nt(Rr.TAG,["OPEN_IN_READER_BUTTON","SKELETON","CONTENT_MISSING_TITLE"]));let Pr=Rr;e.PageContentPreview=Pr;const xr=class{};h(xr,"TAG","webhighlights-documents-list"),h(xr,"TEST_IDS",Nt(xr.TAG,["DOCUMENT_ITEM","DOCUMENT_DOWNLOAD_BUTTON","DOCUMENT_URL","STORAGE_USAGE_TEXT","GET_MORE_STORAGE_BTN","AUTO_DOWNLOAD_ALERT_ICON","DOCUMENT_DELETE_BUTTON"]));let Gr=xr;e.DocumentsList=Gr;const Br=class{};h(Br,"TAG","webhighlights-delete-entity-list"),h(Br,"TEST_IDS",Nt(Br.TAG,["ENTITY_URL","DELETE_ENTITY_BTN","DELETE_ALL_ENTITIES_BTN"]));let Ur=Br;e.DeleteEntityList=Ur;const Mr=class{};h(Mr,"TAG","webhighlights-dropdown"),h(Mr,"TEST_IDS",{...Nt(Mr.TAG,["TRIGGER","CONTENT"])});let jr=Mr;e.Dropdown=jr;const Fr=class{};h(Fr,"TAG","webhighlights-spread-the-word-prompt"),h(Fr,"TEST_IDS",Nt(Fr.TAG,["CTA","CANCEL_BTN","EMAIL_INPUT","URL_INPUT","LINKED_IN_SHARE_BTN","X_SHARE_BTN","FACEBOOK_SHARE_BTN","CLOSE_BTN","JOIN_GIVEAWAY_BTN","NO_THANKS_BTN","DONE_CONTAINER","POST_URL","WINNER_CHANCE_INFO","INPUT_ERROR"]));let $r=Fr;e.SpreadTheWordPrompt=$r;const Hr=class{};h(Hr,"TAG","webhighlights-skeleton"),h(Hr,"TEST_IDS",Nt(Hr.TAG,["CONTAINER"]));let Wr=Hr;e.Skeleton=Wr;const Vr=class{};h(Vr,"TAG","webhighlights-youtube-loading"),h(Vr,"TEST_IDS",Nt(Vr.TAG,["LOADING_TEXT"]));let qr=Vr;e.YoutubeLoading=qr})(St||(St={}));const kt=Nt("webhighlights-bookmark-preview-item",["FAVICON","IMAGE","TITLE","DESCRIPTION","URL"]);var Ct,Lt;(e=>{const t=class{};h(t,"TAG","webhighlights-ai-chat-message"),h(t,"TEST_IDS",Nt(t.TAG,[]));let r=t;e.AiChatMessageComponent=r;const i=class{};h(i,"TAG","webhighlights-ai-chat-empty-state"),h(i,"TEST_IDS",Nt(i.TAG,["UPGRADE_BTN","SUB_TEXT"]));let n=i;e.AiChatEmptyState=n;const o=class{};h(o,"TAG","webhighlights-bookmark-details-dots-menu"),h(o,"TEST_IDS",Nt(o.TAG,[]));let s=o;e.BookmarkDetailsDotsMenu=s;const a=class{};h(a,"TAG","webhighlights-add-content-btn"),h(a,"TEST_IDS",Nt(a.TAG,["ADD_CONTENT_BTN"]));let l=a;e.AddContentBtn=l;const c=class{};h(c,"TAG","webhighlights-bookmark-details-preview"),h(c,"TEST_IDS",{...Nt(c.TAG,["URL_LINK","IMAGE","TITLE_INPUT","DESCRIPTION_INPUT","TOGGLE_BOOKMARK_BTN","OPEN_APP_BTN","OPEN_PAGE_BTN","REMINDER","DOTS_MENU","SHARE_BTN"]),INTEGRATION_LINK:e=>`INTEGRATION_LINK-${e}`});let u=c;e.BookmarkDetailsPreview=u;const d=class{};h(d,"TAG","webhighlights-bookmark-details-sub-toolbar"),h(d,"TEST_IDS",{...Nt(d.TAG,["TAGS","AI_SUMMARY","SHARE_BTN"]),INTEGRATION_LINK:e=>`INTEGRATION_LINK-${e}`});let g=d;e.BookmarkDetailsSubToolbar=g;const f=class{};h(f,"TAG","webhighlights-toast"),h(f,"TEST_IDS",Nt(f.TAG,["CONTAINER","VARIANT_ICON","CONTENT","CLOSE_BTN","CTA_BTN"]));let p=f;e.Toast=p;const m=class{};h(m,"TAG","webhighlights-backup-export-btn"),h(m,"TEST_IDS",{...Nt(m.TAG,["DOWNLOAD_ANCHOR_ELEMENT","EXPORT_BTN"])});let y=m;e.BackupExportBtn=y;const b=class{};h(b,"TAG","webhighlights-backup-import"),h(b,"TEST_IDS",{...Nt(b.TAG,["IMPORT_BTN","UPLOADED_BACKUP_FILE_INFO","CHOOSE_FILE_BTN","FILE_INPUT","IMPORT_BTN"])});let T=b;e.BackupImport=T;const _=class{};h(_,"TAG","webhighlights-bookmark-details-grid"),h(_,"TEST_IDS",Nt(_.TAG,["EMPTY_STATE"]));let A=_;e.BookmarkDetailsGrid=A;const v=class{};h(v,"TAG","webhighlights-bookmark-details-main"),h(v,"TEST_IDS",Nt(v.TAG,["NOTEBOOK_TAB","READER_TAB","AI_CHAT_TAB"]));let w=v;e.BookmarkDetailsMain=w;const E=class{};h(E,"TAG","webhighlights-bookmark-preview-grid"),h(E,"TEST_IDS",{...kt,...Nt(E.TAG,[])});let S=E;e.BookmarkPreviewGrid=S;const I=class{};h(I,"TAG","webhighlights-bookmark-preview-list"),h(I,"TEST_IDS",{...kt,...Nt(I.TAG,[])});let N=I;e.BookmarkPreviewList=N;const O=class{};h(O,"TAG","webhighlights-bookmark-preview-tags"),h(O,"TEST_IDS",{...Nt(O.TAG,[""])});let k=O;e.BookmarkPreviewTags=k;const C=class{};h(C,"TAG","webhighlights-capacities-api-integration"),h(C,"TEST_IDS",{...Nt(C.TAG,["TOKEN_INPUT"])});let L=C;e.CapacitiesApiIntegration=L;const D=class{};h(D,"TAG","webhighlights-change-password-form"),h(D,"TEST_IDS",{...Nt(D.TAG,["OLD_PASSWORD","NEW_PASSWORD","SUBMIT_BTN","ERROR_MSG","SUCCESSS_MSG"])});let R=D;e.ChangePasswordForm=R;const P=class{};h(P,"TAG","webhighlights-color-tile"),h(P,"TEST_IDS",Nt(P.TAG,[""]));let x=P;e.ColorTile=x;const G=class{};h(G,"TAG","webhighlights-forgot-password"),h(G,"TEST_IDS",Nt(G.TAG,[""]));let B=G;e.ForgotPassword=B;const U=class{};h(U,"TAG","webhighlights-forgot-password-form"),h(U,"TEST_IDS",{...Nt(U.TAG,["EMAIL","GO_BACK_BTN","SUBMIT_BTN","ERROR_MSG","SUCCESSS_MSG"])});let M=U;e.ForgotPasswordForm=M;const j=class{};h(j,"TAG","webhighlights-google-sign-in"),h(j,"TEST_IDS",Nt(j.TAG,[""]));let F=j;e.GoogleSignIn=F;const $=class{};h($,"TAG","webhighlights-grid-filters"),h($,"TEST_IDS",Nt($.TAG,["FILTER_TAG"]));let H=$;e.GridFilters=H;const W=class{};h(W,"TAG","webhighlights-grid-toolbar-selector"),h(W,"TEST_IDS",Nt(W.TAG,[]));let V=W;e.GridToolbarSelector=V;const q=class{};h(q,"TAG","webhighlights-learning-categories"),h(q,"TEST_IDS",Nt(q.TAG,["CATEGORY_CARD"]));let z=q;e.LearningCategories=z;const K=class{};h(K,"TAG","webhighlights-learning-confidence"),h(K,"TEST_IDS",Nt(K.TAG,["CONFIDENCE"]));let Y=K;e.LearningConfidence=Y;const X=class{};h(X,"TAG","webhighlights-learning-confidence-bar"),h(X,"TEST_IDS",Nt(X.TAG,[]));let J=X;e.LearningConfidenceBar=J;const Z=class{};h(Z,"TAG","webhighlights-learning-marks-list"),h(Z,"TEST_IDS",Nt(Z.TAG,["MARK_LIST_ITEM","MARK_LIST_ITEM_HEADER_ROW","MARK_LIST_ITEM_TEXT","UN_DISCARD_BTN","DISCARD_BTN"]));let Q=Z;e.LearningMarksList=Q;const ee=class{};h(ee,"TAG","webhighlights-learning-pagination"),h(ee,"TEST_IDS",Nt(ee.TAG,["PAGINATION_INFO","PAGINATION_PREV_BTN","PAGINATION_NEXT_BTN"]));let te=ee;e.LearningPagination=te;const re=class{};h(re,"TAG","webhighlights-learning-schedule"),h(re,"TEST_IDS",Nt(re.TAG,["LEARNED_YESTERDAY_COUNT","LEARNED_TODAY_COUNT","DUE_TOMORROW_COUNT","TODAY_LEARN_BTN"]));let ie=re;e.LearningSchedule=ie;const ne=class{};h(ne,"TAG","webhighlights-learning-session"),h(ne,"TEST_IDS",Nt(ne.TAG,["CURRENT_CARD_INFO"]));let oe=ne;e.LearningSession=oe;const se=class{};h(se,"TAG","webhighlights-learning-session-card"),h(se,"TEST_IDS",Nt(se.TAG,["KNOW_IT_BTN","DONT_KNOW_IT_BTN","DISCARD_BTN"]));let ae=se;e.LearningSessionCard=ae;const le=class{};h(le,"TAG","webhighlights-learning-session-result"),h(le,"TEST_IDS",Nt(le.TAG,["CONTINUE_LEARNING_BTN","KNOWN_CARDS_COUNT","NOT_KNOWN_CARDS_COUNT","DISCARDED_CARDS_COUNT","STREAK_FIGURE","STREAK_TEXT","TOTAL_CARDS_COUNT","GO_TO_DASHBOARD_BTN"]));let ce=le;e.LearningSessionResult=ce;const he=class{};h(he,"TAG","webhighlights-learning-status"),h(he,"TEST_IDS",{...Nt(he.TAG,[]),ROW:e=>`${he.TAG}-ROW-${e.split(" ").join("-")}`,COUNT:e=>`${he.TAG}-COUNT-${e.split(" ").join("-")}`,COUNT_RELATIVE:e=>`${he.TAG}-PROGRESS-${e.split(" ").join("-")}`});let ue=he;e.LearningStatus=ue;const de=class{};h(de,"TAG","webhighlights-mark-preview-list"),h(de,"TEST_IDS",Nt(de.TAG,["URL"]));let ge=de;e.MarkPreviewList=ge;const fe=class{};h(fe,"TAG","webhighlights-notifications-list-item"),h(fe,"TEST_IDS",Nt(fe.TAG,["TITLE","CTA_LINK"]));let pe=fe;e.NotificationsListItem=pe;const me=class{};h(me,"TAG","webhighlights-notion-api-integration"),h(me,"TEST_IDS",{...Nt(me.TAG,["AUTHORIZE_LINK"])});let ye=me;e.NotionApiIntegration=ye;const be=class{};h(be,"TAG","webhighlights-price"),h(be,"TEST_IDS",Nt(be.TAG,["PRICE","INTERVAL_INFO","HINT"]));let Te=be;e.Price=Te;const _e=class{};h(_e,"TAG","webhighlights-pricing-plan-container"),h(_e,"TEST_IDS",{...Nt(_e.TAG,["HEADLINE","FEATURE_LIST"]),CHECKOUT_BTN:e=>`${_e.TAG}-${e}_BTN`,CONTAINER:e=>`${_e.TAG}-${e}`});let Ae=_e;e.PricingPlanContainer=Ae;const ve=class{};h(ve,"TAG","webhighlights-search-entity"),h(ve,"TEST_IDS",{...Nt(ve.TAG,["CONTAINER","SEARCH_TYPE_INDICATOR","SEARCH_ENTITY_CONTENT","SEARCH_ENTITY_DETAILS","SEARCH_ENTITY_DATE","SEARCH_ENTITY_URL"]),SEARCH_TYPE_INDICATOR:e=>`SEARCH_TYPE_INDICATOR_${ve.TAG}-${e}`});let we=ve;e.SearchEntity=we;const Ee=class{};h(Ee,"TAG","webhighlights-share-link"),h(Ee,"TEST_IDS",{...Nt(Ee.TAG,["INPUT","COPY_BTN"])});let Se=Ee;e.ShareLink=Se;const Ie=class{};h(Ie,"TAG","webhighlights-sign-in-form"),h(Ie,"TEST_IDS",{...Nt(Ie.TAG,["EMAIL","PASSWORD","PASSWORD_2","SIGN_IN_BTN","GOOGLE_SIGN_IN","ERROR_MSG","RESEND_EMAIL_BTN","FORGOT_PASSWORD_BTN"])});let Ne=Ie;e.SignInForm=Ne;const Oe=class{};h(Oe,"TAG","webhighlights-sign-up"),h(Oe,"TEST_IDS",{...Nt(Oe.TAG,["EMAIL","PASSWORD_1","PASSWORD_2","PRIVACY_CHECKBOX","SIGN_UP_BTN","GOOGLE_SIGN_UP","ERROR_MSG"])});let ke=Oe;e.SignUp=ke;const Ce=class{};h(Ce,"TAG","webhighlights-sign-up-form"),h(Ce,"TEST_IDS",{...Nt(Ce.TAG,["EMAIL","PASSWORD","PASSWORD_1","PASSWORD_2","PRIVACY_CHECKBOX","SIGN_UP_BTN","GOOGLE_SIGN_UP","ERROR_MSG"])});let Le=Ce;e.SignUpForm=Le;const De=class{};h(De,"TAG","webhighlights-social-auth"),h(De,"TEST_IDS",{...Nt(De.TAG,["GOOGLE_AUTH_BTN"])});let Re=De;e.SocialAuth=Re;const Pe=class{};h(Pe,"TAG","webhighlights-settings-account"),h(Pe,"TEST_IDS",{...Nt(Pe.TAG,["CHANGE_PASSWORD_BTN","EMAIL_ADDRESS","DELETE_ACCOUNT_BTN","LOGOUT_BTN","LINKED_ACCOUNT_LABEL"])});let xe=Pe;e.SettingsAccount=xe;const Ge=class{};h(Ge,"TAG","webhighlights-settings-backup"),h(Ge,"TEST_IDS",{...Nt(Ge.TAG,[""])});let Be=Ge;e.SettingsBackup=Be;const Ue=class{};h(Ue,"TAG","webhighlights-settings-billing"),h(Ue,"TEST_IDS",{...Nt(Ue.TAG,["CURRENT_PLAN_INFO","CHANGE_PAYMENT_METHOD_LINK","USERPLAN_INFO","EXPIRY_INFO","CANCEL_NOW_BTN"])});let Me=Ue;e.SettingsBilling=Me;const je=class{};h(je,"TAG","webhighlights-settings-integrations"),h(je,"TEST_IDS",{...Nt(je.TAG,[]),INTEGRATION_ITEM:e=>`${je.TAG}INTEGRATION_ITEM-${e}`});let Fe=je;e.SettingsIntegrations=Fe;const $e=class{};h($e,"TAG","webhighlights-settings-integration-item"),h($e,"TEST_IDS",{...Nt($e.TAG,[])});let He=$e;e.SettingsIntegrationItem=He;const We=class{};h(We,"TAG","webhighlights-settings-integration-preview"),h(We,"TEST_IDS",{...Nt(We.TAG,[])});let Ve=We;e.SettingsIntegrationPreview=Ve;const qe=class{};h(qe,"TAG","webhighlights-settings-notifications"),h(qe,"TEST_IDS",{...Nt(qe.TAG,["BACKUP_INTERVAL_INPUT"])});let ze=qe;e.SettingsNotifications=ze;const Ke=class{};h(Ke,"TAG","webhighlights-settings-documents"),h(Ke,"TEST_IDS",{...Nt(Ke.TAG,[""])});let Ye=Ke;e.SettingsDocuments=Ye;const Xe=class{};h(Xe,"TAG","webhighlights-settings-settings"),h(Xe,"TEST_IDS",{...Nt(Xe.TAG,[""])});let Je=Xe;e.SettingsSettings=Je;const Ze=class{};h(Ze,"TAG","webhighlights-sign-in"),h(Ze,"TEST_IDS",{...Nt(Ze.TAG,["EMAIL","PASSWORD","PASSWORD_2","SIGN_IN_BTN","GOOGLE_SIGN_IN","ERROR_MSG","RESEND_EMAIL_BTN"])});let Qe=Ze;e.SignIn=Qe;const et=class{};h(et,"TAG","webhighlights-tag-suggestions"),h(et,"TEST_IDS",{...Nt(et.TAG,["SUGGESTION_TAG","PREVIEW_TAG"])});let tt=et;e.TagSuggestions=tt;const rt=class{};h(rt,"TAG","webhighlights-file-import"),h(rt,"TEST_IDS",{...Nt(rt.TAG,["FILE_INPUT","UPLOADED_FILE_INFO","CHOOSE_FILE_BTN","IMPORT_BTN"])});let it=rt;e.FileImport=it;const nt=class{};h(nt,"TAG","webhighlights-highlighter"),h(nt,"TEST_IDS",Nt(nt.TAG,["HIGHLIGHT_BTN","HIGHLIGHT_ICON","HIDE_POPUP_BTN","HIDE_POPUP_ALWAYS","HIDE_POPUP_UNTIL_NEXT_VISIT","HIDE_POPUP_ON_CURRENT_WEBSITE"]));let ot=nt;e.Highlighter=ot;const st=class{};h(st,"TAG","webhighlights-reader-content"),h(st,"TEST_IDS",Nt(st.TAG,[])),h(st,"EVENTS",{READY:`${st.TAG}-ready`});let at=st;e.ReaderContent=at;const lt=class{};h(lt,"TAG","webhighlights-youtube-player"),h(lt,"TEST_IDS",Nt(lt.TAG,[]));let ct=lt;e.YoutubePlayer=ct;const ht=class{};h(ht,"TAG","webhighlights-youtube-transcript"),h(ht,"TEST_IDS",Nt(ht.TAG,[]));let ut=ht;e.YoutubeTranscript=ut;const dt=class{};h(dt,"TAG","webhighlights-reader-controls"),h(dt,"TEST_IDS",{...Nt(dt.TAG,["TOGGLE_SIDEBAR_BTN","FONT_SIZE_BTN_PLUS","FONT_SIZE_BTN_MINUS","CHANGE_COLOR_MODE_BTN","LINE_HEIGHT_BTN_PLUS","LINE_HEIGHT_BTN_MINUS","LAYOUT_WIDTH_BTN_PLUS","LAYOUT_WIDTH_BTN_MINUS","TEXT_LAYOUT_BTN","COLOR_MODE_DROPDOWN","ADD_CONTENT_BTN","PLAY_PAUSE_BTN"]),COLOR_MODE_BTN:e=>`COLOR_MODE_BTN_${dt.TAG}-${e}`});let gt=dt;e.ReaderControls=gt;const ft=class{};h(ft,"TAG","webhighlights-reader-control-dropdown"),h(ft,"TEST_IDS",Nt(ft.TAG,[]));let pt=ft;e.ReaderControlDropdown=pt;const mt=class{};h(mt,"TAG","webhighlights-popup-toolbox-menu"),h(mt,"TEST_IDS",Nt(mt.TAG,["MENU_CONTAINER","MARK_ELEMENT_TOOLBAR"]));let yt=mt;e.PopupToolboxMenu=yt;const bt=class{};h(bt,"TAG","webhighlights-action-toolbar"),h(bt,"TEST_IDS",Nt(bt.TAG,["DELETE_BTN"]));let Tt=bt;e.ActionToolbar=Tt;const _t=class{};h(_t,"TAG","webhighlights-column-resizer"),h(_t,"TEST_IDS",Nt(_t.TAG,[]));let At=_t;e.ColumnResizerComponent=At;const vt=class{};h(vt,"TAG","webhighlights-domains-view"),h(vt,"TEST_IDS",{...Nt(vt.TAG,["SEARCH_INPUT"])});let wt=vt;e.DomainsView=wt;const Et=class{};h(Et,"TAG","webhighlights-filtered-overview"),h(Et,"TEST_IDS",{...Nt(Et.TAG,["TAGS_CONTAINER","BOOKMARKS_CONTAINER","MARKS_CONTAINER","RELATED_TAGS"])});let St=Et;e.FilteredOverview=St;const It=class{};h(It,"TAG","webhighlights-header-toggle"),h(It,"TEST_IDS",{...Nt(It.TAG,["CONTAINER","ACCORDIAN_VIEW_BTN","TAGS_VIEW_BTN","DOMAINS_VIEW_BTN","MARK_VIEW_BTN","SEARCH_BTN"])});let Ot=It;e.HeaderToggle=Ot;const Ct=class{};h(Ct,"TAG","webhighlights-header-toolbox"),h(Ct,"TEST_IDS",{...Nt(Ct.TAG,["CONTAINER","NOTIFICATIONS_BTN","NOTIFICATIONS_BADGE"])});let Lt=Ct;e.HeaderToolbox=Lt;const Dt=class{};h(Dt,"TAG","webhighlights-history-view"),h(Dt,"TEST_IDS",{...Nt(Dt.TAG,["SEARCH_INPUT"])});let Rt=Dt;e.HistoryOverviewView=Rt;const Pt=class{};h(Pt,"TAG","webhighlights-main-component"),h(Pt,"TEST_IDS",Nt(Pt.TAG,["IS_BLACKLISTED_INFO","SIGN_UP_EMPTY_INFO","BOOKMARK_DETAILS","BOOKMARK_DETAILS_POPOVER","POPOVER","EMPTY_STATE_CONTAINER","TOGGLE_SIDEBAR_BTN","BADGE_INDICATOR","RECENTLY_UPDATED_CONTAINER"]));let xt=Pt;e.MainComponentPage=xt;const Gt=class{};h(Gt,"TAG","webhighlights-mark-badge"),h(Gt,"TEST_IDS",Nt(Gt.TAG,[]));let Bt=Gt;e.MarkBadge=Bt;const Ut=class{};h(Ut,"TAG","webhighlights-overview-empty-state"),h(Ut,"TEST_IDS",Nt(Ut.TAG,[]));let Mt=Ut;e.MarkOverviewEmptyState=Mt;const jt=class{};h(jt,"TAG","webhighlights-shortcut-overview"),h(jt,"TEST_IDS",Nt(jt.TAG,[]));let Ft=jt;e.ShortcutOverview=Ft;const $t=class{};h($t,"TAG","webhighlights-sidebar-footer"),h($t,"TEST_IDS",Nt($t.TAG,["SETTINGS_ICON","LEARN_BTN","SHORTCUT_BTN","LEARN_BTN_BADGE","DASHBOARD_LINK","BLACKLIST_TOGGLE_BTN","UPGRADE_BTN","GIFT_BTN"]));let Ht=$t;e.SidebarFooter=Ht;const Wt=class{};h(Wt,"TAG","webhighlights-sidebar-options"),h(Wt,"TEST_IDS",Nt(Wt.TAG,[]));let Vt=Wt;e.SidebarOptions=Vt;const qt=class{};h(qt,"TAG","webhighlights-tags-view"),h(qt,"TEST_IDS",{...Nt(qt.TAG,["SEARCH_INPUT"])});let zt=qt;e.TagsView=zt;const Kt=class{};h(Kt,"TAG","webhighlights-selected-tag-view"),h(Kt,"TEST_IDS",{...Nt(Kt.TAG,["SELECTED_TAG_INFO"])});let Yt=Kt;e.SelectedTagView=Yt;const Xt=class{};h(Xt,"TAG","webhighlights-selected-domain-view"),h(Xt,"TEST_IDS",{...Nt(Xt.TAG,["SELECTED_TAG_INFO"])});let Jt=Xt;e.SelectedDomainView=Jt;const Zt=class{};h(Zt,"TAG","webhighlights-show-popup-selector"),h(Zt,"TEST_IDS",{...Nt(Zt.TAG,["HIDE_POPUP_BTN"]),SHOW_POPUP_OPTION:e=>`highlighter-mode-option-input-${e}`,SHOW_POPUP_OPTION_CONTAINER:e=>`highlighter-mode-option-container-${e}`});let Qt=Zt;e.ShowPopupSelector=Qt})(Ct||(Ct={})),(e=>{const t=class{};h(t,"TAG","WebsiteLikeBtn"),h(t,"TEST_IDS",{...Nt(t.TAG,["BTN"])});let r=t;e.WebsiteLikeBtn=r;const i=class{};h(i,"TAG","webhighlights-legal-footer"),h(i,"TEST_IDS",Nt(i.TAG,["FAQ_LINK","BLOG_LINK","TOS_LINK","PRIVACY_LINK","IMPRINT_LINK","COOKIE_LINK","TOOLS_LINK"]));let n=i;e.WebsiteFooter=n;const o=class{};h(o,"TAG","WebsiteNavbar"),h(o,"TEST_IDS",{...Nt(o.TAG,["BTN"]),NAV_ITEM_LINK:e=>`NAV_ITEM_LINK-${e}`});let s=o;e.WebsiteNavbar=s;const a=class{};h(a,"TAG","WebsiteDiscoverFeed"),h(a,"TEST_IDS",{...Nt(a.TAG,["BTN"]),FEED_TYPE_LINK:e=>`FEED_TYPE_LINK-${e}`});let l=a;e.WebsiteDiscoverFeed=l;const c=class{};h(c,"TAG","WebsitePageNotFound"),h(c,"TEST_IDS",{...Nt(c.TAG,["CONTAINER","TITLE","DESCRIPTION","LINK"])});let u=c;e.WebsitePageNotFound=u;const d=class{};h(d,"TAG","WebsiteLegalDisclaimer"),h(d,"TEST_IDS",{...Nt(d.TAG,["DISCLAIMER"])});let g=d;e.WebsiteLegalDisclaimer=g;const f=class{};h(f,"TAG","AddToBrowserCta"),h(f,"TEST_IDS",{...Nt(f.TAG,[]),LABEL:e=>`LABEL-${e}`,LINK:e=>`LINK-${e}`});let p=f;e.AddToBrowserCta=p;const m=class{};h(m,"TAG","WebsiteFinderTool"),h(m,"TEST_IDS",{...Nt(m.TAG,["EXAMPLE_WEBSITES","CTA_LINK"])});let y=m;e.WebsiteFinderTool=y;const b=class{};h(b,"TAG","ReaderView"),h(b,"TEST_IDS",{...Nt(b.TAG,[]),INSTALL_CTA_DIALOG:e=>`INSTALL_CTA_DIALOG-${e}`});let T=b;e.ReaderView=T})(Lt||(Lt={}));var Dt,Rt=(e=>(e.trash="trash",e["copy-file"]="copy-file",e.blockquote="blockquote",e["file-pdf"]="file-pdf",e["file-html"]="file-html",e.settings="settings",e.rocket="rocket",e.search="search",e.bulb="bulb",e.star="star",e["delete-x"]="delete-x",e.twitter="twitter",e.box="box",e["mark-icon"]="mark-icon",e.linkedin="linkedin",e.facebook="facebook",e.clock="clock",e.calendar="calendar",e["external-link"]="external-link",e["cloud-off"]="cloud-off",e.cloud="cloud",e["cloud-check"]="cloud-check",e["plus-circle"]="plus-circle",e["minus-circle"]="minus-circle",e.info="info",e["x-circle"]="x-circle",e["check-circle"]="check-circle",e["thumbs-up"]="thumbs-up",e["thumbs-down"]="thumbs-down",e.brain="brain",e["arrow-right"]="arrow-right",e.eye="eye",e["eye-off"]="eye-off",e["feather-edit-3"]="feather-edit-3",e.tag="tag",e.home="home",e.bookmark="bookmark",e["align-left"]="align-left",e["align-right"]="align-right",e["push-right"]="push-right",e["sidebar-overlay"]="sidebar-overlay",e["sidebar-expand"]="sidebar-expand",e.sun="sun",e.moon="moon",e.power="power",e.image="image",e["book-open"]="book-open",e.bell="bell",e["minimize-2"]="minimize-2",e["maximize-2"]="maximize-2",e["lock-icon"]="lock-icon",e.link="link",e["unlock-icon"]="unlock-icon",e.menu="menu",e.list="list",e.logout="logout",e["chevron-right"]="chevron-right",e["chevron-left"]="chevron-left",e.history="history",e.globe="globe",e.grid="grid",e["arrows-down-up"]="arrows-down-up",e.filter="filter",e["filter-2"]="filter-2",e.groups="groups",e["size-small"]="size-small",e["size-medium"]="size-medium",e["size-large"]="size-large",e["alert-circle"]="alert-circle",e.save="save",e.user="user",e["arrow-up-circle"]="arrow-up-circle",e.compass="compass",e.zap="zap",e.smartphone="smartphone",e.capacities="capacities",e.notion="notion",e.obsidian="obsidian",e.book="book",e.colorPalette="colorPalette",e.type="type",e.crown="crown",e.command="command",e.circle="circle",e.dragDots="dragDots",e.weava="weava",e.pocket="pocket",e.mail="mail",e.repeat="repeat",e.inbox="inbox",e.flame="flame",e.medal="medal",e["check-badge"]="check-badge",e.check="check",e.dot="dot",e["curved-arrow-left"]="curved-arrow-left",e["buyer-pay-icon"]="buyer-pay-icon",e["save-plant"]="save-plant",e.reader="reader",e.download="download",e.font="font",e["auto-color-mode"]="auto-color-mode",e["paint-brush"]="paint-brush",e.width="width",e.height="height",e.plus="plus",e.pause="pause",e["reader-extension-icon"]="reader-extension-icon",e.gift="gift",e.notebook="notebook",e.share="share",e["ai-stars"]="ai-stars",e["chevron-down"]="chevron-down",e.collapse="collapse",e.expand="expand",e.clipboard="clipboard",e.target="target",e.pin="pin",e.play="play",e.youtube="youtube",e.diigo="diigo",e["stop-circle"]="stop-circle",e["rotate-ccw"]="rotate-ccw",e))(Rt||{});(Dt||(Dt={})).WEB_HIGHLIGHT="web-highlight";var Pt=(e=>(e.BLOCKQUOTE="blockquote",e.PARAGRAPH="paragraph",e.HEADING_1="heading1",e.HEADING_2="heading2",e.HEADING_3="heading3",e.BULLET_LIST_ITEM="bulletListItem",e.IMAGE="image",e.CODE="code",e))(Pt||{});function xt(){var e;return"chrome"in window&&typeof chrome<"u"&&!(null==(e=null==chrome?void 0:chrome.runtime)||!e.id)}function Gt(){var e;return!(typeof globalThis>"u")&&"navigator"in globalThis&&Bt(null==(e=globalThis.navigator)?void 0:e.userAgent)}Object.values(Pt);const Bt=e=>null==e?void 0:e.toLowerCase().includes("firefox");function Ut(){return xt()||function(){var e,t;try{return typeof chrome<"u"&&((null==(e=null==chrome?void 0:chrome.runtime)?void 0:e.id)===p.extensionId||(null==(t=null==chrome?void 0:chrome.runtime)?void 0:t.id)===b.extensionId)}catch(e){return console.error("Error in isFirefoxExtensionEnvironment",e),!1}}()}const Mt=["#fdffb4","#f8b6a8","#a7e8c8","#f7c2d6","#c3bbec","#c3effc"],jt={CONTEXT_MENU_SAVE_TEXT:"CONTEXT_MENU_SAVE_TEXT",CONTEXT_MENU_SAVE_BOOKMARK:"CONTEXT_MENU_SAVE_BOOKMARK",CONTEXT_MENU_SAVE_IMAGE:"CONTEXT_MENU_SAVE_IMAGE",CONTEXT_OPEN_IN_READER:"CONTEXT_OPEN_IN_READER"};function Ft(e,t){return e.id===t}var $t=(e=>(e.marks="marks",e.bookmarks="bookmarks",e.chromesettings="chromesettings",e.pagecontents="pagecontents",e.aichats="aichats",e))($t||{});const Ht={...function(e){return{_id:ct(),createdAt:Date.now(),updatedAt:0,_objectStore:e}}($t.chromesettings),showMarkerPopup:!0,showLeftSidebarWidget:!1,showToolboxAutomatically:!1,defaultHighlightColor:Mt[0],recentColors:[Mt[0]],blacklistedUrls:[],lastSync:Date.now(),showLearningTeaser:!1,chromeRatingPromptDismissed:!1,sidebarOptions:{sidebarWidth:400,sidebarAlignment:"left",sidebarBehavior:"push"},preferredColorMode:"dark",showBackupDialogPrompt:!0,backupDialogPromptInterval:100,autoDownloadPageContent:!0,youtubeOptions:{enableAutoscrolling:!0,enableStickyPlayer:!1}},Wt={jwt_webmarker:"",lastSyncDateInMillis:0,lastServerFetchInMillis:0,notionOAuthToken:null,capacitiesToken:null,signUpPromptDismissed:!1,chromeRatingPromptDismissed:!1,upgradeDealPromptDismissed:!1,lastUserPromptShownAtInMillis:0,lastUpdatedKey:null,isEmailActivated:!1,readerFontSize:20,readerColorMode:"auto",readerLayoutWidth:700,readerLineHeight:1.6,spreadTheWordPromptDismissed:!1,serverConfigJsonString:null};function Vt(){var e;return typeof chrome<"u"&&!(null==(e=null==chrome?void 0:chrome.storage)||!e.sync)}const qt=new class{async getStorage(){return new Promise(e=>{try{chrome.storage.sync.get(t=>{const r={...Wt,...t};e(r)})}catch{e(Wt)}})}async getValue(e){const t=Wt[e];return new Promise(r=>{try{chrome.storage.sync.get(i=>{r(i[e]??t)})}catch{r(t)}})}setValue(e,t){try{const r={[e]:t};chrome.storage.sync.set(r);const i={lastUpdatedKey:e};chrome.storage.sync.set(i),this.getStorage().then(r=>{yi.dispatch("chromeStorageChanged",{detail:{...r,[e]:t}})})}catch{}return Vt()}clear(){var e,t;try{if(typeof chrome>"u")return;null==(t=null==(e=null==chrome?void 0:chrome.storage)?void 0:e.sync)||t.clear()}catch{}}},zt=qt,Kt="url";Rt.circle,Rt.circle,Rt.circle,Rt["auto-color-mode"],Rt.circle;const Yt=["http://","https://","http://www.","https://www.","www."],Xt=["http://localhost:8080/reader.html","http://localhost:9070/reader.html","http://localhost:8080/viewer.html"],Jt=["http://localhost:8080","http://localhost:9090","http://localhost:9080","http://localhost:9070","http://localhost:9040"],Zt=["web-highlights.com","pre.web-highlights.com","localhost:2000"],Qt=["app.web-highlights.com","pre-app.web-highlights.com","localhost:5173"],er=Yt.map(e=>Zt.map(t=>`${e}${t}/discover`)).flat(1),tr=["guid","bookguid","openid.claimed_id","ref_","page","jk","vjk","file","uri","pageId","pageid","url","term"],rr=["#/epubreader?bookguid=","#/notes/","#/lessons/"],ir=["/watch","/search"],nr=Yt.map(e=>Qt.map(t=>`${e}${t}`)).flat(1),or=(Yt.map(e=>Zt.map(t=>`${e}${t}`)).flat(1),["localhost:8080/defaultblacklisted","localhost:8080/defaultblacklistedWildcard/*","newtab/*","extensions/*","drive.google.com/*","docs.google.com/*","medium.com/new-story/*","medium.com/p/[^/]+/edit","photos.google.com/*","accounts.google.com/*","calendar.google.com/*","chrome.google.com/webstore/*","webhighlights.firebaseapp.com/*","paypal.com/*","slack.com/*","office.com/*","onedrive.live.com/*","yahoo.com/*","firebase.google.com/*","feedly.com/*","typeform.com/*","pornhub.com/*","redtube.com/*","youporn.com/*","com/*","com/*","com/*","tube8.com/*","xvideos.com/*","xnxx.com/*"]);function sr(e){let t=e;return ar(t)?vr(t):cr(t)?t:(t=null==t?void 0:t.split("#")[0].split("?")[0],t.endsWith("/")&&(t=t.slice(0,-1)),`(${t})(\\/?)(?:\\s|#|\\?[\\w]{1,}|\\/(\\s)|\\/(#)|($))`)}function ar(e){try{const t=new URL(e);return ur(t.href)||tr.some(e=>t.searchParams.has(e))}catch{return!1}}function lr(e){try{const t=new URL(e);return rr.some(e=>t.hash.includes(e))}catch{return!1}}function cr(e){try{const t=new URL(e);return ir.some(e=>t.href.toLowerCase().includes(e.toLowerCase()))}catch{return ir.some(t=>e.toLowerCase().includes(t.toLowerCase()))}}function hr(e){return decodeURIComponent(e).split("?file=")[1]??""}function ur(e){return!(!gr(e)&&!function(e){return null==e?void 0:e.startsWith("moz-extension://")}(e))&&dr(e)}function dr(e){const t=e.includes("viewer.html?file="),r=!!hr(e);return t&&r}function gr(e){return(null==e?void 0:e.startsWith("chrome-extension://"))||e.startsWith("http://localhost:8080/viewer.html")}function fr(e){gr(e)&&(e=e.split("?file=")[1]??"");try{const t=new URL(e);return((null==t?void 0:t.pathname)||"").endsWith(".pdf")||function(){var e;if(typeof window>"u"||typeof document>"u")return!1;const t=null==(e=null==document?void 0:document.body)?void 0:e.firstChild;return"EMBED"===(null==t?void 0:t.tagName)&&"application/pdf"===(null==t?void 0:t.getAttribute("type"))}()}catch{return!1}}const pr=()=>{var e,t;return typeof chrome>"u"?k.EXTENSION_ID:Gt()?(null==(e=null==chrome?void 0:chrome.i18n)?void 0:e.getMessage("@@extension_id"))??k.EXTENSION_ID:(null==(t=null==chrome?void 0:chrome.runtime)?void 0:t.id)??k.EXTENSION_ID};function mr(e){return`${Gt()?"moz-extension":"chrome-extension"}://${pr()}/${e}`}function yr(e){return e=function(e){const t=(null==e?void 0:e.replace(/https:\/\/|http:\/\/|www.|/gi,""))??"";return t.endsWith("/")?t.slice(0,-1):t}(e),(e=null==e?void 0:e.split("/")[0])??""}function br(e){return Jt.some(t=>e.startsWith(t))&&!xt()}const Tr=e=>nr.some(t=>e.startsWith(t))||(e=>er.some(t=>e.startsWith(t)))(e),_r=()=>!(typeof window>"u"||typeof document>"u"||!document.querySelector(St.Reader.TAG));function Ar(e,t){return null==e?void 0:e.replaceAll(" ","+").replaceAll("%20",t)}function vr(e){try{const t=new URL(e),r=new URLSearchParams(t.search);return Array.from(r.keys()).filter(e=>!tr.includes(e)).forEach(e=>r.delete(e)),t.search=r.toString(),t.toString().toLowerCase()}catch{return e.toLowerCase()}}function wr(e,t){try{if(!e||!t||"string"!=typeof e||"string"!=typeof t)return!1;const r=e=>e.toLowerCase();if(e=r(e),t=r(t),dr(e)){const r=hr(e);if(null!=r&&r.startsWith("file:")){const e=decodeURIComponent(r).split("/"),i=Ar(e[e.length-1],"+");return Ar(decodeURIComponent(t),"+").endsWith(i)}const i=sr(decodeURIComponent(r)),n=new RegExp(i),o=decodeURIComponent(hr(t));return n.test(o)}if(cr(e)||cr(t))return e===t;if(ar(e)||ar(t))return vr(e)===vr(t);if(lr(e)||lr(t))return e===t;const i=sr(decodeURIComponent(e));return new RegExp(i).test(decodeURIComponent(t))}catch(e){return console.error(e),!1}}nr.map(e=>`${e}/reader`);const Er=e=>((e=>(e||location.href).startsWith("chrome-extension://")||(e||location.href).startsWith("moz-extension://")||(e||location.href).startsWith("extension://"))(e)||function(e){return Xt.some(t=>e.startsWith(t))&&!xt()}(e))&&e.includes("reader.html");Object.values({HIGHLIGHT_WEBSITE:"highlight-website",OPEN_WEBSITE_IN_READER_MODE:"open-website-in-reader-mode",HIGHLIGHT_NOTES:"highlight-in-notes",HIGHLIGHT_YOUTUBE_VIDEO:"highlight-youtube-video",YOUTUBE_AI_SUMMARY:"youtube-ai-summary",WEBSITE_AI_SUMMARY:"website-ai-summary",YOUTUBE_TRANSCRIPT_GENERATOR:"youtube-transcript-generator",YOUTUBE_TRANSCRIPT_READER:"youtube-transcript-reader"});function Sr(e){if(!e)return-1;if(0===e.repetitions)return 3;if(e.disableLearning)return 0;const t=(e.easinessFactor-1.3)/(3.2-1.3),r=(0===t?0:.1)*(6-Math.min(e.repetitions,6)),i=Math.abs(r-t),n=r>t&&e.repetitions>1?t-r/e.repetitions:i<.08?t/2.5:t-r,o=Math.max(n,0),s=Math.round(100*o);return Math.min(s,100)}function Ir(e){return e>=80?"Long-Term Memory":e>=60&&e<80?"Confident Recall":e>=40&&e<60?"Moderate Recall":e>=20&&e<40?"Short-Term Memory":e>=0&&e<20?"New Knowledge":"Not Yet Learned"}const Nr={"Long-Term Memory":{id:"Long-Term Memory",isActive:e=>!(null!=e&&e.disableLearning)&&"Long-Term Memory"===Ir(Sr(e)),label:"Long-Term Memory",color:"#46B446"},"Confident Recall":{id:"Confident Recall",isActive:e=>!(null!=e&&e.disableLearning)&&"Confident Recall"===Ir(Sr(e)),label:"Confident Recall",color:"#A9B935"},"Moderate Recall":{id:"Moderate Recall",isActive:e=>!(null!=e&&e.disableLearning)&&"Moderate Recall"===Ir(Sr(e)),label:"Good Recall",color:"#E9C63A"},"Short-Term Memory":{id:"Short-Term Memory",isActive:e=>!(null!=e&&e.disableLearning)&&"Short-Term Memory"===Ir(Sr(e)),label:"Moderate Recall",color:"#E79E3D"},"New Knowledge":{id:"New Knowledge",isActive:e=>!(null!=e&&e.disableLearning)&&"New Knowledge"===Ir(Sr(e)),label:"Likely to forget",color:"#DB4646"},"Not Yet Learned":{id:"Not Yet Learned",isActive:e=>!(null!=e&&e.disableLearning)&&"Not Yet Learned"===Ir(Sr(e)),label:"Not Yet Learned",color:"#ccc"},Discarded:{id:"Discarded",isActive:e=>!(null==e||!e.disableLearning),label:"Discarded",color:"#555555"}};function Or(e){var t,r,i,n;const o=new Date(Date.now()),s=new Date((null==(t=e.learningItem)?void 0:t.nextReviewInMillis)??0),a=new Date((null==(r=e.learningItem)?void 0:r.lastLearned)??0);return!(null!=(i=null==e?void 0:e.learningItem)&&i.disableLearning)&&!(null==(n=null==e?void 0:e.learningItem)||!n.nextReviewInMillis)&&s.getTime()<o.getTime()&&a.toDateString()!==o.toDateString()}Object.values(Nr);const kr=(e,t)=>({name:e,count:(null==t?void 0:t.filter(t=>t.toLowerCase()===e.toLowerCase()).length)??0}),Cr=(e,t)=>{const r=[...e.map(e=>e.tags??[]).flat(1),...t.map(e=>e.tags??[]).flat(1)];return[...new Set(r)].map(e=>kr(e,r)).sort(yt)};["andrebedendo@gmail.com","xyzgcd123@gmail.com"].map(e=>e.toLowerCase());var Lr=(e=>(e.OFFLINE="OFFLINE",e.FREE="FREE",e.FREE_TRIAL="FREE_TRIAL",e.PREMIUM="PREMIUM",e.ULTIMATE="ULTIMATE",e))(Lr||{}),Dr=(e=>(e.ONE_MONTH="1M",e.ONE_YEAR="1Y",e.LIFETIME="Lifetime",e))(Dr||{});async function Rr(e){const{db:t,chromeSyncService:r}=ui(),i=await t.updateChromeSettings(e);typeof e.preferredColorMode<"u"&&G(e.preferredColorMode),yi.dispatch("updatedChromeSettings",{detail:i}),r.executeSync()}function Pr(e){(function(){let e=document.querySelector(St.Toasts.TAG);e||(e=document.createElement(St.Toasts.TAG),document.body.append(e))})(),setTimeout(()=>{yi.dispatch("showToast",{detail:e})},0)}function xr(e){Ot([St.Dialog.TAG],{lazy:!1});const t=St.Dialog.TAG;let r=document.querySelector(St.Dialog.TAG);e.keepCurrentDialog&&(r=null);const i=!!r;return r||(r=document.createElement(t)),r.props=e,r.props.onDialogClosed=t=>{null==r||r.remove(),e.dialogClosedCallback&&e.dialogClosedCallback(t)},i||document.body.append(r),r}function Gr(e){e.length&&xr({dialogName:"delete-entity-list",options:{closable:!0,props:{entities:e,alertOptions:{icon:Rt.info,title:"Some of your content is too large to sync",variant:"warning",text:"Some of your highlights or pages are too large to sync. That means they are not synced to your account \n          and will not be available on other devices and in the web app. \n          You can keep them to use them locally or delete them here."}}}})}Rt["feather-edit-3"],Rt.link,Rt["file-pdf"],Rt.notion,Rt.smartphone,Rt["copy-file"],Rt.capacities,Rt.weava,Rt.diigo,Rt.pocket,Rt.pocket,Rt.bookmark;function Br(e){var t,r,i,n,o,s;if(!e)return Lr.OFFLINE;const a=(new Date).getTime(),l=((null==(t=e.userPlan)?void 0:t.expiresDateMillis)??0)>a,c=typeof e.premium>"u"&&typeof(null==(r=e.userPlan)?void 0:r.subscription_id)>"u",h=null==(i=e.userPlan)?void 0:i.type;if(e.premium||c)return l&&h===Lr.ULTIMATE?Lr.ULTIMATE:Lr.PREMIUM;if(l&&e.userPlan&&h){const t=h===Lr.PREMIUM&&e.userPlan.expiresDateMillis<17110656e5&&!(null!=(n=e.userPlan)&&n.subscription_id),r=h===Lr.PREMIUM&&72580284e5===e.userPlan.expiresDateMillis&&!(null!=(o=e.userPlan)&&o.subscription_id);return t||r?Lr.ULTIMATE:h}return(null==(s=e.userPlan)?void 0:s.type)===Lr.FREE_TRIAL&&e.userPlan.expiresDateMillis>a?Lr.FREE_TRIAL:Lr.FREE}function Ur(e,t){return jr(e,{activeUserPlan:Br(t??null),user:t})}const Mr=1679745752934;function jr(e,{activeUserPlan:t,user:r}){return!(!function(e,t){return"sync"===e&&1675008111780===(null==t?void 0:t.createdAt)}(e,r)&&"backup"!==e&&t!==Lr.FREE_TRIAL&&t!==Lr.ULTIMATE&&("sync"===e?!function(e){var t,r,i;return(null==(t=null==e?void 0:e.userPlan)?void 0:t.type)!==Lr.PREMIUM&&(null==(r=null==e?void 0:e.userPlan)?void 0:r.type)!==Lr.ULTIMATE&&((null==(i=null==e?void 0:e.userPlan)?void 0:i.type)&&e.userPlan.expiresDateMillis<Mr||(null==e?void 0:e.createdAt)&&e.createdAt<Mr)}(r)&&t!==Lr.PREMIUM:"share"!==e||t!==Lr.PREMIUM))}const Fr=new class extends O{constructor(){super(I)}get chromeStorageIsAvailable(){return Vt()}async getJwt(){return this.chromeStorageIsAvailable?zt.getValue(I):super.getJwt()}async getJwtPayload(){try{return N(await this.getJwt())??void 0}catch{return}}async getActivePlan(){return Br(await this.getJwtPayload()??null)}async canSync(){const e=await this.getJwtPayload();return!!e&&Ur("sync",e)}async canGenerateUnlimitedAiSummary(){const e=await this.getJwtPayload();return!!e&&Ur("unlimited-ai-summary",e)}async canGenerateUnlimitedYoutubeVideo(){const e=await this.getJwtPayload();return!!e&&Ur("unlimited-youtube-video",e)}async canGenerateUnlimitedAiChats(){const e=await this.getJwtPayload();return!!e&&Ur("unlimited-ai-chats",e)}async isLoggedIn(){return!!await this.getJwtPayload()}setJwt(e){this.chromeStorageIsAvailable?zt.setValue("jwt_webmarker",e):super.setJwt(e)}},$r=e=>!!e&&(null!=e&&e.notes?!(null==e||!e.notes)&&"<p></p>"!==e.notes:!(null==e||!e.richText)&&(e=>{var t,r,i;return(null==e?void 0:e.richText)&&(e.richText&&(null==(r=null==(t=e.richText)?void 0:t.ops)?void 0:r.length)>1||e.richText&&"\n"!==(null==(i=e.richText)?void 0:i.ops[0].insert))})(e));function Hr(e,t){return e.map(e=>{const r=t.filter(t=>t._bookmark===e._id);return{...e,marksCount:r.length,notesCount:r.filter($r).length}})}Dt.WEB_HIGHLIGHT;class Wr extends Error{constructor(e){super(e),this.name="PayloadTooLargeError"}}function Vr(e){return e instanceof Wr}function qr(e){return e._objectStore===$t.marks}function zr(e){return e._objectStore===$t.bookmarks}function Kr(e){return e._objectStore===$t.chromesettings}function Yr(e){return e._objectStore===$t.pagecontents}function Xr(e){return e._objectStore===$t.aichats}function Jr(e){return ii(e,$t.marks)}function Zr(e){return ii(e,$t.bookmarks)}function Qr(e){return ii(e,$t.chromesettings)}function ei(e){return ii(e,$t.pagecontents)}function ti(e){return ii(e,$t.aichats)}function ri(e){return{...e,lastSync:e.isTooLargeToSync?e.lastSync:Date.now()}}function ii(e,t){return{...e,_objectStore:t}}function ni(e){return!si(e)&&(e.createdAt??0)>(e.lastSync??0)}function oi(e){return!si(e)&&!ni(e)&&(e.updatedAt??0)>(e.lastSync??0)}function si(e){return(e.deletedAt??0)>(e.lastSync??0)}function ai(e){return ni(e)||oi(e)||si(e)}function li(e,t){return{...e,...t}}h(class e{constructor(e){h(this,"executeSyncInProgress",!1),h(this,"executeSyncQueued",!1),h(this,"_chromeSyncStatus",{chromeSyncState:"OFFLINE",entitiesThatNeedSync:[]}),h(this,"areAllServersOffline",!1),this.options=e,this.executeSync()}get chromeSyncStatus(){return this._chromeSyncStatus}set setChromeSyncStatus(e){yi.dispatch("chromeSyncStatusChanged",{detail:e}),this._chromeSyncStatus=e}async getCurrentUser(){return Fr.getJwtPayload()}async resolveChromeSyncState({numberOfEntitiesThatNeedSync:e}){const t=await this.getCurrentUser(),r=Br(t??null);return this.areAllServersOffline?"ALL_SERVERS_OFFLINE":r===Lr.OFFLINE?"OFFLINE":0===e?"UP_TO_DATE":"SERVER_ERROR"===this.chromeSyncStatus.chromeSyncState?"SERVER_ERROR":jr("sync",{activeUserPlan:r,user:t??null})?"NEEDS_SYNC":"PREMIUM_REQUIRED"}async readChromeSyncStatus(){const e=await this.options.db.getEntitiesThatNeedSync();return{chromeSyncState:await this.resolveChromeSyncState({numberOfEntitiesThatNeedSync:e.length}),entitiesThatNeedSync:e}}async executeSyncPromise(){return new Promise(e=>{this.executeSync(()=>{e()})})}executeSync(e){if(this.executeSyncInProgress)return this.executeSyncQueued=!0,void(e&&e());const t=t=>{e&&e(),this.executeSyncInProgress=!1,this.executeSyncQueued?(this.executeSyncQueued=!1,this.executeSync()):this.readChromeSyncStatus().then(e=>{t&&(e.chromeSyncState=t),this.setChromeSyncStatus=e,this.checkForBackupOrSyncDialog()}),this.executeSyncQueued=!1};this.executeSyncInProgress=!0;try{this.readChromeSyncStatus().then(async e=>{this.setChromeSyncStatus=e;const{chromeSyncState:r,entitiesThatNeedSync:i}=e;if("OFFLINE"!==r&&"UP_TO_DATE"!==r&&"PREMIUM_REQUIRED"!==r){i.length&&(this.setChromeSyncStatus={...this.chromeSyncStatus,chromeSyncState:"UPDATING"});try{const e=await this.getCurrentUser();if(!e)throw new Error("Can not sync because user is not signed in.");const r=i.filter(ni),n=i.filter(oi),o=i.filter(si);let s=0;const a=20,l=(null==i?void 0:i.length)>a,c=async(e,t,r=a)=>{if(e=e.filter(e=>!e.isTooLargeToSync),!e.length)return;const n=Math.ceil(e.length/r);for(let o=0;o<n;o++){const n=o*r,a=n+r,c=e.slice(n,a);try{await t(c)}catch(e){if(!Vr(e))throw e;for(const e of c)try{await t([e])}catch(t){if(!Vr(t))throw t;e.isTooLargeToSync=!0}}l&&(s=Math.min(s+r,i.length),yi.dispatch("chromeSyncProgress",{detail:{current:s,of:i.length}}));const h=e.filter(e=>e.isTooLargeToSync);h.length&&(Pr({content:"Content is too large to sync. Click to review.",variant:"error",uniqueId:"too-large-payload",duration:1e4,onContentClick:()=>{Gr(this.chromeSyncStatus.entitiesThatNeedSync.filter(e=>e.isTooLargeToSync))}}),await Promise.all(h.map(e=>this.options.db.createOrUpdateEntities({objectStoreName:e._objectStore,entities:h}))))}};l&&yi.dispatch("chromeSyncProgress",{detail:{current:1,of:i.length}}),await c(r,e=>this.options.httpFacade.createEntities({entities:e})),await c(n,e=>this.options.httpFacade.updateEntities({entities:e})),await c(o,e=>this.options.httpFacade.deleteEntities({entities:e.map(e=>({_id:e._id,_objectStore:e._objectStore}))})),yi.dispatch("chromeSyncProgress",{detail:{current:i.length,of:i.length}}),await Promise.all([i.map(async t=>this.updateEntitiesWithUserIdAfterSync({marks:[t].filter(qr).map(ri),bookmarks:[t].filter(zr).map(ri),chromesettings:[t].filter(Kr).map(ri),pagecontents:[t].filter(Yr).map(ri),aichats:[t].filter(Xr).map(ri)},e))]),await this.runGarbageCollectorAfterSync(i),this.updateLastSync(),t()}catch(e){(e=>401===(null==e?void 0:e.statusCode))(e)&&(await async function(){await Fr.getJwtPayload()&&(yi.dispatch("loginNeeded",{detail:{authType:"signIn"}}),Pr({content:"Your token expired. Please login again.",variant:"warn",uniqueId:"token-expired",duration:1e4}))}(),yi.dispatch("loggedOut",{detail:null})),t("SERVER_ERROR")}}else t()})}catch(e){console.error(e)}}async updateAreAllServersOffline({areAllServersOffline:e}){return this.areAllServersOffline=e,this.updateChromeSyncState()}updateLastSync(e=Date.now()){this.options.lastSyncDateInMillis!==e&&(this.options={...this.options,lastSyncDateInMillis:e},zt.setValue("lastSyncDateInMillis",e))}async writeServerResultIntoLocalDb(e){const t=await this.options.db.getAllPageContents(),r=await this.options.db.getAllAiChats();e={...e,pagecontents:await this.addContentToPageContents(e.pagecontents,t),aichats:await this.addMessagesToAiChat(e.aichats,r)};const i=await this.getCurrentUser();if(i)try{const t=(await this.options.db.getEntitiesThatNeedSync()).filter(e=>!e._user||e._user===i._id),r=function(e,t,r){try{const i=e=>{const r=null==t?void 0:t.find(t=>t._id===e._id);return r&&(null==r?void 0:r.updatedAt)>(null==e?void 0:e.updatedAt)?r:e},n=e.marks.map(Jr).map(ri).map(i),o=e.bookmarks.map(Zr).map(ri).map(i),s=e.chromesettings.map(Qr).map(ri).map(i),a=e.pagecontents.map(ei).map(ri).map(i),l=e.aichats.map(ti).map(ri).map(i),c=[...n,...o,...s,...a,...l],h=null==t?void 0:t.filter(e=>!c.some(t=>t._id===e._id)),u=[...c,...h??[]].map(e=>({...e,_user:null==r?void 0:r._id}));return{marks:u.filter(qr),bookmarks:u.filter(zr),chromesettings:u.filter(Kr),pagecontents:u.filter(Yr),aichats:u.filter(Xr)}}catch{return e}}(e,t,i);return await this.options.db.clearDatabases(),await this.updateEntitiesWithUserIdAfterSync(r,i),await this.options.db.deleteUnreachablePageContents(),this.executeSync(),r}catch(e){console.error(e)}finally{this.updateLastSync(),zt.setValue("lastServerFetchInMillis",Date.now())}}async addContentToPageContents(e,t){return(null==e?void 0:e.map(e=>{var r;return{...e,content:null==(r=t.find(t=>t.url===e.url))?void 0:r.content}}))??[]}async addMessagesToAiChat(e,t){return(null==e?void 0:e.map(e=>{var r;const i=null==(r=t.find(t=>t._id===e._id))?void 0:r.messages;return Array.isArray(i)?{...e,messages:i}:e}))??[]}async updateEntitiesWithUserIdAfterSync({marks:e,bookmarks:t,chromesettings:r,pagecontents:i,aichats:n},o){try{const s={_user:o._id};await Promise.allSettled([this.options.db.createOrUpdateEntities({objectStoreName:$t.marks,entities:e.map(e=>li(e,s))}),this.options.db.createOrUpdateEntities({objectStoreName:$t.bookmarks,entities:t.map(e=>li(e,s))}),this.options.db.createOrUpdateEntities({objectStoreName:$t.chromesettings,entities:r.map(e=>li(e,s))}),this.options.db.createOrUpdateEntities({objectStoreName:$t.pagecontents,entities:i.map(e=>li(e,s))}),this.options.db.createOrUpdateEntities({objectStoreName:$t.aichats,entities:n.map(e=>li(e,s))})])}catch(e){console.error("Error during 'updateEntitiesWithUserIdAfterSync'",e)}}async runGarbageCollectorAfterSync(e){try{const t=e.filter(si);await Promise.allSettled([this.options.db.deleteEntities({objectStoreName:$t.marks,entities:t.filter(qr)}),this.options.db.deleteEntities({objectStoreName:$t.bookmarks,entities:t.filter(zr)}),this.options.db.deleteEntities({objectStoreName:$t.chromesettings,entities:t.filter(Kr)}),this.options.db.deleteEntities({objectStoreName:$t.pagecontents,entities:t.filter(Yr)})])}catch(e){console.error("Error during 'runGarbageCollectorAfterSync'",e)}}static create(t){if(e.instance)return e.instance;const r=new e(t);return e.instance=r,r}static createForUnitTests(t){return new e(t)}async updateChromeSyncState(e){const t=await this.options.db.getEntitiesThatNeedSync();this.setChromeSyncStatus={chromeSyncState:e||await this.resolveChromeSyncState({numberOfEntitiesThatNeedSync:t.length}),entitiesThatNeedSync:t??[]}}async checkForBackupOrSyncDialog(){var e;const t=this.chromeSyncStatus.entitiesThatNeedSync,r=await this.options.db.getChromeSettings();if(null!=t&&t.length&&function({chromeSettings:e,entitiesThatNeedSync:t}){var r;const i=e.showBackupDialogPrompt,n=(null==t?void 0:t.length)??0,o=e.backupDialogPromptInterval,s=function(e){return`backup_prompt_dismissed_${e}`}(n),a=n>=o&&i&&!(null!=(r=null==e?void 0:e.dismissedBackupPromptIds)&&r.includes(s))&&n>=o&&n%o===0;return a&&Rr({dismissedBackupPromptIds:[...e.dismissedBackupPromptIds??[],s]}),a}({chromeSettings:r,entitiesThatNeedSync:t})&&xr({dialogName:"backup-or-sync-prompt",options:{headerOptions:{showLogo:!0,showCloseButton:!0}}}),0===(null==t?void 0:t.length)&&"UP_TO_DATE"===this.chromeSyncStatus.chromeSyncState&&((null==(e=null==r?void 0:r.dismissedBackupPromptIds)?void 0:e.length)??0)>0)return Rr({dismissedBackupPromptIds:[]})}},"instance");const ci=()=>`webhighlightsContext${(()=>{try{return Ut()?pr():br(location.origin)?C+"Dev":""}catch(e){return console.debug("Error in resolveContextId",e),""}})()}`;function hi(){return typeof window>"u"?null:window[ci()]??null}function ui(){const e=hi();if(!function(e){const t=e||hi();return!!(t&&t.chromeSyncService&&t.db&&t.httpFacade)}(e))throw new Error("Context not initialized. Call 'initContext' first.");return e}function di(){try{return ui()}catch{return null}}const gi="webhighlights-notifications",fi=()=>`${gi}${(()=>{try{return Ut()?pr():br(location.origin)?C+"Dev":""}catch(e){return console.debug("Error in resolveNotificationContextId",e),""}})()}`,pi=`[id^="${gi}"]`;function mi(){let e=document.getElementById(fi());return e||(e=function(){const e=document.createElement("div");e.id=fi();const t=di();return e&&t&&Ut()&&(e.setAttribute("data-browser-type",t.appConfig.browserType),e.setAttribute("data-app-type",t.appConfig.appType)),document.body.append(e),e}()),e}const yi={subscribe:function(e,t,r){const i=mi();i.addEventListener(e,t);let n=[];return null!=r&&r.listenAcrossExtensions&&(n=[...document.querySelectorAll(pi)].filter(e=>e.id!==mi().id),n.forEach(r=>{r.addEventListener(e,t)})),{unsubscribe:()=>{i.removeEventListener(e,t),n.forEach(r=>{r.removeEventListener(e,t)})}}},unsubscribe:function(e,t){return mi().removeEventListener(e,t)},dispatch:function(e,t){mi().dispatchEvent(new CustomEvent(e,t))}};h(class e{constructor(e){h(this,"subscriptions",[]),this.options=e}static create(t){return e._singleton?e._singleton:new e(t)}start(){this.stop(),this.subscriptions=[yi.subscribe("updatedMark",e=>this.options.updatedMark(e.detail)),yi.subscribe("deletedMark",e=>this.options.deletedMark(e.detail)),yi.subscribe("bookmarkSelected",e=>this.options.bookmarkSelected(e.detail[0],e.detail[1])),yi.subscribe("openInReader",e=>this.options.openInReader(e.detail[0]))]}stop(){this.subscriptions.forEach(e=>{e.unsubscribe()})}},"_singleton"),Date.now(),Object.values({CANCEL_BY_USER:"Cancelled by user",SEND_NEW_MESSAGE:"Cancelled by sending new message"});const bi=()=>!(typeof window>"u")&&window.innerWidth<=767;Rt.clock,Rt.history,Rt.history,Rt.eye,bi(),bi();$t.bookmarks,$t.marks,$t.bookmarks,$t.bookmarks,$t.bookmarks,$t.bookmarks,$t.bookmarks,$t.marks,bi(),new class{constructor(){h(this,"pressedKeys",{}),h(this,"keyUpListener"),h(this,"keyDownListener")}handleKeydown(e){this.pressedKeys[e.key]=!0}handleKeyUp(e){this.pressedKeys[e.key]=!1}start(){this.keyDownListener=this.handleKeydown.bind(this),this.keyUpListener=this.handleKeyUp.bind(this),window.addEventListener("keydown",this.keyDownListener),window.addEventListener("keyup",this.keyUpListener)}stop(){this.keyDownListener&&window.removeEventListener("keydown",this.keyDownListener),this.keyUpListener&&window.removeEventListener("keyup",this.keyUpListener)}isKeyPressed(e){return!!this.pressedKeys[e]}};const Ti=12345678;Lr.FREE_TRIAL,Lr.PREMIUM,Dr.ONE_MONTH,Lr.PREMIUM,Dr.ONE_MONTH,Lr.ULTIMATE,Dr.ONE_YEAR,Lr.ULTIMATE,Dr.ONE_YEAR,Lr.PREMIUM,Dr.LIFETIME,Lr.PREMIUM;It.BASIC,Lr.PREMIUM,Lr.PREMIUM,Lr.ULTIMATE,Lr.ULTIMATE,Lr.ULTIMATE,Dr.LIFETIME,Lr.PREMIUM,Dr.LIFETIME,Lr.ULTIMATE,Dr.ONE_YEAR,Lr.ULTIMATE,Dr.ONE_MONTH,Lr.PREMIUM,Dr.ONE_YEAR,Lr.PREMIUM,Dr.ONE_MONTH;var _i=(e=>(e[e.bookmarks=$t.bookmarks]="bookmarks",e[e.marks=$t.marks]="marks",e.notes="notes",e.tag="tag",e))(_i||{});Object.values(_i),Rt.tag,Rt.blockquote,Rt["feather-edit-3"],Rt.globe,Rt.user,Rt.save,Rt.settings,Rt["arrow-up-circle"],Rt.zap,Rt.bell,Rt.reader;const Ai=f,vi=new class{constructor(e,t){h(this,"dbName","WebHighlights"),h(this,"version",3),h(this,"db"),h(this,"indexedDb"),h(this,"activeIdbRequests",new Map),h(this,"activeOpenDbRequest",null),this.fallbackStorage=e,this.indexedDb=t}getIdbRequest(e,t){const r=`${e}-${t}`,i=this.activeIdbRequests.get(r);if(i)return i;let n=null;if("getAll"===e&&(n=this.getObjectStore(t,"readonly").getAll()),this.activeIdbRequests.set(r,n),!n)return console.error(`IndexDbService: No request found for {${r}} for {${t}}`),null;const o=()=>{this.activeIdbRequests.delete(r),null==n||n.removeEventListener("success",o)},s=()=>{this.activeIdbRequests.delete(r),null==n||n.removeEventListener("error",s)};return n.addEventListener("success",o),n.addEventListener("error",s),n}clearActiveIdbRequests(){this.activeIdbRequests.clear()}async openDB(e){return new Promise((t,r)=>{const i=this.activeOpenDbRequest??this.indexedDb.open(this.dbName,e??this.version),n=e=>{this.db=e.target.result,this.activeOpenDbRequest=null,null==i||i.removeEventListener("success",n),t(this.db)},o=async e=>{var n;const s=null==(n=e.target.error)?void 0:n.message;if(null!=s&&s.includes("is less than the existing version")){console.warn(`Self-healing db version: '${s}'`);const e=s.match(/\((\d+)\).*\((\d+)\)/);if(e){const i=Number(e[2]);if("number"==typeof i&&Number.isInteger(i)&&i>this.version)try{const e=await this.openDB(i);return void t(e)}catch(e){console.error("Failed to open database with new version:",e),r(e)}}}this.activeOpenDbRequest=null,null==i||i.removeEventListener("error",o),r(e.target.error)};i.addEventListener("success",n),i.addEventListener("error",o),i.onupgradeneeded=e=>{this.initObjectStores(e)}})}initObjectStores(e){const t=e.target.result;t.objectStoreNames.contains($t.marks)||t.createObjectStore($t.marks,{keyPath:"_id"}),t.objectStoreNames.contains($t.bookmarks)||t.createObjectStore($t.bookmarks,{keyPath:"_id"}),t.objectStoreNames.contains($t.chromesettings)||(t.createObjectStore($t.chromesettings,{keyPath:"_id"}),this.createOrUpdateEntities({objectStoreName:$t.chromesettings,entities:[Ht]})),t.objectStoreNames.contains($t.pagecontents)||t.createObjectStore($t.pagecontents,{keyPath:"_id"}),t.objectStoreNames.contains($t.aichats)||t.createObjectStore($t.aichats,{keyPath:"_id"})}getObjectStore(e,t){return this.db.transaction(e,t).objectStore(e)}async getBookmarkForUrl({currentUrl:e,canonicalLink:t,asin:r}){return(await this.getAll($t.bookmarks)).find(i=>r?function(e){return"kindle"===(null==e?void 0:e.type)}(i)&&i.asin===r:function(e,t,r){var i,n;if(!ar(t)&&!ar(e.url)){const t=_r();if(r&&e.canonicalLink&&!t)return(null==r?void 0:r.toLowerCase())===(null==(i=e.canonicalLink)?void 0:i.toLowerCase());if((null==r?void 0:r.toLowerCase())===(null==(n=e.url)?void 0:n.toLowerCase()))return!0}return wr(null==e?void 0:e.url,t)}(i,e,t))??null}async getAllEntities(e){const[t,r,i,n,o]=await Promise.all([this.getAll($t.marks,e),this.getAll($t.bookmarks,e),this.getAll($t.chromesettings,e),this.getAll($t.pagecontents,e),this.getAll($t.aichats,e)]);return{marks:t??[],bookmarks:r??[],chromesettings:i??[Ht],pagecontents:n??[],aichats:o??[]}}async getAllMarks(e){const t=await this.getAll($t.marks,e);return"function"==typeof(null==e?void 0:e.filter)?t.filter(e.filter):t}async getAllPageContents(e){const t=await this.getAll($t.pagecontents,e);return"function"==typeof(null==e?void 0:e.filter)?t.filter(e.filter):t}async getAllBookmarks(e){const t=await this.getAll($t.bookmarks,e);return"function"==typeof(null==e?void 0:e.filter)?t.filter(e.filter):t}async getAllAiChats(e){const t=await this.getAll($t.aichats,e);return"function"==typeof(null==e?void 0:e.filter)?t.filter(e.filter):t}async getEntityById(e){return await this.openDB(),(await this.getAll(e._objectStore)).find(t=>t._id===e._id)??null}async getAiChatByReferenceId(e){return(await this.getAll($t.aichats)).find(t=>t._referenceId===e)??null}async getMarksForTag(e){return(await this.getAll($t.marks)).filter(t=>t.tags.some(t=>t.toLowerCase()===e.toLowerCase()))}async getMarksForDomain(e){return(await this.getAll($t.marks)).filter(t=>{var r;return(null==(r=yr(t.url))?void 0:r.toLowerCase())===e.toLowerCase()})}async getBookmarksForTag(e){const[t,r]=await Promise.all([this.getAll($t.marks),this.getAll($t.bookmarks)]),i=r.filter(t=>t.tags.some(t=>t.toLowerCase()===e.toLowerCase()));return Hr(i,t)}async getBookmarksForDomain(e){const[t,r]=await Promise.all([this.getAll($t.marks),this.getAll($t.bookmarks)]);return r.filter(t=>yr(t.url).toLowerCase()===e.toLowerCase()).map(e=>{const r=t.filter(t=>t._bookmark===e._id);return{...e,marksCount:r.length,notesCount:r.filter($r).length}})}async getMarksForBookmark(e){return(await this.getAll($t.marks)).filter(t=>t._bookmark===e._id)}async getBookmarksWithCount(e){const{marks:t,bookmarks:r}=await this.getAllEntities(),i=t.map(e=>({_bookmark:e._bookmark,hasNote:$r(e)}));return r.map(e=>{const t=i.filter(t=>t._bookmark===e._id);return{...e,marksCount:t.length,notesCount:t.filter(e=>e.hasNote).length}}).sort((t,r)=>pt(t,r,(null==e?void 0:e.sortDirection)??"asc",(null==e?void 0:e.sortType)??"createdAt")).slice((null==e?void 0:e.from)??0,(null==e?void 0:e.limit)??1/0)}async getEntitiesThatNeedSync(){const e=await this.getAllEntities({includeMarkedAsDeleted:!0});return[...e.marks.map(Jr),...e.bookmarks.map(Zr),...e.chromesettings.map(Qr),...e.pagecontents.map(ei),...e.aichats.map(ti)].filter(ai)}async getAllTags(){const[e,t]=await Promise.all([this.getAll($t.marks),this.getAll($t.bookmarks)]);return Cr(e??[],t??[])}async getChromeSettings(){const e=await Fr.getJwtPayload(),t=await this.getAll($t.chromesettings),r=t.find(t=>t._user===(null==e?void 0:e._id)),i=(()=>{if(r)return{...Ht,...r};if(e)return{...Ht,isFallback:!0,_user:e._id};const i=t[t.length-1];return{...Ht,...i??{},_id:Ht._id}})();return i.sidebarOptions.sidebarWidth||(i.sidebarOptions.sidebarWidth=Ht.sidebarOptions.sidebarWidth),i.sidebarOptions.sidebarAlignment||(i.sidebarOptions.sidebarAlignment=Ht.sidebarOptions.sidebarAlignment),i.sidebarOptions.sidebarBehavior||(i.sidebarOptions.sidebarBehavior=Ht.sidebarOptions.sidebarBehavior),i}async updateChromeSettings(e){const t=await this.getChromeSettings(),r=await Fr.getJwtPayload(),i={...t,...e,updatedAt:Date.now(),_user:t._user??(null==r?void 0:r._id)};try{await this.createOrUpdateEntities({objectStoreName:$t.chromesettings,entities:[i]})}catch(e){console.error("Error while updating chrome settings",e)}return i}async getAllCount(e){const t=await this.getAll(e);return(null==t?void 0:t.length)??0}async importBackupData(e){if(!function(e){return!(null===e||"object"!=typeof e||!Array.isArray(null==e?void 0:e.bookmarks)||!Array.isArray(null==e?void 0:e.marks)||typeof e.chromeSettings>"u")}(e))throw new Error("Invalid import backup data");const t=await this.getBackupData(),r=async e=>Promise.all([this.writeSyncableData({bookmarks:e.bookmarks,marks:e.marks,chromesettings:[e.chromeSettings],pagecontents:(null==e?void 0:e.pagecontents)??[],aichats:(null==e?void 0:e.aichats)??[]})]);try{const t=function(e){const t=function(e){const t=ht(e.chromeSettings);let r=e.marks.map(ht);return{bookmarks:e.bookmarks.map(e=>{const t=ct();return r=r.map(r=>({...r,_bookmark:r._bookmark===e._id?t:r._bookmark})),{...e,_id:t}}),marks:r,chromeSettings:t,pagecontents:e.pagecontents}}(e),r=function({marks:e,bookmarks:t,chromeSettings:r,pagecontents:i}){var n;return{bookmarks:t.map(ut).map(dt),marks:e.map(ut).map(dt),chromeSettings:dt(ut(r)),pagecontents:(null==(n=null==i?void 0:i.map(ut))?void 0:n.map(dt))??[]}}(t);return{bookmarks:r.bookmarks,marks:r.marks,chromeSettings:r.chromeSettings,pagecontents:r.pagecontents??[]}}(e);await this.clearDatabases(),await r(t)}catch(e){console.log(e),Pr({content:"Something went wrong, restoring old data...",variant:"error",uniqueId:"general-error"}),await r(t)}}async writeSyncableData(e){return Promise.allSettled([this.createOrUpdateEntities({objectStoreName:$t.marks,entities:e.marks}),this.createOrUpdateEntities({objectStoreName:$t.bookmarks,entities:e.bookmarks}),this.createOrUpdateEntities({objectStoreName:$t.chromesettings,entities:e.chromesettings}),this.createOrUpdateEntities({objectStoreName:$t.pagecontents,entities:e.pagecontents}),this.createOrUpdateEntities({objectStoreName:$t.aichats,entities:e.aichats})])}async getAllOrigins(){return function(e){const t=e.map(e=>yr(e.url)).filter(Boolean).flat(1);return[...new Set(t)].map(e=>kr(e,t)).sort(bt)}(await this.getAll($t.bookmarks)??[])}async getBookmark(e){return this.getEntityById({_id:e._id,_objectStore:$t.bookmarks})}async getAll(e,t){return await this.openDB(),new Promise((r,i)=>{const n=e=>!(null==t||!t.includeMarkedAsDeleted)||!e.deletedAt,o=this.getIdbRequest("getAll",e);if(!o)return i();const s=e=>{null==o||o.removeEventListener("success",s);const t=e.target.result;r(t.filter(n))},a=()=>{i(),null==o||o.removeEventListener("error",a)};o.addEventListener("success",s),o.addEventListener("error",a)})}async createOrUpdateEntities({objectStoreName:e,entities:t}){return await this.openDB(),new Promise((r,i)=>{const n=this.db.transaction([e],"readwrite"),o=n.objectStore(e);null==t||t.forEach(e=>o.put(e)),n.oncomplete=()=>{this.clearActiveIdbRequests(),r()},n.onerror=e=>{this.clearActiveIdbRequests(),i(e.target.error)}})}async markEntitiesAsDeleted({objectStoreName:e,entities:t}){return await this.openDB(),new Promise((r,i)=>{const n=this.db.transaction([e],"readwrite"),o=n.objectStore(e);null==t||t.map(e=>{const t=o.get(e._id);t.onsuccess=()=>{this.clearActiveIdbRequests();const r=t.result;if(null!=r&&r.lastSync){const e={...r,deletedAt:Date.now()};o.put(e)}else o.delete(e._id)}}),n.oncomplete=()=>{this.clearActiveIdbRequests(),r()},n.onerror=e=>{this.clearActiveIdbRequests(),i(e.target.error)}})}async deleteEntities({objectStoreName:e,entities:t}){return await this.openDB(),new Promise((r,i)=>{const n=this.db.transaction([e],"readwrite"),o=n.objectStore(e);null==t||t.forEach(e=>{o.delete(e._id)}),n.oncomplete=()=>{this.clearActiveIdbRequests(),r()},n.onerror=e=>{this.clearActiveIdbRequests(),i(e.target.error)}})}async clearDatabases(){try{return await this.openDB(),new Promise((e,t)=>{const r=this.db.transaction([$t.marks,$t.bookmarks,$t.chromesettings,$t.pagecontents,$t.aichats],"readwrite"),i=r.objectStore($t.marks),n=r.objectStore($t.bookmarks),o=r.objectStore($t.chromesettings),s=r.objectStore($t.pagecontents),a=r.objectStore($t.aichats);i.clear(),n.clear(),o.clear(),s.clear(),a.clear(),r.oncomplete=()=>{this.clearActiveIdbRequests(),e()},r.onerror=e=>{this.clearActiveIdbRequests(),t(e.target.error)}})}catch{console.error("Error while clearing database")}}async getBackupData(){const[e,t,r,i,n]=await Promise.all([this.getAll($t.marks),this.getAll($t.bookmarks),this.getAll($t.chromesettings),this.getAll($t.pagecontents),this.getAll($t.aichats)]);return{marks:e,bookmarks:t,chromeSettings:r[0]||Ht,pagecontents:i,aichats:n}}async getEntitiesForSearchValue({searchValue:e}){e=e.toLowerCase();const t=t=>t.tags.some(t=>t.toLowerCase().includes(e)),[r,i]=await Promise.all([this.getAll($t.marks),this.getAll($t.bookmarks)]),n=Cr(r,i),o=(e,t)=>pt(e,t,"asc","createdAt"),s=r.sort(o).filter(r=>{var i,n;return(null==(i=null==r?void 0:r.text)?void 0:i.toLowerCase().includes(e))||(null==(n=null==r?void 0:r.url)?void 0:n.toLowerCase().includes(e))||t(r)}),a=i.sort(o).filter(r=>{var i,n;return(null==(i=null==r?void 0:r.title)?void 0:i.toLowerCase().includes(e))||(null==(n=null==r?void 0:r.url)?void 0:n.toLowerCase().includes(e))||t(r)}),l=r.filter(t=>{var r;return $r(t)&&(null==(r=t.notes)?void 0:r.toLowerCase().includes(e))}),c=function({allTags:e,searchValue:t,existingTags:r}){if(!Array.isArray(e))return[];const i=e.filter(e=>!(null!=r&&r.some(t=>t.toLowerCase()===e.name.toLowerCase())));if("string"!=typeof t||null==t||!t.length)return i.sort(Tt);const n=t.toLowerCase();return i.filter(e=>e.name.toLowerCase().includes(n)).map(e=>{const r=function(e,t){if(e.toLowerCase()===t.toLowerCase())return 100;if(e.toLowerCase().startsWith(t.toLowerCase()))return 90;if(e.toLowerCase().includes(t.toLowerCase()))return 70;const r=function(e,t){const r=[];if(0===e.length)return t.length;if(0===t.length)return e.length;for(let e=0;e<=t.length;e++)r[e]=[e];for(let t=0;t<=e.length;t++)r[0][t]=t;for(let i=1;i<=t.length;i++)for(let n=1;n<=e.length;n++)t.charAt(i-1)===e.charAt(n-1)?r[i][n]=r[i-1][n-1]:r[i][n]=Math.min(r[i-1][n-1]+1,r[i][n-1]+1,r[i-1][n]+1);return r[t.length][e.length]}(e.toLowerCase(),t.toLowerCase());return Math.max(50-r,0)}(e.name,t),i=e.count>=5?5:e.count%5;return{...e,matchScore:r+i}}).sort(_t)}({allTags:n,searchValue:e});return{marks:s,bookmarks:Hr(a,r),tags:c,marksWithNotes:l}}async getLastHighlightedMark(){return(await this.getAll($t.marks)).sort((e,t)=>t.createdAt-e.createdAt)[0]||null}async getLearningStatus(){return function(e){var t,r,i,n,o;let s=0,a=0,l=0,c=0,h=0,u=0;for(const d of e)try{if(!d.learningItem){u++;continue}if(null!=(t=d.learningItem)&&t.lastLearned&&B(new Date((null==(r=d.learningItem)?void 0:r.lastLearned)??0))&&s++,null!=(i=d.learningItem)&&i.lastLearned&&B(new Date((null==(n=d.learningItem)?void 0:n.lastLearned)??0),{todayOffset:-1})&&a++,null!=(o=d.learningItem)&&o.disableLearning){l++;continue}d.learningItem&&Or(d)&&c++,d.learningItem.nextReviewInMillis&&B(new Date(d.learningItem.nextReviewInMillis),{todayOffset:1})&&h++,d.learningItem&&Or(d)}catch(e){console.error(e)}return{learntTodayCount:s,dueCount:c,unlearnedCount:u,disabledCount:l,learntYesterdayCount:a,dueTomorrowCount:h,marksToLearnCount:c+u}}(await this.getAll($t.marks))}async getPageContentForUrl(e){var t,r;return(null==(r=null==(t=(await this.getAll($t.pagecontents)).filter(t=>wr(t.url,e.url)))?void 0:t.sort((e,t)=>t.createdAt-e.createdAt))?void 0:r[0])||null}async deleteUnreachablePageContents(){const e=function({allPageContents:e,allBookmarks:t}){return e.filter(r=>(e=>!t.some(t=>wr(t.url,e.url)))(r)||(t=>e.some(e=>wr(e.url,t.url)&&e.createdAt>t.createdAt))(r))}({allPageContents:await this.getAll($t.pagecontents),allBookmarks:await this.getAll($t.bookmarks)});return this.markEntitiesAsDeleted({entities:e,objectStoreName:$t.pagecontents})}async getPageContentSizeUsedInBytes(){return(await this.getAll($t.pagecontents)).reduce((e,t)=>e+t.length,0)}}({marks:[],bookmarks:[],chromesettings:[],pagecontents:[],aichats:[]},indexedDB);var wi=function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((i=i.apply(e,t||[])).next())})};function Ei(){chrome.commands.getAll().then(e=>{var t,r,i,n,o,s,a,l,c;const h=null!==(i=null===(r=null!==(t=e.find(e=>"highlight-text"===e.name))&&void 0!==t?t:null)||void 0===r?void 0:r.shortcut)&&void 0!==i?i:T,d=null!==(s=null===(o=null!==(n=e.find(e=>"toggle-bookmark"===e.name))&&void 0!==n?n:null)||void 0===o?void 0:o.shortcut)&&void 0!==s?s:T,g=null!==(c=null===(l=null!==(a=e.find(e=>"open-in-reader"===e.name))&&void 0!==a?a:null)||void 0===l?void 0:l.shortcut)&&void 0!==c?c:T;chrome.contextMenus.removeAll(),Ai.appType===u.reader&&chrome.contextMenus.create({id:jt.CONTEXT_OPEN_IN_READER,title:"Open in reader "+(g?`[${g}]`:""),contexts:["page"]}),Ai.appType===u.highlighter&&(chrome.contextMenus.create({id:jt.CONTEXT_MENU_SAVE_BOOKMARK,title:"Save page as bookmark "+(d?`[${d}]`:""),contexts:["page"]}),chrome.contextMenus.create({id:jt.CONTEXT_MENU_SAVE_TEXT,title:"Highlight selected text "+(h?`[${h}]`:""),contexts:["selection"]})),chrome.contextMenus.create({id:jt.CONTEXT_MENU_SAVE_IMAGE,title:"Save image",contexts:["image"]})})}function Si(e){Ii(function(e){return mr(`viewer.html?file=${encodeURIComponent(e)}`)}(e))}function Ii(e,t={}){try{t.newTab?chrome.tabs.create({url:e,active:!0}):chrome.tabs.update({url:e,active:!0})}catch(e){console.warn(e)}}function Ni(e){vi.getChromeSettings().then(t=>wi(this,void 0,void 0,function*(){if(e.url&&e.id){const r=function(e,t){return function(e,t){var r;const i=null==(r=di())?void 0:r.appConfig;return(!_r()||null==i||!i.isWebApp)&&([...t,...or].some(t=>function(e,t){try{const r=t.endsWith("/*");return t=`^(?:www.|(?:http|https|ftp|ftps|chrome|file|)://(?:www.|))${t}`,r||(t=`${t}(?:$|/$)`),RegExp(t).test(e)}catch{return!1}}(e,t))||Tr(e))}(e,t)}(e.url,t.blacklistedUrls);try{yield function(e,t,r){return wi(this,void 0,void 0,function*(){const i=fr(r),n={text:"Off",color:"#252934"},o={text:"PDF",color:"#d8261c"},s=e?n.text:i?o.text:"",a=e?n.color:i?o.color:"";return Promise.all([Oi({tabId:t,urlIsBlackListed:e,url:r}),ki(t,s),Ci(t,a)])})}(r,e.id,e.url)}catch(e){console.warn(e)}}}))}function Oi(e){return wi(this,arguments,void 0,function*({tabId:e,urlIsBlackListed:t,url:r}){let i="marker-icon";const n=function(e){try{if(!e)return!1;const t=new URL(e);return(t.hostname.includes("youtube.com")||t.hostname.includes("youtu.be"))&&null!==function(e){var t,r=e.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?)|(shorts\/))\??v?=?([^#&?]*).*/);return r&&11===(null==(t=r[8])?void 0:t.length)?r[8]:null}(e)}catch{return!1}}(r);n&&(i="marker-icon-youtube");const o=Ai.appType===u.youtubeHighlighter;(t||o&&!n)&&!Er(r)&&(i="marker-icon-disabled"),yield chrome.action.setIcon({path:`../../../../assets/${i}.png`,tabId:e})})}function ki(e,t){return wi(this,void 0,void 0,function*(){t&&(yield chrome.action.setBadgeText({text:t,tabId:e}))})}function Ci(e,t){return wi(this,void 0,void 0,function*(){t&&(yield chrome.action.setBadgeBackgroundColor({color:t,tabId:e}))})}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self&&self;var Li={exports:{}};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,function(e){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)e.exports=globalThis.browser;else{const t="The message port closed before a response was received.",r=e=>{const r={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(r).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class i extends WeakMap{constructor(e,t=void 0){super(t),this.createItem=e}get(e){return this.has(e)||this.set(e,this.createItem(e)),super.get(e)}}const n=(t,r)=>(...i)=>{e.runtime.lastError?t.reject(new Error(e.runtime.lastError.message)):r.singleCallbackArg||i.length<=1&&!1!==r.singleCallbackArg?t.resolve(i[0]):t.resolve(i)},o=e=>1==e?"argument":"arguments",s=(e,t,r)=>new Proxy(t,{apply:(t,i,n)=>r.call(i,e,...n)});let a=Function.call.bind(Object.prototype.hasOwnProperty);const l=(e,t={},r={})=>{let i=Object.create(null),c={has:(t,r)=>r in e||r in i,get(c,h,u){if(h in i)return i[h];if(!(h in e))return;let d=e[h];if("function"==typeof d)if("function"==typeof t[h])d=s(e,e[h],t[h]);else if(a(r,h)){let t=((e,t)=>function(r,...i){if(i.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${o(t.minArgs)} for ${e}(), got ${i.length}`);if(i.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${o(t.maxArgs)} for ${e}(), got ${i.length}`);return new Promise((o,s)=>{if(t.fallbackToNoCallback)try{r[e](...i,n({resolve:o,reject:s},t))}catch(n){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,n),r[e](...i),t.fallbackToNoCallback=!1,t.noCallback=!0,o()}else t.noCallback?(r[e](...i),o()):r[e](...i,n({resolve:o,reject:s},t))})})(h,r[h]);d=s(e,e[h],t)}else d=d.bind(e);else if("object"==typeof d&&null!==d&&(a(t,h)||a(r,h)))d=l(d,t[h],r[h]);else{if(!a(r,"*"))return Object.defineProperty(i,h,{configurable:!0,enumerable:!0,get:()=>e[h],set(t){e[h]=t}}),d;d=l(d,t[h],r["*"])}return i[h]=d,d},set:(t,r,n,o)=>(r in i?i[r]=n:e[r]=n,!0),defineProperty:(e,t,r)=>Reflect.defineProperty(i,t,r),deleteProperty:(e,t)=>Reflect.deleteProperty(i,t)},h=Object.create(e);return new Proxy(h,c)},c=e=>({addListener(t,r,...i){t.addListener(e.get(r),...i)},hasListener:(t,r)=>t.hasListener(e.get(r)),removeListener(t,r){t.removeListener(e.get(r))}}),h=new i(e=>"function"!=typeof e?e:function(t){const r=l(t,{},{getContent:{minArgs:0,maxArgs:0}});e(r)}),u=new i(e=>"function"!=typeof e?e:function(t,r,i){let n,o,s=!1,a=new Promise(e=>{n=function(t){s=!0,e(t)}});try{o=e(t,r,n)}catch(e){o=Promise.reject(e)}const l=!0!==o&&(c=o)&&"object"==typeof c&&"function"==typeof c.then;var c;return!(!0!==o&&!l&&!s||((l?o:a).then(e=>{i(e)},e=>{let t;t=e&&(e instanceof Error||"string"==typeof e.message)?e.message:"An unexpected error occurred",i({__mozWebExtensionPolyfillReject__:!0,message:t})}).catch(e=>{console.error("Failed to send onMessage rejected reply",e)}),0))}),d=({reject:r,resolve:i},n)=>{e.runtime.lastError?e.runtime.lastError.message===t?i():r(new Error(e.runtime.lastError.message)):n&&n.__mozWebExtensionPolyfillReject__?r(new Error(n.message)):i(n)},g=(e,t,r,...i)=>{if(i.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${o(t.minArgs)} for ${e}(), got ${i.length}`);if(i.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${o(t.maxArgs)} for ${e}(), got ${i.length}`);return new Promise((e,t)=>{const n=d.bind(null,{resolve:e,reject:t});i.push(n),r.sendMessage(...i)})},f={devtools:{network:{onRequestFinished:c(h)}},runtime:{onMessage:c(u),onMessageExternal:c(u),sendMessage:g.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:g.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},p={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return r.privacy={network:{"*":p},services:{"*":p},websites:{"*":p}},l(e,f,r)};e.exports=r(chrome)}}(Li);var Di,Ri,Pi=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(Li.exports);class xi{constructor(){this.isLocal=!0}log({level:e,message:t,timestamp:r,data:i,title:n}){let o;switch(e){case"debug":default:o="log";break;case"info":o="info";break;case"warn":o="warn";break;case"error":case"critical":case"fatal":o="error"}const s=n?`[${n}]`:"";void 0!==i?console[o](`[${r}] - ${xi.LOGGER_PREFIX} ${s} ${t}`,i):console[o](`[${r}] - ${xi.LOGGER_PREFIX} ${s} ${t}`)}}xi.LOGGER_PREFIX="[GFAdUnit] -",function(e){e.checkoutPopupShown="CHECKOUT-POPUP-SHOWN",e.checkoutPopupNotShown="CHECKOUT-POPUP-NOT-SHOWN",e.checkoutPopupSupressed="CHECKOUT-POPUP-SUPRESSED",e.checkoutPopupDonation="CHECKOUT-POPUP-DONATION",e.checkoutPopupFailedActivation="CHECKOUT-POPUP-FAILED-ACTIVATION",e.checkoutPopupPurchaseConfirmed="CHECKOUT-POPUP-PURCHASE-CONFIRMED",e.checkoutPopupHealthCheck="CHECKOUT-POPUP-HEALTH-CHECK",e.checkouPopupActivationFailed="CHECKOUT-POPUP-ACTIVATION-FAILED",e.checkoutPopupOfferDetailsClicked="CHECKOUT-POPUP-OFFER-DETAILS-CLICKED",e.checkoutPopupWhyAmISeeingThisClicked="CHECKOUT-POPUP-WHY-AM-I-SEEING-THIS-CLICKED",e.checkoutPopupLooserExtension="CHECKOUT-POPUP-LOOSER-EXTENSION",e.checkoutPopupActiveDomain="CHECKOUT-POPUP-ACTIVE-DOMAIN",e.checkoutPopupSiteMatches="CHECKOUT-POPUP-SITE-MATCHES"}(Di||(Di={})),function(e){e.adUnitLog="ADUNIT-LOG"}(Ri||(Ri={}));class Gi{constructor(e){this.isLocal=!1,this.backgroundService=e}log({level:e,message:t,data:r,title:i}){this.backgroundService.trackEvent(Ri.adUnitLog,{log:{level:e,message:t,data:r,title:i}})}}const Bi=["debug","info","warn","error","critical","fatal"];class Ui{constructor(e){this.config={minLevel:e?.minLevel??"debug",enabled:e?.enabled??!1,transports:e?.transports??[new xi],title:e?.title??""}}static getInstance(e){return Ui.instance||(Ui.instance=new Ui(e)),Ui.instance}configure(e){this.config={...this.config,...e}}shouldLog(e){return!!this.config.enabled&&Bi.indexOf(e)>=Bi.indexOf(this.config.minLevel)}createLogMessage(e,t,r){return{level:e,version:"1.14.3",message:t,timestamp:(new Date).toISOString(),data:r,title:this.config.title}}log(e,t,r,i){if(!this.shouldLog(e))return;const n=this.createLogMessage(e,t,i);this.config.transports.filter(e=>!r||e.isLocal).forEach(e=>e.log(n))}debug(e,t,r=!1){this.log("debug",e,r,t)}info(e,t,r=!1){this.log("info",e,r,t)}warn(e,t,r=!1){this.log("warn",e,r,t)}error(e,t,r=!1){this.log("error",e,r,t)}critical(e,t,r=!1){this.log("critical",e,r,t)}fatal(e,t,r=!1){this.log("fatal",e,r,t)}addTransport(e){this.config.transports.push(e)}clearTransports(){this.config.transports=[]}disable(){this.config.enabled=!1}enable(){this.config.enabled=!0}}const Mi=3,ji=e=>1e3*e;async function Fi(e,t={},r){const{maxAttempts:i=Mi,delayFn:n=ji}=t;let o=null;for(let t=1;t<=i;t+=1)try{return await e()}catch(e){o=e,t<i&&await new Promise(e=>{setTimeout(e,n(t))})}if(o&&t.logger&&t.operationName&&t.logger.error(`Operation ${t.operationName} failed after ${i} attempts.`,o,!0),void 0!==r)return r;throw o||new Error("Operation failed after multiple attempts")}const $i=Pi,Hi={TRACK_EVENT:"GF_TRACK_EVENT",HIDE_POPUP:"GF_HIDE_POPUP",GET_POPUP_CONFIG:"GF_GET_POPUP_CONFIG",IS_ACTIVE_DOMAIN:"GF_IS_ACTIVE_DOMAIN",SHOULD_STAND_DOWN:"GF_SHOULD_STAND_DOWN",ACTIVATE_OFFER:"GF_ACTIVATE_OFFER",STORE_SHOPIFY_SHOP_ID:"GF_STORE_SHOPIFY_SHOP_ID",GET_DOMAIN_BY_SHOP_ID:"GF_GET_DOMAIN_BY_SHOP_ID",GET_LANGUAGE_CONTENT:"GF_GET_LANGUAGE_CONTENT"},Wi="shopify_shop_ids",Vi="gf_last_health_check",qi="gf_partner_config",zi="gf_global_config",Ki="countryCode",Yi="version",Xi="gf_anonymous_user_info",Ji="gf_anonymous_encrypted_token",Zi="gf_ad_event_history",Qi="wfDevice",en="wfDomains",tn="wfStanddownPolicy",rn="wfStanddownHistory",nn="wfMerchantRates",on="en",sn="GIVE_FREELY_",an={async get(e){const t=`${sn}${e}`;return(await Pi.storage.local.get(t))[t]||null},async set(e,t){const r=`${sn}${e}`;await Pi.storage.local.set({[r]:t})},async remove(e){const t=Array.isArray(e)?e.map(e=>`${sn}${e}`):`${sn}${e}`;await Pi.storage.local.remove(t)}},ln=()=>String("1.14.3"),cn=async(e=!0)=>{const t=await an.get(Yi),r=await ln(),i=t!==r;var n;return e&&i&&await(n=r,an.set(Yi,n)),i},hn=Ui.getInstance(),un={async get(e,t,r,i=!1){let n=await an.get(e);const o=n;let s=!1;if(n&&Date.now()<=n.expiration&&!i)return{content:n.content,isStale:s};try{const i=await t();n=await this.set(e,i,r)}catch(e){hn.error("Error getting cached value",{error:e}),s=!0}return{content:n?.content??o?.content,isStale:s}},async set(e,t,r){const i={content:t,expiration:Date.now()+1e3*(r??300)};return await an.set(e,i),i},async refresh(e,t,r,i=!1){const n=await this.get(e,t,r,i);if(n.isStale||i)try{const i=await t();if(!i)return{content:n.content,isStale:!0};n.content=i,await this.set(e,n.content,r)}catch(e){return hn.error("Error refreshing cached value",{error:e}),{content:n.content,isStale:!0}}return{content:n.content,isStale:!1}},async clear(e){await an.remove(e)}};class dn{constructor(){this.listeners=new Map,this.wildcardListeners=new Set}on(e,t){return this.addListener(e,t,!1)}once(e,t){return this.addListener(e,t,!0)}off(e,t){if(!t)return this.listeners.delete(e),void(this.wildcardListeners=new Set(Array.from(this.wildcardListeners).filter(t=>t.pattern!==e)));if(e.includes("*"))this.wildcardListeners=new Set(Array.from(this.wildcardListeners).filter(r=>!(r.pattern===e&&r.callback===t)));else{const r=this.listeners.get(e);if(r){const i=Array.from(r).filter(e=>e.callback!==t);i.length>0?this.listeners.set(e,new Set(i)):this.listeners.delete(e)}}}emit(e){const t=this.listeners.get(e.path)||new Set,r=new Set;for(const e of t)r.add(e);for(const t of this.wildcardListeners)this.matchesPattern(e.path,t.pattern)&&r.add(t);for(const t of r)t.callback(e),t.once&&this.removeListener(t)}clear(){this.listeners.clear(),this.wildcardListeners.clear()}addListener(e,t,r){const i={pattern:e,callback:t,once:r};if(e.includes("*"))this.wildcardListeners.add(i);else{const t=this.listeners.get(e);t?t.add(i):this.listeners.set(e,new Set([i]))}return()=>this.off(e,t)}removeListener(e){if(e.pattern.includes("*"))this.wildcardListeners.delete(e);else{const t=this.listeners.get(e.pattern);t&&(t.delete(e),0===t.size&&this.listeners.delete(e.pattern))}}matchesPattern(e,t){if("*"===t)return!0;const r=t.split(".").map(e=>"*"===e?"[^.]+":"**"===e?".*":e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("\\.");return new RegExp(`^${r}$`).test(e)}}function gn(e,t,r=""){const i=[];if(e===t)return i;if(fn(e)||fn(t))return e!==t&&i.push({path:r||"root",oldValue:e,newValue:t}),i;if(Array.isArray(e)&&Array.isArray(t))return JSON.stringify(e)!==JSON.stringify(t)&&i.push({path:r||"root",oldValue:e,newValue:t}),i;if(pn(e)&&pn(t)){const n=e,o=t,s=new Set([...Object.keys(n),...Object.keys(o)]);for(const e of s){const t=r?`${r}.${e}`:e,s=n[e],a=o[e];if(e in n)if(e in o){const e=gn(s,a,t);i.push(...e)}else i.push({path:t,oldValue:s,newValue:void 0});else i.push({path:t,oldValue:void 0,newValue:a})}}else e!==t&&i.push({path:r||"root",oldValue:e,newValue:t});return i}function fn(e){return null==e||"object"!=typeof e}function pn(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}var mn;!function(e){e.CLOSED="CLOSED",e.OPEN="OPEN",e.HALF_OPEN="HALF_OPEN"}(mn||(mn={}));class yn{constructor(e={}){this.state=mn.CLOSED,this.failures=[],this.lastFailureTime=0,this.halfOpenCalls=0,this.logger=Ui.getInstance({minLevel:"warn"}),this.options={failureThreshold:5,recoveryTimeout:6e4,monitoringWindow:3e5,halfOpenMaxCalls:3,storageKey:"circuit_breaker_state",...e},this.storageKey=this.options.storageKey}async initialize(){await this.loadFromStorage()}static async create(e={}){const t=new yn(e);return await t.initialize(),t}async loadFromStorage(){try{if("undefined"!=typeof chrome&&chrome.storage&&chrome.storage.local){const e=(await chrome.storage.local.get(this.storageKey))[this.storageKey];e&&(this.state=e.state,this.failures=e.failures||[],this.lastFailureTime=e.lastFailureTime||0,this.halfOpenCalls=e.halfOpenCalls||0,this.cleanupOldFailures())}else if("undefined"!=typeof localStorage){const e=localStorage.getItem(this.storageKey);if(e){const t=JSON.parse(e);this.state=t.state,this.failures=t.failures||[],this.lastFailureTime=t.lastFailureTime||0,this.halfOpenCalls=t.halfOpenCalls||0,this.cleanupOldFailures()}}}catch(e){this.logger.warn("Failed to load circuit breaker state from storage:",e)}}async saveToStorage(){try{const e={state:this.state,failures:this.failures,lastFailureTime:this.lastFailureTime,halfOpenCalls:this.halfOpenCalls};"undefined"!=typeof chrome&&chrome.storage&&chrome.storage.local?await chrome.storage.local.set({[this.storageKey]:e}):"undefined"!=typeof localStorage&&localStorage.setItem(this.storageKey,JSON.stringify(e))}catch(e){this.logger.warn("Failed to save circuit breaker state to storage:",e)}}cleanupOldFailures(){const e=Date.now();this.failures=this.failures.filter(t=>e-t.timestamp<=this.options.monitoringWindow)}async execute(e,t){if(this.state===mn.OPEN){if(!this.shouldAttemptRecovery()){if(t)return t();throw new Error("Circuit breaker is OPEN - service temporarily unavailable")}this.state=mn.HALF_OPEN,this.halfOpenCalls=0,await this.saveToStorage()}if(this.state===mn.HALF_OPEN){if(this.halfOpenCalls>=this.options.halfOpenMaxCalls)throw new Error("Circuit breaker HALF_OPEN call limit exceeded");this.halfOpenCalls+=1,await this.saveToStorage()}try{const t=await e();return await this.onSuccess(),t}catch(e){throw await this.onFailure(e),e}}async onSuccess(){this.state===mn.HALF_OPEN&&(this.state=mn.CLOSED,this.failures=[],await this.saveToStorage())}async onFailure(e){const t=Date.now();this.lastFailureTime=t,this.failures.push({timestamp:t,error:e.message}),this.failures=this.failures.filter(e=>t-e.timestamp<=this.options.monitoringWindow),this.failures.length>=this.options.failureThreshold&&(this.state=mn.OPEN),await this.saveToStorage()}shouldAttemptRecovery(){return Date.now()-this.lastFailureTime>=this.options.recoveryTimeout}getState(){return this.state}getFailureCount(){const e=Date.now();return this.failures.filter(t=>e-t.timestamp<=this.options.monitoringWindow).length}async reset(){this.state=mn.CLOSED,this.failures=[],this.lastFailureTime=0,this.halfOpenCalls=0,await this.saveToStorage()}async clearStorage(){"undefined"!=typeof chrome&&chrome.storage&&chrome.storage.local?await chrome.storage.local.remove(this.storageKey):"undefined"!=typeof localStorage&&localStorage.removeItem(this.storageKey)}getStatus(){return{state:this.state,failureCount:this.getFailureCount(),nextAttemptTime:this.state===mn.OPEN?this.lastFailureTime+this.options.recoveryTimeout:null}}}const bn="https://cdn.givefreely.com/adunit/behavioral/";class Tn{constructor(e){this.partnerApiKey=e,this.partnerConfig=null,this.globalConfig=null,this.mergedConfig=null,this.globalConfigRefreshInterval=60,this.partnerConfigRefreshInterval=60,this.eventEmitter=new dn,this.isInitialized=!1,this.partnerCircuitBreaker=new yn({failureThreshold:3,recoveryTimeout:6e4,monitoringWindow:3e5,storageKey:`gf_partner_circuit_breaker_${e}`}),this.globalCircuitBreaker=new yn({failureThreshold:3,recoveryTimeout:6e4,monitoringWindow:3e5,storageKey:"gf_global_circuit_breaker"})}async initialize(){this.isInitialized||(await Promise.all([this.partnerCircuitBreaker.initialize(),this.globalCircuitBreaker.initialize()]),this.isInitialized=!0)}ensureInitialized(){if(!this.isInitialized)throw new Error("GiveFreelyConfigService must be initialized before use. Call initialize() or use create() method.")}getRetryOptions(){return{delayFn:e=>1e3*e,maxAttempts:3}}async fetchPartnerConfig(){const e=await Fi(async()=>{const e=await fetch(`${bn}${this.partnerApiKey}.json`,{cache:"no-store"});if(!e.ok)throw new Error(`Failed to fetch partner config: ${e.statusText}`);return e.json()},this.getRetryOptions());if(!e)throw new Error("Failed to fetch or get from cache partner config");return this.partnerConfigRefreshInterval=e.configRefreshInterval||this.partnerConfigRefreshInterval,e}async fetchGlobalConfig(){const e=await Fi(async()=>{const e=await fetch(`${bn}global.json`,{cache:"no-store"});if(!e.ok)throw new Error(`Failed to fetch global config => Status code: ${e.status} .${e.statusText}`);return e.json()},this.getRetryOptions());if(!e)throw new Error("Failed to fetch or get from cache global config",e);return this.globalConfigRefreshInterval=e.configRefreshInterval||this.globalConfigRefreshInterval,e}async getCachedConfig(){return this.mergedConfig}async getConfig(e=!1){this.ensureInitialized();let t=!1;e&&(t=await cn());const[r,i]=await Promise.all([await un.get(qi,this.fetchPartnerConfig.bind(this),this.partnerConfigRefreshInterval,t),await un.get(zi,this.fetchGlobalConfig.bind(this),this.globalConfigRefreshInterval,t)]);if(!i.content)throw new Error("Global config is required");if(!r.content)throw new Error("Partner config is required");this.partnerConfig=r.content,this.globalConfig=i.content;const n=this.mergeConfigs(JSON.parse(JSON.stringify(this.globalConfig)),JSON.parse(JSON.stringify(this.partnerConfig)));if(!n)throw new Error("Was not able to merge configs");return((e,t,r)=>{const i=[...t.merchantExclusions??[],...r.merchantExclusions??[]];e.merchantExclusions=i})(n,this.globalConfig,this.partnerConfig),this.emitConfigChanges(n),n}async clearCache(){this.ensureInitialized(),await Promise.all([un.clear(qi),un.clear(zi)]),this.partnerConfig=null,this.globalConfig=null,this.mergedConfig=null,this.eventEmitter.clear(),await Promise.all([this.partnerCircuitBreaker.reset(),this.globalCircuitBreaker.reset()])}getCircuitBreakerStatus(){return this.ensureInitialized(),{partner:this.partnerCircuitBreaker.getStatus(),global:this.globalCircuitBreaker.getStatus()}}mergeConfigs(e,t){if(!t)return e;if(!e)return t;const r={...e};return Object.keys(t).forEach(i=>{if(!Object.prototype.hasOwnProperty.call(t,i))return;const n=e[i],o=t[i];void 0!==o&&(Array.isArray(o)?r[i]=[...o]:r[i]=null===o||"object"!=typeof o||null===n||"object"!=typeof n?o:this.mergeConfigs(n,o))}),r}on(e,t){return this.eventEmitter.on(e,t)}once(e,t){return this.eventEmitter.once(e,t)}off(e,t){this.eventEmitter.off(e,t)}emitConfigChanges(e){if(!this.mergedConfig)return this.mergedConfig=e,void this.eventEmitter.emit({path:"root",oldValue:null,newValue:e,config:e});const t=gn(this.mergedConfig,e);for(const r of t)this.eventEmitter.emit({path:r.path,oldValue:r.oldValue,newValue:r.newValue,config:e});this.mergedConfig=e}}class _n{constructor(e,t,r,i=60){this.track=async(e,t,r,i=!1,n=!1)=>{const o={partner:`adUnit_${this._partnerApiKey}`,eventType:e,eventData:{userId:i?void 0:this._userService?.user?.id,libVersion:ln(),wfDeviceId:t,...r}};try{const e=JSON.stringify(o,(e,t)=>t instanceof Error?{name:t.name,message:t.message,stack:t.stack}:t),t=await this.getEventsUrl();return t?await this.BroadcastEvent(t,e,o,n):(this._logger.info("Cant broadcast event. eventsUrl cant be retrieved from config",o,!0),!1)}catch(e){return this._logger.error("Something unexpected happened when dispatching a gf event",{error:e,event:o},!0),!1}},this.getEventsHistory=async()=>{const e=await an.get(Zi),t=(e=>{const t=new Date;return t.setTime(t.getTime()+60*e*1e3),t.getTime()})(-this._debounceWindowInMinutes),r=(e||[]).filter(e=>e.createdAt>t);return await an.set(Zi,r),r},this.shouldBroadcastEvent=async(e,t)=>!!t||!(await this.getEventsHistory()).some(t=>t.payload===e),this.pushEventToHistory=async e=>{const t=await this.getEventsHistory();t.push({createdAt:Date.now(),payload:e}),await an.set(Zi,t)},this._partnerApiKey=e,this._userService=t,this._debounceWindowInMinutes=i,this._logger=Ui.getInstance({title:"Analytics"}),this._configService=r}async BroadcastEvent(e,t,r,i){if(await this.shouldBroadcastEvent(t,i)){const i=await fetch(e,{headers:{"Content-Type":"application/json"},method:"POST",body:t,cache:"no-store"});return i.ok?(await this.pushEventToHistory(t),!0):(this._logger.error("Something unexpected happened when dispatching an event",{status:i.status,statusText:i.statusText,event:r},!0),!1)}return this._logger.info("This event has already been broadcasted during the past hour",r,!0),!1}async getEventsUrl(){const e=await this._configService.getCachedConfig();return e?.eventsUrl}}_n.trackEvent=async(e,t,r=!1,i=!1)=>{await async function(e){return await $i.runtime.sendMessage(e)}({type:Hi.TRACK_EVENT,payload:{eventType:e,eventData:t,anonymous:r,skipThrottling:i}})};class An{constructor(e,t){this.lastCheck=null,this.trackEvent=e,this.logger=t}async initialize(){const e=await an.get(Vi);e&&(this.lastCheck=e)}getToday(){return(new Date).toISOString().split("T")[0]}async check(){try{const e=this.lastCheck??0,t=this.getToday();(e?new Date(e).toISOString().split("T")[0]:null)!==t&&(this.lastCheck=Date.now(),await an.set(Vi,this.lastCheck),await this.trackEvent(Di.checkoutPopupHealthCheck,{language:Pi.i18n.getUILanguage()}))}catch(e){this.logger.error("Health check failed",{error:e instanceof Error?e.message:"Unknown error"},!0)}}}var vn;!function(e){e[e.Pending=0]="Pending",e[e.Ready=1]="Ready",e[e.Received=2]="Received",e[e.Donated=3]="Donated",e[e.Disqualified=4]="Disqualified"}(vn||(vn={}));class wn{constructor(e,t,r){this.adUnitId=e,this.config=t,this.logger=r}async getAnonymousUserCommissions(e,t){try{const r=new URLSearchParams(t).toString(),i=await fetch(`${this.config.apiConfig.baseUri}/${this.config.apiConfig.getAnonymousUserComissionsPath}?${r}`,{method:"GET",headers:{"Content-Type":"application/json","X-AnonymousUserToken":e}});if(!i.ok)throw new Error(`Failed to fetch commissions. Status code: ${i.status} .${i.statusText}`);return await i.json()}catch(e){throw this.logger.error("[GiveFreelyApiClient] Error fetching anonymous user's commissions:",{error:e}),e}}async createOrUpdateAnonymousUser(e,t){try{const r=await fetch(`${this.config.apiConfig.baseUri}/${this.config.apiConfig.createAnonymousUserPath}?adUnitId=${this.adUnitId}`,{method:"PUT",headers:{"Content-Type":"application/json","X-GF-Platform":"adUnitLibrary","X-AnonymousUserToken":t??""},body:JSON.stringify(e)});if(!r.ok)throw this.logger.error(`Failed to create/update anonymous user. Status code: ${r.status}. ${r.statusText}`),new Error(`Failed to create/update anonymous user. Status code: ${r.status}. ${r.statusText}`);this.logger.info("[GiveFreelyApiClient] anonymous user created/updated successfully.");const i=await r.json(),n=r.headers.get("X-AnonymousUserToken");return{resultUser:{...i,charity:{ein:i.selectedCharity,thirdPartyId:i.selectedCharityThirdPartyIdentifier,name:void 0}},resultToken:n}}catch(e){throw this.logger.error("[GiveFreelyApiClient] Error creating anonymous user:",{error:e},!0),e}}}class En{constructor(e,t){this._giveFreelyApiClient=e,this._logger=t,this.user=null}async resetUser(){await an.remove(Ji),await an.remove(Xi)}async upsertUser(e,t){let r=await this.fetchUser();try{const i={selectedCharity:e?.ein,selectedCharityThirdPartyIdentifier:e?.thirdPartyId,deviceId:t};if(!await this.shouldCreateOrUpdateUser(r,i))return r;const n=await an.get(Ji),{resultUser:o,resultToken:s}=await this._giveFreelyApiClient.createOrUpdateAnonymousUser(i,n);s&&await an.set(Ji,s),o&&(await an.set(Xi,o),r=o)}catch(e){this._logger.error("Error creating/updating anonymous user:",e)}return this.user=r,r}async fetchUser(){const e=await an.get(Xi);return this.user=e,e}async shouldCreateOrUpdateUser(e,t){return!e||e.charity?.ein!==t.selectedCharity||e.charity?.thirdPartyId!==t.selectedCharityThirdPartyIdentifier||e.deviceId!==t.deviceId}}class Sn{constructor(e,t,r,i,n){this.wfSecret=e,this.wfAppId=t,this.deviceUrl=r,this.dataUrl=i,this._logger=n}async getWildfireDevice(){try{const e=await fetch(this.deviceUrl,{method:"POST",body:JSON.stringify({}),headers:{"Content-Type":"application/json","WF-Secret":this.wfSecret,"WF-App-ID":this.wfAppId}});if(e.ok)return e.json();throw new Error(`Failed to fetch Wildfire device from ${this.deviceUrl}. Status ${e.status}. ${e.statusText}`)}catch(e){throw this._logger.error("Failed to fetch the Wildfire device",{err:e}),e}}async getActiveDomains(){try{const e=`${this.dataUrl}/${this.wfAppId}/active-domain/1`,t=await fetch(e);if(t.ok)return t.json();throw new Error(`Failed to fetch active domains from ${e}. Status ${t.status}. ${t.statusText}`)}catch(e){throw this._logger.error("Failed to fetch the active domains",{err:e}),e}}async getStanddownPolicy(){const e=`${this.dataUrl}/${this.wfAppId}/stand-down-policy/1`;try{const t=await fetch(e);if(t.ok)return t.json();throw new Error(`Failed to fetch standdown policy from ${e}. Status ${t.status}. ${t.statusText}`)}catch(t){throw this._logger.error("Failed to fetch the standdown policy",{err:t,url:e}),t}}async getMerchantRates(){const e=`${this.dataUrl}/${this.wfAppId}/merchant-rate/1`;try{const t=await fetch(e);if(this._logger.debug("Merchant rates response",{response:t}),!t.ok)throw new Error(`Failed to fetch merchant rates from ${e}. Status ${t.status}. ${t.statusText}`);const r=t.json();return this._logger.debug("Merchant rates",{rates:r}),r}catch(t){throw this._logger.error("Failed to fetch the merchant rates",{err:t,url:e}),t}}}async function In(e,t,r){try{const i=(await On())?.[t];if(i&&i>Date.now())return e.info("Standing down because current affiliate stand down session has not expired"),kn(t),!0;await this.refreshCache();const n=await this.getStanddownPolicy();if(Ln(n,new URL(r).search))return e.info("Standing down because url has affiliate params"),kn(t),!0;e.info("No need to stand down.")}catch(t){e.error("Exception produced when trying to determine if it should stand down",t)}return!1}function Nn(e,t){if(!this.standDownPolicy)return this.logger.warn("Couldnt check affilliation. No stand down policy found"),this.getStanddownPolicy().then(e=>{this.standDownPolicy=e}),!1;const r=e.some(e=>Cn(this.standDownPolicy,e))||Ln(this.standDownPolicy,t);return this.logger.info("Affilliation result:",r),r}const On=async()=>an.get(rn),kn=async(e,t=1)=>{const r=await On()??{};r[e]=Date.now()+60*t*60*1e3,await an.set(rn,r)},Cn=(e,t)=>{if(!t)return!1;const{Domains:r}=e;return r.some(e=>t.includes(e))},Ln=(e,t)=>{if(!t)return!1;const{Params:r}=e;return r.some(e=>t.toLowerCase().includes(`?${e.toLowerCase()}`))||r.some(e=>t.toLowerCase().includes(`&${e.toLowerCase()}`))};class Dn{constructor(e,t,r,i){this.userId=e,this.charityEin=t,this.charityThirdPartyIdentifier=r,this.partnerId=i}toString(){return`userId=${this.encodeUserId(this.userId)},charityEin=${this.charityEin},charityThirdPartyIdentifier=${this.charityThirdPartyIdentifier},partnerId=${this.partnerId}`}encodeUserId(e){return btoa(e).replace(/_/g,"/").replace(/-/g,"+")}}class Rn{constructor(e,t,r,i=21600){if(this.standDownPolicy=null,this.shouldStandDown=In.bind(this),this.hasAffilliation=Nn.bind(this),!e||!r)throw new Error("WildfireService requires wildfireClient and vanityBaseUrl");this.wildfireClient=e,this.vanityBaseUrl=r.replace(/\/$/,""),this.refreshInterval=i,this.logger=t}async getActiveDomains(e=!1){try{const t=(await un.get(en,async()=>this.fetchActiveDomains(),this.refreshInterval,e)).content;if(!t)throw Error("Failed to retrieve active domains");return t}catch(e){throw this.logger.error("Failed to get active domains:",e),new Error("Failed to retrieve active domains")}}async getMerchantRates(e,t=!1){try{const r=await un.get(nn,async()=>this.fetchMerchantRates(),this.refreshInterval,t);if(!r.content)throw new Error("Failed to retrieve merchant rates from cache");return r.content[e]}catch(e){throw this.logger.error("Failed to retrieve merchant rates:",e),new Error("Failed to retrieve merchant rates")}}async generateAffiliateUrl(e,t,r,i){if(!e||!t||!i)throw new Error("Missing required parameters for affiliate URL generation");try{const n=await this.getDevice(),o=await this.generateTrackingCode(r,i,n),s=encodeURIComponent(t),a=encodeURIComponent(o);return`${this.vanityBaseUrl}/e?d=${n.DeviceID}&c=${e.ID}&tc=${a}&url=${s}`}catch(e){throw this.logger.error("Failed to generate affiliate URL:",e),new Error("Failed to generate affiliate URL")}}async clearCache(){try{await Promise.all([un.clear(en),un.clear(tn),un.clear(nn)])}catch(e){throw this.logger.error("Failed to clear cache:",e),new Error("Failed to clear cache")}}async clearDevice(){try{await an.remove(Qi),this.logger.info("Cleared wildfire device ID")}catch(e){throw this.logger.error("Failed to clear wildfire device:",e),new Error("Failed to clear wildfire device")}}async refreshCache(e=!1){try{const[,t]=await Promise.all([un.refresh(en,()=>this.fetchActiveDomains(),this.refreshInterval,e),un.refresh(tn,()=>this.fetchStanddownPolicy(),this.refreshInterval,e),un.refresh(nn,()=>this.fetchMerchantRates(),this.refreshInterval,e)]);t?.content&&(this.standDownPolicy=t.content)}catch(e){throw this.logger.error("Failed to refresh cache:",e),new Error("Failed to refresh cache")}}async getStanddownPolicy(){try{const e=await un.get(tn,async()=>this.fetchStanddownPolicy(),this.refreshInterval);if(!e.content)throw new Error("Failed to retrieve standdown policy from cache");return this.logger.info("Retrieved standdown policy from cache",e.content),this.standDownPolicy=e.content,this.standDownPolicy}catch(e){throw this.logger.error("Failed to get standdown policy from cache:",e),new Error("Failed to retrieve standdown policy")}}getRetryOptions(e){return{delayFn:e=>1e3*e,maxAttempts:3,logger:this.logger,operationName:e}}async getDevice(){try{const e=await an.get(Qi);return e?.DeviceID?e:Fi(()=>this.fetchAndStoreDevice(),this.getRetryOptions("Get Device"))}catch(e){throw this.logger.error("Failed to get device:",e),new Error("Failed to retrieve device information")}}async fetchAndStoreDevice(){const e=await this.wildfireClient.getWildfireDevice();if(!e?.DeviceID)throw new Error("Failed to retrieve device information");return await an.set(Qi,e),e}async generateTrackingCode(e,t,r){if(!(e?.id&&e?.charity&&e?.charity.ein&&e?.charity.thirdPartyId)){const e=`notregistered-${r.DeviceID}`;return this.logger.info("User not provided. Using GF's default bucket instead.",e),e}return new Dn(e.id,e.charity.ein,e.charity.thirdPartyId,t).toString()}async fetchActiveDomains(){const e=await Fi(()=>this.wildfireClient.getActiveDomains(),this.getRetryOptions("Fetch Active Domains"));return this.logger.info("Updated active domains"),e}async fetchStanddownPolicy(){const e=await Fi(()=>this.wildfireClient.getStanddownPolicy(),this.getRetryOptions("Get Standdown policy"),{Domains:[],LostAttribution:[],Params:[],Serp:[]});return this.logger.info("Updated standdown policy"),e}async fetchMerchantRates(){const e=await Fi(()=>this.wildfireClient.getMerchantRates(),this.getRetryOptions("Fetch Merchant Rates"),{});return this.logger.debug("Updated Merchant rates"),e}static async createWildfireService(e,t){e.debug("Initializing wildfire service with config",t);const r=new Sn(t.wfSecret,t.wfAppId,t.deviceUrl,t.dataUrl,e),i=new Rn(r,e,t.vanityBaseUrl,t.refreshInterval),n=await cn();return await i.refreshCache(n),i}}const Pn=e=>{try{return new URL(e),!0}catch{return!1}},xn=new Set,Gn=new Set,Bn={urls:["<all_urls>"],types:["main_frame"]};class Un extends Error{constructor(e="Service not initialized"){super(e),this.name="UninitializedServiceError"}}const Mn=e=>{if(!e)throw new Un};class jn{static register(e,t){this.strategies.set(e,t)}static get(e){return this.strategies.get(e)}static exists(e){return!!function(e){return"object"==typeof e&&null!==e&&"type"in e&&"payload"in e&&"string"==typeof e.type}(e)&&this.knownMessageTypes.has(e.type)}}jn.strategies=new Map,jn.knownMessageTypes=new Set([...Object.values(Hi)]);const Fn=async(e,t)=>{Mn(e.isInitialized());const r=jn.get(t.type);if(!r)return;const i={giveFreelyService:e};return r.handle(t,i)};class $n{async handle(e,t){const{activeDomain:r,originalUrl:i,selectedCharity:n}=e.payload,{giveFreelyService:o}=t,s=o.getLogger();s.debug("Activating offer",{activeDomain:r,selectedCharity:n});try{if(!n?.ein||!n?.thirdPartyId)throw new Error("Missing charity information");const e=await o.initializeWfDeviceId();if(!e)throw new Error("Failed to initialize Wildfire device ID");const t=await o.upsertUser(n,e);s.debug("Upserted user",{currentUser:t}),t||s.info("Failed to create user. Using default bucket's user");const a=await o.generateAffiliateUrl(r,i,t);return s.debug("Generated affiliate URL",{affiliateUrl:a}),(async e=>{const t=$i.tabs.getCurrent(),r=await t,i=await $i.tabs.create({url:e,openerTabId:r?.id,active:!1,pinned:!0});await(async e=>new Promise(t=>{$i.tabs.onUpdated.addListener(async function r(i,n){if(i===e&&"complete"===n.status){if($i.tabs.onUpdated.removeListener(r),!(await $i.tabs.get(e)).url)return void t(!1);t(!0)}})}))(i.id)&&setTimeout(()=>{i?.id&&$i.tabs.remove(i.id)},3e4)})(a),await o.updateStanddownHistory(r.Domain),s.debug("Activated offer",{activeDomain:r,selectedCharity:n}),{type:Hi.ACTIVATE_OFFER,payload:{response:!0}}}catch(e){return s.error("Error activating offer",{activeDomain:r,error:e}),o.trackEvent(Di.checkoutPopupFailedActivation,{activeDomain:r,error:e}),{type:Hi.ACTIVATE_OFFER,payload:{response:!1}}}}}class Hn{async handle(e,t){const{shopId:r}=e.payload,{giveFreelyService:i}=t,n=i.getLogger();try{const e=Wi,t=(await an.get(e)||[]).find(e=>e.shopId===r);return t?(n.debug("Found domain for shop ID",{shopId:r,domain:t.domain}),{type:Hi.GET_DOMAIN_BY_SHOP_ID,payload:{found:!0,domain:t.domain,shopInfo:t}}):(n.debug("No domain found for shop ID",{shopId:r}),{type:Hi.GET_DOMAIN_BY_SHOP_ID,payload:{found:!1}})}catch(e){return n.error("Error getting domain for shop ID",{shopId:r,error:e}),{type:Hi.GET_DOMAIN_BY_SHOP_ID,payload:{found:!1}}}}}class Wn{async handle(e,t){const{lang:r}=e.payload,{giveFreelyService:i}=t,n=i.getLogger();n.debug("Getting language strings",{lang:r});try{const e=await i.getLanguage(r);return n.debug("Language strings fetched",{language:e}),{type:Hi.GET_LANGUAGE_CONTENT,payload:{translations:e.translations,charities:e.charities}}}catch(e){return n.error("Error getting language strings",{error:e}),{type:Hi.GET_LANGUAGE_CONTENT,payload:{translations:null,charities:null}}}}}class Vn{async handle(e,t){const{giveFreelyService:r}=t,i=r.getLogger(),n=await r.getCachedConfig();try{return i.debug("Fetching popup config"),{type:Hi.GET_POPUP_CONFIG,payload:{config:n}}}catch(e){return i.error("Error fetching popup config",{error:e}),{type:Hi.GET_POPUP_CONFIG,payload:{config:null}}}}}class qn{async handle(e,t){const{days:r}=e.payload,{giveFreelyService:i}=t,n=i.getLogger();try{const e=new Date;return e.setDate(e.getDate()+r),await an.set("popup_hide",{popupHide:e.getTime()}),n.debug("Popup hidden",{days:r,expiry:e}),{type:Hi.HIDE_POPUP,payload:{ack:!0}}}catch(e){return n.error("Error hiding popup",{days:r,error:e}),{type:Hi.HIDE_POPUP,payload:{ack:!1}}}}}class zn{async handle(e,t){const{hostname:r}=e.payload,{giveFreelyService:i}=t,n=i.getLogger(),o=await i.getConfig().merchantExclusions,s=await i.getActiveDomains();n.debug("Checking hostname",{hostname:r});try{if(i.healthCheck(),o.some(e=>e.disableDomain&&(r===e.domain||r.endsWith(`.${e.domain}`))))return n.debug("Hostname is in merchant exclusions",{hostname:r}),{type:Hi.IS_ACTIVE_DOMAIN,payload:{isActive:!1,domain:void 0,rates:[]}};if(!s||0===s.length)throw new Error("No active domains");n.debug("Retrieved active domains",{count:s.length});const e=s.find(e=>r===e.Domain||r.endsWith(`.${e.Domain}`));n.debug("Domain check result",{hostname:r,isActive:!!e});let t=[];if(e?.ID){const r=await i.getMerchantRates(e.Merchant.ID);r&&(n.debug("Retrieved merchant rates",{merchantRates:r}),t=r)}return{type:Hi.IS_ACTIVE_DOMAIN,payload:{isActive:!!e,domain:e,rates:t}}}catch(e){return n.error("Error checking domain",{hostname:r,error:e}),{type:Hi.IS_ACTIVE_DOMAIN,payload:{isActive:!1,domain:void 0,rates:[]}}}}}class Kn{async handle(e,t){const r=e.payload,{giveFreelyService:i}=t,n=i.getLogger();try{const e=Wi,t=await an.get(e)||[],i=t.findIndex(e=>e.shopId===r.shopId);return i>=0?t[i]=r:t.push(r),await an.set(e,t),n.debug("Stored Shopify shop ID",{shopInfo:r}),{type:Hi.STORE_SHOPIFY_SHOP_ID,payload:{success:!0}}}catch(e){return n.error("Error storing Shopify shop ID",{shopInfo:r,error:e}),{type:Hi.STORE_SHOPIFY_SHOP_ID,payload:{success:!1}}}}}class Yn{async handle(e,t){const{activeDomain:r,url:i}=e.payload,{giveFreelyService:n}=t,o=n.getLogger();o.debug("Checking if we should stand down",{activeDomain:r});try{const e=await n.shouldStandDown(r,i);return{type:Hi.SHOULD_STAND_DOWN,payload:{result:e}}}catch(e){return o.error("Error checking if we should stand down. Returning false",{activeDomain:r,error:e}),{type:Hi.SHOULD_STAND_DOWN,payload:{result:!1}}}}}class Xn{async handle(e,t){const{eventType:r,eventData:i,anonymous:n,skipThrottling:o}=e.payload,{giveFreelyService:s}=t,a=s.getLogger();a.debug("Broadcasting event",{eventType:r,eventData:i,anonymous:n,skipThrottling:o});try{const e=await s.trackEvent(r,i,n,o);return{type:Hi.TRACK_EVENT,payload:{result:e}}}catch(e){return a.error("Error broadcasting event. Returning false",{eventType:r,eventData:i,error:e}),{type:Hi.TRACK_EVENT,payload:{result:!1}}}}}const Jn=Ui.getInstance(),Zn="https://cdn.givefreely.com/adunit/language",Qn=async(e,t,r,i,n=[],o=!1)=>{const s=(n??[]).includes(r)?on:r;e.debug(`Requested lang ${r} and current lang ${s}`);const a=`lang-${on}`,l=await un.get(a,async()=>(e.debug(`Fetching default language ${on} for partner ${t}`),eo(t,on)),i||60,o);if(!l.content)throw new Error(`Failed to fetch default language ${on} and no cache version available`);if(on===s)return l.content;const c=`lang-${s}`,h=await un.get(c,async()=>(e.debug(`Fetching language ${s} for partner ${t}`),eo(t,s)),i||60,o);if(!h.content)return l.content;const u=io(l.content,h.content);return await un.set(c,u,i||60),u},eo=async(e,t)=>{const r=`/global-${t}.json`,i=`/${e}/${t}.json`,[n,o]=await Promise.allSettled([to(`${Zn}${r}`),to(`${Zn}${i}`)]);let s,a;"fulfilled"===n.status&&(s=n.value),"fulfilled"===o.status&&(a=o.value);const l=ro(s,a);return{translations:l.translations,charities:l.charities}},to=async e=>{const t=await fetch(e,{cache:"no-store"});if(!t.ok)throw new Error(`Failed to fetch partner language file ${e}. Status: ${t.status}. Reason: ${t.statusText}`);return t.json()},ro=(e,t)=>({translations:{...e?.translations??{},...t??{}},charities:{...e?.charities??{}}}),io=(e,t)=>({translations:{...e.translations,...t.translations},charities:{...e.charities,...t.charities}});async function no(e=async()=>(this.logger.debug("Using default partnerFilter."),!0)){if(!this.state.initialized){this.logger.info("Starting initialization with mutex protection");try{await this.dependencies.configService.initialize();const t=await this.dependencies.configService.getConfig(!0);this.logger.configure({enabled:t.loggingEnabled??!0,minLevel:t.backgroundMinLogLevel??"error"}),this.logger.info("Initializing GiveFreelyService",{partnerApiKey:this.partnerApiKey});const r=await Rn.createWildfireService(this.logger,t);this.state.healthCheck=new An(this.trackEvent.bind(this),this.logger),await this.state.healthCheck.initialize();const i=new wn(this.partnerApiKey,t,this.logger);this.state.giveFreelyUserService=new En(i,this.logger),await this.state.giveFreelyUserService.fetchUser(),this.state.giveFreelyUserService.user?.id||await this.state.giveFreelyUserService.upsertUser(),this.state.analytics=new _n(this.partnerApiKey,this.state.giveFreelyUserService,this.dependencies.configService);try{const e=await an.get(Qi);e?.DeviceID?(this.state.wfDeviceId=e,this.logger.info("Loaded existing wfDeviceId from storage",{deviceId:e.DeviceID})):this.logger.debug("No existing wfDeviceId found in storage - will be created on first offer activation")}catch(e){this.logger.debug("Could not check for existing wfDeviceId in storage",e)}jn.register(Hi.IS_ACTIVE_DOMAIN,new zn),jn.register(Hi.GET_POPUP_CONFIG,new Vn),jn.register(Hi.HIDE_POPUP,new qn),jn.register(Hi.SHOULD_STAND_DOWN,new Yn),jn.register(Hi.TRACK_EVENT,new Xn),jn.register(Hi.ACTIVATE_OFFER,new $n),jn.register(Hi.STORE_SHOPIFY_SHOP_ID,new Kn),jn.register(Hi.GET_DOMAIN_BY_SHOP_ID,new Hn),jn.register(Hi.GET_LANGUAGE_CONTENT,new Wn),await(async e=>{try{await(async()=>await an.get(Ki)||(async()=>{Jn.debug("detecting country");const e={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Basic OTEzOTkxOnFlYmpaWF9DOGNRY0lxSHA4WTVjNGxzU1pRSlM2VW9MMExzTF9tbWs="}};try{const t=await fetch("https://geoip.maxmind.com/geoip/v2.1/country/me",e);if(Jn.debug("Received geolocation response",{status:t.status}),!t.ok)return void Jn.error("Failed to get geolocation data",{status:t.status,statusText:t.statusText});const r=await t.json();if(!r)throw new Error("There was an error fetching geoip look up");return await an.set(Ki,r.country.iso_code),r.country.iso_code}catch(e){return void Jn.error("Failed to get geolocation data",{error:e},!0)}})())()}catch(t){e.debug("Failed to get geolocation data",{error:t})}})(this.logger),await(async(e,t,r)=>{t.purgeLanguages&&t.purgeLanguages.length>0&&await Promise.all(t.purgeLanguages.flatMap(e=>[un.clear(`lang-${e}`),un.clear(`global-${e}`)])),Fi(async()=>{e.debug("Initializing default language with partner API key",{partnerApiKey:r}),await Qn(e,r,on,t.configRefreshInterval)})})(this.logger,t,this.partnerApiKey),this.state=((e,t)=>{const{wildfireService:r,partnerFilter:i,config:n}=t;return{...e,initialized:!0,wildfireService:r,partnerFilter:i,config:n}})(this.state,{wildfireService:r,partnerFilter:e,config:t}),this.logger.addTransport(new Gi(this)),this.cleanupListeners=(e=>{let t;if(Pi.webRequest){const r=(e=>{const t=e.getLogger();return({requestId:r,url:i,initiator:n})=>{try{if(xn.has(r)||Gn.has(r)||!Pn(i))return;const{hostname:o,search:s}=new URL(i);if(o.includes("wild.link"))return t.info("Cashback activation request identified, ignoring affiliate check for request"),void Gn.add(r);let a;n&&Pn(n)&&(a=new URL(n).hostname),(e.hasAffiliation([o,a],s)||e.isCustomStandownMatch([i,n]))&&(t.info("Affiliation found or custom standown match on url, adding request id to track"),xn.add(r))}catch(e){t.error("Error on handleAffiliateOnBeforeRequest",e)}}})(e);Pi.webRequest.onBeforeRequest.addListener(r,Bn);const i=(e=>{const t=e.getLogger();return async({requestId:r,redirectUrl:i})=>{try{if(!xn.has(r))return;t.info("Attempting to find active domain");const{hostname:n}=new URL(i),o=(await e.getActiveDomains()).find(e=>n===e.Domain||n.endsWith(`.${e.Domain}`));if(!o)return;t.info("Found active domain. Updating standdown state"),await kn(o.Domain)}catch(e){t.error("Error on handleAffiliateOnBeforeRedirect",e)}}})(e);Pi.webRequest.onBeforeRedirect.addListener(i,Bn);const n=(e=>{const t=e.getLogger();return({requestId:e})=>{try{xn.has(e)&&(t.info("Tracking request completed. Request Id:",e),xn.delete(e))}catch(e){t.error("Error on handleAffiliateOnCompleted",e)}}})(e);Pi.webRequest.onCompleted.addListener(n,Bn),t=()=>{Pi.webRequest.onBeforeRequest.removeListener(r),Pi.webRequest.onBeforeRedirect.removeListener(i),Pi.webRequest.onCompleted.removeListener(n)}}const r=function(){const t=Ui.getInstance(),r=(r,i,n)=>{const o=(async t=>(e.getLogger().debug("Received message",{type:t.type,payload:t.payload}),Fn(e,t)))(r);return o instanceof Promise?(o.then(e=>{e&&function(e){n(e)}(e)}).catch(e=>{t.warn("Async message callback error:",e)}),!0):!0===o||void 0};return $i.runtime.onMessage.addListener(r),r}();return function(){t&&t(),Pi.runtime.onMessage.removeListener(r)}})(this),so.call(this),this.logger.info("GiveFreelyService initialized successfully")}catch(e){const t=e instanceof Error?e.message:"Unknown error";throw this.logger.error("Failed to initialize GiveFreelyService",{error:t}),new Error(`Failed to initialize GiveFreelyService: ${t}`)}}}function oo(){return this.state.initialized}function so(){this.onConfigChange("wfAppId",async e=>{this.logger.info(`Wildfire App ID changed from ${e.oldValue} to ${e.newValue} - clearing device`),await ao.call(this)}),this.onConfigChange("wfSecret",async e=>{this.logger.info("Wildfire Secret changed - clearing device"),await ao.call(this)})}async function ao(){try{this.state.wildfireService&&(await this.state.wildfireService.clearDevice(),this.state.wfDeviceId=null,this.logger.info("Wildfire device cleared due to config change"))}catch(e){this.logger.error("Failed to clear wildfire device:",e)}}var lo={config:Object.freeze({__proto__:null,getCachedConfig:async function(){return Mn(this.state.initialized),this.state.config=await this.dependencies.configService.getConfig(),this.logger.configure({minLevel:this.state.config.backgroundMinLogLevel??"error"}),this.state.config},getConfig:function(){return Mn(this.state.initialized),this.state.config},offConfigChange:function(e,t){Mn(this.state.initialized),this.dependencies.configService.off(e,t)},onConfigChange:function(e,t){return Mn(this.state.initialized),this.dependencies.configService.on(e,t)},onceConfigChange:function(e,t){return Mn(this.state.initialized),this.dependencies.configService.once(e,t)}}),merchants:Object.freeze({__proto__:null,generateAffiliateUrl:async function(e,t,r){return Mn(this.state.initialized),this.state.wildfireService.generateAffiliateUrl(e,t,r,this.state.partnerApiKey)},getActiveDomains:async function(){return Mn(this.state.initialized),this.state.wildfireService.getActiveDomains()},getMerchantRates:async function(e){if(Mn(this.state.initialized),!this.state.wildfireService)throw new Error("Wildfire service not initialized");return this.state.wildfireService.getMerchantRates(e)}}),observability:Object.freeze({__proto__:null,getLogger:function(){return Mn(this.state.initialized),this.logger},healthCheck:async function(){Mn(this.state.initialized),await this.state.healthCheck.check()},trackEvent:function(e,t,r=!1,i=!1){return Mn(this.state.initialized),this.state.analytics.track(e,this.state.wfDeviceId?.DeviceID,t,r,i)}}),standdown:Object.freeze({__proto__:null,hasAffiliation:function(e,t){if(!this.state.wildfireService)return this.logger.warn("Wildfire service not initialized yet"),!1;const r=this.state.wildfireService.hasAffilliation(e,t);return r&&this.logger.info("WF Affiliation identified"),r},isCustomStandownMatch:function(e){const t=e.some(e=>this.getConfig().customStandownPolicy?.urlRegex?.some(t=>!!e&&function(e,t){return new RegExp(t).test(e)}(e,t)));return t&&this.logger.info("Custom Standown identified"),t},shouldStandDown:async function(e,t){Mn(this.state.initialized);const r=new URL(t);if(!await this.state.partnerFilter(r.hostname))return this.logger.info("Should standdown due to partner filter."),!0;if(this.getConfig().merchantExclusions.some(t=>t.mutePopups&&e===t.domain))return this.logger.info("Should standdown due to merchant exclusions"),!0;const i=await this.state.wildfireService.shouldStandDown(this.logger,e,t);return i&&this.logger.info("Should standdown due to vendor policy"),i},updateStanddownHistory:function(e){return Mn(this.state.initialized),kn(e)}}),identity:Object.freeze({__proto__:null,getCurrentUser:function(){return Mn(this.state.initialized),this.state.giveFreelyUserService.user},getLanguage:async function(e){return Mn(this.state.initialized),Qn(this.logger,this.state.partnerApiKey,e,this.state.config?.configRefreshInterval,this.state.config?.ignoredLanguages)},initializeWfDeviceId:async function(){if(Mn(this.state.initialized),this.state.wfDeviceId=await this.state.wildfireService.getDevice(),!this.state.wfDeviceId)throw new Error("Failed to initialize Wildfire device ID");return this.state.wfDeviceId.DeviceID},upsertUser:function(e,t){return Mn(this.state.initialized),this.state.giveFreelyUserService.upsertUser(e,t)}})};class co{constructor(e){this.partnerApiKey=e,this.cleanupListeners=null,this.initialize=no.bind(this),this.isInitialized=oo.bind(this),this.getConfig=lo.config.getConfig.bind(this),this.getCachedConfig=lo.config.getCachedConfig.bind(this),this.onConfigChange=lo.config.onConfigChange.bind(this),this.onceConfigChange=lo.config.onceConfigChange.bind(this),this.offConfigChange=lo.config.offConfigChange.bind(this),this.getLogger=lo.observability.getLogger.bind(this),this.healthCheck=lo.observability.healthCheck.bind(this),this.trackEvent=lo.observability.trackEvent.bind(this),this.initializeWfDeviceId=lo.identity.initializeWfDeviceId.bind(this),this.upsertUser=lo.identity.upsertUser.bind(this),this.getCurrentUser=lo.identity.getCurrentUser.bind(this),this.getLanguage=lo.identity.getLanguage.bind(this),this.getActiveDomains=lo.merchants.getActiveDomains.bind(this),this.generateAffiliateUrl=lo.merchants.generateAffiliateUrl.bind(this),this.getMerchantRates=lo.merchants.getMerchantRates.bind(this),this.shouldStandDown=lo.standdown.shouldStandDown.bind(this),this.updateStanddownHistory=lo.standdown.updateStanddownHistory.bind(this),this.hasAffiliation=lo.standdown.hasAffiliation.bind(this),this.isCustomStandownMatch=lo.standdown.isCustomStandownMatch.bind(this),this.dependencies={configService:new Tn(e)},this.logger=Ui.getInstance(),this.logger.configure({enabled:!0,title:"Background - GiveFreelyService"}),this.state=(e=>({initialized:!1,wildfireService:null,partnerFilter:null,config:null,wfDeviceId:null,analytics:null,giveFreelyUserService:null,partnerApiKey:e,healthCheck:null}))(e)}async destroy(){var e;this.logger.info("Destroying GiveFreelyService"),await Promise.all([this.dependencies.configService.clearCache(),this.state.wildfireService?.clearCache(),this.state.giveFreelyUserService?.resetUser()]),this.cleanupListeners&&(this.cleanupListeners(),this.logger.info("Event listeners cleared."),this.cleanupListeners=null),this.state=(e=this.state,{...e,initialized:!1,wildfireService:null,partnerFilter:null,analytics:null,config:null})}}class ho{constructor(e){this.partnerApiKey=e,this.initialize=e=>this._adUnitService.initialize(e),this.destroy=()=>this._adUnitService.destroy(),this._adUnitService=new co(e)}}const uo=e=>{var t;return null===(t=null==e?void 0:e.url)||void 0===t?void 0:t.includes(k.BACKEND_URL)},go=e=>{var t;return null===(t=null==e?void 0:e.url)||void 0===t?void 0:t.includes(k.BACKEND_URL_FALLBACK)},fo=e=>"net::ERR_FAILED"===(null==e?void 0:e.error),po=[k.BACKEND_URL,k.BACKEND_URL_FALLBACK].map(e=>`${e}/*`);var mo,yo;chrome.runtime.onInstalled.addListener(e=>{chrome.runtime.setUninstallURL(Math.random()<.95?Ai.uninstallURL:Ai.uninstallSurveyURL)}),function(){chrome.contextMenus.onClicked.addListener(e=>function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((i=i.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){chrome.tabs.query({active:!0,currentWindow:!0},t=>{e.menuItemId,jt[e.menuItemId]&&A.sendMessage({id:e.menuItemId,detail:e})})}))}(),chrome.action.onClicked.addListener(e=>{e.url&&function(e){return e&&"string"==typeof e&&!(null==e||!e.length)&&fr(e)&&!ur(e)}(e.url)&&Si(e.url),A.sendMessage({id:"browserActionClicked"})}),"undefined"!=typeof chrome&&(null===(yo=null===(mo=null===chrome||void 0===chrome?void 0:chrome.runtime)||void 0===mo?void 0:mo.onMessage)||void 0===yo||yo.addListener((e,t,r)=>{if(!Ai.featureIsEnabled.givefreely||!(e=>jn.exists(e))(e)){if(Ft(e,"navigateToPdfViewer")&&Si(e.detail),Ft(e,"navigateToReader")&&Ii(function(e){const t=typeof window<"u"&&!Ut()&&!(typeof window>"u")&&window.location.href.startsWith("http://localhost")?`${window.location.origin}/reader.html`:mr("reader.html");return e.url?`${t}?${Kt}=${encodeURIComponent(e.url)}`:t}(e.detail),{newTab:!1}),Ft(e,"navigateToFromBackground")&&"string"==typeof e.detail&&Ii(e.detail),Ft(e,"backgroundIndexDbQuery")){const t=e.detail;v(vi,t)&&vi[t.method](t.payload).catch(console.error)}if(Ft(e,"setBadge")){const{text:t,backgroundColor:r,textColor:i}=e.detail;"string"==typeof t&&"string"==typeof r&&chrome.tabs.query({currentWindow:!0,active:!0},function(e){var n;const o=null===(n=e[0])||void 0===n?void 0:n.id;o&&(chrome.action.setBadgeText({text:t,tabId:o}),i&&chrome.action.setBadgeTextColor({color:i,tabId:o}),r&&chrome.action.setBadgeBackgroundColor({color:r,tabId:o}))})}r()}}),chrome.runtime.onConnect.addListener(e=>{!function(e){const{name:t}=e;if(function(e){return"string"==typeof e&&Object.values(_).includes(e)}(t))return void function(e,t){e===_.COMMANDS&&chrome.commands.getAll().then(e=>{t.postMessage(e.filter(e=>!!e.description).map(e=>Object.assign(Object.assign({},e),{shortcut:e.shortcut||T})))})}(t,e);const r=function(e){try{return JSON.parse(e)}catch{return null}}(t);v(vi,r)&&vi[r.method](r.payload).then(t=>{e.postMessage(t)})}(e)}),chrome.runtime.onInstalled.addListener(e=>function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((i=i.apply(e,t||[])).next())})}(void 0,void 0,void 0,function*(){if("install"===e.reason){chrome.tabs.query({url:["http://*/*","https://*/*","file://*/*"]},e=>{e.forEach(e=>{if(e.id)try{chrome.scripting.executeScript({target:{tabId:e.id},files:["content-loader.js"]})}catch(t){console.error(`Error loading content-loader.js in tab ${e.id}: ${t}`)}})});const e=m.extensionId===chrome.runtime.id||m.extensionIdDev===chrome.runtime.id?"https://web-highlights.com/extensions/reader-mode/welcome":y.extensionId===chrome.runtime.id||y.extensionIdDev===chrome.runtime.id?"https://web-highlights.com/extensions/youtube-highlighter/welcome":"https://web-highlights.com/extensions/pdf-web-highlighter/welcome";chrome.tabs.create({url:`${e}?ref=install`,active:!0})}Ei()}))),chrome.tabs.onActivated.addListener(e=>{chrome.tabs.query({currentWindow:!0,active:!0},function(e){Ni(e[0])})}),chrome.tabs.onUpdated.addListener(function(e,t,r){Ei(),Ni(r)}),chrome.commands.onCommand.addListener(e=>{A.sendMessage({id:"keyboardShortcut",detail:e})}),function(){!function(e,t,r,i){new(r||(r=Promise))(function(n,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((i=i.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){if("undefined"==typeof chrome||!("webRequest"in chrome))return;let e=!0,t=!0;chrome.webRequest.onErrorOccurred.addListener(function(r){uo(r)&&fo(r)&&(e=!1),go(r)&&fo(r)&&(t=!1),e||t||A.sendMessage({id:"allServersAreOffline"})},{urls:po}),chrome.webRequest.onCompleted.addListener(function(r){let i=!e&&!t;uo(r)&&(e=!0),go(r)&&(t=!0),i&&(e||t)&&A.sendMessage({id:"serversAreBackOnline"})},{urls:po})})}(),function(){!function(e,t,r,i){new(r||(r=Promise))(function(n,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}l((i=i.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{if(!Ai.featureIsEnabled.givefreely)return;const e=new ho("webhighlightsprod");yield e.initialize()}catch(e){console.error(`initGivefreelyBackground failed: ${String(e)}`)}})}()})(),{}})());